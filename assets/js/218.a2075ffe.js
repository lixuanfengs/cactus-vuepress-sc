(window.webpackJsonp=window.webpackJsonp||[]).push([[218],{570:function(s,a,t){"use strict";t.r(a);var e=t(0),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"一、基本概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、基本概念"}},[s._v("#")]),s._v(" 一、基本概念")]),s._v(" "),a("h2",{attrs:{id:"_1、docker架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、docker架构"}},[s._v("#")]),s._v(" 1、Docker架构")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/docker-1.png",alt:""}}),s._v("\nK8S：CRI（Container Runtime Interface）\nClient： 客户端；操作docker服务器的客户端（命令行或者界面） Docker_Host：Docker主机；安装Docker服务的主机Docker_Daemon：后台进程；运行在Docker服务器的后台进程\nContainers：容器；在Docker服务器中的容器（一个容器一般是一个应用实例，容器间互相隔离）\nImages：镜像、映像、程序包；Image是只读模板，其中包含创建Docker容器的说明。容器是由Image运行而来，Image固定不变。\nRegistries：仓库；存储Docker Image的地方。官方远程仓库地址： https://hub.docker.com/search")]),s._v(" "),a("blockquote",[a("p",[s._v("Docker用Go编程语言编写，并利用Linux内核的多种功能来交付其功能。 Docker使用一种称为名称空间的技术来提供容器的隔离工作区。 运行容器时，Docker会为该容器创建一组名称空间。 这些名称空间提供了一层隔离。 容器的每个方面都在单独的名称空间中运行，并且对其的访问仅限于该名称空间。")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[a("strong",[s._v("Docker")])]),s._v(" "),a("th",[a("strong",[s._v("面向对象")])])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("镜像（Image）")]),s._v(" "),a("td",[s._v("类")])]),s._v(" "),a("tr",[a("td",[s._v("容器（Container）")]),s._v(" "),a("td",[s._v("对象（实例）")])])])]),s._v(" "),a("p",[a("strong",[s._v("容器与虚拟机")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/docker-2.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_2、docker隔离原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、docker隔离原理"}},[s._v("#")]),s._v(" 2、Docker隔离原理")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("namespace 6项隔离 （资源隔离）")])])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[a("strong",[s._v("namespace")])]),s._v(" "),a("th",[a("strong",[s._v("系统调用参数")])]),s._v(" "),a("th",[a("strong",[s._v("隔离内容")])])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("UTS")]),s._v(" "),a("td",[s._v("CLONE_NEWUTS")]),s._v(" "),a("td",[s._v("主机和域名")])]),s._v(" "),a("tr",[a("td",[s._v("IPC")]),s._v(" "),a("td",[s._v("CLONE_NEWIPC")]),s._v(" "),a("td",[s._v("信号量、消息队列和共享内存")])]),s._v(" "),a("tr",[a("td",[s._v("PID")]),s._v(" "),a("td",[s._v("CLONE_NEWPID")]),s._v(" "),a("td",[s._v("进程编号")])]),s._v(" "),a("tr",[a("td",[s._v("Network")]),s._v(" "),a("td",[s._v("CLONE_NEWNET")]),s._v(" "),a("td",[s._v("网络设备、网络栈、端口等")])]),s._v(" "),a("tr",[a("td",[s._v("Mount")]),s._v(" "),a("td",[s._v("CLONE_NEWNS")]),s._v(" "),a("td",[s._v("挂载点(文件系统)")])]),s._v(" "),a("tr",[a("td",[s._v("User")]),s._v(" "),a("td",[s._v("CLONE_NEWUSER")]),s._v(" "),a("td",[s._v("用户和用户组")])])])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("cgroups资源限制 （资源限制）")])])]),s._v(" "),a("p",[s._v("cgroup提供的主要功能如下：")]),s._v(" "),a("ol",[a("li",[s._v("资源限制：限制任务使用的资源总额，并在超过这个配额时发出提示")]),s._v(" "),a("li",[s._v("优先级分配：分配CPU时间片数量及磁盘IO带宽大小、控制任务运行的优先级资源统计：统计系统资源使用量，如CPU使用时长、内存用量等")]),s._v(" "),a("li",[s._v("任务控制：对任务执行挂起、恢复等操作")])]),s._v(" "),a("blockquote",[a("p",[s._v("cgroup资源控制系统，每种子系统独立地控制一种资源。功能如下")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[a("strong",[s._v("子系统")])]),s._v(" "),a("th",[a("strong",[s._v("功能")])])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("cpu")]),s._v(" "),a("td",[s._v("使用调度程序控制任务对CPU的使用。")])]),s._v(" "),a("tr",[a("td",[s._v("cpuacct(CPU Accounting)")]),s._v(" "),a("td",[s._v("自动生成cgroup中任务对CPU资源使用情况的报告。")])]),s._v(" "),a("tr",[a("td",[s._v("cpuset")]),s._v(" "),a("td",[s._v("为cgroup中的任务分配独立的CPU(多处理器系统时)和内存。")])]),s._v(" "),a("tr",[a("td",[s._v("devices")]),s._v(" "),a("td",[s._v("开启或关闭cgroup中任务对设备的访问")])]),s._v(" "),a("tr",[a("td",[s._v("freezer")]),s._v(" "),a("td",[s._v("挂起或恢复cgroup中的任务")])]),s._v(" "),a("tr",[a("td",[s._v("memory")]),s._v(" "),a("td",[s._v("设定cgroup中任务对内存使用量的限定，并生成这些任务对内存资源使用情况的报告")])]),s._v(" "),a("tr",[a("td",[s._v("perf_event(Linux CPU性能探测器)")]),s._v(" "),a("td",[s._v("使cgroup中的任务可以进行统一的性能测试")])]),s._v(" "),a("tr",[a("td",[s._v("net_cls(Docker未使用)")]),s._v(" "),a("td",[s._v("通过等级识别符标记网络数据包，从而允许Linux流量监控程序(Traffic Controller)识别从具体cgroup中生成的数据包")])])])]),s._v(" "),a("h2",{attrs:{id:"_3、docker安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、docker安装"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3、Docker安装")])]),s._v(" "),a("blockquote",[a("p",[s._v("以下以centos为例；")]),s._v(" "),a("p",[s._v("更多其他安装方式，详细参照文档： "),a("a",{attrs:{href:"https://docs.docker.com/engine/install/centos/",target:"_blank",rel:"noopener noreferrer"}},[a("strong",[s._v("https://docs.docker.com/engine/install/centos/")]),a("OutboundLink")],1)])]),s._v(" "),a("h3",{attrs:{id:"_1、移除旧版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、移除旧版本"}},[s._v("#")]),s._v(" 1、移除旧版本")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum remove docker*\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_2、设置docker-yum源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、设置docker-yum源"}},[s._v("#")]),s._v(" 2、设置docker yum源")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" yum-utils\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum-config-manager "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--add-repo "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\nhttps://download.docker.com/linux/centos/docker-ce.repo\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#此处可以百度 docker yum aliyun 切换为ali的yum源")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"_3、安装最新docker-engine"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、安装最新docker-engine"}},[s._v("#")]),s._v(" 3、安装最新docker engine")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce docker-ce-cli containerd.io\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_4、安装指定版本docker-engine"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、安装指定版本docker-engine"}},[s._v("#")]),s._v(" 4、安装指定版本docker engine")]),s._v(" "),a("h4",{attrs:{id:"_1、在线安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、在线安装"}},[s._v("#")]),s._v(" 1、在线安装")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#找到所有可用docker版本列表")]),s._v("\nyum list docker-ce "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--showduplicates")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装指定版本，用上面的版本号替换<VERSION_STRING>")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("VERSION_STRING"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(".x86_64 docker-ce-cli-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("VERSION_STRING"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(".x86_64 containerd.io \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#例如：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#yum install docker-ce-3:20.10.5-3.el7.x86_64 docker-ce-cli-3:20.10.5- 3.el7.x86_64 containerd.io")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意加上 .x86_64 大版本号")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"_2、离线安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、离线安装"}},[s._v("#")]),s._v(" 2、离线安装")]),s._v(" "),a("p",[s._v("https://download.docker.com/linux/centos/7/x86_64/stable/Packages/")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ivh")]),s._v(" xxx.rpm\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可以下载 tar解压启动即可")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("https://docs.docker.com/engine/install/binaries/#install-daemon-and-client-binaries-on-linux")]),s._v(" "),a("h4",{attrs:{id:"_5、启动服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、启动服务"}},[s._v("#")]),s._v(" 5、启动服务")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl start "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"_6、镜像加速"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、镜像加速"}},[s._v("#")]),s._v(" 6、镜像加速")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /etc/docker\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/docker/daemon.json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<-")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'EOF'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://82m9ar63.mirror.aliyuncs.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" EOF\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart docke\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#以后docker下载直接从阿里云拉取相关镜像")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("blockquote",[a("p",[s._v("/etc/docker/daemon.json 是Docker的核心配置文件。")])]),s._v(" "),a("h4",{attrs:{id:"_7、可视化界面-portainer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7、可视化界面-portainer"}},[s._v("#")]),s._v(" 7、可视化界面-Portainer")]),s._v(" "),a("h5",{attrs:{id:"_1、什么是portainer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、什么是portainer"}},[s._v("#")]),s._v(" 1、什么是Portainer")]),s._v(" "),a("p",[s._v("https://documentation.portainer.io/")]),s._v(" "),a("p",[s._v("Portainer社区版2.0拥有超过50万的普通用户，是功能强大的开源工具集，可让您轻松地在Docker， Swarm，Kubernetes和Azure ACI中构建和管理容器。 Portainer的工作原理是在易于使用的GUI后面隐藏使管理容器变得困难的复杂性。通过消除用户使用CLI，编写YAML或理解清单的需求，Portainer使部署 应用程序和解决问题变得如此简单，任何人都可以做到。 Portainer开发团队在这里为您的Docker之旅提供帮助；")]),s._v(" "),a("h5",{attrs:{id:"_2、安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、安装"}},[s._v("#")]),s._v(" 2、安装")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务端部署")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v(":8000 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000")]),s._v(":9000 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("portainer "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v("\n/var/run/docker.sock:/var/run/docker.sock "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" portainer_data:/data portainer/portainer-ce\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问 9000 端口即可")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#agent端部署")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9001")]),s._v(":9001 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" portainer_agent "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v("\n/var/run/docker.sock:/var/run/docker.sock "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v("\n/var/lib/docker/volumes:/var/lib/docker/volumes portainer/agent\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);