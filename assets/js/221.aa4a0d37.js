(window.webpackJsonp=window.webpackJsonp||[]).push([[221],{574:function(s,t,a){"use strict";a.r(t);var n=a(0),r=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"四、深入dockerfile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四、深入dockerfile"}},[s._v("#")]),s._v(" 四、深入Dockerfile")]),s._v(" "),t("p",[s._v("Dockerfile由一行行命令语句组成，并且支持以#开头的注释行。基础的小linux系统。jdk；一般而言，Dockerfile可以分为四部分。")]),s._v(" "),t("ul",[t("li",[t("font",{attrs:{color:"#FF7F50"}},[s._v("基础镜像信息 ")])],1),s._v(" "),t("li",[t("font",{attrs:{color:"#FF7F50"}},[s._v("维护者信息")])],1),s._v(" "),t("li",[t("font",{attrs:{color:"#FF7F50"}},[s._v("镜像操作指令 ")])],1),s._v(" "),t("li",[t("font",{attrs:{color:"#FF7F50"}},[s._v("  启动时执行指令")])],1)]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[t("strong",[s._v("指令")])]),s._v(" "),t("th",[t("strong",[s._v("说明")])])])]),s._v(" "),t("tbody",[t("tr",[t("td",[t("strong",[s._v("FROM")])]),s._v(" "),t("td",[s._v("指定基础镜像")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("MAINTAINER")])]),s._v(" "),t("td",[s._v("指定维护者信息，已经过时，可以使用LABEL maintainer=xxx 来替代")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("RUN")])]),s._v(" "),t("td",[s._v("运行命令 v")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("CMD")])]),s._v(" "),t("td",[s._v("指定启动容器时默认的命令 v")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("ENTRYPOINT")])]),s._v(" "),t("td",[s._v("指定镜像的默认入口.运行命令 v")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("EXPOSE")])]),s._v(" "),t("td",[s._v("声明镜像内服务监听的端口 v")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("ENV")])]),s._v(" "),t("td",[s._v("指定环境变量，可以在docker run的时候使用-e改变 v；会被固化到image的config里面")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("ADD")])]),s._v(" "),t("td",[s._v("复制指定的src路径下的内容到容器中的dest路径下，src可以为url会自动下载， 可以为tar文件，会自动解压")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("COPY")])]),s._v(" "),t("td",[s._v("复制本地主机的src路径下的内容到镜像中的dest路径下，但不会自动解压等")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("LABEL")])]),s._v(" "),t("td",[s._v("指定生成镜像的元数据标签信息")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("VOLUME")])]),s._v(" "),t("td",[s._v("创建数据卷挂载点")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("USER")])]),s._v(" "),t("td",[s._v("指定运行容器时的用户名或UID")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("WORKDIR")])]),s._v(" "),t("td",[s._v("配置工作目录，为后续的RUN、CMD、ENTRYPOINT指令配置工作目录")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("ARG")])]),s._v(" "),t("td",[s._v("指定镜像内使用的参数（如版本号信息等），可以在build的时候，使用--build- args改变 v")])]),s._v(" "),t("tr",[t("td",[s._v("OBBUILD")]),s._v(" "),t("td",[s._v("配置当创建的镜像作为其他镜像的基础镜像是，所指定的创建操作指令")])]),s._v(" "),t("tr",[t("td",[s._v("STOPSIGNAL")]),s._v(" "),t("td",[s._v("容器退出的信号值")])]),s._v(" "),t("tr",[t("td",[s._v("HEALTHCHECK")]),s._v(" "),t("td",[s._v("健康检查")])]),s._v(" "),t("tr",[t("td",[s._v("SHELL")]),s._v(" "),t("td",[s._v("指定使用shell时的默认shell类型")])])])]),s._v(" "),t("h2",{attrs:{id:"_1、from"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、from"}},[s._v("#")]),s._v(" 1、FROM")]),s._v(" "),t("p",[s._v("FROM 指定基础镜像，最好挑一些apline，slim之类的基础小镜像。")]),s._v(" "),t("p",[s._v("scratch镜像是一个空镜像，常用于多阶段构建。\n如何确定我需要什么要的基础镜像？\nJava应用当然是java基础镜像（SpringBoot应用）或者Tomcat基础镜像（War应用）")]),s._v(" "),t("p",[s._v("​        JS模块化应用一般用nodejs基础镜像")]),s._v(" "),t("p",[s._v("​       其他各种语言用自己的服务器或者基础环境镜像，如python、golang、java、php等")]),s._v(" "),t("h2",{attrs:{id:"_2、label"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、label"}},[s._v("#")]),s._v(" 2、LABEL")]),s._v(" "),t("p",[s._v("标注镜像的一些说明信息。")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" multi.label1="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value1"')]),s._v(" multi.label2="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value2"')]),s._v(" other="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value3"')])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" multi.label1="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\nmulti.label2="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value2"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\nother="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value3"')])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"_3、run"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、run"}},[s._v("#")]),s._v(" 3、RUN")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("RUN指令在当前镜像层顶部的新层执行任何命令，并提交结果，生成新的镜像层。")])]),s._v(" "),t("li",[t("strong",[s._v("生成的提交映像将用于Dockerfile中的下一步。 分层运行RUN指令并生成提交符合Docker的核心概念，就像源代码控制一样。")])]),s._v(" "),t("li",[t("strong",[s._v("exec形式可以避免破坏shell字符串，并使用不包含指定shell可执行文件的基本映像运行RUN命令。可以使用SHELL命令更改shell形式的默认shell。 在shell形式中，您可以使用\\（反斜杠）将一条RUN指令继续到下一行。")])])]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" </font><command> ( shell 形式, /bin/sh -c 的方式运行，避免破坏shell字符串)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"executable"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param1"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param2"')]),s._v("]( exec 形式)")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" /bin/bash -c "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'source $HOME/.bashrc; \\ echo $HOME'")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#上面等于下面这种写法")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" /bin/bash -c "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'source $HOME/.bashrc; echo $HOME'")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/bash"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo hello"')]),s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试案例")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" alpine")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" maintainer=cactusli xx=aa")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" msg="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hello cactus'")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$msg")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$msg"')]),s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" /bin/sh -c "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'echo $msg'")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo $msg"')]),s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" sleep 10000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#总结； 由于[]不是shell形式，所以不能输出变量信息，而是输出$msg。其他任何/bin/sh -c 的形式都可以输出变量信息")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("总结：什么是shell和exec形式")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". shell 是  /bin/sh "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("command"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("的方式，\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v(",command"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 的方式"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" shell方式\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#也就是exec 默认方式不会进行变量替换")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"_4、cmd和entrypoint"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、cmd和entrypoint"}},[s._v("#")]),s._v(" 4、CMD和ENTRYPOINT")]),s._v(" "),t("h3",{attrs:{id:"_0、都可以作为容器启动入口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_0、都可以作为容器启动入口"}},[s._v("#")]),s._v(" 0、都可以作为容器启动入口")]),s._v(" "),t("p",[t("strong",[s._v("CMD 的三种写法：")])]),s._v(" "),t("ul",[t("li",[t("font",{attrs:{color:"#32CD332"}},[s._v('CMD ["executable","param1","param2"] ( exec 方式, 首选方式)')])],1),s._v(" "),t("li",[t("font",{attrs:{color:"#32CD332"}},[s._v('CMD ["param1","param2"] (为ENTRYPOINT提供默认参数)')])],1),s._v(" "),t("li",[t("font",{attrs:{color:"#32CD332"}},[s._v("CMD command param1 param2 ( shell 形式)")])],1)]),s._v(" "),t("p",[t("strong",[s._v("ENTRYPOINT的两种写法：")])]),s._v(" "),t("ul",[t("li",[t("font",{attrs:{color:"#32CD332"}},[s._v('ENTRYPOINT ["executable", "param1", "param2"] ( exec 方式, 首选方式)')])],1),s._v(" "),t("li",[t("font",{attrs:{color:"#32CD332"}},[s._v("ENTRYPOINT command param1 param2 (shell 形式)")])],1)]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一个示例")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" alpine")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" maintainer=cactusli")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1111"')]),s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2222"')]),s._v("] ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo"')]),s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#构建出如上镜像后测试")]),s._v("\ndocker run xxxx：#效果 echo 2222\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h3",{attrs:{id:"_1、只能有一个cmd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、只能有一个cmd"}},[s._v("#")]),s._v(" 1、只能有一个CMD")]),s._v(" "),t("p",[t("strong",[s._v("Dockerfile中只能有一条CMD指令。 如果您列出多个CMD，则只有最后一个CMD才会生效。")]),s._v(" "),t("strong",[s._v("CMD的主要目的是为执行中的容器提供默认值。 这些默认值可以包含可执行文件，也可以省略可执行文件，在这种情况下，您还必须指定ENTRYPOINT指令。")])]),s._v(" "),t("h3",{attrs:{id:"_2、cmd为entrypoint提供默认参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、cmd为entrypoint提供默认参数"}},[s._v("#")]),s._v(" 2、CMD为ENTRYPOINT提供默认参数")]),s._v(" "),t("p",[t("strong",[s._v("如果使用CMD为ENTRYPOINT指令提供默认参数，则CMD和ENTRYPOINT指令均应使用JSON数组格 式指定。")])]),s._v(" "),t("h3",{attrs:{id:"_3、组合最终效果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、组合最终效果"}},[s._v("#")]),s._v(" 3、组合最终效果")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th"),s._v(" "),t("th",[t("strong",[s._v("无ENTRYPOINT")])]),s._v(" "),t("th",[t("strong",[s._v("ENTRYPOINTexec_entryp1_entry")])]),s._v(" "),t("th",[t("strong",[s._v("ENTRYPOINT[“exec_entry”,“p1_entry”]")])])])]),s._v(" "),t("tbody",[t("tr",[t("td",[t("strong",[s._v("无CMD")])]),s._v(" "),t("td",[s._v("错误*,* 不允许的写法 ；容器没有启动命令")]),s._v(" "),t("td",[s._v("/bin/sh -c exec_entry p1_entry")]),s._v(" "),t("td",[s._v("exec_entry p1_entry")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("CMD[“exec_cmd”,“p1_cmd”]")])]),s._v(" "),t("td",[s._v("exec_cmd p1_cmd")]),s._v(" "),t("td",[s._v("/bin/sh -c exec_entry p1_entry")]),s._v(" "),t("td",[s._v("exec_entry p1_entry exec_cmd p1_cmd")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("CMD[“p1_cmd”,“p2_cmd”]")])]),s._v(" "),t("td",[s._v("p1_cmd p2_cmd")]),s._v(" "),t("td",[s._v("/bin/sh -c exec_entry p1_entry")]),s._v(" "),t("td",[s._v("exec_entry p1_entry p1_cmd p2_cmd")])])])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[t("strong",[s._v("CMD exec_cmd p1_cmd")])]),s._v(" "),t("th",[s._v("/bin/sh -c exec_cmd无ENTRYPOINT p1_cmd")]),s._v(" "),t("th",[t("strong",[s._v("ENTRYPOINTexec_entryp1_entry")])]),s._v(" "),t("th",[t("strong",[s._v("ENTRYPOINT[“exec_entry”,“p1_entry”]")])]),s._v(" "),t("th")])]),s._v(" "),t("tbody",[t("tr",[t("td"),s._v(" "),t("td"),s._v(" "),t("td",[s._v("这条竖线，总是以ENTRYPOINT的为准")]),s._v(" "),t("td",[s._v("这条竖线，ENTRYPOINT 和CMD共同作用")]),s._v(" "),t("td")])])]),s._v(" "),t("h3",{attrs:{id:"_4、docker-run启动参数会覆盖cmd内容"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、docker-run启动参数会覆盖cmd内容"}},[s._v("#")]),s._v(" 4、docker run启动参数会覆盖CMD内容")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一个示例")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" alpine")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" maintainer=cactusli")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1111"')]),s._v("] ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo"')]),s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#构建出如上镜像后测试")]),s._v("\ndocker run xxxx：#什么都不传则 echo 1111 \ndocker run xxx arg1：#传入arg1 则echo arg1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h2",{attrs:{id:"_5、arg和env"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、arg和env"}},[s._v("#")]),s._v(" 5、ARG和ENV")]),s._v(" "),t("h3",{attrs:{id:"_1、arg"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、arg"}},[s._v("#")]),s._v(" 1、ARG")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("ARG指令定义了一个变量，用户可以在构建时使用--build-arg = 传递，docker build命令会将其传递给构建器。")])]),s._v(" "),t("li",[t("strong",[s._v("--build-arg 指定参数会覆盖Dockerfile 中指定的同名参数")])]),s._v(" "),t("li",[t("strong",[s._v("如果用户指定了 未在Dockerfile中定义的构建参数 ，则构建会输出 警告 。")])]),s._v(" "),t("li",[t("strong",[s._v("ARG只在构建期有效，运行期无效")])]),s._v(" "),t("li",[t("strong",[s._v("不建议使用构建时变量来传递诸如github密钥，用户凭据等机密。因为构建时变量值使用docker history是可见的。")])]),s._v(" "),t("li",[t("strong",[s._v("ARG变量定义从Dockerfile中定义的行开始生效。")])]),s._v(" "),t("li",[t("strong",[s._v("使用ENV指令定义的环境变量始终会覆盖同名的ARG指令。")])])]),s._v(" "),t("h3",{attrs:{id:"_2、env"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、env"}},[s._v("#")]),s._v(" 2、ENV")]),s._v(" "),t("p",[t("strong",[s._v("在构建阶段中所有后续指令的环境中使用，并且在许多情况下也可以内联替换。")])]),s._v(" "),t("p",[t("strong",[s._v("引号和反斜杠可用于在值中包含空格。")])]),s._v(" "),t("p",[t("strong",[s._v("ENV 可以使用key value的写法，但是这种不建议使用了，后续版本可能会删除")])]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" MY_MSG hello")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" MY_NAME="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"John Doe"')])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" MY_DOG=Rex\\ The\\ Dog")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" MY_CAT=fluffy")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#多行写法如下")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" MY_NAME="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"John Doe"')]),s._v(" MY_DOG=Rex\\ The\\ Dog "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\nMY_CAT=fluffy")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[t("strong",[s._v("docker run --env 可以修改这些值")])]),s._v(" "),t("p",[t("strong",[s._v("容器运行时ENV值可以生效")])]),s._v(" "),t("p",[t("strong",[s._v("ENV在image阶段就会被解析并持久化（docker inspect image查看），参照下面示例。")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("FROM alpine\nENV "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("arg")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111111")]),s._v("\nENV "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("runcmd")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$arg")]),s._v("\nRUN "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$runcmd")]),s._v("\nCMD "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$runcmd")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ENV的固化问题： 改变arg，会不会改变 echo的值，会改变哪些值，如何修改这些值?")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"_3、综合测试示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、综合测试示例"}},[s._v("#")]),s._v(" 3、综合测试示例")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" alpine")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" arg1=22222")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" arg2=1111111")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" runcmd="),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$arg1")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$arg1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$arg2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$runcmd")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" echo "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$arg1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$arg2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$runcmd")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h2",{attrs:{id:"_6、add和copy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6、add和copy"}},[s._v("#")]),s._v(" 6、ADD和COPY")]),s._v(" "),t("h3",{attrs:{id:"_1、copy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、copy"}},[s._v("#")]),s._v(" 1、COPY")]),s._v(" "),t("p",[s._v("COPY的两种写法")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" [--chown=<user>:<group>] <src>... <dest>")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" [--chown=<user>:<group>] ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<src>"')]),s._v(",... "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<dest>"')]),s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("--chown功能仅在用于构建Linux容器的Dockerfiles上受支持，而在Windows容器上不起作用")]),s._v(" "),t("p",[s._v("COPY指令从 "),t("font",{attrs:{color:"#3CB371"}},[s._v("src ")]),s._v("复制新文件或目录，并将它们添加到容器的文件系统中，路径为 "),t("font",{attrs:{color:"#3CB371"}},[s._v("dest")]),s._v(" 。")],1),s._v(" "),t("p",[s._v("可以指定多个 "),t("font",{attrs:{color:"#3CB371"}},[s._v("src")]),s._v(" 资源，但是文件和目录的路径将被解释为相对于构建上下文的源。")],1),s._v(" "),t("p",[s._v("每个都可以包含通配符，并且匹配将使用Go的 "),t("font",{attrs:{color:"#3CB371"}},[s._v("filepath.Match ")]),s._v(" 规则进行。")],1),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" hom* /mydir/ #当前上下文，以home开始的所有资源")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" hom?.txt /mydir/ # ?匹配单个字符")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" test.txt relativeDir/ # 目标路径如果设置为相对路径，则相对与 WORKDIR 开始")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把 “test.txt” 添加到 <WORKDIR>/relativeDir/")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" test.txt /absoluteDir/ #也可以使用绝对路径，复制到容器指定位置")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#所有复制的新文件都是uid(0)/gid(0)的用户，可以使用--chown改变")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token options"}},[t("span",{pre:!0,attrs:{class:"token property"}},[s._v("--chown")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("55:mygroup")])]),s._v(" files* /somedir/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token options"}},[t("span",{pre:!0,attrs:{class:"token property"}},[s._v("--chown")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("bin")])]),s._v(" files* /somedir/ COPY --chown=1 files* /somedir/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token options"}},[t("span",{pre:!0,attrs:{class:"token property"}},[s._v("--chown")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("10:11")])]),s._v(" files* /somedir/")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"_2、add"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、add"}},[s._v("#")]),s._v(" 2、ADD")]),s._v(" "),t("p",[t("strong",[s._v("同COPY用法，不过 ADD拥有自动下载远程文件和解压的功能。")])]),s._v(" "),t("p",[t("strong",[s._v("注意：")])]),s._v(" "),t("ul",[t("li",[s._v("src 路径必须在构建的上下文中； 不能使用"),t("font",{attrs:{color:"#FFA500"}},[s._v(" ../something /something")]),s._v(" 这种方式，因为docker 构建的第一步是将上下文目录（和子目录）发送到docker守护程序。")],1),s._v(" "),t("li",[s._v("如果"),t("font",{attrs:{color:"#FFA500"}},[s._v(" src ")]),s._v("是URL，并且 "),t("font",{attrs:{color:"#FFA500"}},[s._v(" dest  ")]),s._v("不以斜杠结尾，则从URL下载文件并将其复制到 "),t("font",{attrs:{color:"#FFA500"}},[s._v(" dest  ")]),s._v("。\n"),t("ul",[t("li",[s._v("如果 "),t("font",{attrs:{color:"#FFA500"}},[s._v(" dest  ")]),s._v(" 以斜杠结尾，将自动推断出url的名字（保留最后一部分），保存到 "),t("font",{attrs:{color:"#FFA500"}},[s._v(" dest  ")])],1)])],1),s._v(" "),t("li",[s._v("如果 "),t("font",{attrs:{color:"#FFA500"}},[s._v(" src  ")]),s._v("是目录，则将复制目录的整个内容，包括文件系统元数据。")],1)]),s._v(" "),t("h2",{attrs:{id:"_7、workdir和volume"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7、workdir和volume"}},[s._v("#")]),s._v(" 7、WORKDIR和VOLUME")]),s._v(" "),t("h3",{attrs:{id:"_1、workdir"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、workdir"}},[s._v("#")]),s._v(" 1、WORKDIR")]),s._v(" "),t("ul",[t("li",[s._v("WORKDIR指令为Dockerfile中跟随它的所有 "),t("font",{attrs:{color:"#FFA500"}},[s._v(" RUN，CMD，ENTRY000POINT，COPY，ADD ")]),s._v("指令设置工作目录。 如果WORKDIR不存在，即使以后的Dockerfile指令中未使用它也将被创建。")],1),s._v(" "),t("li",[s._v("WORKDIR指令可在Dockerfile中多次使用。 如果提供了相对路径，则它将相对于上一个WORKDIR指令的路径。 例如：")])]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /a")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" b")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" c")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" pwd")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#结果 /a/b/c")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("也可以用到环境变量")])]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" DIRPATH=/path")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DIRPATH")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DIRNAME")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" pwd")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#结果 /path/$DIRNAME")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"_2、volume"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、volume"}},[s._v("#")]),s._v(" 2、VOLUME")]),s._v(" "),t("p",[s._v("作用：把容器的某些文件夹映射到主机外部")]),s._v(" "),t("p",[s._v("写法：")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VOLUME")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/log/"')]),s._v("] #可以是JSON数组")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VOLUME")]),s._v(" /var/log #可以直接写")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VOLUME")]),s._v(" /var/log /var/db #可以空格分割多个")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("注意：\n用 VOLUME 声明了卷，那么以后对于卷内容的修改会被丢弃，所以， "),t("font",{attrs:{color:"#FFA500"}},[s._v("一定在volume声明之前修改内容 ；")])],1),s._v(" "),t("h3",{attrs:{id:"_8、user"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8、user"}},[s._v("#")]),s._v(" 8、USER")]),s._v(" "),t("p",[s._v("写法：")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" <user>[:<group>]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" <UID>[:<GID>]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("USER指令设置运行镜像时要使用的用户名（或UID）以及可选的用户组（或GID），以及Dockerfile 中USER后面所有RUN，CMD和ENTRYPOINT指令。")])]),s._v(" "),t("h3",{attrs:{id:"_9、expose"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9、expose"}},[s._v("#")]),s._v(" 9、EXPOSE")]),s._v(" "),t("ul",[t("li",[s._v("EXPOSE指令通知Docker容器在运行时在指定的网络端口上进行侦听。 可以指定端口是侦听TCP还是UDP，如果未指定协议，则默认值为TCP。")]),s._v(" "),t("li",[s._v("EXPOSE指令实际上不会发布端口。 它充当构建映像的人员和运行容器的人员之间的一种文档，即有关打算发布哪些端口的信息。 要在运行容器时实际发布端口，请在docker run上使用-p标志发布并映射一个或多个端口，或使用-P标志发布所有公开的端口并将其映射到高阶端口。")])]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" <port> [<port>/<protocol>...]\t")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" [80,443]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80/tcp")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80/udp ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"_10、multi-stage-builds"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10、multi-stage-builds"}},[s._v("#")]),s._v(" 10、multi-stage builds")]),s._v(" "),t("p",[t("strong",[s._v("多阶段构建")])]),s._v(" "),t("h4",{attrs:{id:"_1、使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、使用"}},[s._v("#")]),s._v(" 1、使用")]),s._v(" "),t("p",[s._v("https://docs.docker.com/develop/develop-images/multistage-build/\n解决：如何让一个镜像变得更小; 多阶段构建的典型示例")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 我们如何打包一个Java镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" maven ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . .")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mvn clean package")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" /app/target/*.jar /app/app.jar ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" java -jar app.jar")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h4",{attrs:{id:"_2、生产示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、生产示例"}},[s._v("#")]),s._v(" 2、生产示例")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#以下所有前提 保证Dockerfile和项目在同一个文件夹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第一阶段：环境构建; 用这个也可以")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" maven:3.5.0-jdk-8-alpine "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" builder")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" ./ /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mvn clean package -Dmaven.test.skip=true ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第二阶段，最小运行时环境，只需要jre；第二阶段并不会有第一阶段哪些没用的层")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#基础镜像没有 jmap； jdk springboot-actutor（jdk）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" openjdk:8-jre-alpine ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" maintainer="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1183895890@qq.com"')])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从上一个阶段复制内容")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token options"}},[t("span",{pre:!0,attrs:{class:"token property"}},[s._v("--from")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("builder")])]),s._v(" /app/target/*.jar /app.jar ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改时区")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && echo "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Asia/Shanghai'")]),s._v(" >/etc/timezone && touch /app.jar")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" JAVA_OPTS="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" PARAMS="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行jar包")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" [ "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java -Djava.security.egd=file:/dev/./urandom$JAVA_OPTS -jar /app.jar $PARAMS"')]),s._v(" ]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("为了加速下载需要在pom文件中复制如下 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("repositories"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("repository"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("aliyun"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Nexus")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Snapshot")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Repository")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("https"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("maven"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyun"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("repository"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("layout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("layout"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("releases"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("enabled"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("enabled"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("releases"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("snapshots默认是关闭的"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("需要开启 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("snapshots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("enabled"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("enabled"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("snapshots"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("repository"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("repositories"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("pluginRepositories"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("pluginRepository"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("aliyun"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Nexus")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Snapshot")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Repository")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("https"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("maven"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyun"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("repository"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("layout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("layout"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("releases"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("enabled"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("enabled"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("releases"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("snapshots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("enabled"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("enabled"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("snapshots"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pluginRepository"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pluginRepositories"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br")])]),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("######小细节")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && echo "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Asia/Shanghai'")]),s._v(" >/etc/timezone")]),s._v("\n或者\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && echo "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Asia/Shanghai'")]),s._v(" >/etc/timezone")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可以让镜像时间同步。")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 容器同步系统时间 CST（China Shanghai Timezone）")]),s._v("\n-v /etc/localtime:/etc/localtime:ro #已经不同步的如何同步？\ndocker cp /etc/localtime 容器id:/etc/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[t("strong",[s._v('docker build --build-arg url="git address" -t demo:test . ：自动拉代码并构建镜像')])]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" maven:3.6.1-jdk-8-alpine "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" buildapp ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#第二阶段，把克隆到的项目源码拿过来")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token options"}},[t("span",{pre:!0,attrs:{class:"token property"}},[s._v("--from")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("git")])]),s._v(" clone * /app/ ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" pom.xml .")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" src .")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mvn clean package -Dmaven.test.skip=true")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /app 下面有 target ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" pwd && ls -l")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" cp /app/target/*.jar /app.jar ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" ls -l")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 以上第一阶段结束，我们得到了一个 app.jar")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 只要一个JRE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# FROM openjdk:8-jre-alpine ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" openjdk:8u282-slim")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && echo "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Asia/Shanghai'")]),s._v(" >/etc/timezone")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" maintainer="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1183895890@qq.com"')]),s._v(" ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把上一个阶段的东西复制过来")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token options"}},[t("span",{pre:!0,attrs:{class:"token property"}},[s._v("--from")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("buildapp")])]),s._v(" /app.jar /app.jar")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" JAVA_OPTS="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" PARAMS="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" [ "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java -Djava.security.egd=file:/dev/./urandom$JAVA_OPTS -jar /app.jar $PARAMS"')]),s._v(" ]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# docker run -e JAVA_OPTS="-Xmx512m -Xms33 -" -e PARAMS="--spring.profiles=dev --server.port=8080" -jar /app/app.jar # 启动java的命令')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])]),t("p",[s._v("自己 写一个多阶段构建")]),s._v(" "),t("p",[s._v("1、自动从git下载指定的项目")]),s._v(" "),t("p",[s._v("2、把项目自动打包生成镜像")]),s._v(" "),t("p",[s._v("3、我们只需要运行镜像即可")]),s._v(" "),t("h3",{attrs:{id:"_11、images瘦身实践"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_11、images瘦身实践"}},[s._v("#")]),s._v(" 11、Images瘦身实践")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("选择最小的基础镜像")])]),s._v(" "),t("li",[t("p",[s._v("合并RUN环节的所有指令，少生成一些层")])]),s._v(" "),t("li",[t("p",[s._v("RUN期间可能安装其他程序会生成临时缓存，要自行删除。如：")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开发期间，逐层验证正确的")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" xxx ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" xxx ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" aaa \\ ")]),s._v("\naaa  \\ \nvvv \\\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#生产环境")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt-get update && apt-get install -y \\ ")]),s._v("\nbzr \\\ncvs \\ \ngit \\\nmercurial \\ \nsubversion \\\n&& rm -rf /var/lib/apt/lists/*\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("使用 "),t("font",{attrs:{color:"#32CD32"}},[s._v(".dockerignore 文件")]),s._v("，排除上下文中无需参与构建的资源")],1)]),s._v(" "),t("li",[t("p",[s._v("使用多阶段构建")])]),s._v(" "),t("li",[t("p",[s._v("合理使用构建缓存加速构建。[--no-cache]")])])]),s._v(" "),t("p",[s._v("学习更多Dockerfile的写法： "),t("a",{attrs:{href:"https://github.com/docker-library/",target:"_blank",rel:"noopener noreferrer"}},[t("strong",[s._v("https://github.com/docker-library/")]),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"_12、springboot-java-最终写法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_12、springboot-java-最终写法"}},[s._v("#")]),s._v(" 12、springboot java 最终写法")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" openjdk:8-jre-alpine")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" maintainer="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1183895890@qq.com"')])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" target/*.jar /app.jar")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && echo "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Asia/Shanghai'")]),s._v(" >/etc/timezone && touch /app.jar")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" JAVA_OPTS="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" PARAMS="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" [ "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java -Djava.security.egd=file:/dev/./urandom$JAVA_OPTS -jar /app.jar $PARAMS"')]),s._v(" ]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行命令 ")]),s._v('\ndocker run -e JAVA_OPTS="-Xmx512m -Xms33 -" -e PARAMS="-- spring.profiles=dev --server.port=8080" -jar /app/app.jar\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])])])}),[],!1,null,null,null);t.default=r.exports}}]);