(window.webpackJsonp=window.webpackJsonp||[]).push([[290],{641:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("center",[a("h1",[s._v("Kubernetes平台存储系统搭建\n    ")])]),s._v(" "),a("blockquote",[a("p",[s._v("存储系统是个专业性的整个体系，我们只用常见方式搭建，具体优化需要参照公司自己的产品等各种进行调整")])]),s._v(" "),a("h2",{attrs:{id:"一、ceph"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、ceph"}},[s._v("#")]),s._v(" 一、Ceph")]),s._v(" "),a("p",[s._v("https://ceph.io/")]),s._v(" "),a("h3",{attrs:{id:"_1、基本概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、基本概念"}},[s._v("#")]),s._v(" 1、基本概念")]),s._v(" "),a("p",[s._v("Ceph可以有")]),s._v(" "),a("ul",[a("li",[s._v("Ceph对象存储：键值存储，其接口就是简单的GET,PUT,DEL等。如七牛，阿里云oss等")]),s._v(" "),a("li",[s._v("Ceph块设备："),a("strong",[s._v("AWS的EBS")]),s._v("，"),a("strong",[s._v("青云的云硬盘")]),s._v("和"),a("strong",[s._v("阿里云的盘古系统")]),s._v("，还有"),a("strong",[s._v("Ceph的RBD")]),s._v("(RBD是Ceph面向块存储的接口)")]),s._v(" "),a("li",[s._v("Ceph文件系统：它比块存储具有更丰富的接口，需要考虑目录、文件属性等支持，实现一个支持并行化的文件存储应该是最困难的。")])]),s._v(" "),a("p",[s._v("一个Ceph存储集群需要")]),s._v(" "),a("ul",[a("li",[s._v("至少一个Ceph监视器、Ceph管理器、Ceph OSD（对象存储守护程序）")]),s._v(" "),a("li",[s._v("需要运行Ceph文件系统客户端，则需要部署 Ceph Metadata Server。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/37f38700cd784da451becd6718695f086edd0fd2ab5f8e8daf686249096ce7ab-1621584467436.png",alt:"37f38700cd784da451becd6718695f086edd0fd2ab5f8e8daf686249096ce7ab.png"}})]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("Monitors")]),s._v(":  "),a("a",{attrs:{href:"https://docs.ceph.com/en/latest/glossary/#term-Ceph-Monitor",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ceph Monitor"),a("OutboundLink")],1),s._v(" ("),a("code",[s._v("ceph-mon")]),s._v(") 监视器：维护集群状态信息\n"),a("ul",[a("li",[s._v("维护集群状态的映射，包括监视器映射，管理器映射，OSD映射，MDS映射和CRUSH映射。")]),s._v(" "),a("li",[s._v("这些映射是Ceph守护程序相互协调所必需的关键群集状态。")]),s._v(" "),a("li",[s._v("监视器还负责管理守护程序和客户端之间的身份验证。")]),s._v(" "),a("li",[s._v("通常至少需要三个监视器才能实现冗余和高可用性。")])])]),s._v(" "),a("li",[a("strong",[s._v("Managers")]),s._v(": "),a("a",{attrs:{href:"https://docs.ceph.com/en/latest/glossary/#term-Ceph-Manager",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ceph Manager"),a("OutboundLink")],1),s._v(" 守护进程("),a("code",[s._v("ceph-mgr")]),s._v(") : 负责跟踪运行时指标和Ceph集群的当前状态\n"),a("ul",[a("li",[s._v("Ceph Manager守护进程（ceph-mgr）负责跟踪运行时指标和Ceph集群的当前状态")]),s._v(" "),a("li",[s._v("包括存储利用率，当前性能指标和系统负载。")]),s._v(" "),a("li",[s._v("Ceph Manager守护程序还托管基于python的模块，以管理和公开Ceph集群信息，包括基于Web的Ceph Dashboard和REST API。")]),s._v(" "),a("li",[s._v("通常，至少需要两个管理器才能实现高可用性。")])])]),s._v(" "),a("li",[a("strong",[s._v("Ceph OSDs")]),s._v(": "),a("a",{attrs:{href:"https://docs.ceph.com/en/latest/glossary/#term-Ceph-OSD",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ceph OSD"),a("OutboundLink")],1),s._v(" (对象存储守护进程, "),a("code",[s._v("ceph-osd")]),s._v(") 【存储数据】\n"),a("ul",[a("li",[s._v("通过检查其他Ceph OSD守护程序的心跳来存储数据，处理数据复制，恢复，重新平衡，并向Ceph监视器和管理器提供一些监视信息。")]),s._v(" "),a("li",[s._v("通常至少需要3个Ceph OSD才能实现冗余和高可用性。")])])]),s._v(" "),a("li",[a("strong",[s._v("MDSs")]),s._v(": "),a("a",{attrs:{href:"https://docs.ceph.com/en/latest/glossary/#term-Ceph-Metadata-Server",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ceph Metadata Server"),a("OutboundLink")],1),s._v(" (MDS, "),a("code",[s._v("ceph-mds")]),s._v("ceph元数据服务器)\n"),a("ul",[a("li",[s._v("存储能代表 "),a("a",{attrs:{href:"https://docs.ceph.com/en/latest/glossary/#term-Ceph-File-System",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ceph File System"),a("OutboundLink")],1),s._v(" 的元数据(如：Ceph块设备和Ceph对象存储不使用MDS).")]),s._v(" "),a("li",[s._v("Ceph元数据服务器允许POSIX文件系统用户执行基本命令（如ls，find等），而不会给Ceph存储集群带来巨大负担")])])])]),s._v(" "),a("h2",{attrs:{id:"二、rook"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、rook"}},[s._v("#")]),s._v(" 二、Rook")]),s._v(" "),a("h3",{attrs:{id:"_1、基本概念-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、基本概念-2"}},[s._v("#")]),s._v(" 1、基本概念")]),s._v(" "),a("p",[s._v("Rook是云原生平台的存储编排工具")]),s._v(" "),a("p",[s._v("Rook工作原理如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/rook-architecture.png",alt:"Rook Architecture on Kubernetes"}})]),s._v(" "),a("p",[s._v("Rook架构如下")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/kubernetes.png",alt:"Rook Components on Kubernetes"}})]),s._v(" "),a("p",[s._v("RGW：为Restapi Gateway")]),s._v(" "),a("h3",{attrs:{id:"_2、operator是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、operator是什么"}},[s._v("#")]),s._v(" 2、operator是什么")]),s._v(" "),a("p",[s._v("k8s中operator+CRD（CustomResourceDefinitions【k8s自定义资源类型】），可以快速帮我们部署一些有状态应用集群，如redis，mysql，Zookeeper等。")]),s._v(" "),a("p",[s._v("Rook的operator是我们k8s集群和存储集群之间进行交互的解析器")]),s._v(" "),a("p",[s._v("CRD：CustomResourceDefinitions (自定义资源)；如：Itdachang")]),s._v(" "),a("p",[s._v("operator：这个能处理自定义资源类型")]),s._v(" "),a("h2",{attrs:{id:"三、部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、部署"}},[s._v("#")]),s._v(" 三、部署")]),s._v(" "),a("p",[s._v("https://rook.io/docs/rook/v1.8/ceph-quickstart.html")]),s._v(" "),a("h3",{attrs:{id:"_1、查看前提条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、查看前提条件"}},[s._v("#")]),s._v(" 1、查看前提条件")]),s._v(" "),a("ul",[a("li",[s._v("Raw devices (no partitions or formatted filesystems)； 原始磁盘，无分区或者格式化")]),s._v(" "),a("li",[s._v("Raw partitions (no formatted filesystem)；原始分区，无格式化文件系统")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("fdisk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" \n找到自己挂载的磁盘\n如： /dev/vdc\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看满足要求的")]),s._v("\nlsblk "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#云厂商都这么磁盘清0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/zero "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("of")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/vdc "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1M "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("progress\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#本机挂载的块存储")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/zero "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("of")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/sdb "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1M "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("progress\n\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("blockquote",[a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("NAME                  FSTYPE      LABEL UUID                                   MOUNTPOINT\nvda\n└─vda1                LVM2_member       >eSO50t-GkUV-YKTH-WsGq-hNJY-eKNf-3i07IB\n ├─ubuntu--vg-root   ext4              c2366f76-6e21-4f10-a8f3-6776212e2fe4   /\n └─ubuntu--vg-swap_1 swap              9492a3dc-ad75-47cd-9596-678e8cf17ff9   [SWAP]\nvdb\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])]),s._v(" "),a("p",[s._v("vdb 是可用的")]),s._v(" "),a("h3",{attrs:{id:"_2、部署-修改operator"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、部署-修改operator"}},[s._v("#")]),s._v(" 2、部署&修改operator")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" cluster/examples/kubernetes/ceph\nkubectl create "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" crds.yaml "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" common.yaml "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" operator.yaml "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意修改operator镜像")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# verify the rook-ceph-operator is in the `Running` state before proceeding")]),s._v("\nkubectl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" rook-ceph get pod\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("blockquote",[a("p",[s._v("修改operator.yaml")]),s._v(" "),a("p",[s._v("把以前的默认镜像换成能用的，如下")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# ROOK_CSI_CEPH_IMAGE: "registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/cephcsi:v3.3.1"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# ROOK_CSI_REGISTRAR_IMAGE: "registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/csi-node-driver-registrar:v2.0.1"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# ROOK_CSI_RESIZER_IMAGE: "registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/csi-resizer:v1.0.1"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# ROOK_CSI_PROVISIONER_IMAGE: "registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/csi-provisioner:v2.0.4"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# ROOK_CSI_SNAPSHOTTER_IMAGE: "registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/csi-snapshotter:v4.0.0"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# ROOK_CSI_ATTACHER_IMAGE: "registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/csi-attacher:v3.0.2"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("镜像： "),a("code",[s._v("rook/ceph:v1.6.3")]),s._v("   换成  "),a("code",[s._v("registry.cn-hangzhou.aliyuncs.com/cactusmall/rook-ceph:v1.8.6")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 建议修改以下的东西。在operator.yaml里面")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ROOK_CSI_CEPH_IMAGE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry.cn-hangzhou.aliyuncs.com/cactusmall/cephcsi:v3.5.1"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ROOK_CSI_REGISTRAR_IMAGE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry.cn-hangzhou.aliyuncs.com/cactusmall/csi-node-driver-registrar:v2.5.0"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ROOK_CSI_RESIZER_IMAGE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry.cn-hangzhou.aliyuncs.com/cactusmall/csi-resizer:v1.4.0"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ROOK_CSI_PROVISIONER_IMAGE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry.cn-hangzhou.aliyuncs.com/cactusmall/csi-provisioner:v3.1.0"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ROOK_CSI_SNAPSHOTTER_IMAGE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry.cn-hangzhou.aliyuncs.com/cactusmall/csi-snapshotter:v5.0.1"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ROOK_CSI_ATTACHER_IMAGE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry.cn-hangzhou.aliyuncs.com/cactusmall/csi-attacher:v3.4.0"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"_3、部署集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、部署集群"}},[s._v("#")]),s._v(" 3、部署集群")]),s._v(" "),a("blockquote",[a("p",[s._v("修改"),a("code",[s._v("cluster.yaml")]),s._v("使用我们指定的磁盘当做存储节点即可")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cluster level storage configuration and selection")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("useAllNodes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("useAllDevices")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("osdsPerDevice")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v(" \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s-node3"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("devices")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sdb"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s-node1"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("devices")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sdb"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s-node2"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("devices")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sdb"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("镜像： "),a("code",[s._v("ceph/ceph:v16.2.7")]),s._v(" 换成 "),a("code",[s._v("registry.cn-hangzhou.aliyuncs.com/cactusmall/ceph:v16.2.7")])]),s._v(" "),a("h3",{attrs:{id:"_4、部署dashboard"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、部署dashboard"}},[s._v("#")]),s._v(" 4、部署dashboard")]),s._v(" "),a("p",[s._v("https://www.rook.io/docs/rook/v1.8/ceph-dashboard.html")]),s._v(" "),a("p",[s._v("前面的步骤，已经自动部署了。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" rook-ceph get "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看service")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#为了方便访问我们改为nodePort。应用nodePort文件")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取访问密码")]),s._v("\nkubectl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" rook-ceph get secret rook-ceph-dashboard-password "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"{['data']['password']}\"")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" base64 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--decode")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认账号 admin")]),s._v("\nsN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v("XVmI%Gee*tf4/U?"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("MGR: 2；只有一个能用")]),s._v(" "),a("p",[s._v("Mon: 3; 全部可用")]),s._v(" "),a("p",[s._v("Osd: 全部可用")]),s._v(" "),a("blockquote",[a("p",[s._v("部署了高可用的mgr：提供页面。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("先部署nodePort，验证到底哪个mgr不能访问")])]),s._v(" "),a("li",[a("p",[s._v("他是主备模式的高可用。kubectl get svc -n rook-ceph|grep dashboard")])]),s._v(" "),a("li",[a("p",[s._v("curl 访问dashboard确定哪个mgr不能访问")])]),s._v(" "),a("li",[a("p",[s._v("自己做一个可访问到的service。如果哪天服务器故障mgr有问题。修改svc的selector即可")]),s._v(" "),a("ul",[a("li",[a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mgr\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ceph_daemon_id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" a\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rook_cluster")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mgr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dashboard"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("active\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dashboard\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8443")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TCP\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8443")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#service选择哪些Pod")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mgr\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ceph_daemon_id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" a\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rook_cluster")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sessionAffinity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" None\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterIP\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])])])])]),s._v(" "),a("li",[a("p",[s._v("再部署如下的ingress")]),s._v(" "),a("ul",[a("li",[a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Ingress\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dash\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nginx.ingress.kubernetes.io/backend-protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HTTPS"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nginx.ingress.kubernetes.io/server-snippet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v("\n      proxy_ssl_verify off;")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tls:  不用每个名称空间都配置证书信息")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - hosts:")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     - itdachang.com")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     -  未来的")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   secretName: testsecret-tls")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook.itdachang.com\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pathType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Prefix\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("backend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mgr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dashboard"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("active\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8443")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])])])])])])]),s._v(" "),a("h3",{attrs:{id:"_5、神坑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、神坑"}},[s._v("#")]),s._v(" 5、神坑")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#部署完成的最终结果一定要有这些组件")]),s._v("\nNAME                                                 READY   STATUS      RESTARTS   AGE\ncsi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cephfsplugin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d77bb49c6"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("n5tgs         5/5     Running     0          140s\ncsi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cephfsplugin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d77bb49c6"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v9rvn         5/5     Running     0          140s\ncsi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cephfsplugin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rthrp                               3/3     Running     0          140s\ncsi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rbdplugin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("hbsm7                                  3/3     Running     0          140s\ncsi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rbdplugin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5b5cd64fd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nvk6c            6/6     Running     0          140s\ncsi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rbdplugin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5b5cd64fd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("q7bxl            6/6     Running     0          140s\nrook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("crashcollector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("minikube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5b57b7c5d4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("hfldl   1/1     Running     0          105s\nrook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mgr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("64cd7cdf54"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("j8b5p                     1/1     Running     0          77s\nrook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("694bb7987d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fp9w7                     1/1     Running     0          105s\nrook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("856fdd5cb9"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5h2qk                     1/1     Running     0          94s\nrook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("57545897fc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("j576h                     1/1     Running     0          85s\nrook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("operator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("85f5b946bd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s8grz                  1/1     Running     0          92m\nrook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("osd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("6bb747b6c5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("lnvb6                     1/1     Running     0          23s\nrook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("osd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("7f67f9646d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("44p7v                     1/1     Running     0          24s\nrook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("osd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("6cd4b776ff"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v4d68                     1/1     Running     0          25s\nrook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("osd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prepare"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("vx2rz                    0/2     Completed   0          60s\nrook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("osd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prepare"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ab3fd                    0/2     Completed   0          60s\nrook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("osd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prepare"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("w4xyz                    0/2     Completed   0          60s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解决方案。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#找到自己的operator，删除这个pod，让重新执行")]),s._v("\n\nkubectl delete pod rook-ceph-operator-65965c66b5-cxrl8 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" rook-ceph\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#rbd：是ceph用来做块存储的")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cephfs：是用来做共享文件系统的")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"_6、卸载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、卸载"}},[s._v("#")]),s._v(" 6、卸载")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rook集群的清除，")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##1、 delete -f 之前的yaml")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##2、 再执行如下命令")]),s._v("\nkubectl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" rook-ceph get cephcluster\nkubectl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" rook-ceph patch cephclusters.ceph.rook.io rook-ceph "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{"metadata":{"finalizers": []}}\'')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("merge\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##3、 清除每个节点的 /var/lib/rook 目录")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 顽固的自定义资源删除；")]),s._v("\nkubectl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" rook-ceph patch cephblockpool.ceph.rook.io replicapool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{"metadata":{"finalizers": []}}\'')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("merge\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("Rook+Ceph；")]),s._v(" "),a("ul",[a("li",[s._v("Rook帮我们创建好 StorageClass\n"),a("ul",[a("li",[s._v("pvc只需要指定存储类，Rook自动调用 StorageClass 里面的 Provisioner供应商，接下来对ceph集群操作")])])]),s._v(" "),a("li",[s._v("Ceph\n"),a("ul",[a("li",[s._v("Block：块存储。RWO（ReadWriteOnce）单节点读写【一个Pod操作一个自己专属的读写区】，适用于（有状态副本集）")]),s._v(" "),a("li",[s._v("Share FS：共享存储。RWX（ReadWriteMany）多节点读写【多个Pod操作同一个存储区，可读可写】，适用于无状态应用。（文件系统 ）")]),s._v(" "),a("li",[s._v("......")]),s._v(" "),a("li",[s._v("总结： 无状态应用随意复制多少份，一定用到RWX能力。有状态应用复制任意份，每份都只是读写自己的存储，用到RWO（优先）或者RWX。")])])]),s._v(" "),a("li",[s._v("直接通过Rook可以使用到任意能力的存储。")])]),s._v(" "),a("p",[s._v("CRI、CNI、CSI")]),s._v(" "),a("p",[s._v("CRI：Container Runtime Interface：容器运行时接口（k8s集群整合容器运行时环境）")]),s._v(" "),a("p",[s._v("CNI：Container Network Interface：容器网络接口（k8s集群整合网络组件的接口）")]),s._v(" "),a("p",[s._v("CSI：Container Storage Interface：容器存储接口（k8s集群整合存储组件的接口）")]),s._v(" "),a("blockquote",[a("p",[s._v("kubelet启动一个Pod。CRI、CNI、CSI 起作用的顺序")]),s._v(" "),a("ul",[a("li",[s._v("启动Pod流程\n"),a("ul",[a("li",[s._v("每个Pod，都伴随一个Pause容器（沙箱容器）。真正的容器（nginx-pvc）和沙箱容器是公用一个网络、存储、名称空间。。。。")]),s._v(" "),a("li",[s._v("启动沙箱容器。给沙箱容器设置好网络，存储\n"),a("ul",[a("li",[s._v("CRI。创建沙箱容器的运行时环境")]),s._v(" "),a("li",[s._v("CNI。挂载沙箱容器网络等")]),s._v(" "),a("li",[s._v("CSI。调用存储系统进行数据挂载。（提前把应用容器需要挂载的挂进来）")])])]),s._v(" "),a("li",[s._v("启动应用容器。（kubectl get pod 1/1【不算沙箱容器】  ）\n"),a("ul",[a("li",[s._v("应用容器直接创建运行时CRI，用以上的 CNI、CSI")])])])])]),s._v(" "),a("li",[s._v("从应用容器角度出发："),a("code",[s._v("CSI先与CRI启动")]),s._v("。")]),s._v(" "),a("li",[s._v("从Pod出发。CRI。CNI。CSI\n"),a("ul",[a("li",[s._v("沙箱容器代码 https://github.com/kubernetes/kubernetes/blob/d541872f9a036ed4f792232e43fde6dacf0e1084/pkg/kubelet/dockershim/docker_sandbox.go#L89")]),s._v(" "),a("li",[s._v("应用容器 https://github.com/kubernetes/kubernetes/blob/d541872f9a036ed4f792232e43fde6dacf0e1084/pkg/kubelet/kubelet.go#L1469\n"),a("ul",[a("li",[s._v("判断网络（前面准备好的）")]),s._v(" "),a("li",[s._v("挂载")]),s._v(" "),a("li",[s._v("容器启动")])])])])])])]),s._v(" "),a("h2",{attrs:{id:"四、实战"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、实战"}},[s._v("#")]),s._v(" 四、实战")]),s._v(" "),a("h3",{attrs:{id:"_1、块存储-rdb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、块存储-rdb"}},[s._v("#")]),s._v(" 1、块存储(RDB)")]),s._v(" "),a("p",[s._v("RDB： RADOS Block Devices")]),s._v(" "),a("p",[s._v("RADOS： Reliable, Autonomic Distributed Object Store")]),s._v(" "),a("p",[s._v("不能是RWX模式。")]),s._v(" "),a("h4",{attrs:{id:"_1、配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、配置"}},[s._v("#")]),s._v(" 1、配置")]),s._v(" "),a("p",[s._v("RWO:（ReadWriteOnce）")]),s._v(" "),a("p",[s._v("https://www.rook.io/docs/rook/v1.8/ceph-block.html")]),s._v(" "),a("p",[s._v("常用 块存储 。RWO模式；STS删除，pvc不会删除，需要自己手动维护")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ceph.rook.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CephBlockPool\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" replicapool\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("failureDomain")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" host  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容灾模式，host或者osd")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicated")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据副本数量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" storage.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" StorageClass  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#存储驱动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("block\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# Change "rook-ceph" provisioner prefix to match the operator namespace if needed')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("provisioner")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph.rbd.csi.ceph.com\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("parameters")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# clusterID is the namespace where the rook cluster is running")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clusterID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Ceph pool into which the RBD image shall be created")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" replicapool\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# (optional) mapOptions is a comma-separated list of map options.")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For krbd options refer")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://docs.ceph.com/docs/master/man/8/rbd/#kernel-rbd-krbd-options")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For nbd options refer")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://docs.ceph.com/docs/master/man/8/rbd-nbd/#options")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mapOptions: lock_on_read,queue_depth=1024")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# (optional) unmapOptions is a comma-separated list of unmap options.")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For krbd options refer")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://docs.ceph.com/docs/master/man/8/rbd/#kernel-rbd-krbd-options")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For nbd options refer")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://docs.ceph.com/docs/master/man/8/rbd-nbd/#options")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# unmapOptions: force")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# RBD image format. Defaults to "2".')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imageFormat")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# RBD image features. Available for imageFormat: "2". CSI RBD currently supports only `layering` feature.')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imageFeatures")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" layering\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The secrets contain Ceph admin credentials.")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("csi.storage.k8s.io/provisioner-secret-name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("csi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rbd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("csi.storage.k8s.io/provisioner-secret-namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("csi.storage.k8s.io/controller-expand-secret-name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("csi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rbd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("csi.storage.k8s.io/controller-expand-secret-namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("csi.storage.k8s.io/node-stage-secret-name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("csi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rbd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("csi.storage.k8s.io/node-stage-secret-namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Specify the filesystem type of the volume. If not specified, csi-provisioner")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# will set default as `ext4`. Note that `xfs` is not recommended due to potential deadlock")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# in hyperconverged settings where the volume is mounted on the same node as the osds.")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("csi.storage.k8s.io/fstype")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ext4\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Delete the rbd volume when a PVC is deleted")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("reclaimPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Delete\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allowVolumeExpansion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br")])]),a("h4",{attrs:{id:"_2、sts案例实战"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、sts案例实战"}},[s._v("#")]),s._v(" 2、STS案例实战")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" StatefulSet\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nginx\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nginx "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# has to match .spec.template.metadata.labels")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sts-nginx"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# by default is 1")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nginx "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# has to match .spec.selector.matchLabels")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("terminationGracePeriodSeconds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nginx\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" www\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /usr/share/nginx/html\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeClaimTemplates")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" www\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("accessModes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ReadWriteOnce"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storageClassName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rook-ceph-block"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requests")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 20Mi\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nginx\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nginx\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterIP\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TCP\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br")])]),a("blockquote",[a("p",[s._v("测试： 创建sts、修改nginx数据、删除sts、重新创建sts。他们的数据丢不丢，共享不共享")])]),s._v(" "),a("h3",{attrs:{id:"_2、文件存储-cephfs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、文件存储-cephfs"}},[s._v("#")]),s._v(" 2、文件存储(CephFS)")]),s._v(" "),a("h4",{attrs:{id:"_1、配置-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、配置-2"}},[s._v("#")]),s._v(" 1、配置")]),s._v(" "),a("p",[s._v("常用 文件存储。 RWX模式；如：10个Pod共同操作一个地方")]),s._v(" "),a("p",[s._v("https://rook.io/docs/rook/v1.8/ceph-filesystem.html")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ceph.rook.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CephFilesystem\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myfs\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# namespace:cluster")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The metadata pool spec. Must use replication.")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadataPool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicated")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requireSafeReplicaSize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("parameters")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Inline compression mode for the data pool")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Further reference: https://docs.ceph.com/docs/nautilus/rados/configuration/bluestore-config-ref/#inline-compression")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("compression_mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        none\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gives a hint (%) to Ceph in terms of expected consumption of the total cluster capacity of a given pool")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# for more info: https://docs.ceph.com/docs/master/rados/operations/placement-groups/#specifying-expected-pool-size")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#target_size_ratio: ".5"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The list of data pool specs. Can use replication or erasure coding.")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dataPools")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("failureDomain")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" host\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicated")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Disallow setting pool with replica 1, this could lead to data loss without recovery.")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Make sure you're *ABSOLUTELY CERTAIN* that is what you want")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requireSafeReplicaSize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("parameters")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Inline compression mode for the data pool")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Further reference: https://docs.ceph.com/docs/nautilus/rados/configuration/bluestore-config-ref/#inline-compression")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("compression_mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          none\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gives a hint (%) to Ceph in terms of expected consumption of the total cluster capacity of a given pool")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# for more info: https://docs.ceph.com/docs/master/rados/operations/placement-groups/#specifying-expected-pool-size")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#target_size_ratio: ".5"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Whether to preserve filesystem after CephFilesystem CRD deletion")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("preserveFilesystemOnDelete")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The metadata service (mds) configuration")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadataServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The number of active MDS instances")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("activeCount")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Whether each active MDS instance will have an active standby with a warm metadata cache for faster failover.")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# If false, standbys will be available, but will not have a warm cache.")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("activeStandby")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The affinity rules to apply to the mds deployment")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("placement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  nodeAffinity:")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    requiredDuringSchedulingIgnoredDuringExecution:")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#      nodeSelectorTerms:")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#      - matchExpressions:")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        - key: role")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          operator: In")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          values:")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          - mds-node")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  topologySpreadConstraints:")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  tolerations:")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  - key: mds-node")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    operator: Exists")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  podAffinity:")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("podAntiAffinity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requiredDuringSchedulingIgnoredDuringExecution")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labelSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchExpressions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" app\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" In\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("values")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mds\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# topologyKey: kubernetes.io/hostname will place MDS across different hosts")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("topologyKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kubernetes.io/hostname\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("preferredDuringSchedulingIgnoredDuringExecution")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weight")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("podAffinityTerm")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labelSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchExpressions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" app\n                    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" In\n                    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("values")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mds\n              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# topologyKey: */zone can be used to spread MDS across different AZ")]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Use <topologyKey: failure-domain.beta.kubernetes.io/zone> in k8s cluster if your cluster is v1.16 or lower")]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Use <topologyKey: topology.kubernetes.io/zone>  in k8s cluster is v1.17 or upper")]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("topologyKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" topology.kubernetes.io/zone\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A key/value list of annotations")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  key: value")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A key/value list of labels")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  key: value")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The requests and limits set here, allow the filesystem MDS Pod(s) to use half of one CPU core and 1 gigabyte of memory")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  limits:")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#    cpu: "500m"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#    memory: "1024Mi"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  requests:")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#    cpu: "500m"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#    memory: "1024Mi"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# priorityClassName: my-priority-class")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mirroring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br")])]),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" storage.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" StorageClass\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cephfs\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# Change "rook-ceph" provisioner prefix to match the operator namespace if needed')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("provisioner")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph.cephfs.csi.ceph.com\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("parameters")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# clusterID is the namespace where operator is deployed.")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clusterID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CephFS filesystem name into which the volume shall be created")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fsName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myfs\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Ceph pool into which the volume shall be created")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# Required for provisionVolume: "true"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data0\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The secrets contain Ceph admin credentials. These are generated automatically by the operator")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# in the same namespace as the cluster.")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("csi.storage.k8s.io/provisioner-secret-name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("csi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cephfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("csi.storage.k8s.io/provisioner-secret-namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("csi.storage.k8s.io/controller-expand-secret-name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("csi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cephfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("csi.storage.k8s.io/controller-expand-secret-namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("csi.storage.k8s.io/node-stage-secret-name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("csi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cephfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("csi.storage.k8s.io/node-stage-secret-namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("reclaimPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Delete\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allowVolumeExpansion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("h4",{attrs:{id:"_2、测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、测试"}},[s._v("#")]),s._v(" 2、测试")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rollingUpdate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maxSurge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 25%\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maxUnavailable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 25%\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RollingUpdate\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  nginx\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" localtime\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/localtime\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("storage\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /usr/share/nginx/html\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" localtime\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /usr/share/zoneinfo/Asia/Shanghai\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("storage\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("persistentVolumeClaim")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("claimName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("claim\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PersistentVolumeClaim\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("claim\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storageClassName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cephfs\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("accessModes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ReadWriteMany  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##如果是ReadWriteOnce将会是什么效果")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requests")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10Mi\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br")])]),a("blockquote",[a("p",[s._v("测试，创建deploy、修改页面、删除deploy，新建deploy是否绑定成功，数据是否在。")])]),s._v(" "),a("h3",{attrs:{id:"_3、pvc扩容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、pvc扩容"}},[s._v("#")]),s._v(" 3、pvc扩容")]),s._v(" "),a("p",[s._v("参照CSI（容器存储接口）文档：")]),s._v(" "),a("p",[s._v("卷扩容：https://www.rook.io/docs/rook/v1.8/ceph-csi-drivers.html")]),s._v(" "),a("h4",{attrs:{id:"_1、动态卷扩容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、动态卷扩容"}},[s._v("#")]),s._v(" 1、动态卷扩容")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 之前创建storageclass的时候已经配置好了")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试：去容器挂载目录  curl -O 某个大文件  默认不能下载")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改原来的PVC，可以扩充容器。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意，只能扩容，不能缩容")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("blockquote",[a("p",[s._v("有状态应用（3个副本）使用块存储。自己操作自己的pvc挂载的pv；也不丢失")]),s._v(" "),a("p",[s._v("无状态应用（3个副本）使用共享存储。很多人操作一个pvc挂载的一个pv；也不丢失")]),s._v(" "),a("ul",[a("li",[s._v("其他Pod可以对数据进行修改")]),s._v(" "),a("li",[s._v("MySQL 有状态做成主节点。。。MySQL - Master  ---- pv")]),s._v(" "),a("li",[s._v("MySQL 无状态只读 挂载master的 pvc。")])])]),s._v(" "),a("h3",{attrs:{id:"_4、更多参照官方文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、更多参照官方文档"}},[s._v("#")]),s._v(" 4、更多参照官方文档")])],1)}),[],!1,null,null,null);a.default=e.exports}}]);