(window.webpackJsonp=window.webpackJsonp||[]).push([[346],{701:function(s,e,n){"use strict";n.r(e);var a=n(0),r=Object(a.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("因为febs-server-system模块负责用户管理、角色管理、菜单管理、部门管理等模块的增删改查，所以这章将演示如何在febs-server-system模块里集成swagger，其他微服务系统要集成swagger照猫画虎就行了。")]),s._v(" "),e("p",[s._v("增删改查的代码较为枯燥，也比较简单，所以这一小节只演示用户管理模块的增删改查。")]),s._v(" "),e("h2",{attrs:{id:"集成mybatis-plus"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#集成mybatis-plus"}},[s._v("#")]),s._v(" 集成MyBatis Plus")]),s._v(" "),e("p",[s._v("因为在上一章中，我们已经演示了如何在febs-auth里集成MyBatis Plus，所以这里大部分只贴代码，不做过多说明。")]),s._v(" "),e("p",[s._v("在febs-server-system的父模块febs-server的pom里引入MySQL连接驱动和多数据源依赖：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("<dependency>\n    <groupId>com.baomidou</groupId>\n    <artifactId>dynamic-datasource-spring-boot-starter</artifactId>\n    <version>2.5.4</version>\n</dependency>\n<dependency>\n    <groupId>p6spy</groupId>\n    <artifactId>p6spy</artifactId>\n    <version>3.8.1</version>\n</dependency>\n<dependency>\n    <groupId>mysql</groupId>\n    <artifactId>mysql-connector-java</artifactId>\n    <scope>runtime</scope>\n</dependency>\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("p",[s._v("其中p6sy用于在控制台中打印MyBatis执行的SQL，便于异常分析。")]),s._v(" "),e("p",[s._v("因为febs-server-test模块还没有引入多数据源配置，所以需要在它的配置文件application.yml里关闭多数据源自动装配：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("spring:\n  autoconfigure:\n    exclude: org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("接着在febs-server-system模块的配置文件application.yml里引入数据源和MyBatis Plus相关配置：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("spring:\n  datasource:\n    dynamic:\n      hikari:\n        connection-timeout: 30000\n        max-lifetime: 1800000\n        max-pool-size: 15\n        min-idle: 5\n        connection-test-query: select 1\n        pool-name: FebsHikariCP\n      primary: base\n      datasource:\n        base:\n          username: root\n          password: 123456\n          driver-class-name: com.mysql.cj.jdbc.Driver\n          url: jdbc:mysql://localhost:3306/febs_cloud_base?useUnicode=true&characterEncoding=UTF-8&useJDBCCompliantTimezoneShift=true&useLegacyDatetimeCode=false&serverTimezone=GMT%2b8\n\nmybatis-plus:\n  type-aliases-package: cc.mrbird.febs.common.entity.system\n  mapper-locations: classpath:mapper/*/*.xml\n  configuration:\n    jdbc-type-for-null: null\n  global-config:\n    banner: false\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br")])]),e("p",[s._v("此外，因为现在已经在febs-server-system模块里配置了数据源，所以之前在其配置文件里配置的，用于关闭数据源自动装配的配置需要删除掉：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("spring:\n  autoconfigure:\n    exclude: org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("最后，编写一个MyBatis Plus分页插件配置。在febs-server-system模块的cc.mrbird.febs.system.configure路径下新建"),e("code",[s._v("FebsWebConfigure")]),s._v("配置类：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("@Configuration\npublic class FebsWebConfigure {\n\n    @Bean\n    public PaginationInterceptor paginationInterceptor() {\n        PaginationInterceptor paginationInterceptor = new PaginationInterceptor();\n        List<ISqlParser> sqlParserList = new ArrayList<>();\n        sqlParserList.add(new BlockAttackSqlParser());\n        paginationInterceptor.setSqlParserList(sqlParserList);\n        return paginationInterceptor;\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h2",{attrs:{id:"配置p6spy"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置p6spy"}},[s._v("#")]),s._v(" 配置p6spy")]),s._v(" "),e("p",[s._v("如前所述，p6spy用于在控制台中打印MyBatis执行的SQL。要开启p6spy功能只需要在febs-server-system的配置文件application.yml里添加如下配置即可：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("spring:\n  datasource:\n    dynamic:\n      p6spy: true\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("p6spy适合在开发环境用于问题分析，其会带来一定的性能耗损，所以在生产环境这个配置最好改为false，将其关闭。")]),s._v(" "),e("p",[s._v("p6spy默认打印格式可能不符合我们的要求，我们也可以自定义打印规则。")]),s._v(" "),e("p",[s._v("在febs-server-system模块的resources目录下新建"),e("code",[s._v("spy.properties")]),s._v("p6spy配置文件：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 使用日志系统记录 sql\nappender=com.p6spy.engine.spy.appender.Slf4JLogger\n# 自定义日志打印\nlogMessageFormat=cc.mrbird.febs.server.system.configure.P6spySqlFormatConfigure\n# 是否开启慢 SQL记录\noutagedetection=true\n# 慢 SQL记录标准 2 秒\noutagedetectioninterval=2\n# 开启过滤\nfilter=true\n# 配置不打印的内容\nexclude=select 1\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("更多p6spy的配置可以参考https://p6spy.readthedocs.io/en/latest/configandusage.html。")]),s._v(" "),e("p",[s._v("上面配置中，我们通过"),e("code",[s._v("logMessageFormat")]),s._v("指定了自定义打印配置类，接下来我们编写这个配置类。在febs-server-system模块的cc.mrbird.febs.server.system.configure路径下新建"),e("code",[s._v("P6spySqlFormatConfigure")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('public class P6spySqlFormatConfigure implements MessageFormattingStrategy {\n\n    @Override\n    public String formatMessage(int connectionId, String now, long elapsed, String category, String prepared, String sql, String url) {\n        return StringUtils.isNotBlank(sql) ? DateUtil.formatFullTime(LocalDateTime.now(), DateUtil.FULL_TIME_SPLIT_PATTERN)\n                + " | 耗时 " + elapsed + " ms | SQL 语句：" + StringUtils.LF + sql.replaceAll("[\\\\s]+", StringUtils.SPACE) + ";" : StringUtils.EMPTY;\n    }\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("其中"),e("code",[s._v("DateUtil")]),s._v("为自定义的日期格式化工具类，在febs-common模块的cc.mrbird.febs.common.utils路径下新建"),e("code",[s._v("DateUtil")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('public class DateUtil {\n\n    public static final String FULL_TIME_PATTERN = "yyyyMMddHHmmss";\n\n    public static final String FULL_TIME_SPLIT_PATTERN = "yyyy-MM-dd HH:mm:ss";\n\n    public static final String CST_TIME_PATTERN = "EEE MMM dd HH:mm:ss zzz yyyy";\n\n    public static String formatFullTime(LocalDateTime localDateTime) {\n        return formatFullTime(localDateTime, FULL_TIME_PATTERN);\n    }\n\n    public static String formatFullTime(LocalDateTime localDateTime, String pattern) {\n        DateTimeFormatter dateTimeFormatter = DateTimeFormatter.ofPattern(pattern);\n        return localDateTime.format(dateTimeFormatter);\n    }\n\n    public static String getDateFormat(Date date, String dateFormatType) {\n        SimpleDateFormat simpleDateFormat = new SimpleDateFormat(dateFormatType, Locale.CHINA);\n        return simpleDateFormat.format(date);\n    }\n\n    public static String formatCSTTime(String date, String format) throws ParseException {\n        SimpleDateFormat simpleDateFormat = new SimpleDateFormat(CST_TIME_PATTERN, Locale.US);\n        Date usDate = simpleDateFormat.parse(date);\n        return DateUtil.getDateFormat(usDate, format);\n    }\n\n    public static String formatInstant(Instant instant, String format) {\n        LocalDateTime localDateTime = LocalDateTime.ofInstant(instant, ZoneId.systemDefault());\n        return localDateTime.format(DateTimeFormatter.ofPattern(format));\n    }\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br")])]),e("h2",{attrs:{id:"用户管理模块增删改查"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#用户管理模块增删改查"}},[s._v("#")]),s._v(" 用户管理模块增删改查")]),s._v(" "),e("p",[s._v("t_user数据表对应的实体类SystemUser已经在febs-common里定义过了，所以这里从Dao层开始编写。")]),s._v(" "),e("p",[s._v("在febs-server-system模块的cc.mrbird.febs.system路径下新增mapper包，然后在该包下新建"),e("code",[s._v("UserMapper")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('public interface UserMapper extends BaseMapper<SystemUser> {\n\n    /**\n     * 查找用户详细信息\n     *\n     * @param page 分页对象\n     * @param user 用户对象，用于传递查询条件\n     * @return Ipage\n     */\n    IPage<SystemUser> findUserDetailPage(Page page, @Param("user") SystemUser user);\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("因为我们需要在用户管理模块查询出用户的详细信息，比如用户角色名称，部门名称等，需要使用SQL关联多个数据表查询（MyBatis Plus只支持单表查询），所以我们在上面的接口里定义了一个"),e("code",[s._v("findUserDetailPage")]),s._v("方法。")]),s._v(" "),e("p",[s._v("要让该Mapper注册到IOC容器中，可以在类上使用"),e("code",[s._v("@Mapper")]),s._v("注解标注，但更推荐的做法是在febs-server-system模块的入口类里添加"),e("code",[s._v('@MapperScan("cc.mrbird.febs.server.system.mapper")')]),s._v("注解：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('@EnableDiscoveryClient\n@EnableFeignClients\n@SpringBootApplication\n@FebsCloudApplication\n@EnableGlobalMethodSecurity(prePostEnabled = true)\n@MapperScan("cc.mrbird.febs.server.system.mapper")\npublic class FebsServerSystemApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(FebsServerSystemApplication.class, args);\n    }\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("接着在febs-server-system模块的resources目录下新建mapper包，然后在该包下新建system包，在system包下新建"),e("code",[s._v("UserMapper.xml")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">\n<mapper namespace="cc.mrbird.febs.server.system.mapper.UserMapper">\n    <select id="findUserDetailPage" parameterType="systemUser" resultType="systemUser">\n        SELECT\n        u.user_id userId,\n        u.username,\n        u.email,\n        u.mobile,\n        u.status,\n        u.create_time createTime,\n        u.ssex sex,\n        u.dept_id deptId,\n        u.last_login_time lastLoginTime,\n        u.modify_time modifyTime,\n        u.description,\n        u.avatar,\n        d.dept_name deptName,\n        GROUP_CONCAT(r.role_id) roleId,\n        GROUP_CONCAT(r.ROLE_NAME) roleName\n        FROM\n        t_user u\n        LEFT JOIN t_dept d ON (u.dept_id = d.dept_id)\n        LEFT JOIN t_user_role ur ON (u.user_id = ur.user_id)\n        LEFT JOIN t_role r ON r.role_id = ur.role_id\n        WHERE 1 = 1\n        <if test="user.username != null and user.username != \'\'">\n            AND u.username = #{user.username}\n        </if>\n        <if test="user.deptId != null and user.deptId != \'\'">\n            AND d.dept_id = #{user.deptId}\n        </if>\n        <if test="user.sex != null and user.sex != \'\'">\n            AND u.ssex = #{user.sex}\n        </if>\n        <if test="user.status != null and user.status != \'\'">\n            AND u.status = #{user.status}\n        </if>\n        <if test="user.mobile != null and user.mobile != \'\'">\n            AND u.mobile = #{user.mobile}\n        </if>\n        <if test="user.deptName != null and user.deptName != \'\'">\n            AND d.dept_name like CONCAT(\'%\',#{user.deptName},\'%\')\n        </if>\n        <if test="user.createTimeFrom != null and user.createTimeFrom !=\'\'">\n            And u.create_time &gt; #{user.createTimeFrom}\n        </if>\n        <if test="user.createTimeTo!= null and user.createTimeTo !=\'\'">\n            And u.create_time &lt; #{user.createTimeTo}\n        </if>\n        group by u.username,u.user_id,u.email,u.mobile,u.status,u.create_time,u.ssex,\n        u.dept_id,u.last_login_time,u.modify_time,u.description,u.avatar\n    </select>\n</mapper>\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br")])]),e("p",[s._v("该XML文件用于映射"),e("code",[s._v("UserMapper")]),s._v("接口里的"),e("code",[s._v("findUserDetailPage")]),s._v("方法。")]),s._v(" "),e("p",[s._v("创建完Dao层后，我们开始编写Service层代码。在febs-server-system模块的cc.mrbird.febs.system路径下新建service包，然后在该包下新建"),e("code",[s._v("IUserService")]),s._v("接口：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("public interface IUserService extends IService<SystemUser> {\n\n    /**\n     * 查找用户详细信息\n     *\n     * @param request request\n     * @param user    用户对象，用于传递查询条件\n     * @return IPage\n     */\n    IPage<SystemUser> findUserDetail(SystemUser user, QueryRequest request);\n\n    /**\n     * 新增用户\n     *\n     * @param user user\n     */\n    void createUser(SystemUser user);\n\n    /**\n     * 修改用户\n     *\n     * @param user user\n     */\n    void updateUser(SystemUser user);\n\n    /**\n     * 删除用户\n     *\n     * @param userIds 用户 id数组\n     */\n    void deleteUsers(String[] userIds);\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br")])]),e("p",[s._v("该接口定义了用户模块的增删改查抽象方法。其中"),e("code",[s._v("QueryRequest")]),s._v("为通用查询参数类，用于接收前端上送的分页和排序信息。在febs-common模块的cc.mrbird.febs.common.entity路径下新建"),e("code",[s._v("QueryRequest")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("@Data\n@ToString\npublic class QueryRequest implements Serializable {\n\n    private static final long serialVersionUID = -4869594085374385813L;\n    /**\n     * 当前页面数据量\n     */\n    private int pageSize = 10;\n    /**\n     * 当前页码\n     */\n    private int pageNum = 1;\n    /**\n     * 排序字段\n     */\n    private String field;\n    /**\n     * 排序规则，asc升序，desc降序\n     */\n    private String order;\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br")])]),e("p",[s._v("创建好service接口后，接着创建它的实现类。在febs-server-system模块的cc.mrbird.febs.server.system.service路径下新建impl包，然后在该包下新建"),e("code",[s._v("IUserService")]),s._v("的实现类"),e("code",[s._v("UserServiceImpl")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("@Service\n@Transactional(propagation = Propagation.SUPPORTS, readOnly = true, rollbackFor = Exception.class)\npublic class UserServiceImpl extends ServiceImpl<UserMapper, SystemUser> implements IUserService {\n\n    @Autowired\n    private IUserRoleService userRoleService;\n    @Autowired\n    private PasswordEncoder passwordEncoder;\n\n    @Override\n    public IPage<SystemUser> findUserDetail(SystemUser user, QueryRequest request) {\n        Page<SystemUser> page = new Page<>(request.getPageNum(), request.getPageSize());\n        return this.baseMapper.findUserDetailPage(page, user);\n    }\n\n    @Override\n    @Transactional\n    public void createUser(SystemUser user) {\n        // 创建用户\n        user.setCreateTime(new Date());\n        user.setAvatar(SystemUser.DEFAULT_AVATAR);\n        user.setPassword(passwordEncoder.encode(SystemUser.DEFAULT_PASSWORD));\n        save(user);\n        // 保存用户角色\n        String[] roles = user.getRoleId().split(StringPool.COMMA);\n        setUserRoles(user, roles);\n    }\n\n    @Override\n    @Transactional\n    public void updateUser(SystemUser user) {\n        // 更新用户\n        user.setPassword(null);\n        user.setUsername(null);\n        user.setCreateTime(null);\n        user.setModifyTime(new Date());\n        updateById(user);\n\n        userRoleService.remove(new LambdaQueryWrapper<UserRole>().eq(UserRole::getUserId, user.getUserId()));\n        String[] roles = user.getRoleId().split(StringPool.COMMA);\n        setUserRoles(user, roles);\n    }\n\n    @Override\n    @Transactional\n    public void deleteUsers(String[] userIds) {\n        List<String> list = Arrays.asList(userIds);\n        removeByIds(list);\n        // 删除用户角色\n        this.userRoleService.deleteUserRolesByUserId(userIds);\n    }\n\n    private void setUserRoles(SystemUser user, String[] roles) {\n        Arrays.stream(roles).forEach(roleId -> {\n            UserRole ur = new UserRole();\n            ur.setUserId(user.getUserId());\n            ur.setRoleId(Long.valueOf(roleId));\n            userRoleService.save(ur);\n        });\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br")])]),e("p",[e("code",[s._v("@Transactional")]),s._v("注解用于开启数据库事务，要让该注解生效，还需要在febs-server-system模块的入口类上添加"),e("code",[s._v("@EnableTransactionManagement")]),s._v("注解：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('@EnableDiscoveryClient\n@EnableFeignClients\n@SpringBootApplication\n@FebsCloudApplication\n@EnableTransactionManagement\n@EnableGlobalMethodSecurity(prePostEnabled = true)\n@MapperScan("cc.mrbird.febs.server.system.mapper")\npublic class FebsServerSystemApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(FebsServerSystemApplication.class, args);\n    }\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[e("code",[s._v("UserServiceImpl")]),s._v("的代码较为简单，大体上没什么可说的，就是结合MyBatis Plus提供的方法进行"),e("code",[s._v("SystemUser")]),s._v("的增删改查。在RBAC模型中，用户和角色关联，所以在上面的用户的增删改代码都涉及到了角色的操作。"),e("code",[s._v("UserRole")]),s._v("为"),e("code",[s._v("t_user_role")]),s._v("数据表对应的实体类，"),e("code",[s._v("IUserRoleService")]),s._v("为"),e("code",[s._v("t_user_role")]),s._v("数据表对应的service。")]),s._v(" "),e("p",[s._v("在febs-common模块的cc.mrbird.febs.common.entity.system路径下新建"),e("code",[s._v("UserRole")]),s._v("实体类：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('@Data\n@TableName("t_user_role")\npublic class UserRole implements Serializable {\n\n    private static final long serialVersionUID = -3166012934498268403L;\n\n    @TableField(value = "USER_ID")\n    private Long userId;\n\n    @TableField(value = "ROLE_ID")\n    private Long roleId;\n\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[s._v("然后在febs-server-system模块的cc.mrbird.febs.server.system.mapper路径下新建"),e("code",[s._v("UserRoleMapper")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('public interface UserRoleMapper extends BaseMapper<UserRole> {\n\n    /**\n     * 根据用户Id删除该用户的角色关系\n     *\n     * @param userId 用户 ID\n     * @return boolean\n     */\n    Boolean deleteByUserId(@Param("userId") Long userId);\n\n    /**\n     * 根据角色Id删除该角色的用户关系\n     *\n     * @param roleId 角色 ID\n     * @return boolean\n     */\n    Boolean deleteByRoleId(@Param("roleId") Long roleId);\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("p",[s._v("在febs-server-system模块的resources.mapper.system路径下新建"),e("code",[s._v("UserRoleMapper.xml")]),s._v("XML文件，映射该Mapper接口：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">\n<mapper namespace="cc.mrbird.febs.server.system.mapper.UserRoleMapper">\n    \x3c!--根据用户Id删除该用户的角色关系--\x3e\n    <delete id="deleteByUserId">\n\t\tDELETE FROM t_user_role WHERE user_id = #{userId}\n\t</delete>\n\n    \x3c!--根据角色Id删除该角色的用户关系--\x3e\n    <delete id="deleteByRoleId">\n\t\tDELETE FROM t_user_role WHERE role_id = #{roleId}\n\t</delete>\n</mapper>\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[s._v("在febs-server-system模块的cc.mrbird.febs.server.system.service路径下新建"),e("code",[s._v("IUserRoleService")]),s._v("接口：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("public interface IUserRoleService extends IService<UserRole> {\n\n\tvoid deleteUserRolesByRoleId(String[] roleIds);\n\n\tvoid deleteUserRolesByUserId(String[] userIds);\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("在febs.mrbird.febs.server.system.service.impl路径下新建"),e("code",[s._v("IUserRoleService")]),s._v("接口的实现类"),e("code",[s._v("UserRoleServiceImpl")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('@Service("userRoleService")\n@Transactional(propagation = Propagation.SUPPORTS, readOnly = true, rollbackFor = Exception.class)\npublic class UserRoleServiceImpl extends ServiceImpl<UserRoleMapper, UserRole> implements IUserRoleService {\n\n\t@Override\n\t@Transactional\n\tpublic void deleteUserRolesByRoleId(String[] roleIds) {\n\t\tArrays.stream(roleIds).forEach(id -> baseMapper.deleteByRoleId(Long.valueOf(id)));\n\t}\n\n\t@Override\n\t@Transactional\n\tpublic void deleteUserRolesByUserId(String[] userIds) {\n\t\tArrays.stream(userIds).forEach(id -> baseMapper.deleteByUserId(Long.valueOf(id)));\n\t}\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("h2",{attrs:{id:"暴露服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#暴露服务"}},[s._v("#")]),s._v(" 暴露服务")]),s._v(" "),e("p",[s._v("到这里，用户模块的增删改查服务创建完了，接下来定义一个"),e("code",[s._v("UserController")]),s._v("控制器，对外提供用户模块的增删改查服务，风格为REST：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('@Slf4j\n@Validated\n@RestController\n@RequestMapping("user")\npublic class UserController {\n\n    @Autowired\n    private IUserService userService;\n\n    @GetMapping\n    @PreAuthorize("hasAnyAuthority(\'user:view\')")\n    public FebsResponse userList(QueryRequest queryRequest, SystemUser user) {\n        Map<String, Object> dataTable = FebsUtil.getDataTable(userService.findUserDetail(user, queryRequest));\n        return new FebsResponse().data(dataTable);\n    }\n\n    @PostMapping\n    @PreAuthorize("hasAnyAuthority(\'user:add\')")\n    public void addUser(@Valid SystemUser user) throws FebsException {\n        try {\n            this.userService.createUser(user);\n        } catch (Exception e) {\n            String message = "新增用户失败";\n            log.error(message, e);\n            throw new FebsException(message);\n        }\n    }\n\n    @PutMapping\n    @PreAuthorize("hasAnyAuthority(\'user:update\')")\n    public void updateUser(@Valid SystemUser user) throws FebsException {\n        try {\n            this.userService.updateUser(user);\n        } catch (Exception e) {\n            String message = "修改用户失败";\n            log.error(message, e);\n            throw new FebsException(message);\n        }\n    }\n\n    @DeleteMapping("/{userIds}")\n    @PreAuthorize("hasAnyAuthority(\'user:delete\')")\n    public void deleteUsers(@NotBlank(message = "{required}") @PathVariable String userIds) throws FebsException {\n        try {\n            String[] ids = userIds.split(StringPool.COMMA);\n            this.userService.deleteUsers(ids);\n        } catch (Exception e) {\n            String message = "删除用户失败";\n            log.error(message, e);\n            throw new FebsException(message);\n        }\n    }\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br")])]),e("p",[s._v("其中"),e("code",[s._v("FebsException")]),s._v("为FEBS系统通用业务异常，在febs-common模块的cc.mrbird.febs.common.exception路径下新增"),e("code",[s._v("FebsException")]),s._v("异常类：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("public class FebsException extends Exception{\n\n    private static final long serialVersionUID = -6916154462432027437L;\n\n    public FebsException(String message){\n        super(message);\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("然后在febs-common模块的"),e("code",[s._v("BaseExceptionHandler")]),s._v("里添加该异常处理：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v(' @ExceptionHandler(value = FebsException.class)\n    @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)\n    public FebsResponse handleFebsException(FebsException e) {\n        log.error("系统错误", e);\n        return new FebsResponse().message(e.getMessage());\n    }\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("在"),e("code",[s._v("UserController")]),s._v("的"),e("code",[s._v("userList")]),s._v("方法中，我们通过"),e("code",[s._v("FebsUtil#getDataTable")]),s._v("方法将"),e("code",[s._v("IPage<T>")]),s._v("类型数据包装为前端表格插件所需的数据格式，在febs-common模块的"),e("code",[s._v("FebsUtil")]),s._v("里添加"),e("code",[s._v("getDataTable")]),s._v("方法：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('/**\n * 封装前端分页表格所需数据\n *\n * @param pageInfo pageInfo\n * @return Map<String, Object>\n */\npublic static Map<String, Object> getDataTable(IPage<?> pageInfo) {\n    Map<String, Object> data = new HashMap<>();\n    data.put("rows", pageInfo.getRecords());\n    data.put("total", pageInfo.getTotal());\n    return data;\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("在"),e("code",[s._v("UserController")]),s._v("的各个方法中，我们还使用了"),e("code",[s._v("@PreAuthorize(\"hasAnyAuthority('xxx')\")")]),s._v("注解对方法进行了权限控制。")]),s._v(" "),e("h2",{attrs:{id:"数据校验"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#数据校验"}},[s._v("#")]),s._v(" 数据校验")]),s._v(" "),e("p",[s._v("在"),e("code",[s._v("UserController")]),s._v("方法中，我们使用了"),e("code",[s._v("@Validated")]),s._v("和"),e("code",[s._v("@Valid")]),s._v("注解对请求参数进行了校验。下面详细介绍这两个注解的使用方法。")]),s._v(" "),e("p",[s._v("请求参数分为普通参数和实体对象参数，所以它们的校验也分为两种。"),e("code",[s._v("@Valid")]),s._v("对应实体对象传参时的参数校验；"),e("code",[s._v("@Validated")]),s._v("对应普通参数的校验。")]),s._v(" "),e("h3",{attrs:{id:"普通参数校验"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#普通参数校验"}},[s._v("#")]),s._v(" 普通参数校验")]),s._v(" "),e("p",[s._v("在"),e("code",[s._v("UserController")]),s._v("的"),e("code",[s._v("deleteUsers")]),s._v("方法参数上，我们使用"),e("code",[s._v('@NotBlank(message = "{required}")')]),s._v("注解标注了"),e("code",[s._v("userIds")]),s._v("参数（更多可用的注解可以参考"),e("a",{attrs:{href:"https://mrbird.cc/Spring%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Spring表单校验"),e("OutboundLink")],1),s._v("），该注解表示请求参数不能为空，提示信息为"),e("code",[s._v("{required}")]),s._v("占位符里的内容。"),e("code",[s._v("@Validated")]),s._v("的作用是让"),e("code",[s._v("@NotBlank")]),s._v("注解生效。"),e("code",[s._v("{required}")]),s._v("提示内容需要在febs-server-system模块的resources路径下创建"),e("code",[s._v("ValidationMessages.properties")]),s._v("配置文件，在该配置文件里添加如下内容：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("required=\\u4E0D\\u80FD\\u4E3A\\u7A7A\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("内容为中文转Unicode后的值，可以使用http://tool.chinaz.com/tools/unicode.aspx网站转换，"),e("code",[s._v("\\u4e0d\\u80fd\\u4e3a\\u7a7a")]),s._v("转为中文为“不能为空”。")]),s._v(" "),e("p",[s._v("当普通类型参数校验不合法时，控制器层会抛出"),e("code",[s._v("javax.validation.ConstraintViolationException")]),s._v("异常，我们可以在febs-common的"),e("code",[s._v("BaseExceptionHandler")]),s._v("里添加该类型异常捕获：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('/**\n * 统一处理请求参数校验(普通传参)\n *\n * @param e ConstraintViolationException\n * @return FebsResponse\n */\n@ExceptionHandler(value = ConstraintViolationException.class)\n@ResponseStatus(HttpStatus.BAD_REQUEST)\npublic FebsResponse handleConstraintViolationException(ConstraintViolationException e) {\n    StringBuilder message = new StringBuilder();\n    Set<ConstraintViolation<?>> violations = e.getConstraintViolations();\n    for (ConstraintViolation<?> violation : violations) {\n        Path path = violation.getPropertyPath();\n        String[] pathArr = StringUtils.splitByWholeSeparatorPreserveAllTokens(path.toString(), ".");\n        message.append(pathArr[1]).append(violation.getMessage()).append(",");\n    }\n    message = new StringBuilder(message.substring(0, message.length() - 1));\n    return new FebsResponse().message(message.toString());\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br")])]),e("h3",{attrs:{id:"实体对象参数校验"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实体对象参数校验"}},[s._v("#")]),s._v(" 实体对象参数校验")]),s._v(" "),e("p",[s._v("当参数较少的时候可以使用上面这种方式，但如果参数众多上面的方式就略显繁琐了。这时候我们可以使用实体对象来进行传参。")]),s._v(" "),e("p",[s._v("在febs-common模块的"),e("code",[s._v("SystemUser")]),s._v("类里添加相关参数校验注解，代码如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('@Data\n@TableName("t_user")\npublic class SystemUser implements Serializable {\n\n    private static final long serialVersionUID = -4352868070794165001L;\n\n    // 用户状态：有效\n    public static final String STATUS_VALID = "1";\n    // 用户状态：锁定\n    public static final String STATUS_LOCK = "0";\n    // 默认头像\n    public static final String DEFAULT_AVATAR = "default.jpg";\n    // 默认密码\n    public static final String DEFAULT_PASSWORD = "1234qwer";\n    // 性别男\n    public static final String SEX_MALE = "0";\n    // 性别女\n    public static final String SEX_FEMALE = "1";\n    // 性别保密\n    public static final String SEX_UNKNOW = "2";\n\n    /**\n     * 用户 ID\n     */\n    @TableId(value = "USER_ID", type = IdType.AUTO)\n    private Long userId;\n\n    /**\n     * 用户名\n     */\n    @TableField("USERNAME")\n    @Size(min = 4, max = 10, message = "{range}")\n    private String username;\n\n    /**\n     * 密码\n     */\n    @TableField("PASSWORD")\n    private String password;\n\n    /**\n     * 部门 ID\n     */\n    @TableField("DEPT_ID")\n    private Long deptId;\n\n    /**\n     * 邮箱\n     */\n    @TableField("EMAIL")\n    @Size(max = 50, message = "{noMoreThan}")\n    @Email(message = "{email}")\n    private String email;\n\n    /**\n     * 联系电话\n     */\n    @TableField("MOBILE")\n    @IsMobile(message = "{mobile}")\n    private String mobile;\n\n    /**\n     * 状态 0锁定 1有效\n     */\n    @TableField("STATUS")\n    @NotBlank(message = "{required}")\n    private String status;\n\n    /**\n     * 创建时间\n     */\n    @TableField("CREATE_TIME")\n    private Date createTime;\n\n    /**\n     * 修改时间\n     */\n    @TableField("MODIFY_TIME")\n    private Date modifyTime;\n\n    /**\n     * 最近访问时间\n     */\n    @TableField("LAST_LOGIN_TIME")\n    private Date lastLoginTime;\n\n    /**\n     * 性别 0男 1女 2 保密\n     */\n    @TableField("SSEX")\n    @NotBlank(message = "{required}")\n    private String sex;\n\n    /**\n     * 头像\n     */\n    @TableField("AVATAR")\n    private String avatar;\n\n    /**\n     * 描述\n     */\n    @TableField("DESCRIPTION")\n    @Size(max = 100, message = "{noMoreThan}")\n    private String description;\n\n    /**\n     * 部门名称\n     */\n    @TableField(exist = false)\n    private String deptName;\n\n    @TableField(exist = false)\n    private String createTimeFrom;\n    @TableField(exist = false)\n    private String createTimeTo;\n    /**\n     * 角色 ID\n     */\n    @TableField(exist = false)\n    private String roleId;\n\n    @TableField(exist = false)\n    private String roleName;\n\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br"),e("span",{staticClass:"line-number"},[s._v("75")]),e("br"),e("span",{staticClass:"line-number"},[s._v("76")]),e("br"),e("span",{staticClass:"line-number"},[s._v("77")]),e("br"),e("span",{staticClass:"line-number"},[s._v("78")]),e("br"),e("span",{staticClass:"line-number"},[s._v("79")]),e("br"),e("span",{staticClass:"line-number"},[s._v("80")]),e("br"),e("span",{staticClass:"line-number"},[s._v("81")]),e("br"),e("span",{staticClass:"line-number"},[s._v("82")]),e("br"),e("span",{staticClass:"line-number"},[s._v("83")]),e("br"),e("span",{staticClass:"line-number"},[s._v("84")]),e("br"),e("span",{staticClass:"line-number"},[s._v("85")]),e("br"),e("span",{staticClass:"line-number"},[s._v("86")]),e("br"),e("span",{staticClass:"line-number"},[s._v("87")]),e("br"),e("span",{staticClass:"line-number"},[s._v("88")]),e("br"),e("span",{staticClass:"line-number"},[s._v("89")]),e("br"),e("span",{staticClass:"line-number"},[s._v("90")]),e("br"),e("span",{staticClass:"line-number"},[s._v("91")]),e("br"),e("span",{staticClass:"line-number"},[s._v("92")]),e("br"),e("span",{staticClass:"line-number"},[s._v("93")]),e("br"),e("span",{staticClass:"line-number"},[s._v("94")]),e("br"),e("span",{staticClass:"line-number"},[s._v("95")]),e("br"),e("span",{staticClass:"line-number"},[s._v("96")]),e("br"),e("span",{staticClass:"line-number"},[s._v("97")]),e("br"),e("span",{staticClass:"line-number"},[s._v("98")]),e("br"),e("span",{staticClass:"line-number"},[s._v("99")]),e("br"),e("span",{staticClass:"line-number"},[s._v("100")]),e("br"),e("span",{staticClass:"line-number"},[s._v("101")]),e("br"),e("span",{staticClass:"line-number"},[s._v("102")]),e("br"),e("span",{staticClass:"line-number"},[s._v("103")]),e("br"),e("span",{staticClass:"line-number"},[s._v("104")]),e("br"),e("span",{staticClass:"line-number"},[s._v("105")]),e("br"),e("span",{staticClass:"line-number"},[s._v("106")]),e("br"),e("span",{staticClass:"line-number"},[s._v("107")]),e("br"),e("span",{staticClass:"line-number"},[s._v("108")]),e("br"),e("span",{staticClass:"line-number"},[s._v("109")]),e("br"),e("span",{staticClass:"line-number"},[s._v("110")]),e("br"),e("span",{staticClass:"line-number"},[s._v("111")]),e("br"),e("span",{staticClass:"line-number"},[s._v("112")]),e("br"),e("span",{staticClass:"line-number"},[s._v("113")]),e("br"),e("span",{staticClass:"line-number"},[s._v("114")]),e("br"),e("span",{staticClass:"line-number"},[s._v("115")]),e("br"),e("span",{staticClass:"line-number"},[s._v("116")]),e("br"),e("span",{staticClass:"line-number"},[s._v("117")]),e("br"),e("span",{staticClass:"line-number"},[s._v("118")]),e("br"),e("span",{staticClass:"line-number"},[s._v("119")]),e("br"),e("span",{staticClass:"line-number"},[s._v("120")]),e("br"),e("span",{staticClass:"line-number"},[s._v("121")]),e("br"),e("span",{staticClass:"line-number"},[s._v("122")]),e("br"),e("span",{staticClass:"line-number"},[s._v("123")]),e("br"),e("span",{staticClass:"line-number"},[s._v("124")]),e("br"),e("span",{staticClass:"line-number"},[s._v("125")]),e("br"),e("span",{staticClass:"line-number"},[s._v("126")]),e("br")])]),e("p",[e("code",[s._v('@Size(min = 4, max = 10, message = "{range}")')]),s._v("注解表示值的长度范围为4到10；"),e("code",[s._v('@Size(max = 50, message = "{noMoreThan}")')]),s._v("表示值的长度不能超过50；"),e("code",[s._v('@IsMobile(message = "{mobile}")')]),s._v("表示值必须为手机号码（这个注解为自定义注解，下面会介绍到）；"),e("code",[s._v('@Email(message = "{email}")')]),s._v("表示值必须为邮箱。")]),s._v(" "),e("p",[s._v("在"),e("code",[s._v("ValidationMessages.properties")]),s._v("配置文件里补充这些自定义提示:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("range=\\u6709\\u6548\\u957f\\u5ea6{min}\\u5230{max}\\u4e2a\\u5b57\\u7b26\nemail=\\u90ae\\u7bb1\\u683c\\u5f0f\\u4e0d\\u5408\\u6cd5\nmobile=\\u624b\\u673a\\u53f7\\u4e0d\\u5408\\u6cd5\nnoMoreThan=\\u957f\\u5ea6\\u4e0d\\u80fd\\u8d85\\u8fc7{max}\\u4e2a\\u5b57\\u7b26\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("值得注意的是，这个配置文件里可以使用"),e("code",[s._v("{min}")]),s._v("和"),e("code",[s._v("{max}")]),s._v("占位符，对应校验注解里的min和max属性值。")]),s._v(" "),e("p",[s._v("使用实体对象传参的方式参数校验需要在相应的参数前加上"),e("code",[s._v("@Valid")]),s._v("注解。当校验不通过时，控制器层将抛出"),e("code",[s._v("BindException")]),s._v("类型异常，我们可以在febs-common的"),e("code",[s._v("BaseExceptionHandler")]),s._v("里添加该类型异常捕获：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('/**\n * 统一处理请求参数校验(实体对象传参)\n *\n * @param e BindException\n * @return FebsResponse\n */\n@ExceptionHandler(BindException.class)\n@ResponseStatus(HttpStatus.BAD_REQUEST)\npublic FebsResponse handleBindException(BindException e) {\n    StringBuilder message = new StringBuilder();\n    List<FieldError> fieldErrors = e.getBindingResult().getFieldErrors();\n    for (FieldError error : fieldErrors) {\n        message.append(error.getField()).append(error.getDefaultMessage()).append(",");\n    }\n    message = new StringBuilder(message.substring(0, message.length() - 1));\n    return new FebsResponse().message(message.toString());\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("p",[s._v("复制")]),s._v(" "),e("h3",{attrs:{id:"自定义参数校验注解"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#自定义参数校验注解"}},[s._v("#")]),s._v(" 自定义参数校验注解")]),s._v(" "),e("p",[s._v("在febs-common模块的cc.mrbird.febs.common.annotation路径下新建"),e("code",[s._v("IsMobile")]),s._v("注解：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("@Target({ElementType.FIELD})\n@Retention(RetentionPolicy.RUNTIME)\n@Constraint(validatedBy = MobileValidator.class)\npublic @interface IsMobile {\n\n    String message();\n\n    Class<?>[] groups() default {};\n\n    Class<? extends Payload>[] payload() default {};\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("其中"),e("code",[s._v("MobileValidator")]),s._v("用于编写具体的校验逻辑。在febs-common模块的cc.mrbird.febs.common路径下新建validator包，在该包下新建"),e("code",[s._v("MobileValidator")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("public class MobileValidator implements ConstraintValidator<IsMobile, String> {\n\n    @Override\n    public void initialize(IsMobile isMobile) {\n    }\n\n    @Override\n    public boolean isValid(String s, ConstraintValidatorContext constraintValidatorContext) {\n        try {\n            if (StringUtils.isBlank(s)) {\n                return true;\n            } else {\n                String regex = RegexpConstant.MOBILE_REG;\n                return FebsUtil.match(regex, s);\n            }\n        } catch (Exception e) {\n            return false;\n        }\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br")])]),e("p",[e("code",[s._v("RegexpConstant")]),s._v("为正则表达式常量，在febs-common模块的cc.mrbird.febs.common.entity路径下新建"),e("code",[s._v("RegexpConstant")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('public class RegexpConstant {\n\n    // 简单手机号正则（这里只是简单校验是否为 11位，实际规则更复杂）\n    public static final String MOBILE_REG = "[1]\\\\d{10}";\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[e("code",[s._v("FebsUtil#match")]),s._v("为正则校验方法，在febs-common模块的"),e("code",[s._v("FebsUitl")]),s._v("工具类里添加"),e("code",[s._v("match")]),s._v("方法：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n * 正则校验\n *\n * @param regex 正则表达式字符串\n * @param value 要匹配的字符串\n * @return 正则校验结果\n */\npublic static boolean match(String regex, String value) {\n    Pattern pattern = Pattern.compile(regex);\n    Matcher matcher = pattern.matcher(value);\n    return matcher.matches();\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("到这里，febs-server-system模块的用户管理增删改查基本就完成了。")]),s._v(" "),e("h2",{attrs:{id:"postman测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#postman测试"}},[s._v("#")]),s._v(" PostMan测试")]),s._v(" "),e("p",[s._v("在IDEA的Services窗口下逐步启动febs-register、febs-auth、febs-gateway和febs-server-system模块。")]),s._v(" "),e("p",[s._v("在启动febs-server-system模块的时候，程序出错：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("public cc.mrbird.febs.common.entity.FebsResponse cc.mrbird.febs.server.system.controller.UserController.userList(cc.mrbird.febs.common.entity.QueryRequest,cc.mrbird.febs.common.entity.system.SystemUser)\nto {GET /user}: There is already 'testController' bean method\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("因为我们在"),e("code",[s._v("TestController")]),s._v("里已经定义了一个"),e("code",[s._v("/user")]),s._v("对应的方法，我们把它调整为：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('@RestController\npublic class TestController {\n    ......\n    \n    @GetMapping("currentUser")\n    public Principal currentUser(Principal principal) {\n        return principal;\n    }\n    ......\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[s._v("重新启动febs-server-system模块，启动后，先从认证服务器获取令牌，然后测试用户查询：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/15/mEYP2R.png",alt:"97.png"}})]),s._v(" "),e("p",[s._v("测试新增用户：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/15/mEYfzR.png",alt:"98.png"}})]),s._v(" "),e("p",[s._v("请求返回200，说明没问题，查看数据库，看是否成功插入数据：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/15/mEtCTS.png",alt:"99.png"}})]),s._v(" "),e("p",[s._v("因为我们配置了p6spy，所以控制台能看到相应的SQL日志打印：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("2019-08-16 08:48:49.585  INFO 7640 --- [nio-8201-exec-5] p6spy                                    : 2019-08-16 08:48:49 | 耗时 7 ms | SQL 语句：\nINSERT INTO t_user (USERNAME, PASSWORD, STATUS, CREATE_TIME, SSEX, AVATAR) VALUES ('Jane', '$2a$10$8xOvp8NXRy6WZ.wcp7iXwuXaYqO4aGZM76tQZB1XSehXC8ZhUCAHW', '1', '2019-08-16T08:48:49.232+0800', '1', 'default.jpg');\n2019-08-16 08:48:49.608  INFO 7640 --- [nio-8201-exec-5] p6spy                                    : 2019-08-16 08:48:49 | 耗时 0 ms | SQL 语句：\nINSERT INTO t_user_role (USER_ID, ROLE_ID) VALUES (2, 1);\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("新增用户请求，当参数校验不通过时，请求返回：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/15/mEt8p9.png",alt:"100.png"}})]),s._v(" "),e("p",[s._v("测试修改用户请求：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/15/mENngA.png",alt:"101.png"}})]),s._v(" "),e("p",[s._v("请求返回200，修改成功，查看数据库看看是否修改成功：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/15/mENNgs.png",alt:"102.png"}})]),s._v(" "),e("p",[s._v("测试删除用户：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/15/mEa1fg.png",alt:"103.png"}})]),s._v(" "),e("p",[s._v("请求返回200，删除成功，查看数据库：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/15/mEdt8e.png",alt:"104.png"}})]),s._v(" "),e("p",[s._v("Jane这条数据删除成功。")])])}),[],!1,null,null,null);e.default=r.exports}}]);