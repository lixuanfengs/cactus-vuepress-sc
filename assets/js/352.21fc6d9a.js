(window.webpackJsonp=window.webpackJsonp||[]).push([[352],{706:function(s,e,a){"use strict";a.r(e);var n=a(0),t=Object(n.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("目前，各个微服务系统的日志都保存在各自指定的目录中，如果这些微服务部署在不同的服务器上，那么日志文件也是分散在各自的服务器上。分散的日志不利于我们快速通过日志定位问题，我们可以借助ELK来收集各个微服务系统的日志并集中展示。")]),s._v(" "),e("p",[s._v("ELK即Elasticsearch、Logstash和Kibana首字母缩写。Elasticsearch用于存储日志信息，Logstash用于收集日志，Kibana用于图形化展示。")]),s._v(" "),e("h2",{attrs:{id:"搭建elk环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#搭建elk环境"}},[s._v("#")]),s._v(" 搭建ELK环境")]),s._v(" "),e("p",[s._v("在Windwos上搭建ELK环境较为麻烦，这里我选择在CentOS7 上通过Docker来搭建ELK环境，对Docker基本使用不熟悉的同学可以参考 "),e("a",{attrs:{href:"https://mrbird.cc/tags/Docker/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker基础教程"),e("OutboundLink")],1),s._v("。")]),s._v(" "),e("p",[s._v("在此之前，我们需要准备一台CentOS 7虚拟机。推荐大家使用Vagrant来创建，创建教程可以参考："),e("a",{attrs:{href:"https://mrbird.cc/Create-Virtual-Machine-By-Vagrant.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("使用Vagrant创建CentOS虚拟机"),e("OutboundLink")],1),s._v("。这里分享下我的Vagrantfile配置：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('Vagrant.configure("2") do |config|\n  config.vm.box = "centos7"\n  config.vm.network "private_network", ip: "192.168.33.10"\n  config.vm.hostname = "febs"\n  config.vm.provider "virtualbox" do |v|\n    v.memory = 6144\n    v.cpus = 2\n  end\nend\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("上面配置了虚拟机的IP地址为192.168.33.10，hostname为febs，内存为6*1024MB（6144MB即6GB），cpu核心数为2。")]),s._v(" "),e("h3",{attrs:{id:"安装docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装docker"}},[s._v("#")]),s._v(" 安装docker")]),s._v(" "),e("p",[s._v("在CMD终端使用命令"),e("code",[s._v("vagrant ssh")]),s._v("连接虚拟机后，运行"),e("code",[s._v("sudo -s")]),s._v("切换到root用户，下面的示例都是用root用户完成的。")]),s._v(" "),e("p",[s._v("在Linux中安装Docker可以参考官方文档：https://docs.docker.com/install/linux/docker-ce/centos/，主要分为下面这几步：")]),s._v(" "),e("ol",[e("li",[s._v("卸载旧版本Docker（如果系统之前没安装过Docker，可以跳过）：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("yum remove docker \\\n                  docker-client \\\n                  docker-client-latest \\\n                  docker-common \\\n                  docker-latest \\\n                  docker-latest-logrotate \\\n                  docker-logrotate \\\n                  docker-engine\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("ol",[e("li",[s._v("安装Docker所需要的包：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("yum install -y yum-utils \\\n  device-mapper-persistent-data \\\n  lvm2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ol",[e("li",[s._v("设置稳定的仓库：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("yum-config-manager \\\n    --add-repo \\\n    https://download.docker.com/linux/centos/docker-ce.repo\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ol",[e("li",[s._v("安装最新版的Docker引擎：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("yum install docker-ce docker-ce-cli containerd.io\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ol",[e("li",[s._v("启动Docker：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("systemctl start docker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("查看是否安装成功：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/24/myhhK1.png",alt:"143.png"}})]),s._v(" "),e("h3",{attrs:{id:"安装docker-compose"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装docker-compose"}},[s._v("#")]),s._v(" 安装Docker Compose")]),s._v(" "),e("p",[s._v("安装好Docker后，我们接着安装Docker Compose，官方安装教程 https://docs.docker.com/compose/install/，主要步骤为：")]),s._v(" "),e("ol",[e("li",[s._v("获取Docker Compose的最新稳定版本：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('curl -L "https://github.com/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ol",[e("li",[s._v("对二进制文件授予可执行权限：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("chmod +x /usr/local/bin/docker-compose\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ol",[e("li",[s._v("创建link：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("查看是否安装成功：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/24/myIY4O.png",alt:"144.png"}})]),s._v(" "),e("h3",{attrs:{id:"docker-compose搭建elk"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose搭建elk"}},[s._v("#")]),s._v(" Docker Compose搭建ELK")]),s._v(" "),e("p",[s._v("在搭建ELK之前，我们需要做一些准备工作。")]),s._v(" "),e("p",[s._v("正如官方所说的那样 https://www.elastic.co/guide/en/elasticsearch/reference/current/vm-max-map-count.html，Elasticsearch默认使用mmapfs目录来存储索引。操作系统默认的mmap计数太低可能导致内存不足，我们可以使用下面这条命令来增加内存：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sysctl -w vm.max_map_count=262144\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("创建Elasticsearch数据挂载路径：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mkdir -p /febs/elasticsearch/data\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("对该路径授予777权限：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("chmod 777 /febs/elasticsearch/data\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("创建Elasticsearch插件挂载路径：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mkdir -p /febs/elasticsearch/plugins\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("创建Logstash配置文件存储路径：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mkdir -p /febs/logstash\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("在该路径下创建"),e("code",[s._v("logstash-febs.conf")]),s._v("配置文件（没有安装vim的话可以使用"),e("code",[s._v("yum install vim")]),s._v("命令安装）：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("vim /febs/logstash/logstash-febs.conf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("内容如下所示：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('input {\n  tcp {\n    mode => "server"\n    host => "0.0.0.0"\n    port => 4560\n    codec => json_lines\n  }\n}\noutput {\n  elasticsearch {\n    hosts => "es:9200"\n    index => "febs-logstash-%{+YYYY.MM.dd}"\n  }\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("p",[s._v("创建ELK Docker Compose文件存储路径：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mkdir -p /febs/elk\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("在该目录下创建"),e("code",[s._v("docker-compose.yml")]),s._v("文件：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("vim /febs/elk/docker-compose.yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("内容如下所示：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('version: \'3\'\nservices:\n  elasticsearch:\n    image: elasticsearch:6.4.1\n    container_name: elasticsearch\n    environment:\n      - "cluster.name=elasticsearch" #集群名称为elasticsearch\n      - "discovery.type=single-node" #单节点启动\n      - "ES_JAVA_OPTS=-Xms512m -Xmx512m" #jvm内存分配为512MB\n    volumes:\n      - /febs/elasticsearch/plugins:/usr/share/elasticsearch/plugins\n      - /febs/elasticsearch/data:/usr/share/elasticsearch/data\n    ports:\n      - 9200:9200\n  kibana:\n    image: kibana:6.4.1\n    container_name: kibana\n    links:\n      - elasticsearch:es #配置elasticsearch域名为es\n    depends_on:\n      - elasticsearch\n    environment:\n      - "elasticsearch.hosts=http://es:9200" #因为上面配置了域名，所以这里可以简写为http://es:9200\n    ports:\n      - 5601:5601\n  logstash:\n    image: logstash:6.4.1\n    container_name: logstash\n    volumes:\n      - /febs/logstash/logstash-febs.conf:/usr/share/logstash/pipeline/logstash.conf\n    depends_on:\n      - elasticsearch\n    links:\n      - elasticsearch:es\n    ports:\n      - 4560:4560\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br")])]),e("p",[s._v("切换到"),e("code",[s._v("/febs/elk")]),s._v("目录下，使用如下命令启动：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose up -d\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("第一次启动的时候，Docker需要拉取ELK镜像，过程可能稍慢，耐心等待即可。成功启动后，观察容器运行情况：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/24/myLEQS.png",alt:"145.png"}})]),s._v(" "),e("p",[s._v("三个容器都已经启动成功。")]),s._v(" "),e("h3",{attrs:{id:"logstash中安装json-lines插件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#logstash中安装json-lines插件"}},[s._v("#")]),s._v(" Logstash中安装json_lines插件")]),s._v(" "),e("p",[s._v("使用如下命令进入到Logstash容器中：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker exec -it logstash /bin/bash\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("切换到/bin目录，安装json_lines插件，然后退出：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/24/myLgwd.png",alt:"146.png"}})]),s._v(" "),e("p",[s._v("使用浏览器访问"),e("a",{attrs:{href:"http://192.168.33.10:5601/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://192.168.33.10:5601"),e("OutboundLink")],1),s._v("便可以看到Kibana管理界面：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/24/myLOkn.png",alt:"147.png"}})]),s._v(" "),e("h2",{attrs:{id:"修改微服务日志配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改微服务日志配置"}},[s._v("#")]),s._v(" 修改微服务日志配置")]),s._v(" "),e("p",[s._v("就目前微服务模块来说，我们比较关注febs-auth、febs-gateway、febs-server-system和febs-server-test模块的日志，所以我们分别在febs-auth、febs-gateway和febs-server模块的pom里引入"),e("code",[s._v("Logstash")]),s._v("依赖：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("<dependency>\n    <groupId>net.logstash.logback</groupId>\n    <artifactId>logstash-logback-encoder</artifactId>\n    <version>6.1</version>\n</dependency>\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("然后在febs-auth、febs-gateway、febs-server-system和febs-server-test模块的日志配置文件"),e("code",[s._v("logback-spring.xml")]),s._v("里添加如下配置：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('\x3c!--输出到 logstash的 appender--\x3e\n<appender name="logstash" class="net.logstash.logback.appender.LogstashTcpSocketAppender">\n    <destination>192.168.33.10:4560</destination>\n    <encoder charset="UTF-8" class="net.logstash.logback.encoder.LogstashEncoder"/>\n</appender>\n\n......\n<root level="info">\n    ......\n    <appender-ref ref="logstash" />\n</root>\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[e("code",[s._v("192.168.33.10:4560")]),s._v("对应我们刚刚搭建的Logstash地址。")]),s._v(" "),e("h2",{attrs:{id:"演示"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#演示"}},[s._v("#")]),s._v(" 演示")]),s._v(" "),e("p",[s._v("依次启动febs-register、febs-gateway、febs-auth、febs-server-system和febs-server-test模块，然后回到Kibana管理界面创建Kinaba Index Patterns：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/24/m69iJH.png",alt:"148.png"}})]),s._v(" "),e("p",[s._v("在Index pattern里输入我们在logstash配置文件"),e("code",[s._v("logstash-febs.conf")]),s._v("里"),e("code",[s._v("output.index")]),s._v("指定的值"),e("code",[s._v("febs-logstash-*")]),s._v("：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/24/m693Ss.png",alt:"149.png"}})]),s._v(" "),e("p",[s._v("点击Next Step，在下拉框里选择"),e("code",[s._v("@timestamp")]),s._v("：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/24/m69yOx.png",alt:"150.png"}})]),s._v(" "),e("p",[s._v("最后点击Create Index Pattern按钮完成创建。")]),s._v(" "),e("p",[s._v("使用PostMan获取令牌：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/24/m69jhQ.png",alt:"151.png"}})]),s._v(" "),e("p",[s._v("然后发送一笔"),e("a",{attrs:{href:"localhost:8301/test/hello?name=%E5%A4%8F%E5%A4%A9"}},[s._v("localhost:8301/test/hello?name=夏天")]),s._v("请求：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/24/m6CCn0.png",alt:"152.png"}})]),s._v(" "),e("p",[s._v("在Kibana里搜索这笔日志：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/24/m6C3ND.png",alt:"153.png"}})]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/24/m6CwHf.png",alt:"154.png"}})]),s._v(" "),e("p",[s._v("日志收集成功。")]),s._v(" "),e("p",[s._v("整合ELK后，我们的系统架构图如下所示：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/31/mxlFNq.png",alt:"A06.png"}})])])}),[],!1,null,null,null);e.default=t.exports}}]);