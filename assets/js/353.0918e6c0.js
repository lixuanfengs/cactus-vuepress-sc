(window.webpackJsonp=window.webpackJsonp||[]).push([[353],{705:function(s,e,a){"use strict";a.r(e);var t=a(0),n=Object(t.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("FEBS Cloud Web使用的HTTP请求插件为 "),e("a",{attrs:{href:"https://github.com/axios/axios",target:"_blank",rel:"noopener noreferrer"}},[s._v("Axios"),e("OutboundLink")],1),s._v("。Axios是一款基于Promise，用于浏览器和node.js的HTTP客户端，我们可以对Axios进行一些封装，让后续使用更为方便。")]),s._v(" "),e("p",[s._v("在FEBS Cloud Web的src/utils目录下，我们创建了request.js文件，在该文件头部，我们引入了下面这些模块：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import axios from 'axios'\nimport { Message } from 'element-ui'\nimport store from '@/store/index'\nimport { getToken, getRefreshToken, getExpireTime } from '@/utils/auth'\nimport NProgress from 'nprogress'\nimport 'nprogress/nprogress.css'\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[e("code",[s._v("@/")]),s._v("是在vue.config.js里自定义别名，代表项目src目录。")]),s._v(" "),e("ol",[e("li",[e("code",[s._v("import axios from 'axios'")]),s._v("引入了Axios组件；")]),s._v(" "),e("li",[e("code",[s._v("import { Message } from 'element-ui'")]),s._v("引入了Element的"),e("a",{attrs:{href:"https://element.eleme.cn/#/zh-CN/component/message",target:"_blank",rel:"noopener noreferrer"}},[s._v("消息提示组件"),e("OutboundLink")],1),s._v("；")]),s._v(" "),e("li",[e("code",[s._v("import store from '@/store/index'")]),s._v("引入了Vuex，用于后续存储信息（用户信息等）使用；")]),s._v(" "),e("li",[e("code",[s._v("import NProgress from 'nprogress'")]),s._v("引入了NProgress组件，即网页头部加载的进度条插件；")]),s._v(" "),e("li",[e("code",[s._v("import { getToken, getRefreshToken, getExpireTime } from '@/utils/auth'")]),s._v("引入了"),e("code",[s._v("@/utils/auth")]),s._v("文件中暴露的三个方法，"),e("code",[s._v("@/utils/auth.js")]),s._v("源码如下所示：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import db from '@/utils/localstorage'\n\nexport function getToken() {\n  return db.get('ACCESS_TOKEN', '')\n}\n\nexport function getRefreshToken() {\n  return db.get('REFRESH_TOKEN', '')\n}\n\nexport function getExpireTime() {\n  return db.get('EXPIRE_TIME', 0)\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[s._v("其中"),e("code",[s._v("db")]),s._v("对象为封装后的"),e("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/localStorage",target:"_blank",rel:"noopener noreferrer"}},[s._v("LocalStorage"),e("OutboundLink")],1),s._v("，具体可以阅读"),e("code",[s._v("@/utils/localstorage.js")]),s._v("的源码。"),e("code",[s._v("getToken")]),s._v("方法用于从浏览器内存中获取访问令牌（登录成功的时候，我们将令牌信息存储到浏览器内存中，后续会介绍到）；"),e("code",[s._v("getRefreshToken")]),s._v("方法用于从浏览器内存里获取刷新令牌（刷新令牌的时候后续会介绍到，也是在登录成功后存储到浏览器内存中的）；"),e("code",[s._v("getExpireTime")]),s._v("用于获取访问令牌的有效时间。")]),s._v(" "),e("blockquote",[e("p",[s._v("import,export为ES6新增的JS模块化特性，具体可以参考：http://es6.ruanyifeng.com/#docs/module")])]),s._v(" "),e("h2",{attrs:{id:"创建请求对象"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建请求对象"}},[s._v("#")]),s._v(" 创建请求对象")]),s._v(" "),e("p",[s._v("在request.js里，我们通过下面这段代码创建了一个Axios对象：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const service = axios.create({\n  baseURL: process.env.VUE_APP_BASE_API,\n  timeout: 10000,\n  responseType: 'json',\n  validateStatus(status) {\n    return status === 200\n  }\n})\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("ol",[e("li",[e("code",[s._v("baseURL")]),s._v("请求的基本路径前缀。因为和后端的交互都是通过微服务网关来完成的，所以在开发环境下，该值为vue.config.js里定义的"),e("code",[s._v("http://localhost:8301/")]),s._v("，当系统部署打包部署到生产环境时，请修改env.production文件里的"),e("code",[s._v("VUE_APP_BASE_API")]),s._v("值；")]),s._v(" "),e("li",[e("code",[s._v("timeout")]),s._v("请求超时时间，这里为10000毫秒，即10秒钟；")]),s._v(" "),e("li",[e("code",[s._v("responseType")]),s._v("响应数据格式，这里使用JSON格式；")]),s._v(" "),e("li",[e("code",[s._v("validateStatus")]),s._v("方法里指定了只有当后端系统返回200HTTP状态码的时候，才认定请求成功，否则将认定为失败（可根据实际情况修改，比如在某些系统中，204状态码也是成功的）。")])]),s._v(" "),e("p",[s._v("创建好请求对象service后，后续的Axios操作都基于该对象。")]),s._v(" "),e("h2",{attrs:{id:"拦截请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#拦截请求"}},[s._v("#")]),s._v(" 拦截请求")]),s._v(" "),e("p",[s._v("接着我们在request.js里配置了请求拦截器，代码如下所示：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("service.interceptors.request.use(\n  config => {\n    if (getToken()) {\n      config.headers['Authorization'] = 'bearer ' + getToken()\n    }\n    return config\n  },\n  error => {\n    console.error(error)\n    return Promise.reject(error)\n  }\n)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("请求拦截器的任务很简单，就是在发送请求前，判断浏览器内存中是否含有后端访问令牌，有的话在HTTP请求头部携带该令牌，key为"),e("code",[s._v("Authorization")]),s._v("，value为"),e("code",[s._v("bearer")]),s._v("+令牌，这和我们之前通过PostMan发送测试请求做法一致。")]),s._v(" "),e("p",[s._v("上面代码第二个参数用于打印发送请求之前出现的异常信息，比如在处理请求参数时发送的异常。")]),s._v(" "),e("h2",{attrs:{id:"拦截响应"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#拦截响应"}},[s._v("#")]),s._v(" 拦截响应")]),s._v(" "),e("p",[s._v("传统的后端系统，响应数据一般是下面这种格式：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('{\n   "code": "200",\n   "message": "请求成功",\n   ......\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("请求是否成功通过返回数据的"),e("code",[s._v("code")]),s._v("字段判断。FEBS Cloud并没有采用这种方式，而是直接通过HTTP状态码来判断。因为HTTP响应里都会包含HTTP状态码，所以就没必要再通过一个"),e("code",[s._v("code")]),s._v("字段来表达响应状态了，这样做也更符合RESTful的风格。")]),s._v(" "),e("p",[s._v("于是，我们可以定义一个Axios响应拦截器，根据不同的HTTP状态码作出不同的响应")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("service.interceptors.response.use((config) => {\n  return config\n}, (error) => {\n  if (error.response) {\n    const errorMessage = error.response.data === null ? '系统内部异常，请联系网站管理员' : error.response.data.message\n    switch (error.response.status) {\n      case 404:\n        Message({\n          message: '很抱歉，资源未找到' || 'Error',\n          type: 'error',\n          duration: 5 * 1000\n        })\n        break\n      case 403:\n        Message({\n          message: '很抱歉，您暂无该操作权限' || 'Error',\n          type: 'error',\n          duration: 5 * 1000\n        })\n        break\n      case 401:\n        Message({\n          message: '很抱歉，认证已失效，请重新登录' || 'Error',\n          type: 'error',\n          duration: 5 * 1000\n        })\n        break\n      default:\n        if (errorMessage) {\n          Message({\n            message: errorMessage,\n            type: 'error',\n            duration: 5 * 1000\n          })\n        }\n        break\n    }\n  }\n  return Promise.reject(error)\n})\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br")])]),e("p",[s._v("如上面代码所写的那样，我们根据不同的HTTP状态码，使用Element UI的消息提示组件作出了不同的提示，这样我们就不必在每个请求中通过"),e("code",[s._v("catch")]),s._v("块来一一判断处理了。")]),s._v(" "),e("p",[s._v("当然，如果你不想使用上面定义的默认行为，你也可以自己通过"),e("code",[s._v("catch")]),s._v("块对特定的HTTP状态码作特殊处理。")]),s._v(" "),e("h2",{attrs:{id:"封装rest风格请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#封装rest风格请求"}},[s._v("#")]),s._v(" 封装REST风格请求")]),s._v(" "),e("p",[s._v("FEBS Cloud后端接口采用RESTful风格，下面简单介绍下什么是RESTful。")]),s._v(" "),e("p",[s._v("REST实际上为"),e("strong",[s._v("Re")]),s._v("presentational "),e("strong",[s._v("S")]),s._v("tate "),e("strong",[s._v("T")]),s._v("ransfer的缩写，翻译为“表现层状态转化” 。如果一个架构符合REST 原则，就称它为RESTful架构。")]),s._v(" "),e("p",[s._v("实际上，“表现层状态转化”省略了主语，完整的说应该是“资源表现层状态转化”。什么是资源（Resource）？资源指的是网络中信息的表现形式，比如一段文本，一首歌，一个视频文件等等；什么是表现层（Reresentational）？表现层即资源的展现在你面前的形式，比如文本可以是JSON格式的，也可以是XML形式的，甚至为二进制形式的。图片可以是gif，也可以是PNG；什么是状态转换（State Transfer）？用户可使用URL通过HTTP协议来获取各种资源，HTTP协议包含了一些操作资源的方法，比如：GET 用来获取资源， POST 用来新建资源 , PUT 用来更新资源， DELETE 用来删除资源， PATCH 用来更新资源的部分属性。通过这些HTTP协议的方法来操作资源的过程即为状态转换。")]),s._v(" "),e("p",[s._v("下面对比下传统URL请求和RESTful风格请求的区别：")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[s._v("描述")]),s._v(" "),e("th",{staticStyle:{"text-align":"left"}},[s._v("传统请求")]),s._v(" "),e("th",{staticStyle:{"text-align":"left"}},[s._v("方法")]),s._v(" "),e("th",{staticStyle:{"text-align":"left"}},[s._v("REST请求")]),s._v(" "),e("th",{staticStyle:{"text-align":"left"}},[s._v("方法")])])]),s._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("查询")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("/user/query?name=mrbird")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("GET")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("/user?name=mrbird")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("GET")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("详情")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("/user/getInfo?id=1")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("GET")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("/user/1")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("GET")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("创建")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("/user/create?name=mrbird")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("POST")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("/user")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("POST")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("修改")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("/user/update?name=mrbird&id=1")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("POST")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("/user/1")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("PUT")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("删除")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("/user/delete?id=1")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("GET")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("/user/1")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("DELETE")])])])]),s._v(" "),e("p",[s._v("从上面这张表，我们大致可以总结下传统请求和RESTful请求的几个区别：")]),s._v(" "),e("ol",[e("li",[s._v("传统请求通过URL来描述行为，如create，delete等；RESTful请求通过URL来描述资源。")]),s._v(" "),e("li",[s._v("RESTful请求通过HTTP请求的方法来描述行为，比如DELETE，POST，PUT等，并且使用HTTP状态码来表示不同的结果。")]),s._v(" "),e("li",[s._v("RESTful请求通过JSON来交换数据。")])]),s._v(" "),e("p",[s._v("总而言之，RESTful只是一种风格，并不是一种强制性的标准。")]),s._v(" "),e("p",[s._v("为了向后端发送不同的请求（如GET，POST，PUT，DELETE等），我们通过上面创建的service Axios对象封装几个相应的方法：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const request = {\n  login(url, params) {\n    params['grant_type'] = 'password'\n    return service.post(url, params, {\n      transformRequest: [(params) => {\n        return tansParams(params)\n      }],\n      headers: {\n        'Authorization': 'Basic ZmViczoxMjM0NTY='\n      }\n    })\n  },\n  post(url, params) {\n    return service.post(url, params, {\n      transformRequest: [(params) => {\n        return tansParams(params)\n      }],\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded'\n      }\n    })\n  },\n  put(url, params) {\n    return service.put(url, params, {\n      transformRequest: [(params) => {\n        return tansParams(params)\n      }],\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded'\n      }\n    })\n  },\n  get(url, params) {\n    let _params\n    if (Object.is(params, undefined)) {\n      _params = ''\n    } else {\n      _params = '?'\n      for (const key in params) {\n        if (params.hasOwnProperty(key) && params[key] !== null) {\n          _params += `${key}=${params[key]}&`\n        }\n      }\n    }\n    return service.get(`${url}${_params}`)\n  },\n  delete(url, params) {\n    let _params\n    if (Object.is(params, undefined)) {\n      _params = ''\n    } else {\n      _params = '?'\n      for (const key in params) {\n        if (params.hasOwnProperty(key) && params[key] !== null) {\n          _params += `${key}=${params[key]}&`\n        }\n      }\n    }\n    return service.delete(`${url}${_params}`)\n  },\n}\n\nfunction tansParams(params) {\n  let result = ''\n  Object.keys(params).forEach((key) => {\n    if (!Object.is(params[key], undefined) && !Object.is(params[key], null)) {\n      result += encodeURIComponent(key) + '=' + encodeURIComponent(params[key]) + '&'\n    }\n  })\n  return result\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br")])]),e("p",[s._v("上面代码中，我们主要封装了几个请求方法。"),e("code",[s._v("get(url, params)")]),s._v("方法用于发送GET请求，"),e("code",[s._v("post(url, params)")]),s._v("用于发送POST请求，"),e("code",[s._v("put(url, params)")]),s._v("方法用于发送PUT请求，"),e("code",[s._v("delete(url, params)")]),s._v("用于发送DELETE请求。这些方法的具体用法下面会介绍到。")]),s._v(" "),e("p",[s._v("此外，我们还定义了一个"),e("code",[s._v("login(url, params)")]),s._v("方法，用于处理用户登录获取访问令牌。在第一章搭建认证服务器时，我们曾使用PostMan发送获取令牌请求，请求头部需要指定如下内容：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/08/26/mfIrpq.png",alt:"155.png"}})]),s._v(" "),e("p",[s._v("这个值为认证服务器里配置的"),e("code",[s._v("client_id:client_secret")]),s._v("经过Base64编码后的值，所以我们在"),e("code",[s._v("login(url, params)")]),s._v("方法里添加了该请求头，并且请求参数里指定"),e("code",[s._v("grant_type")]),s._v("为"),e("code",[s._v("password")]),s._v("。")]),s._v(" "),e("h2",{attrs:{id:"全局注册"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#全局注册"}},[s._v("#")]),s._v(" 全局注册")]),s._v(" "),e("p",[s._v("在request.js文件末尾，我们通过"),e("code",[s._v("export default request")]),s._v("将request对象暴露出去，接着在src/main.js里对request对象暴露的几个方法进行了全局注册：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import Vue from 'vue'\nimport request from '@/utils/request'\n......\n\nVue.prototype.$post = request.post\nVue.prototype.$get = request.get\nVue.prototype.$put = request.put\nVue.prototype.$delete = request.delete\nVue.prototype.$login = request.login\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("这样，这几个方法就变成了Vue的属性了，在项目里可以直接通过"),e("code",[s._v("this.")]),s._v("的方式来调用。")]),s._v(" "),e("h3",{attrs:{id:"发送get请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#发送get请求"}},[s._v("#")]),s._v(" 发送GET请求")]),s._v(" "),e("p",[s._v("比如，我们要发送一笔GET请求，可以这样做：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("this.$get(uri, {\n   ...params\n}).then((r) => {\n   console.log(r)\n})\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("使用路径参数：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("this.$get(`uri/${param}`).then((r) => {\n  console.log(r)\n})\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("也可以直接使用URI传参：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("this.$get(`uri?key=${value}`).then((r) => {\n  console.log(r)\n})\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"发送post请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#发送post请求"}},[s._v("#")]),s._v(" 发送POST请求")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("this.$post(uri, {\n   ...params\n}).then((r) => {\n   console.log(r)\n})\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"发送put请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#发送put请求"}},[s._v("#")]),s._v(" 发送PUT请求")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("this.$put(uri, {\n   ...params\n}).then((r) => {\n   console.log(r)\n})\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"delete请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#delete请求"}},[s._v("#")]),s._v(" DELETE请求")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("this.$delete(`uri/${param}`).then((r) => {\n   console.log(r)\n})\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])])])}),[],!1,null,null,null);e.default=n.exports}}]);