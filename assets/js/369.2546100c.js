(window.webpackJsonp=window.webpackJsonp||[]).push([[369],{718:function(s,e,a){"use strict";a.r(e);var t=a(0),n=Object(t.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("这一节我们需要安装的内容较多，包括Docker、Docker Compose、MySQL、Redis、ELK等软件。")]),s._v(" "),e("h2",{attrs:{id:"时区设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#时区设置"}},[s._v("#")]),s._v(" 时区设置")]),s._v(" "),e("p",[s._v("调整master、node1、node2、node3、nfs和extend这几台虚拟机的时区：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("yum -y install ntp\n#通过阿里云时间服务器校准时间\nntpdate ntp1.aliyun.com\n# 设置时区为上海\ntimedatectl set-timezone Asia/Shanghai\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("因为时区不正确的话，会影响令牌有效性校验。")]),s._v(" "),e("p",[s._v("设置后，使用"),e("code",[s._v("timedatectl")]),s._v("命令查看下时间是否和当前北京时间相符合。")]),s._v(" "),e("h2",{attrs:{id:"安装docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装docker"}},[s._v("#")]),s._v(" 安装Docker")]),s._v(" "),e("p",[s._v("后续需要安装的kubernetes集群版本为1.16.2，该版本的kubernetes最高支持的docker版本为18.09。可以通过该地址查看kubernetes和docker的版本对应关系：https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.16.md#downloads-for-v1160：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/12/06/QYNyXF.png",alt:"525.png"}})]),s._v(" "),e("p",[s._v("需要安装Docker的虚拟机有：master、node1、node2、node3和extend，下面以master为例，演示如何安装Docker 18.09。")]),s._v(" "),e("p",[s._v("使用"),e("code",[s._v("vagrant ssh master")]),s._v("命令连接master虚拟机，然后通过"),e("code",[s._v("sudo -s")]),s._v("命令切换到root账号。")]),s._v(" "),e("p",[s._v("安装必要依赖:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("yum install -y yum-utils \\\n  device-mapper-persistent-data \\\n  lvm2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("添加docker稳定版仓库：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("yum-config-manager \\\n    --add-repo \\\n    https://download.docker.com/linux/centos/docker-ce.repo\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("安装18.09版本：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("yum -y install docker-ce-18.09.0 docker-ce-cli-18.09.0 containerd.io\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("启动docker，并设置开机自启：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("systemctl enable docker && systemctl start docker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("修改/etc/docker/daemon.json文件:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("vi /etc/docker/daemon.json\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("添加国内镜像加速地址：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('{\n  "registry-mirrors": [\n    "https://dockerhub.azk8s.cn",\n    "https://reg-mirror.qiniu.com",\n    "https://registry.docker-cn.com"\n  ]\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("重启docker：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("systemctl daemon-reload\nsystemctl restart docker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("验证下是否安装成功：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/12/06/QYUr4I.png",alt:"526.png"}})]),s._v(" "),e("h2",{attrs:{id:"安装docker-compose"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装docker-compose"}},[s._v("#")]),s._v(" 安装Docker compose")]),s._v(" "),e("p",[s._v("需要安装Docker Compose的虚拟机有：master和extend。以master为例：")]),s._v(" "),e("p",[s._v("下载Docker Compose文档版本：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('sudo curl -L "https://github.com/docker/compose/releases/download/1.25.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("对下载的文件添加可执行权限：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo chmod +x /usr/local/bin/docker-compose\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("创建软连接：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("测试一下是否安装成功：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/12/06/QYajQf.png",alt:"527.png"}})]),s._v(" "),e("h2",{attrs:{id:"安装mysql、redis"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装mysql、redis"}},[s._v("#")]),s._v(" 安装MySQL、Redis")]),s._v(" "),e("p",[s._v("在extend虚拟机上安装MySQL和Redis服务。")]),s._v(" "),e("p",[s._v("登录extend虚拟机后，在当前目录（/home/vagrant）下创建mysql-redis.yml配置文件：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("vi mysql-redis.yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("文件内容如下所示：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("version: '3'\n\nservices:\n  mysql:\n    image: mysql:5.7.24 # MySQL镜像\n    container_name: mysql # MySQL容器名称\n    environment:\n      MYSQL_ROOT_PASSWORD: 123456 # MySQL ROOT账号密码\n    ports:\n      - 3306:3306 # 端口映射\n    volumes:\n      - /febs/mysql/data:/var/lib/mysql #挂载 MySQL数据\n  redis:\n    image: redis:4.0.14 # Redis镜像\n    container_name: redis # Redis容器名称\n    command: redis-server /usr/local/etc/redis/redis.conf --appendonly yes # 表示通过挂载配置文件追加配置\n    volumes:\n      - /febs/redis/data:/data #挂载 Redis数据\n      - /febs/redis/conf/redis.conf:/usr/local/etc/redis/redis.conf #挂载 Redis配置\n    ports:\n      - 6379:6379 # 端口映射\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br")])]),e("p",[s._v("然后创建这些挂载目录：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mkdir -p /febs/mysql/data /febs/redis/data /febs/redis/conf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("创建redis挂载的配置文件redis.conf：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("vi /febs/redis/conf/redis.conf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("添加如下内容：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("requirepass 123456\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("然后运行如下命令创建MySQL和Redis容器：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose -f mysql-redis.yml up -d\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("启动好后，查看Docker容器状态：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('docker ps -a | grep -E "mysql|redis"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/12/06/QY0Nid.png",alt:"528.png"}})]),s._v(" "),e("p",[s._v("启动顺利，在Windows上使用Navicat测试下MySQL的连通性：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/12/06/QY0xOK.png",alt:"529.png"}})]),s._v(" "),e("p",[s._v("在MySQL下新建febs_cloud_base数据库：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/12/06/QYBG60.png",alt:"530.png"}})]),s._v(" "),e("p",[s._v("然后导入FEBS Cloud项目febs_cloud_base.sql脚本。")]),s._v(" "),e("p",[s._v("接着测试Redis的连通性，在windows下使用RedisDesktopManager连接Redis：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/12/06/QYBHnf.png",alt:"531.png"}})]),s._v(" "),e("p",[s._v("连接成功。")]),s._v(" "),e("h2",{attrs:{id:"安装elk"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装elk"}},[s._v("#")]),s._v(" 安装ELK")]),s._v(" "),e("p",[s._v("在extend虚拟机的/home/vagrant目录下新建elk.yml配置文件：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("vi elk.yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("内容如下所示：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('version: \'3\'\n\nservices:\n  elasticsearch:\n    image: elasticsearch:6.4.1\n    container_name: elasticsearch\n    restart: always\n    environment:\n      - cluster.name=elasticsearch\n      - xpack.security.enabled=false\n      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"\n      - node.name=elasticsearch_node_1\n      - "TZ=Asia/Shanghai"\n    volumes:\n      - /febs/elasticsearch/data:/usr/share/elasticsearch/data\n      - /febs/elasticsearch/logs:/usr/share/elasticsearch/logs\n      - /febs/elasticsearch/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml\n    ports:\n      - 9200:9200\n      - 9300:9300\n  kibana:\n    image: kibana:6.4.1\n    container_name: kibana\n    links:\n      - elasticsearch:es\n    depends_on:\n      - elasticsearch\n    environment:\n      - "elasticsearch.hosts=http://es:9200"\n    ports:\n      - 5601:5601\n  logstash:\n    image: logstash:6.4.1\n    container_name: logstash\n    volumes:\n      - /febs/logstash/logstash-febs.conf:/usr/share/logstash/pipeline/logstash.conf\n    depends_on:\n      - elasticsearch\n    links:\n      - elasticsearch:es\n    ports:\n      - 4560:4560\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br")])]),e("p",[s._v("ELK配置文件在前面的章节中都有介绍过，所以这里就不再赘述每个配置含义了。")]),s._v(" "),e("p",[s._v("同样的，在启动这些容器之前，我们先创建相应的挂载目录和配置文件：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 创建挂载目录\nmkdir -p /febs/elasticsearch/data /febs/elasticsearch/logs /febs/logstash\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("对Elasticsearch的挂载目录授予最高权限：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("chmod 777 -R /febs/elasticsearch\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("创建Elasticsearch配置文件elasticsearch.yml：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("vi /febs/elasticsearch/elasticsearch.yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("添加如下内容：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('http.host: 0.0.0.0\nhttp.cors.enabled: true\nhttp.cors.allow-origin: "*"\ntransport.host: 0.0.0.0\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("接着创建Logstash配置文件logstash-febs.conf：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("vi /febs/logstash/logstash-febs.conf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("添加如下内容：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('input {\n  tcp {\n    mode => "server"\n    host => "0.0.0.0"\n    port => 4560\n    codec => json_lines\n  }\n}\noutput {\n  elasticsearch {\n    hosts => "es:9200"\n    index => "febs-logstash-%{+YYYY.MM.dd}"\n  }\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("p",[s._v("Elasticsearch默认使用mmapfs目录来存储索引。操作系统默认的mmap计数太低可能导致内存不足，我们可以使用下面这条命令来增加内存：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sysctl -w vm.max_map_count=262144\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("准备完毕后，运行下面这条命令创建这些容器：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose -f elk.yml up -d\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("启动的时候要拉取镜像，稍等片刻后，查看容器状态：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/12/12/QyQRHK.png",alt:"532.png"}})]),s._v(" "),e("p",[s._v("可以看到容器都处于UP状态。")]),s._v(" "),e("p",[s._v("在Windows下使用浏览器访问：http://192.168.33.16:9200/：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/12/07/Qt5t5n.png",alt:"533.png"}})]),s._v(" "),e("p",[s._v("这说明Elasticsearch启动成功。")]),s._v(" "),e("p",[s._v("浏览器访问：http://192.168.33.16:5601/：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/12/07/Qt5Xxf.png",alt:"535.png"}})]),s._v(" "),e("p",[s._v("说明Kibana启动成功。")]),s._v(" "),e("p",[s._v("接着回到extend虚拟机，使用如下命令进入到Logstash容器中：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker exec -it logstash sh\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("切换到/bin目录，安装json_lines插件，然后退出：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s2.ax1x.com/2019/12/07/QtI1Rx.png",alt:"536.png"}})]),s._v(" "),e("h2",{attrs:{id:"小结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),e("p",[s._v("到这里，我们已经安装的服务有：")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[s._v("服务名")]),s._v(" "),e("th",{staticStyle:{"text-align":"left"}},[s._v("IP地址")]),s._v(" "),e("th",{staticStyle:{"text-align":"left"}},[s._v("端口号")])])]),s._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("MySQL")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.33.16")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("3306")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("Redis")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.33.16")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("6379")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("logstash")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.33.16")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("4560")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("kibana")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.33.16")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("5601")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("elasticsearch")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.33.16")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("9200、9300")])])])]),s._v(" "),e("p",[s._v("接下来，我们开始搭建K8S集群。")])])}),[],!1,null,null,null);e.default=n.exports}}]);