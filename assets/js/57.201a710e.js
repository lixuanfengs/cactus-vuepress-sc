(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{412:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"tomcat安装与使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tomcat安装与使用"}},[s._v("#")]),s._v(" tomcat安装与使用")]),s._v(" "),a("h3",{attrs:{id:"安装jdk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装jdk"}},[s._v("#")]),s._v(" 安装jdk")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar xf jdk-8u221-linux-x64.tar.gz -C /usr/local/")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /usr/local/jdk1.8.0_221/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑环境变量")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/profile.d/jdk.sh")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_HOME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/jdk1.8.0_221/\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/bin:"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使环境变量生效")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# . /etc/profile.d/jdk.sh")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证jdk是否安装完成")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# java -version")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" version "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.8.0_221"')]),s._v("\nJava"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" SE Runtime Environment "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("build "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.8")]),s._v(".0_221-b11"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nJava HotSpot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("-Bit Server VM "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("build "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25.221")]),s._v("-b11, mixed mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"安装tomcat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装tomcat"}},[s._v("#")]),s._v(" 安装tomcat")]),s._v(" "),a("h4",{attrs:{id:"解压源码包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解压源码包"}},[s._v("#")]),s._v(" 解压源码包")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar xf apache-tomcat-8.5.42.tar.gz  -C /usr/local/")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /usr/local/")]),s._v("\nroot@ubuntu1:/usr/local"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ln -sv apache-tomcat-8.5.42/  tomcat")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tomcat'")]),s._v(" -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apache-tomcat-8.5.42/'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"设置用户和组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置用户和组"}},[s._v("#")]),s._v(" 设置用户和组")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:/usr/local"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sudo useradd -m -U -d /opt/tomcat -s /bin/false tomcat")]),s._v("\nroot@ubuntu1:/usr/local/tomcat"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chown -R tomcat /usr/local/tomcat/*")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 赋予 bin 目录中的脚本可执行权限")]),s._v("\nroot@ubuntu1:/usr/local/tomcat"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  sudo sh -c 'chmod +x  /usr/local/tomcat/bin/*.sh'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"编辑启动脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编辑启动脚本"}},[s._v("#")]),s._v(" 编辑启动脚本")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat  /etc/systemd/system/tomcat.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Tomcat "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.5")]),s._v(" servlet container\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network.target\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forking\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("User")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tomcat\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Group")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tomcat\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"JAVA_HOME=/usr/local/jdk1.8.0_221/"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CATALINA_BASE=/usr/local/tomcat"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CATALINA_HOME=/usr/local/tomcat"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CATALINA_PID=/usr/local/tomcat/temp/tomcat.pid"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CATALINA_OPTS=-Xms512M -Xmx1024M -server -XX:+UseParallelGC"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/tomcat/bin/startup.sh\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStop")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/tomcat/bin/shutdown.sh\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("h4",{attrs:{id:"启动tomcat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动tomcat"}},[s._v("#")]),s._v(" 启动tomcat")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sudo systemctl daemon-reload")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sudo systemctl start tomcat")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"查看tomcat-状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看tomcat-状态"}},[s._v("#")]),s._v(" 查看tomcat 状态")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl status tomcat")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"查看tomcat监听端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看tomcat监听端口"}},[s._v("#")]),s._v(" 查看tomcat监听端口")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ss -ntl")]),s._v("\nLISTEN                  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("                                                          *:8080                                                  *:*\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"目录结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目录结构"}},[s._v("#")]),s._v(" 目录结构")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、bin:服务启动、停止等相关\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("、conf:配置文件\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("、lib:库目录\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("、logs:日志目录\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("、webapps:应用程序,应用部署目录\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("、work:jsp编译后的结果文件\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h4",{attrs:{id:"配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[s._v("#")]),s._v(" 配置文件")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、server.xml:主配置文件\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("、web.xml:每个webapp只有“部署”后才能被访问，它的部署方式通常由web.xml进行定义，其存放位置为WEB-INF/目录中；此文件为所有的webapps提供\n默认部署相关的配置\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("、context.xml:每个webapp都可以专用的配置文件，它通常由专用的配置文件context.xml来定义，其存放位置为WEB-INF/目录中；此文件为所有的\nwebapps提供默认配置\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("、tomcat-users.xml:用户认证的账号和密码文件\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("、catalina.policy:当使用-security选项启动tomcat时，用于为tomcat设置安全策略\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("、catalina.properties:Java属性的定义文件，用于设定类加载器路径，以及一些与JVM调优相关参数\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("、logging.properties:日志系统相关的配置\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"应用部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用部署"}},[s._v("#")]),s._v(" 应用部署")]),s._v(" "),a("h4",{attrs:{id:"根目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#根目录"}},[s._v("#")]),s._v(" 根目录")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、Tomcat中默认网站根目录是CATALINA_BASE/webapps/\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("、在Tomcat中部署主站应用程序和其他应用程序，和之前WEB服务程序不同\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("nginx \n假设在nginx中部署2个网站应用eshop、bbs，假设网站根目录是/var/www/html，那么部署可以是这样的。\neshop解压缩所有文件放到/var/www/html/目录下。\nbbs的文件放在/var/www/html/bbs下。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("Tomcat\nTomcat中默认网站根目录是CATALINA_BASE/webapps/\n在Tomcat的webapps目录中，有个非常特殊的目录ROOT，它就是网站默认根目录。\n将eshop解压后的文件放到这个ROOT中\nbbs解压后文件都放在CATALINA_BASE/webapps/bbs目录下\n每一个虚拟主机的目录都可以使用appBase配置自己的站点目录，里面都可以使用ROOT目录作为主站目录。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h4",{attrs:{id:"jsp-webapp目录结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jsp-webapp目录结构"}},[s._v("#")]),s._v(" JSP WebApp目录结构")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("主页配置：一般指定为index.jsp或index.html\nWEB-INF/：当前WebApp的私有资源路径，通常存储当前应用使用的web.xml和context.xml配置文件\nMETA-INF/：类似于WEB-INF\nclasses/：类文件，当前webapp需要的类\nlib/：当前应用依赖的jar包\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"webapp归档格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webapp归档格式"}},[s._v("#")]),s._v(" "),a("strong",[s._v("webapp")]),s._v("归档格式")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(".war：WebApp打包\n.jar：EJB类打包文件\n.rar：资源适配器类打包文件\n.ear：企业级WebApp打包\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("传统应用开发测试后，通常打包为war格式，这种文件部署到了Tomcat的webapps下，还可以自动展开。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Host "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("appBase")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"webapps"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("unpackWARs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("autoDeploy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"部署deploy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署deploy"}},[s._v("#")]),s._v(" "),a("strong",[s._v("部署")]),s._v("Deploy")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、部署：将webapp的源文件放置到目标目录，通过web.xml和context.xml文件中配置的路径就可以访问该webapp，通过类加载器加载其特有的类和依赖的类到JVM上。\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("、自动部署Auto Deploy：Tomcat发现多了这个应用就把它加载并启动起来\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("、手动部署\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、冷部署：将webapp放到指定目录，才去启动Tomcat\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("、热部署：Tomcat服务不停止，需要依赖manager、ant脚本、tcd（tomcat client \ndeployer）等工具\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:/usr/local/tomcat/webapps/ROOT"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat test.jsp")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("%@ page "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("language")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("contentType")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text/html; charset=UTF-8"')]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pageEncoding")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UTF-8"')]),s._v("%"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("DOCTYPE html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("head"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("meta "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("charset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"utf-8"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("title"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("jsp例子"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/title"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/head"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("body"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                 后面的内容是服务器端动态生成字符串，最后拼接在一起\n                 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("%\n                 out.println"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello jsp"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                 %"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                 %"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("br"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                 %"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("request.getRequestURL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                 %"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/body"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n         %"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试访问")]),s._v("\nhttp://10.2.32.10:8080/test.jsp\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 模拟部署一个应用")]),s._v("\nroot@ubuntu1:/usr/local/tomcat/webapps"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir myapp")]),s._v("\nroot@ubuntu1:/usr/local/tomcat/webapps"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp ROOT/test.jsp  myapp/index.jsp")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试访问")]),s._v("\nhttp://10.2.32.10:8080/myapp/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"配置详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置详解"}},[s._v("#")]),s._v(" 配置详解")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 8005是Tomcat的管理端口，默认监听在127.0.0.1上。SHUTDOWN这个字符串接收到后就会关闭此Server。")]),s._v("\nroot@ubuntu1:/usr/local/tomcat/conf"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim server.xml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Server "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8005"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("shutdown")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SHUTDOWN"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:/usr/local/tomcat/conf"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim server.xml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个管理功能建议禁用，改shutdown为一串猜不出的字符串    shutdown后面是md5值加密")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Server "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("shutdown")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fa7cda24e4e94031fb70956edfdfb33a"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这样改就不慌有人恶作剧了")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"用户认证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用户认证"}},[s._v("#")]),s._v(" 用户认证")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改配置文件")]),s._v("\nroot@ubuntu1:/usr/local/tomcat/conf"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tomcat-users.xml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("tomcat-users "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("xmlns")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://tomcat.apache.org/xml"')]),s._v("\n              xmlns:xsi"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://www.w3.org/2001/XMLSchema-instance"')]),s._v("\n              xsi:schemaLocation"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://tomcat.apache.org/xml tomcat-users.xsd"')]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("role "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rolename")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"manager-gui"')]),s._v("/"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("role "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rolename")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin-gui"')]),s._v("/"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("user "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("username")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wayne"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wayne"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("roles")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"manager-gui,admin-gui"')]),s._v("/"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/tomcat-users"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置白名单   本地用户访问")]),s._v("\nroot@ubuntu1:/usr/local/tomcat/webapps/manager/META-INF"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim context.xml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Valve "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("className")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"org.apache.catalina.valves.RemoteAddrValve"')]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("allow")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^.*$"')]),s._v(" /"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n root@ubuntu1:/usr/local/tomcat/webapps/host-manager/META-INF"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim context.xml ")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 虚拟主机")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Valve "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("className")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"org.apache.catalina.valves.RemoteAddrValve"')]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("allow")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^.*$"')]),s._v(" /"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         \n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启tomcat        ")]),s._v("\n root@ubuntu1:/usr/local/tomcat/webapps/manager/META-INF"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart tomcat")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试访问    账号:wayne 密码:wayne")]),s._v("\nhttp://10.2.32.10:8080/manager/html\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"虚拟主机配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#虚拟主机配置"}},[s._v("#")]),s._v(" 虚拟主机配置")]),s._v(" "),a("p",[s._v("defaultHost指向内部定义某虚拟主机。缺省虚拟主机可以改动，默认localhost")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Host "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("appBase")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"webapps"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("unpackWARs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("autoDeploy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("虚拟主机配置：\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、name必须是主机名，用主机名来匹配。\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("、appBase，当前主机的网页根目录，是相对于CATALINA_HOME，也可以使用绝对路径\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("、unpackWARs是否自动解压war格式\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("、autoDeploy 热部署，自动加载并运行应用\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 虚拟主机配置实验")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir -p /data/webapps")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp /usr/local/tomcat/webapps/myapp/   /data/webapps/ROOT -r")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑配置文件")]),s._v("\nroot@ubuntu1:/usr/local/tomcat/conf"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim server.xml")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Host "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"www.xiaomao.com"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("appBase")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/webapps"')]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("unpackWARs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("autoDeploy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/Host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启测试  ")]),s._v("\nhttp://www.xiaomao.com:8080/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"context配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#context配置"}},[s._v("#")]),s._v(" "),a("strong",[s._v("Context配置")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("Context作用：\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、路径映射\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("、应用独立配置，例如单独配置应用日志、单独配置应用访问控制\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试  项目代码")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp /usr/local/tomcat/webapps/myapp/   /data/myappv1/  -r")]),s._v("\nroot@ubuntu1:/data"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ln -sv myappv1/  test")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),s._v(" -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'myappv1/'")]),s._v("\nroot@ubuntu1:/data"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\ndrwxr-xr-x  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":58 ./\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" 06:00 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/\ndrwxr-xr-x  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":58 myappv1/\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":54 nginx/\nlrwxrwxrwx  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":58 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" myappv1/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Context "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/test"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("docBase")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/test"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("reloadable")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"false"')]),s._v(" /"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("path指的是访问的路径\ndocBase，可以是绝对路径，也可以是相对路径（相对于Host的appBase）\nreloadable，true表示如果WEB-INF/classes或META-INF/lib目录下.class文件有改动，就会将WEB应用\n重新加载，性能消耗很大。生成环境中，会使用false来禁用。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改配置文件")]),s._v("\nroot@ubuntu1:/usr/local/tomcat/conf"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim server.xml")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Host "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"www.xiaomao.com"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("appBase")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/webapps"')]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("unpackWARs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("autoDeploy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Context "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/test"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("docBase")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/test"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("reloadable")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"false"')]),s._v(" /"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/Host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("strong",[s._v("注意")]),s._v("：这里特别使用了软链接，原因就是以后版本升级，需要将软链接指向myappv2，重启Tomcat。如果新版上线后，出现问题，重新修改软链接到上一个版本的目录，并重启，就可以实现回滚。")]),s._v(" "),a("h3",{attrs:{id:"nginx-tomcat-实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-tomcat-实践"}},[s._v("#")]),s._v(" Nginx+tomcat 实践")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 单机反向代理")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat linux39.conf")]),s._v("\n location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            index  index.html  index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_pass http://10.2.32.10:8080/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启测试访问")]),s._v("\nhttp://10.2.32.10/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h4",{attrs:{id:"动静分离"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动静分离"}},[s._v("#")]),s._v(" 动静分离")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n root /data/webapps/ROOT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n index index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ~* 不区分大小写")]),s._v("\nlocation ~* "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(".jsp$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n proxy_pass http://www.xiaomao.com:8080"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /etc/hosts")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注释:在/data/webapps/ROOT目录下增加一个index.html。")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h1",{attrs:{id:"nginx安装与使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx安装与使用"}},[s._v("#")]),s._v(" nginx安装与使用")]),s._v(" "),a("h2",{attrs:{id:"nginx基础"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx基础"}},[s._v("#")]),s._v(" Nginx基础")]),s._v(" "),a("h3",{attrs:{id:"nginx功能介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx功能介绍"}},[s._v("#")]),s._v(" Nginx功能介绍")]),s._v(" "),a("p",[s._v("1、静态的web资源服务器HTML,图片,js,css,txt等静态资源")]),s._v(" "),a("p",[s._v("2、结合FastCGI/uWSGI/SCGI等协议反向代理动态资源请求")]),s._v(" "),a("p",[s._v("3、http/https协议的反向代理")]),s._v(" "),a("p",[s._v("4、imap4/pop3协议的方向代理")]),s._v(" "),a("p",[s._v("5、tcp/udp协议的请求转发(反向代理)")]),s._v(" "),a("h3",{attrs:{id:"基础特性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础特性"}},[s._v("#")]),s._v(" 基础特性")]),s._v(" "),a("p",[s._v("1、模块化设计，较好的扩展性")]),s._v(" "),a("p",[s._v("2、高可靠性")]),s._v(" "),a("p",[s._v("3、支持热部署:不停机更新配置文件,升级版本,更换日志文件")]),s._v(" "),a("p",[s._v("4、低内存消耗:10000个keep-alive连接模式下的非活动连接，仅需2.5M内存")]),s._v(" "),a("h3",{attrs:{id:"和web服务相关的功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#和web服务相关的功能"}},[s._v("#")]),s._v(" 和web服务相关的功能")]),s._v(" "),a("p",[s._v("1、虚拟主机(server)")]),s._v(" "),a("p",[s._v("2、支持keep-alive和管道连接(利用一个连接做多次请求)")]),s._v(" "),a("p",[s._v("3、访问日志(支持基于日志缓冲提高其性能)")]),s._v(" "),a("p",[s._v("4、url rewirte")]),s._v(" "),a("p",[s._v("5、路径别名")]),s._v(" "),a("p",[s._v("6、基于IP及用户的访问控制")]),s._v(" "),a("p",[s._v("7、支持速率限制及并发数限制")]),s._v(" "),a("p",[s._v("8、重新配置和在线升级无需中断客户的工作进程")]),s._v(" "),a("h3",{attrs:{id:"nginx组织结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx组织结构"}},[s._v("#")]),s._v(" Nginx组织结构")]),s._v(" "),a("p",[s._v("web请求处理机制:")]),s._v(" "),a("p",[s._v("1、多进程方式:服务器每接收到一个客户端就有服务器的主进程生成一个子进程响应客户端,直到用户关闭连接,这样的优势是处理速度快,各子进程之间相互独立,但是如果访问过大会导致服务器资源耗尽而无法提供请求")]),s._v(" "),a("p",[s._v("2、多线程方式:与多进程方式类似,但是每收到一个客户端请求会有服务进程派生出一个线程来对客户方进行交互,一个线程的开销远远小于一个进程,因此多线程方式在很大程度减轻了web服务器对系统资源的要求,但是多线程也有自已的缺点,即当多个线程位于同一个进程内工作的时候，可以相互访问同样的内存地址空间,所以他们相互影响，另外一旦主进程挂掉则所有子线程都不能工作了，IIS服务器使用了多线程的方式,需要间隔一段时间就重启一次才能稳定")]),s._v(" "),a("h3",{attrs:{id:"nginx模块介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx模块介绍"}},[s._v("#")]),s._v(" Nginx模块介绍")]),s._v(" "),a("p",[s._v("1、核心模块:是Nginx服务器正常运行必不可少的模块,提供错误日志记录、配置文件解析、事件驱动机制、进程管理等核心功能")]),s._v(" "),a("p",[s._v("2、标准HTTP模块:提供HTTP协议解析相关的功能:比如:端口配置、网页编码设置、HTTP响应头设置等等")]),s._v(" "),a("p",[s._v("3、可选HTTP模块:主要用于扩展标准的HTTP功能,让Nginx能处理一些特殊的服务,比如:Flash多媒体传输、解析GeoIP请求、网络传输压缩、安全协议SSL支持等")]),s._v(" "),a("p",[s._v("4、邮件服务模块:主要用于支持Nginx的邮件服务，包括对POP3协议、IMAP协议和SMTP协议的支持")]),s._v(" "),a("p",[s._v("5、第三方模块:是为了扩展Nginx服务器应用,完成开发者自定义功能,比如:Json支持、Lua支持等")]),s._v(" "),a("p",[s._v("6、Nginx高度模块化:但其模块早期不支持DSO机制；1.9.11版本支持动态装载和卸载")]),s._v(" "),a("h3",{attrs:{id:"模块分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模块分类"}},[s._v("#")]),s._v(" 模块分类")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、核心模块:core module\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("、标准模块:HTTP模块:ngx_http_*、\n          HTTP Core modules 默认功能\n          HTTP Optional modules  需编译时指定\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("、 Mail模块:ngx_mail_*\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("、Stream模块:ngx_stream_*\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"nginx安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx安装"}},[s._v("#")]),s._v(" Nginx安装")]),s._v(" "),a("p",[s._v("Nginx的安装版本分为Mainline version(主要开发版本,其实就是还处于开发版本)、Stable version(当前最新稳定版本)和Legacy versions(旧的稳定版)")]),s._v(" "),a("h4",{attrs:{id:"开始安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开始安装"}},[s._v("#")]),s._v(" 开始安装")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装依赖环境")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sudo apt install curl gnupg2 ca-certificates lsb-release ubuntu-keyring")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导入密钥")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl https://nginx.org/keys/nginx_signing.key | gpg --dearmor \\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /usr/share/keyrings/nginx-archive-keyring.gpg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证密钥")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gpg --dry-run --quiet --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导入稳定版本的源")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\')]),s._v("\nhttp://nginx.org/packages/ubuntu "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("lsb_release "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-cs")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(' nginx" '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/apt/sources.list.d/nginx.list\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#更新源")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt update")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 搜索Nginx版本")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt-cache madison nginx")]),s._v("\n     nginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.20")]),s._v(".1-1~bionic "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" http://nginx.org/packages/ubuntu bionic/nginx amd64 Packages\n     nginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.20")]),s._v(".0-1~bionic "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" http://nginx.org/packages/ubuntu bionic/nginx amd64 Packages\n     nginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.18")]),s._v(".0-2~bionic "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" http://nginx.org/packages/ubuntu bionic/nginx amd64 Packages\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开始安装Nginx ")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt install nginx=1.16.1-1~bionic")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示版本和编译参数")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx -V")]),s._v("\nnginx version: nginx/1.16.1\nbuilt by gcc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.4")]),s._v(".0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ubuntu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.4")]),s._v(".0-1ubuntu1~18.04.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试配置文件是否异常")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx -t")]),s._v("\nnginx: the configuration "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" /etc/nginx/nginx.conf syntax is ok\nnginx: configuration "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" /etc/nginx/nginx.conf "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" is successful\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h4",{attrs:{id:"编译安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译安装"}},[s._v("#")]),s._v(" 编译安装")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载源码包")]),s._v("\nroot@ubuntu1:/usr/local/src"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget http://nginx.org/download/nginx-1.16.1.tar.gz")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压源码包")]),s._v("\nroot@ubuntu1:/usr/local/src"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar xf nginx-1.16.1.tar.gz")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装依赖")]),s._v("\nroot@ubuntu1:/usr/local/src/nginx-1.16.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt install libgd-dev libgeoip-dev libpcre3 libpcre3-dev   libssl-dev")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开始编译安装")]),s._v("\nroot@ubuntu1:/usr/local/src/nginx-1.16.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir -p /apps/nginx")]),s._v("\n  ./configure "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--prefix")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/apps/nginx  --with-http_ssl_module "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n            --with-http_v2_module  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n            --with-http_realip_module "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n            --with-http_addition_module  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n            --with-http_image_filter_module "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n            --with-http_geoip_module "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n            --with-http_gunzip_module "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n            --with-http_stub_status_module "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n            --with-http_gzip_static_module "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n            --with-pcre "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n            --with-stream "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n            --with-stream_ssl_module "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n            --with-stream_realip_module\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编译步骤,根据Makefile文件生成相应的模块")]),s._v("\nroot@ubuntu1:/usr/local/src/nginx-1.16.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# make")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建目录,并将生成的模块和文件复制到相应的目录")]),s._v("\nroot@ubuntu1:/usr/local/src/nginx-1.16.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# make install")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看是否编译成功")]),s._v("\nroot@ubuntu1:/usr/local/src/nginx-1.16.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /apps/nginx/")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":32 ./\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":13 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":32 conf/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#该目录保存了nginx所有的配置文件")]),s._v("\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":32 html/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#该目录中保存了nginx服务器的web文件")]),s._v("\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":32 logs/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#错误日志")]),s._v("\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":32 sbin/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动脚本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#以普通⽤⼾启动nginx")]),s._v("\nroot@ubuntu1:/usr/local/src/nginx-1.16.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# useradd -m -r -s /bin/bash -u 2019 -U nginx")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#授权")]),s._v("\nroot@ubuntu1:/usr/local/src/nginx-1.16.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chown nginx.nginx -R /apps/nginx/")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动nginx")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /apps/nginx/sbin/nginx")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看nginx版本")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /apps/nginx/sbin/nginx  -v")]),s._v("\nnginx version: nginx/1.16.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"编辑nginx启动脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编辑nginx启动脚本"}},[s._v("#")]),s._v(" 编辑nginx启动脚本")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /lib/systemd/system/nginx.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network.target\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forking\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/apps/nginx/sbin/nginx\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecReload")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/apps/nginx/sbin/nginx  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" reload\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStop")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/apps/nginx/sbin/nginx  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" quit\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PrivateTmp")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#EnvironmentFile=/etc/sysconfig/rdisc")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ExecStart=/sbin/rdisc $RDISCOPTS")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h4",{attrs:{id:"默认配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#默认配置文件"}},[s._v("#")]),s._v(" 默认配置文件")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# grep -v "#" /apps/nginx/conf/nginx.conf | grep -v "^$"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全局配置端,对全局生效,主要设置nginx的启动用户/组,启动的工作进程数量,工作模式,Nginx的PID路径,日志路径等")]),s._v("\nuser ngixn nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动Nginx工作进程的用户和组")]),s._v("\nworker_processes  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动工作进程数数量")]),s._v("\npid        /run/nginx.pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \nevents "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#events设置快,主要影响nginx服务器与用户的网络连接,比如是否允许同时接受多个网络连接,使用哪种事件驱动模型请求,每个工作进程可以同时支持的最大连接数,是否开启对多工作进程下的网络连接进行序列化等")]),s._v("\n    worker_connections  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置单个nginx工作进程可以接受的最大并发,作为web服务器的时候最大并发数为worker_connections * worker_processes,作为反向代理的时候就为(worker_connections * worker_processes)/2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nhttp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#http块是Nginx服务器配置中的重要部分,缓存、代理和日志格式定义等绝大多数功能和第三方模块都可以在这设置,http块可以包含多个server块,而一个server块中又可以包含多个location块,server块可以配置文件引入、MIME-Type定义、日志自定义、是否启用sendfile、连接超时时间和单个链接的请求上限等")]),s._v("\n    include       mime.types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    default_type  application/octet-stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    sendfile        on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 作为web服务器的时候打开sendfile加快静态文件传输,指定是否使用sndfile系统调用来传输文件,sendfile系统调用在两个文件描述符之间直接传递数据(完全在内核中操作),从而避免了数据在内核缓冲区和用户缓冲区之间的拷贝,操作效率很高,被称之为零拷贝,硬盘 >> kernel buffer(快速拷贝到kernelsocket buffer) >> 协议栈")]),s._v("\n    keepalive_timeout  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 长连接超时时间,单位是秒")]),s._v("\n    server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置一个虚拟主机,可以包含自已的全局块,同时也可以包含多个location模块。比如本虚拟机监听的端口、本虚拟机的名称和IP配置,多个server可以使用一个端口，比如都使用80端口提供web服务器")]),s._v("\n        listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("88")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置server监听的端口")]),s._v("\n        server_name  localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#本server的名称,当访问此名称的时候nginx会调用当前server内部的配置进程匹配")]),s._v("\n        location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location其实是server的一个指令,为nginx服务器提供比较多而且灵活的指令,都是在location中体现的,主要是基于nginx接受到的请求字符串,对用户请求的URL进行匹配,并对特定的指令进行处理  ")]),s._v("\n            root   html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#相当于默认页面的目录名称,默认是相对路径,可以使用绝多路径配置。")]),s._v("\n            index  index.html index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认的页眉文件名称")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        error_page   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v("  /50x.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#错误页眉的文件名称")]),s._v("\n        location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /50x.html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location处理对应的不同错误码的页面定义到/50.html,这个跟对应其server中定义的目录下")]),s._v("\n            root   html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义默认页面所在的目录")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("h4",{attrs:{id:"核心配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#核心配置"}},[s._v("#")]),s._v(" 核心配置")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("user nginx ningx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动Nginx工作进程的用户和组")]),s._v("\nworker_processes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("number "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" auto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动Nginx⼯作进程的数量")]),s._v("\nworker_cpu_affinity auto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将Nginx⼯作进程绑定到指定的CPU核 ⼼，默认Nginx是不进⾏进程绑定的，绑定并不是意味着当前nginx进程独占以⼀核⼼CPU，但是可以保证此进程不会 运⾏在其他核⼼上，这就极⼤减少了nginx的⼯作进程在不同的cpu核⼼上的来回跳转，减少了CPU对进程的资源分配与 回收以及内存管理等，因此可以有效的提升nginx服务器的性能。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#错误⽇志记录配置，语法：error_log file [debug | info | notice | warn | error | crit | alert | emerg] #error_log logs/error.log; #error_log logs/error.log notice; ")]),s._v("\nerror_log /apps/nginx/logs/error.log error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#pid⽂件保存路径 ")]),s._v("\npid /apps/nginx/logs/nginx.pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#⼯作进程nice值，-20~19 一般情况下不会调这个参数")]),s._v("\nworker_priority "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \nworker_rlimit_nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这个数字包括Nginx的所有连接（例如与代理服务器的连接等），⽽不仅仅是与 客⼾端的连接,另⼀个考虑因素是实际的并发连接数不能超过系统级别的最⼤打开⽂件数的限制.")]),s._v("\nevents "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#事件模型配置参数 ")]),s._v("\n     worker_connections "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置单个⼯作进程的最⼤并发连接数")]),s._v("\n\t use epoll"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使⽤epoll事件驱动，Nginx⽀持众多的事件驱动，⽐如select、poll、epoll，只能设置在 events模块中设置。")]),s._v("\n\t accept_mutex on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#优化同⼀时刻只有⼀个请求⽽避免多个睡眠进程被唤醒的设置，on为防⽌被同时唤醒默认 为off，全部唤醒的过程也成为"惊群"，因此nginx刚安装完以后要进⾏适当的优化。 multi_accept on; Nginx服务器的每个⼯作进程可以同时接受多个新的⽹络连接，但是需要在配置⽂件中配 置，此指令默认为关闭，即默认为⼀个⼯作进程只能⼀次接受⼀个新的⽹络连接，打开后⼏个同时接受多个。')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h4",{attrs:{id:"http详细配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http详细配置"}},[s._v("#")]),s._v(" http详细配置")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tinclude mime.types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#导⼊⽀持的⽂件类型")]),s._v("\n    default_type application/octet-stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置默认的类型，会提⽰下载不匹配的类型⽂件")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#⾃定义优化参数 ")]),s._v("\n    sendfile on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#实现⽂件零拷⻉")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#tcp_nopush on; #在开启了sendfile的情况下，合并请求后统⼀发送给客⼾端。")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#tcp_nodelay off; #在开启了keepalived模式下的连接是否启⽤TCP_NODELAY选项，当为off时，延 迟0.2s发送，默认On时，不延迟发送，⽴即发送⽤⼾相应报⽂。")]),s._v("\n    keepalive_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置会话保持时间 ")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#gzip on; #开启⽂件压缩")]),s._v("\n    server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       listen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置监听地址和端⼝")]),s._v("\n       server_name localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置server name，可以以空格隔开写多个并⽀持正则表达式，如 *.magedu.com www.magedu.* www.(site\\d+)\\.magedu\\.com$ default_server")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#charset koi8-r; #设置编码格式，默认是俄语格式，可以改为utf-8 ")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#access_log logs/host.access.log main;")]),s._v("\n       location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n       \t\troot html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n       \t\tindex index.html index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n       error_page "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v(" /50x.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义错误⻚⾯ ")]),s._v("\n       location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /50x.html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n       \t\troot html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location ~ /\\.ht { #拒绝web形式访问指定⽂件，如很多的⽹站都是通过.htaccess⽂件来改变⾃⼰ 的重定向等功能。 # deny all; #}")]),s._v("\n       location ~ /passwd.html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n       \t\t\tdeny all"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("h4",{attrs:{id:"核心配置示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#核心配置示例"}},[s._v("#")]),s._v(" 核心配置示例")]),s._v(" "),a("p",[s._v("基于不同的IP、不同的端口以及不同得的域名实现不同的虚拟主机，依赖于核心模块ngx_http_core_module实现")]),s._v(" "),a("h5",{attrs:{id:"新建一个pc-web站点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新建一个pc-web站点"}},[s._v("#")]),s._v(" 新建一个PC web站点")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /apps/nginx/conf/conf.d")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /apps/nginx/conf/conf.d/")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /data/nginx/html/pc/  -p")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat !$")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /data/nginx/html/pc/index.html\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("html "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("lang")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"en"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("head"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("meta "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("charset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UTF-8"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("title"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("小茂 官网"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/title"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/head"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("body"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("h"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("hello world"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/h"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/body"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改nginx的配置文件")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat linux39.conf")]),s._v("\nserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("88")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name   www.xiaomao.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        charset  utf-8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n        location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root   /data/nginx/html/pc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            index  index.html  index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导入配置文件")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /apps/nginx/conf/nginx.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在http模块里面加入")]),s._v("\ninclude  /apps/nginx/conf/conf.d/*.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查配置是否有错")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /apps/nginx/sbin/nginx  -t")]),s._v("\nnginx: the configuration "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" /apps/nginx/conf/nginx.conf syntax is ok\nnginx: configuration "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" /apps/nginx/conf/nginx.conf "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" is successful\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启nginx")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /apps/nginx/sbin/nginx  -s reload")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后配置hosts解析访问即可")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("h5",{attrs:{id:"新建一个mobile-web站点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新建一个mobile-web站点"}},[s._v("#")]),s._v(" 新建⼀个"),a("strong",[s._v("Mobile web")]),s._v("站点")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /data/nginx/html/mobile -p")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat mobile.conf")]),s._v("\nserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("88")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name   www.mobile.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        charset  utf-8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n        location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root   /data/nginx/html/mobile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            index  index.html  index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试代码")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "mobile www" >> /data/nginx/html/mobile/index.html')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启nginx")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /apps/nginx/sbin/nginx  -s reload")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后配置hosts解析访问即可")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("h5",{attrs:{id:"静态资源配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#静态资源配置"}},[s._v("#")]),s._v(" 静态资源配置")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑配置文件")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat linux39.conf")]),s._v("\nserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("88")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name   www.xiaomao.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        charset  utf-8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n        location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root   /data/nginx/html/pc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            index  index.html  index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        location /tfs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root  /data/nginx/static"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            index  index.html index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir -p /data/nginx/static/tfs")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上传图片测试")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /data/nginx/static/tfs/")]),s._v("\nroot@ubuntu1:/data/nginx/static/tfs"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".jpg\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("h5",{attrs:{id:"访问测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#访问测试"}},[s._v("#")]),s._v(" 访问测试")]),s._v(" "),a("p",[a("img",{attrs:{src:"images%5Cf9d6bc1ab25d4bdb8597fcdd05221e22.png",alt:"img"}})]),s._v(" "),a("h5",{attrs:{id:"root与alias"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#root与alias"}},[s._v("#")]),s._v(" root与alias")]),s._v(" "),a("p",[s._v("root:指定web的家目录,在定义location的时候,文件的绝对路径等于 root+location")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[s._v("# 准备测试代码\nroot@ubuntu1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("apps"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx# cd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\nroot@ubuntu1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pc# mkdir about\nroot@ubuntu1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pc# echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"about 1123"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" about"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html\n# 修改配置文件\nroot@ubuntu1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("apps"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d# cat linux39"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\nserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("88")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name   www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xiaomao"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        charset  utf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n        location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            index  index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html  index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("about "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  #必须要在html⽬录中创建⼀个about⽬录才可以访问，否则报错\n            index index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tfs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            index  index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n# 重启nginx测试\nroot@ubuntu1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("apps"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d# systemctl restart nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("h5",{attrs:{id:"location的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#location的使用"}},[s._v("#")]),s._v(" location的使用")]),s._v(" "),a("p",[s._v("在没有使⽤正则表达式的时候，nginx会先在server中的多个location选取匹配度最⾼的⼀个uri，uri是⽤⼾请求的 字符串，即域名后⾯的web⽂件路径，然后使⽤该location模块中的正则url和字符串，如果匹配成功就结束搜索， 并使⽤此location处理此请求。")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("语法规则： location "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("uri"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" … "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#⽤于标准uri前，需要请求字串与uri精确匹配，如果匹配成功就停⽌向下匹配并⽴即处理请求。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#⽤于标准uri前，表⽰包含正则表达式并且区分⼤⼩写，并且匹配")]),s._v("\n!"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#⽤于标准uri前，表⽰包含正则表达式并且区分⼤⼩写，并且不匹配")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#⽤于标准uri前，表⽰包含正则表达式并且不区分⼤写，并且匹配")]),s._v("\n!"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#⽤于标准uri前，表⽰包含正则表达式并且不区分⼤⼩写,并且不匹配")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#⽤于标准uri前，表⽰包含正则表达式并且匹配以什么开头")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#⽤于标准uri前，表⽰包含正则表达式并且匹配以什么结尾")]),s._v("\n\\ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#⽤于标准uri前，表⽰包含正则表达式并且转义字符。可以转. * ?等")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#⽤于标准uri前，表⽰包含正则表达式并且代表任意⻓度的任意字符")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h5",{attrs:{id:"精确匹配"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#精确匹配"}},[s._v("#")]),s._v(" 精确匹配")]),s._v(" "),a("p",[s._v("在server部分使⽤location配置⼀个web界⾯，要求：当访问nginx 服务器的/login的时候要显⽰指定html⽂件的内 容")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat linux39.conf")]),s._v("\nserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("88")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name   www.xiaomao.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        charset  utf-8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root   /data/nginx/html/pc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            index  index.html  index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        location /1.jpg "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root  /var/www/nginx/images/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#精确匹配")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上传图片到/vat/www/nginx/images/并重启测试")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问路径:http://www.xiaomao.com:88/1.jpg")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h5",{attrs:{id:"匹配大小写"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#匹配大小写"}},[s._v("#")]),s._v(" 匹配大小写")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 精确匹配名称")]),s._v("\nlocation ~ /Aa.jpg "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root  /var/www/nginx/images/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            index  index.html  index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启nginx访问测试")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问http://www.xiaomao.com:88/AA.jpg 会直接报404")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问http://www.xiaomao.com:88/Aa.jpg 就会出图")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h5",{attrs:{id:"不区分大小写"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#不区分大小写"}},[s._v("#")]),s._v(" 不区分大小写")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("location ~* /Aa.jpg "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root  /var/www/nginx/images/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启nginx访问测试")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问http://www.xiaomao.com:88/AA.jpg 也会出图")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问http://www.xiaomao.com:88/Aa.jpg 就会出图")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h5",{attrs:{id:"匹配开头"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#匹配开头"}},[s._v("#")]),s._v(" 匹配开头")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配开头")]),s._v("\n location ^~ /images "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root  /var/www/nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            index   index.html index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新建测试目录 ")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /var/www/nginx/images1")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo images >>  /var/www/nginx/images/index.html")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo images1 >>  /var/www/nginx/images1/index.html")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启nginx")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart nginx")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl http://www.xiaomao.com:88/images/")]),s._v("\nimages\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl http://www.xiaomao.com:88/images1/")]),s._v("\nimages1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h5",{attrs:{id:"匹配文件后缀名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#匹配文件后缀名"}},[s._v("#")]),s._v(" 匹配文件后缀名")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx配置文件")]),s._v("\nlocation ~* "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gif"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpg"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpeg"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("bmp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("webp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("tif"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("ico"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("wmf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                root /data/nginx/images1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                index index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配优先级")]),s._v("\n匹配优先级："),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(", ^~, 〜/〜*，/ \nlocation优先级："),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("location 完整路径"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("location ^~ 路径"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("location ~,~* 正 则顺序"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("location 部分起始路径"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h5",{attrs:{id:"生产使用案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生产使用案例"}},[s._v("#")]),s._v(" 生产使用案例")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接匹配⽹站根会加速Nginx访问处理: ")]),s._v("\nlocation "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nlocation / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 静态资源配置")]),s._v("\nlocation ^~ /static/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nlocation ~* "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gif"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpg"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpeg"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("css"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("js"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("ico"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h5",{attrs:{id:"访问控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#访问控制"}},[s._v("#")]),s._v(" 访问控制")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx配置文件")]),s._v("\nlocation ~* "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gif"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpg"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpeg"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("bmp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("webp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("tif"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("ico"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("wmf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                root /data/nginx/images1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                index index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                deny "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(".32.11"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拒绝")]),s._v("\n                allow "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(".32.0/19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许")]),s._v("\n                deny all"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#先允许⼩部分，再拒绝⼤部分")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试访问")]),s._v("\nroot@ubuntu2:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl --head http://www.xiaomao.com:88/1.webp")]),s._v("\nHTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("403")]),s._v(" Forbidden\nServer: nginx/1.16.1\nDate: Tue, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":14:14 GMT\nContent-Type: text/html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("charset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf-8\nContent-Length: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153")]),s._v("\nConnection: keep-alive\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h5",{attrs:{id:"自定义错误界面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义错误界面"}},[s._v("#")]),s._v(" 自定义错误界面")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("88")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name   www.xiaomao.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        charset  utf-8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        error_page "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" /error.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#错误页面")]),s._v("\n        location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root   /data/nginx/html/pc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            index  index.html  index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        location /error.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 错误页面路径")]),s._v("\n            root /data/nginx/html/pc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            index  index.html  index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#准备测试文件")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "业务升级中..........." >> /data/nginx/html/pc/error.html')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启nginx测试")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart nginx")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl http://www.xiaomao.com:88/1.webp")]),s._v("\n业务升级中"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h5",{attrs:{id:"自定义访问日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义访问日志"}},[s._v("#")]),s._v(" 自定义访问日志")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置在nginx配置文件中")]),s._v("\naccess_log /data/nginx/logs/www-magedu-net_access.log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#访问日志")]),s._v("\nerror_log /data/nginx/logs/www-magedu-net_error.log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#错误日志")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h5",{attrs:{id:"检测文件是否存在"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检测文件是否存在"}},[s._v("#")]),s._v(" 检测文件是否存在")]),s._v(" "),a("p",[s._v("try_fifiles会按顺序检查⽂件是否存在，返回第⼀个找到的⽂件或⽂件夹（结尾加斜线表⽰为⽂件夹），如果所有⽂ 件或⽂件夹都找不到，会进⾏⼀个内部重定向到最后⼀个参数。只有最后⼀个参数可以引起⼀个内部重定向，之前 的参数只设置内部URI的指向。最后⼀个参数是回退URI且必须存在，否则会出现内部500错误。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx配置文件")]),s._v("\nlocation /tfs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root  /data/nginx/static"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            index  index.html index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            try_files "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v("/index.html "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(".html  tfs/index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#访问不存在的页面会重定向到tfs/index.html页面")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启测试   这个是访问不存在的页面出现500错误")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl --head http://www.xiaomao.com:88/tfs/index.html")]),s._v("\nHTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" Internal Server Error\nServer: nginx/1.16.1\nDate: Thu, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" 06:15:25 GMT\nContent-Type: text/html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("charset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf-8\nContent-Length: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("177")]),s._v("\nConnection: close\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重定向过后的")]),s._v("\nroot@ubuntu1:/data/nginx/static/tfs"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl --head http://www.xiaomao.com:88/tfs/index.html")]),s._v("\nHTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\nServer: nginx/1.16.1\nDate: Thu, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" 06:22:58 GMT\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h5",{attrs:{id:"长连接配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#长连接配置"}},[s._v("#")]),s._v(" 长连接配置")]),s._v(" "),a("p",[s._v("keepalive_timeout number; #设定保持连接超时时⻓，0表⽰禁⽌⻓连接，默认为75s，通常配置在http字段作为")]),s._v(" "),a("p",[s._v("站点全局配置 keepalive_requests number; #在⼀次⻓连接上所允许请求的资源的最⼤数量，默认为100次")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改配置文件做测试")]),s._v("\nkeepalive_requests "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nkeepalive_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启长连接后,返回客户端的会话保持时间为60s,单次连接累计请求达到指定次数请求或65s就会断开,后面的60为发送给客户端应答报文头部中显示的超时时间设置为60s:如果不设置客户端将不显示超时时间。")]),s._v("\nKeep-Alive:timeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#浏览器收到的服务器返回的报⽂")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试 三次连接过后会出现Connection closed by foreign host. 所以要重新发起连接")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# telnet www.xiaomao.com 88")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h5",{attrs:{id:"下载服务器配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载服务器配置"}},[s._v("#")]),s._v(" 下载服务器配置")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /data/nginx/html/pc/download")]),s._v("\n location /download "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                autoindex on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自动索引功能")]),s._v("\n                autoindex_exact_size off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#计算⽂件确切⼤⼩（单位bytes），off只显⽰⼤概⼤⼩（单位kb、mb、 gb）")]),s._v("\n                autoindex_localtime on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#显⽰本机时间⽽⾮GMT(格林威治)时间")]),s._v("\n                root /data/nginx/html/pc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 目录")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启并访问下载页面")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("limit_rate rate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#限制响应给客⼾端的传输速率，单位是bytes/second，默认值0表⽰⽆限制 限速与不限速的对⽐：")]),s._v("\nlimit_rate 10k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启并测试")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget http://www.xiaomao.com:88/download/ubuntu-18.04.5-live-server-amd64.iso")]),s._v("\nubuntu-18.04.5-live-server-amd64.iso              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("                                                                                                       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("412")]),s._v(".00K  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".0KB/s    eta 26h 13m\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h5",{attrs:{id:"作为上传服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#作为上传服务器"}},[s._v("#")]),s._v(" 作为上传服务器")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("client_max_body_size 1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置允许客⼾端上传单个⽂件的最⼤值，默认值为1m")]),s._v("\nclient_body_buffer_size size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#⽤于接收每个客⼾端请求报⽂的body部分的缓冲区⼤⼩；默认16k；超出 此⼤⼩时，其将被暂存到磁盘上的由下⾯client_body_temp_path指令所定义的位置")]),s._v("\nclient_max_body_size 1m； "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置允许客⼾端上传单个⽂件的最⼤值，默认值为1m")]),s._v("\nclient_body_temp_path path "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("level1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("level2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("level3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设定存储客⼾端请求报⽂的body部分的临时存储路径及⼦⽬录结构和数量，⽬录名为16进制的数字，使⽤hash之后的 值从后往前截取1位、2位、2位作为⽂件名：")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# md5sum /data/nginx/html/pc/index.html")]),s._v("\n09fa1f3223588b73e681a11414d2d77a  /data/nginx/html/pc/index.html\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("级⽬录占1位16进制，即2^4"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("个⽬录 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-f \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("级⽬录占2位16进制，即2^8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v("个⽬录 00-ff\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("级⽬录占2位16进制，即2^8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v("个⽬录 00-ff\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置示例")]),s._v("\nclient_max_body_size 10m；\nclient_body_buffer_size 16k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nclient_body_temp_path /apps/nginx/temp "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#reload Nginx会⾃动创建temp⽬录")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h5",{attrs:{id:"隐藏nginx版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#隐藏nginx版本"}},[s._v("#")]),s._v(" 隐藏Nginx版本")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在nginx.conf中配置")]),s._v("\nhttp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n open_file_cache "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("inactive")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("60s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最⼤缓存10000个⽂件，⾮活动数据超时时⻓60s")]),s._v("\n open_file_cache_valid 60s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每间隔60s检查⼀下缓存数据有效性")]),s._v("\n open_file_cache_min_uses "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#60秒内⾄少被命中访问5次才被标记为活动数据")]),s._v("\n open_file_cache_errors on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#缓存错误信息")]),s._v("\n server_tokens off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#隐藏Nginx server版本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h4",{attrs:{id:"nginx高级配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx高级配置"}},[s._v("#")]),s._v(" Nginx高级配置")]),s._v(" "),a("h5",{attrs:{id:"nginx状态页"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx状态页"}},[s._v("#")]),s._v(" Nginx状态页")]),s._v(" "),a("p",[s._v("在编译安装nginx的时候需要添加编译参数--with-http_stub_status_module，否则配置完成之后监测会是提⽰语法错误")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置示例")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim linux39.conf")]),s._v("\nlocation /tfs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root  /data/nginx/static"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            index  index.html index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            stub_status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            allow "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(".32.11/19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            allow "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            deny all"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启 Windows web界面访问失败的查看连接次数")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"状态页详细信息说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#状态页详细信息说明"}},[s._v("#")]),s._v(" 状态页详细信息说明")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看状态页输出信息说明")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl http://www.xiaomao.com:88/tfs/")]),s._v("\nActive connections: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nserver accepts handled requests\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上⾯三个数字分别对应accepts,handled,requests三个值")]),s._v("\nReading: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Writing: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" Waiting: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("1、Active connections： 当前处于活动状态的客⼾端连接数，包括连接等待空闲连接数。")]),s._v(" "),a("p",[s._v("2、accepts：统计总值，Nginx⾃启动后已经接受的客⼾端请求的总数。")]),s._v(" "),a("p",[s._v("3、handled：统计总值，Nginx⾃启动后已经处理完成的客⼾端请求的总数，通常等于accepts")]),s._v(" "),a("p",[s._v("4、worker_connections限制等被拒绝的连接")]),s._v(" "),a("p",[s._v("5、requests：统计总值，Nginx⾃启动后客⼾端发来的总的请求数")]),s._v(" "),a("p",[s._v("6、Reading：当前状态，正在读取客⼾端请求报⽂⾸部的连接的连接数")]),s._v(" "),a("p",[s._v("7、Writing：当前状态，正在向客⼾端发送响应报⽂过程中的连接数")]),s._v(" "),a("p",[s._v("8、Waiting：当前状态，正在等待客⼾端发出请求的空闲连接数，开启 keep-alive的情况下,这个值等于 active –")]),s._v(" "),a("p",[s._v("(reading+writing),")]),s._v(" "),a("h5",{attrs:{id:"nginx第三方模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx第三方模块"}},[s._v("#")]),s._v(" Nginx第三方模块")]),s._v(" "),a("p",[s._v("第三模块是对nginx 的功能扩展，第三⽅模块需要在编译安装Nginx 的时候使⽤参数--add-module=PATH指定路径 添加，有的模块是由公司的开发⼈员针对业务需求定制开发的，有的模块是开源爱好者开发好之后上传到github进 ⾏开源的模块，nginx⽀持第三⽅模块需要从源码重新编译⽀持，⽐如开源的echo模块 https://github.com/openresty/echo-nginx-module：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导入第三方模块")]),s._v("\nroot@ubuntu1:/usr/local/src"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://github.com/openresty/echo-nginx-module/archive/v0.61.tar.gz")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新编译nginx")]),s._v("\nroot@ubuntu1:/usr/local/src/nginx-1.16.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./configure   --prefix=/apps/nginx --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_addition_module --with-http_image_filter_module --with-http_geoip_module --with-http_gunzip_module --with-http_stub_status_module --with-http_gzip_static_module --with-pcre --with-stream --with-stream_ssl_module --with-stream_realip_module --with-http_stub_status_module --add-module=/usr/local/src/echo-nginx-module-0.61")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试第三方模块是否能使用")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat linux39.conf")]),s._v("\nlocation / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#root   /data/nginx/html/pc;")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#index  index.html  index.htm;")]),s._v("\n            default_type text/html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello world,main--\x3e"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            echo_reset_timer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            echo_location /sub1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            echo_location /sub2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"took '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$echo_timer_elapsed")]),s._v(' sec for total."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        location /sub1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" sub1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        location /sub2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" sub2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启测试访问")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl http://www.xiaomao.com:88/")]),s._v("\nhello world,main--"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nsub1\nsub2\ntook "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v(" sec "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" total.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h5",{attrs:{id:"nginx变量使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx变量使用"}},[s._v("#")]),s._v(" Nginx变量使用")]),s._v(" "),a("p",[s._v("nginx的变量可以在配置⽂件中引⽤，作为功能判断或者⽇志等场景使⽤，变量可以分为内置变量和⾃定义变量， 内置变量是由nginx模块⾃带，通过变量可以获取到众多的与客⼾端访问相关的值。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#存放了客⼾端的地址，注意是客⼾端的公⽹IP，也就是⼀家⼈访问⼀个⽹站，则会显⽰为路由器的公⽹IP。")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$args")]),s._v("；\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#变量中存放了URL中的指令,例如http://www.magedu.net/main/index.do?id=20190221&partner=search 中的id=20190221&partner=search")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$document_root")]),s._v("； \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#保存了针对当前资源的请求的系统根⽬录，如/apps/nginx/html。")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),s._v("； "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#存放了请求的host名称。")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_user_agent")]),s._v("； "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#客⼾端浏览器的详细信息")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_cookie")]),s._v("； "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#客⼾端的cookie信息。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$limit_rate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果nginx服务器使⽤limit_rate配置了显⽰⽹络速率，则会显⽰，如果没有设置， 则显⽰0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_port")]),s._v("； "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#客⼾端请求Nginx服务器时随机打开的端⼝，这是每个客⼾端⾃⼰的端⼝。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_port")]),s._v("； "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#请求的服务器的端⼝号")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_name")]),s._v("； "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#请求的服务器的主机名")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h5",{attrs:{id:"自定义变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义变量"}},[s._v("#")]),s._v(" 自定义变量")]),s._v(" "),a("p",[s._v("假如需要⾃定义变量名称和值，使⽤指令set $variable value;，则⽅法如下")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(" location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$name")]),s._v(" magedu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$my_port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$my_port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#端口号")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h5",{attrs:{id:"nginx-自定义访问日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-自定义访问日志"}},[s._v("#")]),s._v(" "),a("strong",[s._v("Nginx")]),s._v(" ⾃定义访问⽇志")]),s._v(" "),a("p",[s._v("访问⽇志是记录客⼾端即⽤⼾的具体请求内容信息，全局配置模块中的error_log是记录nginx服务器运⾏时的⽇志 保存路径和记录⽇志的level，因此有着本质的区别，⽽且Nginx的错误⽇志⼀般只有⼀个，但是访问⽇志可以在不 同server中定义多个，定义⼀个⽇志需要使⽤access_log指定⽇志的保存路径，使⽤log_format指定⽇志的格式， 格式中定义要保存的具体⽇志内容。")]),s._v(" "),a("p",[s._v("⾃定义json格式⽇志")]),s._v(" "),a("p",[s._v("Nginx 的默认访问⽇志记录内容相对⽐较单⼀，默认的格式也不⽅便后期做⽇志统计分析，⽣产环境中通常将nginx⽇志转换为json⽇志，然后配合使⽤ELK做⽇志收集-统计-分析")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:/apps/nginx/conf"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim nginx.conf")]),s._v("\nhttp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tlog_format access_json "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{"@timestamp":"$time_iso8601",\'')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"host":"$server_addr",\'')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"clientip":"$remote_addr",\'')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\"size\":$body_bytes_sent,'")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\"responsetime\":$request_time,'")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"upstreamtime":"$upstream_response_time",\'')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"upstreamhost":"$upstream_addr",\'')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"http_host":"$host",\'')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"uri":"$uri",\'')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"domain":"$host",\'')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"xff":"$http_x_forwarded_for",\'')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"referer":"$http_referer",\'')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"tcp_xff":"$proxy_protocol_addr",\'')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"http_user_agent":"$http_user_agent",\'')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"status":"$status"}\'')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pc端配置应用")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim linux39.conf")]),s._v("\nserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("88")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name   www.xiaomao.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        charset  utf-8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_page 500 502 503 504 404 /error.html;")]),s._v("\n\n        access_log /data/nginx/logs/www-magedu-net_access.log  access_json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#访问日志")]),s._v("\n        error_log /data/nginx/logs/www-magedu-net_error.log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#错误日志")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启测试看看是否是json格式")]),s._v("\nroot@ubuntu1:/data/nginx/logs"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tail -f www-magedu-net_access.log")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@timestamp"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2021-10-15T09:07:50+00:00"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"host"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.2.32.10"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"clientip"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.1.10.1"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"size"')]),s._v(":25,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"responsetime"')]),s._v(":0.000,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"upstreamtime"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"upstreamhost"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http_host"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"www.xiaomao.com"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"uri"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/2WGLMPpywpRdcqVe2FNGZFZtJsJ9/index.html"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"domain"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"www.xiaomao.com"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xff"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"referer"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tcp_xff"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http_user_agent"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"status"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"200"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h5",{attrs:{id:"nginx压缩功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx压缩功能"}},[s._v("#")]),s._v(" Nginx压缩功能")]),s._v(" "),a("p",[s._v("Nginx⽀持对指定类型的⽂件进⾏压缩然后再传输给客⼾端，⽽且压缩还可以设置压缩⽐例，压缩后的⽂件⼤⼩将⽐源⽂件显著变⼩，这样有助于降低出⼝带宽的利⽤率，降低企业的IT⽀出，不过会占⽤相应的CPU资源。Nginx对⽂件的压缩功能是依赖于模块ngx_http_gzip_module，官⽅⽂档： https://nginx.org/en/docs/http/ngx_http_gzip_module.html， 配置指令如下：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启⽤或禁⽤gzip压缩，默认关闭 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" on "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#压缩⽐由低到⾼从1到9，默认为1 ")]),s._v("\ngzip_comp_level level"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#禁⽤IE6 gzip功能 ")]),s._v("\ngzip_disable "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MSIE [1-6]\\."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#gzip压缩的最⼩⽂件，⼩于设置值的⽂件将不会压缩 ")]),s._v("\ngzip_min_length 1k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启⽤压缩功能时，协议的最⼩版本，默认HTTP/1.1 ")]),s._v("\ngzip_http_version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定Nginx服务需要向服务器申请的缓存空间的个数*⼤⼩，默认32 4k|16 8k; ")]),s._v("\ngzip_buffers number size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指明仅对哪些类型的资源执⾏压缩操作；默认为gzip_types text/html，不⽤显⽰指定，否则出错 ")]),s._v("\ngzip_types mime-type "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果启⽤压缩，是否在响应报⽂⾸部插⼊“Vary: Accept-Encoding” ")]),s._v("\ngzip_vary on "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑nginx配置文件")]),s._v("\nroot@ubuntu1:/apps/nginx/conf"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim nginx.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ngzip_comp_level "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ngzip_min_length 1k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ngzip_types text/plain application/javascript application/x-javascript text/cssapplication/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ngzip_vary on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ngzip_buffers "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v(" 4k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 压缩缓存  压成512M")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h5",{attrs:{id:"关于favicon-ico"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关于favicon-ico"}},[s._v("#")]),s._v(" 关于"),a("strong",[s._v("favicon.ico")])]),s._v(" "),a("p",[s._v("favicon.ico ⽂件是浏览器收藏⽹址时显⽰的图标，当客⼾端使⽤浏览器问⻚⾯时，浏览器会⾃⼰主动发起请求获取 ⻚⾯的favicon.ico⽂件，但是当浏览器请求的favicon.ico⽂件不存在时，服务器会记录404⽇志，⽽且浏览器也会 显⽰404报错。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将图标保存到指定目录访问:")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim linux39.conf")]),s._v("\nlocation "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /favicon.ico "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n           root /data/nginx/static"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n           expires 90d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置文件过期时间")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 图片上传        ")]),s._v("\nroot@ubuntu1:/data/nginx/static"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16958")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" 09:29 favicon.ico\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h5",{attrs:{id:"隐藏nginx版本号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#隐藏nginx版本号"}},[s._v("#")]),s._v(" 隐藏Nginx版本号")]),s._v(" "),a("p",[s._v("更改nginx源码信息并重新编译Nginx")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路径是源码目录下的")]),s._v("\n root@ubuntu1:/usr/local/src/nginx-1.16.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim src/http/ngx_http_header_filter_module.c")]),s._v("\nroot@ubuntu1:/usr/local/src/nginx-1.16.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pwd")]),s._v("\n/usr/local/src/nginx-1.16.1\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v(" static u_char ngx_http_server_string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Server: linux39"')]),s._v(" CRLF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后重新编译即可")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"升级openssl版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#升级openssl版本"}},[s._v("#")]),s._v(" 升级"),a("strong",[s._v("OpenSSL")]),s._v("版本")]),s._v(" "),a("p",[s._v("​\t\t⼼脏出⾎（英语：Heartbleed），也简称为⼼⾎漏洞，是⼀个出现在加密程序库OpenSSL的安全漏洞，该程序库 ⼴泛⽤于实现互联⽹的传输层安全（TLS）协议。它于2012年被引⼊了软件中，2014年4⽉⾸次向公众披露。只要 使⽤的是存在缺陷的OpenSSL实例，⽆论是服务器还是客⼾端，都可能因此⽽受到攻击。此问题的原因是在实现TLS的⼼跳扩展时没有对输⼊进⾏适当验证（缺少边界检查），因此漏洞的名称来源于“⼼跳”（heartbeat）。该程 序错误属于缓冲区过读，即可以读取的数据⽐应该允许读取的还多")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载源码包")]),s._v("\nroot@ubuntu1:/usr/local/src"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://www.openssl.org/source/openssl-1.1.1l.tar.gz")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压源码包")]),s._v("\nroot@ubuntu1:/usr/local/src/nginx-1.16.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar xf openssl-1.1.1l.tar.gz")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开始编译")]),s._v("\nroot@ubuntu1:/usr/local/src/nginx-1.16.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./configure  --prefix=/apps/nginx --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_addition_module --with-http_image_filter_module --with-http_geoip_module --with-http_gunzip_module --with-http_stub_status_module --with-http_gzip_static_module --with-pcre --with-stream --with-stream_ssl_module --with-stream_realip_module --with-http_stub_status_module --add-module=/usr/local/src/echo-nginx-module-0.61  --with-openssl=/usr/local/src/openssl-1.1.1l")]),s._v("\nroot@ubuntu1:/usr/local/src/nginx-1.16.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# make && make install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看是否编译成功")]),s._v("\nroot@ubuntu1:/usr/local/src/nginx-1.16.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /apps/nginx/sbin/nginx -V")]),s._v("\nnginx version: nginx/1.16.1\nbuilt by gcc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.5")]),s._v(".0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ubuntu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.5")]),s._v(".0-3ubuntu1~18.04"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nbuilt with OpenSSL "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(".1l  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"rewrite相关功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rewrite相关功能"}},[s._v("#")]),s._v(" "),a("strong",[s._v("Rewrite")]),s._v("相关功能")]),s._v(" "),a("p",[s._v("​\tNginx服务器利⽤ngx_http_rewrite_module 模块解析和处理rewrite请求，此功能依靠 PCRE(perl compatibleregularexpression)，因此编译之前要安装PCRE库，rewrite是nginx服务器的重要功能之⼀，⽤于实现URL的重 写，URL的重写是⾮常有⽤的功能，⽐如它可以在我们改变⽹站结构之后，不需要客⼾端修改原来的书签，也⽆需 其他⽹站修改我们的链接，就可以设置为访问，另外还可以在⼀定程度上提⾼⽹站的安全性")]),s._v(" "),a("h5",{attrs:{id:"if指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#if指令"}},[s._v("#")]),s._v(" if指令")]),s._v(" "),a("p",[s._v("⽤于条件匹配判断，并根据条件判断结果选择不同的Nginx配置，可以配置在server或location块中进⾏配置，Nginx的if语法仅能使⽤if做单次判断，不⽀持使⽤if else或者if elif这样的多重判断，⽤法如下：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" （条件匹配） "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\naction \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("使⽤正则表达式对变量进⾏匹配，匹配成功时if指令认为条件为true，否则认为false，变量与表达式之间使⽤以下 符号链接：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("： "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#⽐较变量和字符串是否相等，相等时if指令认为该条件为true，反之为false。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#⽐较变量和字符串是否不相等，不相等时if指令认为条件为true，反之为false。")]),s._v("\n~： "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#表⽰在匹配过程中区分⼤⼩写字符，（可以通过正则表达式匹配），满⾜匹配条件为真，不满⾜为假。 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("~："),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#为区分⼤⼩写字符且匹配结果不匹配，不满⾜为真，满⾜为假。")]),s._v("\n~*: "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#表⽰在匹配过程中不区分⼤⼩写字符，（可以通过正则表达式匹配），满⾜匹配条件为真，不满⾜为假。 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("~*: "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#为不区分⼤⼩字符且匹配结果不匹配，满⾜为假，不满⾜为真。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" 和 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -f: "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#判断请求的⽂件是否存在和是否不存在 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" 和 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -d: "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#判断请求的⽬录是否存在和是否不存在。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" 和 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -x: "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#判断⽂件是否可执⾏和是否不可执⾏。 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" 和 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -e: "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#判断请求的⽂件或⽬录是否存在和是否不存在(包括⽂件，⽬录，软链接)。")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h5",{attrs:{id:"rewrite-flflag使用介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rewrite-flflag使用介绍"}},[s._v("#")]),s._v(" "),a("strong",[s._v("rewrite flflag")]),s._v("使⽤介绍")]),s._v(" "),a("p",[s._v("利⽤nginx的rewrite的指令，可以实现url的重新跳转，rewrtie有四种不同的flflag，分别是redirect(临时重定向)、permanent(永久重定向)、break和last。其中前两种是跳转型的flflag，后两种是代理型，跳转型是指有客⼾端浏览 器重新对新地址进⾏请求，代理型是在WEB服务器内部实现跳转的。")]),s._v(" "),a("p",[s._v("Syntax: rewrite regex replacement [flflag]; #通过正则表达式处理⽤⼾请求并返回替换后的数据包。 Default: —Context: server, location, if")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("redirect； \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#临时重定向，重写完成后以临时重定向⽅式直接返回重写后⽣成的新URL给客⼾端，由客⼾端重新发起请求；使⽤相对 路径,或者http://或https://开头，状态码：302")]),s._v("\npermanent； \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重写完成后以永久重定向⽅式直接返回重写后⽣成的新URL给客⼾端，由客⼾端重新发起请求，状态码：301")]),s._v("\nlast； \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重写完成后停⽌对当前URI在当前location中后续的其它重写操作，⽽后对新的URL启动新⼀轮重写检查，不建议在 location中使⽤")]),s._v("\nbreak； \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重写完成后停⽌对当前URL在当前location中后续的其它重写操作，⽽后直接将匹配结果返还给客⼾端即结束循环并 返回数据给客⼾端，建议在location中使⽤")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h5",{attrs:{id:"域名永久与临时重定向"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#域名永久与临时重定向"}},[s._v("#")]),s._v(" 域名永久与临时重定向")]),s._v(" "),a("p",[s._v("要求：因业务需要，将访问源域名 www.xiaomao.com 的请求永久重定向到www.xiaomao.net 。 临时重定向不会缓存域名解析记录(A记录)，但是永久重定向会缓存。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim linux39.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑nginx配置文件")]),s._v("\nlocation / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            default_type text/html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            root   /data/nginx/html/pc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            index  index.html  index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 域名重定向配置")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" www.xiaomao.com "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rewrite /(.*)  http://www.xiaomao.net/$1 permanent;")]),s._v("\n                   rewrite /"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(".*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  http://www.xiaomao.net/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" redirect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n             "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启并访问测试")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h5",{attrs:{id:"rewrite案例-brak"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rewrite案例-brak"}},[s._v("#")]),s._v(" "),a("strong",[s._v("rewrite")]),s._v("案例**--brak**")]),s._v(" "),a("p",[s._v("要求：访问about的请求被转发⾄images，⽽访问images传递请求再次被转发⾄images1，以此测试last和break分别有什么区别：")]),s._v(" "),a("p",[s._v("break测试案例：当客⼾端访问break的时候，测试通过rewrite将URL重写为test1，然后再通过rewrite将test1 重写为test2测试两条write规则最终哪⼀条⽣效，并且测试重写后的URL会不会到其他location重新匹配")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim linux39.conf    ")]),s._v("\n    location /break"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n           root /data/nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n           index index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n           rewrite ^/break/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(".*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" /test1/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n           rewrite ^/test1/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(".*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" /test2/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /test1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n           index  index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n           root   /data/nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /test2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            index index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            root /data/nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#break匹配成功后不再向下匹配，也不会跳转到其他的 location，即直接结束匹配并给客⼾端返回结果数据。")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("break适⽤于不改变客⼾端访问⽅式，但是要将访问的⽬的URL做单次重写的场景，⽐如有V1/V2两个版本的⽹站前端 ⻚⾯并存，旧版本的⽹站数据已经保存到了statics不能丢失，但是要将访问新版本的资源重写到新的静态资源路径到 新的⽬录static：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(" root@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim linux39.conf")]),s._v("\n  location /statics "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        root /data/nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        index index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        rewrite ^/statics/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(".*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" /static/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:/data/nginx/statics"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /data/nginx/static/index.js")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" v2\nroot@ubuntu1:/data/nginx/statics"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /data/nginx/statics/index.js")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("  v1\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启测试")]),s._v("\nroot@ubuntu1:/data/nginx/statics"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl http://www.xiaomao.com/statics/index.js")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" v2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"nginx反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx反向代理"}},[s._v("#")]),s._v(" Nginx反向代理")]),s._v(" "),a("p",[s._v("反向代理：反向代理也叫reverse proxy，指的是代理外⽹⽤⼾的请求到内部的指定web服务器，并将数据返回给⽤ ⼾的⼀种⽅式，这是⽤的⽐较多的⼀种⽅式。")]),s._v(" "),a("p",[s._v("Nginx除了可以在企业提供⾼性能的web服务之外，另外还可以将本⾝不具备的请求通过某种预定义的协议转发⾄ 其它服务器处理，不同的协议就是Nginx服务器与其他服务器进⾏通信的⼀种规范，主要在不同的场景使⽤以下模 块实现不同的功能")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ngx_http_proxy_module： 将客⼾端的请求以http协议转发⾄指定服务器进⾏处理。"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java apache nginx 应用层 rewrite "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \nngx_stream_proxy_module：将客⼾端的请求以tcp协议转发⾄指定服务器处理。"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("用于mysql  redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \nngx_http_fastcgi_module：将客⼾端对php的请求以fastcgi协议转发⾄指定服务器助理。"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fastcgi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" ngx_http_uwsgi_module：将客⼾端对Python的请求以uwsgi协议转发⾄指定服务器处理。"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("python"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h5",{attrs:{id:"实现http反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现http反向代理"}},[s._v("#")]),s._v(" 实现http反向代理")]),s._v(" "),a("p",[s._v("要求：将⽤⼾对域 www.nagedu.net 的请求转发值后端服务器处理，官⽅⽂档： https://nginx.org/en/docs/http/ngx_http_proxy_module.html，")]),s._v(" "),a("p",[s._v("环境准备")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(".32.10  ubuntu1 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Nginx 代理服务器 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(".32.11  ubuntu2 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#后端web A，Apache部署 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(".32.12 ubuntu3 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#后端web B，Apache部署")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("部署安装apache")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu2:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt install apache2")]),s._v("\nroot@ubuntu2:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "web1 10.2.32.11" > /var/www/html/index.html')]),s._v("\nroot@ubuntu2:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start apache2 && systemctl enable apache2")]),s._v("\n\nroot@ubuntu3:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt install apache2")]),s._v("\nroot@ubuntu3:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "web2 10.2.32.12" > /var/www/html/index.html')]),s._v("\nroot@ubuntu3:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start apache2 && systemctl enable apache2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("strong",[s._v("Nginx http")]),s._v(" 反向代理⼊⻔")]),s._v(" "),a("p",[s._v("官⽅⽂档：https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试 ")]),s._v("\nroot@ubuntu2:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /var/www/html/app")]),s._v("\nroot@ubuntu2:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "web 10.2.32.11" >  /var/www/html/app/index.html')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 反向代理参数")]),s._v("\nproxy_pass； "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#⽤来设置将客⼾端请求转发给的后端服务器的主机，可以是主机名、IP地址：端⼝的⽅式，也可以代理到预先设置的 主机群组，需要模块gx_http_upstream_module⽀持。")]),s._v("\n location /app "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            index  index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不带斜线将访问的/app,等于访问后端服务器s http://10.2.32.11:80/app/index.html，即后端服务 器配置的站点根⽬录要有app⽬录才可以被访问，这是⼀个追加/web到后端服务器 http://servername:port/app/INDEX.HTML的操作  ")]),s._v("\n            proxy_pass http://10.2.32.11:80"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 标准测试")]),s._v("\n            \n           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy_pass http://10.2.32.11:80/; #带斜线，等于访问后端服务器的http://10.2.32.11:80/index.html 内容返回给客⼾端")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启nginx测试访问  标准测试")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl http://www.xiaomao.com/app")]),s._v("\nweb "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(".32.11\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加了/后测试")]),s._v("\n location /app "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            index  index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_pass http://10.2.32.11:80/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl http://www.xiaomao.com/app")]),s._v("\nweb1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(".32.11\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("proxy_pass_header field"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认nginx在响应报⽂中不传递后端服务器的⾸部字段Date, Server, X-Pad, X-Accel等参数，如果要传递的 话则要使⽤ proxy_pass_header field声明将后端服务器返回的值传递给客⼾端。显示后端服务器版本号信息")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("proxy_hide_header field"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#⽤于nginx作为反向代理的时候，在返回给客⼾端http响应的时候，隐藏后端服务版本相应头部的信息，可以设置在 http/server或location块，")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置")]),s._v("\n location /app "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            index  index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_pass http://10.2.32.11:80/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_hide_header Etag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("proxy_connect_timeout "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置nginx服务器与后端服务器尝试建⽴连接的超时时间，默认为60秒，⽤法如下：")]),s._v("\nproxy_connect_timeout 60s； "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#60s为⾃定义nginx与后端服务器建⽴连接的超时时间")]),s._v("\nproxy_read_timeout time； "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置nginx服务器向后端服务器或服务器组发起read请求后，等待的超时时间，默认60s ")]),s._v("\nproxy_send_timeout time； "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置nginx项后端服务器或服务器组发起write请求后，等待的超时时间，默认60s")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("proxy_ignore_client_abort off；\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#当客⼾端⽹络中断请求时，nginx服务器中断其对后端服务器的请求。即如果此项设置为on开启，则服务器会忽略客 ⼾端中断并⼀直等着代理服务执⾏返回，如果设置为off，则客⼾端中断后Nginx也会中断客⼾端请求并⽴即记录499⽇ 志，默认为off。")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("proxy_headers_hash_bucket_size "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("； "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#当配置了 proxy_hide_header和proxy_set_header的时候，⽤于设置nginx保存HTTP报⽂头的hash表的上 限。")]),s._v("\nproxy_headers_hash_max_size "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v("； "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置proxy_headers_hash_bucket_size的最⼤可⽤空间")]),s._v("\nserver_namse_hash_bucket_size "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#server_name hash表申请空间⼤⼩")]),s._v("\nserver_names_hash_max_szie "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置服务器名称hash表的上限⼤⼩")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h5",{attrs:{id:"反向代理缓存功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反向代理缓存功能"}},[s._v("#")]),s._v(" 反向代理缓存功能")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 缓存功能默认关闭状态")]),s._v("\nproxy_cache zone "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 默认off "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指明调⽤的缓存，或关闭缓存机制；Context:http, server, location")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("proxy_cache_key string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#缓存中⽤于“键”的内容，默认值：proxy_cache_key $scheme$proxy_host$request_uri;")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("proxy_cache_valid "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("code "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义对特定响应码的响应内容的缓存时⻓，定义在http{...}中")]),s._v("\n⽰例: proxy_cache_valid "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("302")]),s._v(" 10m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n     proxy_cache_valid "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" 1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n     proxy_cache_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n定义可⽤于proxy功能的缓存；Context:http proxy_cache_path path "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("levels"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("levels"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("use_temp_path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("keys_zone")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("name:size "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("inactive"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("max_size"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("manager_files"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("number"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("manager_sleep"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("manager_threshold"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("loader_files"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("number"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("loader_sleep"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("loader_threshold"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("purger"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("purger_files"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("number"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("purger_sleep"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("purger_threshold"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ⽰例：在http配置定义缓存信息")]),s._v("\nproxy_cache_path /var/cache/nginx/proxy_cache "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义缓存保存路径，proxy_cache会⾃动创建")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("levels")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":2:2 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义缓存⽬录结构层次，1:2:2可以⽣成2^4x2^8x2^8=1048576个⽬录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("keys_zone")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("proxycache:20m "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指内存中缓存的⼤⼩，主要⽤于存放key和metadata（如：使⽤次数）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("inactive")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("120s； "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#缓存有效时间")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max_size")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1g"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最⼤磁盘占⽤空间，磁盘存⼊⽂件内容的缓存空间最⼤值")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#调⽤缓存功能，需要定义在相应的配置段，如server{...}；或者location等")]),s._v("\nproxy_cache proxycache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nproxy_cache_key "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nproxy_cache_valid "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("302")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" 10m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定的状态码返回的数据缓存多⻓时间")]),s._v("\nproxy_cache_valid any 1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("proxy_cache_use_stale error http_502 http_503"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在被代理的后端服务器出现哪种情况下，可直接使⽤过期的缓存响应客⼾端，")]),s._v("\nproxy_cache_use_stale error "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" invalid_header "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" updating "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" http_500 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" http_502\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" http_503 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" http_504 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" http_403 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" http_404 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" off "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认是off")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("proxy_cache_methods GET "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" HEAD "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" POST "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#对哪些客⼾端请求⽅法对应的响应进⾏缓存，GET和HEAD⽅法总是被缓存")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h5",{attrs:{id:"非缓存场景压测"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#非缓存场景压测"}},[s._v("#")]),s._v(" 非缓存场景压测")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 准备测试页面")]),s._v("\nroot@ubuntu3:/var/www/html"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll -h")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".9M\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".0K Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":38 ./\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".0K Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":32 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":36 index.html\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".9M Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":38 lotus.log\nroot@ubuntu3:/var/www/html"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ab -n 2000 -c200 http://www.xiaomao.com/app/lotus.log")]),s._v("\nConcurrency Level:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\nTime taken "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" tests:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.428")]),s._v(" seconds\nComplete requests:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\nFailed requests:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nNon-2xx responses:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\nTotal transferred:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("914000")]),s._v(" bytes\nHTML transferred:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("554000")]),s._v(" bytes\nRequests per second:    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4674.60")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/sec] (mean)")]),s._v("\nTime per request:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42.784")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTime per request:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.214")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean, across all concurrent requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTransfer rate:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2086.22")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Kbytes/sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" received\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("h5",{attrs:{id:"准备缓存配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备缓存配置"}},[s._v("#")]),s._v(" 准备缓存配置")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /apps/nginx/conf/nginx.conf")]),s._v("\nhttp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n proxy_cache_path /apps/nginx/proxycache "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("levels")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":2:2 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("keys_zone")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("proxycache:20m "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("inactive")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("120s "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max_size")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1g"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 调用缓存")]),s._v("\nroot@ubuntu1:/apps/nginx/proxycache"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /apps/nginx/conf/conf.d/linux39.conf")]),s._v("\nlocation /app "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            index  index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_pass http://10.2.32.12/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_cache proxycache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_cache_key "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_cache_valid "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("302")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" 10m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_cache_valid any 1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问并验证缓存文件")]),s._v("\nroot@ubuntu3:/var/www/html"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ab -n 80000 -c200 http://www.xiaomao.com/app/")]),s._v("\nConcurrency Level:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\nTime taken "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" tests:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26.240")]),s._v(" seconds\nComplete requests:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80000")]),s._v("\nFailed requests:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nNon-2xx responses:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80000")]),s._v("\nTotal transferred:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36560000")]),s._v(" bytes\nHTML transferred:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22160000")]),s._v(" bytes\nRequests per second:    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3048.75")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/sec] (mean)")]),s._v("\nTime per request:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65.601")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTime per request:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.328")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean, across all concurrent requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTransfer rate:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1360.62")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Kbytes/sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" received\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#验证缓存⽬录结构及⽂件⼤⼩")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tree /apps/nginx/proxycache/")]),s._v("\n/apps/nginx/proxycache/\n├── "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n│   └── "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("\n│       └── "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n├── "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n│   └── "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("\n│       └── "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n└── a\n    └── "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("\n        └── e\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("h5",{attrs:{id:"添加头部报文信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加头部报文信息"}},[s._v("#")]),s._v(" 添加头部报文信息")]),s._v(" "),a("p",[s._v("nginx基于模块ngx_http_headers_module可以实现对头部报⽂添加指定的key与值， https://nginx.org/en/docs/http/ngx_http_headers_module.html")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加⾃定义⾸部，如下：")]),s._v("\nadd_header name value "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("always"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\tadd_header X-Via "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\tadd_header X-Cache "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$upstream_cache_status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\tadd_header X-Accel "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx配置")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/conf.d"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim linux39.conf")]),s._v("\n    location /app "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            index  index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_pass http://10.2.32.12/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            add_header X-Via "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            add_header X-Cache "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$upstream_cache_status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            add_header X-Accel "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证头部信息   第一次访问没有缓存")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl -I http://www.xiaomao.com/app")]),s._v("\nHTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\nServer: linux39\nDate: Mon, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" 07:41:46 GMT\nContent-Type: text/html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("charset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf-8\nContent-Length: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4040629")]),s._v("\nConnection: keep-alive\nVary: Accept-Encoding\nLast-Modified: Sun, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":38:05 GMT\nETag: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3da7b5-5cf1a3131cd40"')]),s._v("\nVary: Accept-Encoding\nX-Via: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\nX-Cache: MISS\nX-Accel: www.xiaomao.com\nAccept-Ranges: bytes\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第二次访问  有缓存 X-Cache: HIT")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl -I http://www.xiaomao.com/app")]),s._v("\nHTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\nServer: linux39\nDate: Mon, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" 07:42:26 GMT\nContent-Type: text/html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("charset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf-8\nContent-Length: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4040629")]),s._v("\nConnection: keep-alive\nVary: Accept-Encoding\nLast-Modified: Sun, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":38:05 GMT\nETag: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3da7b5-5cf1a3131cd40"')]),s._v("\nVary: Accept-Encoding\nX-Via: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\nX-Cache: HIT\nX-Accel: www.xiaomao.com\nAccept-Ranges: bytes\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("h5",{attrs:{id:"http-upstream配置参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-upstream配置参数"}},[s._v("#")]),s._v(" "),a("strong",[s._v("http upstream")]),s._v("配置参数")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置⼀个后端web服务器，配置在upstream内，⾄少要有⼀个server服务器配置。")]),s._v("\nupstream name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#⾃定义⼀组服务器，配置在http内")]),s._v("\nserver address "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("parameters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#server⽀持的parameters如下：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("weight")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("number "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置权重，默认为1。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max_conns")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("number "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#给当前server设置最⼤活动链接数，默认为0表⽰没有限制。 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max_fails")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("number "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#对后端服务器连续监测失败多少次就标记为不可⽤。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fail_timeout")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("time "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#对后端服务器的单次监测超时时间，默认为10秒。 ")]),s._v("\nbackup "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置为备份服务器，当所有服务器不可⽤时将重新启⽤次服务器。")]),s._v("\ndown "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#标记为down状态。")]),s._v("\nresolve "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#当server定义的是主机名的时候，当A记录发⽣变化会⾃动应⽤新IP⽽不⽤重启Nginx。")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("hash")]),s._v(" KEY consistent；\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#基于指定key做hash计算，使⽤consistent参数，将使⽤ketama⼀致性hash算法，适⽤于后端是Cache服务器 （如varnish）时使⽤，consistent定义使⽤⼀致性hash运算，⼀致性hash基于取模运算。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("hash")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")]),s._v(" consistent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#基于⽤⼾请求的uri做hash")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ip_hash； "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#源地址hash调度⽅法，基于的客⼾端的remote_addr(源地址)做hash计算，以实现会话保持，")]),s._v("\nleast_conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最少连接调度算法，优先将客⼾端请求调度到当前连接最少的后端服务器")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 反向代理多台web服务器")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /apps/nginx/conf/conf.d/linux39.conf")]),s._v("\nupstream webserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        server "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(".32.11:88   "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("weight")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fail_timeout")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("5s "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max_fails")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(".32.12:80   "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("weight")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fail_timeout")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("5s "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max_fails")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tlocation /app "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            index  index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_pass http://webserver/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试")]),s._v("\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl http://www.xiaomao.com/app/index.html")]),s._v("\napp "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(".32.11\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl http://www.xiaomao.com/app/index.html")]),s._v("\napp "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(".32.12\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl http://www.xiaomao.com/app/index.html")]),s._v("\napp "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(".32.11\nroot@ubuntu1:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl http://www.xiaomao.com/app/index.html")]),s._v("\napp "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(".32.12\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h5",{attrs:{id:"负载均衡实例-mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡实例-mysql"}},[s._v("#")]),s._v(" 负载均衡实例："),a("strong",[s._v("MySQL")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu3:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt install mysql-server")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑配置文件")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/tcp"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat tcp.conf")]),s._v("\nstream "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        upstream linux39-mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                server "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(".32.12:3306 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max_fails")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fail_timeout")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("30s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                listen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(".32.10:3306"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#客户端访问这个地址然后反代到10.2.32.12上")]),s._v("\n                proxy_pass  linux39-mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 转发到具体服务器组")]),s._v("\n                proxy_connect_timeout 1s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#连接超时时间")]),s._v("\n                proxy_timeout 3s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#转发超时时间")]),s._v("\n                \n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@ubuntu1:/apps/nginx/conf/tcp"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /apps/nginx/conf/nginx.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在http外导入")]),s._v("\ninclued /apps/nginx/conf/tcp/*.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启并查看MySQL端口")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/tcp"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart nginx")]),s._v("\nroot@ubuntu1:/apps/nginx/conf/tcp"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ss -ntl")]),s._v("\nState                    Recv-Q                    Send-Q                                        Local Address:Port                                       Peer Address:Port\nLISTEN                   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("                                              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(".32.10:3306                                            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h5",{attrs:{id:"系统参数优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统参数优化"}},[s._v("#")]),s._v(" 系统参数优化")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("默认的Linux内核参数考虑的是最通⽤场景，不符合⽤于⽀持⾼并发访问的Web服务器的定义，根据业务特点来进⾏调 整，当Nginx作为静态web内容服务器、反向代理或者提供压缩服务器的服务器时，内核参数的调整都是不同的，此处 针对最通⽤的、使Nginx⽀持更多并发请求的TCP⽹络参数做简单的配置,修改/etc/sysctl.conf来更改内核参数\n\nnet.ipv4.ip_nonlocal_bind "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许⾮本地IP地址socket监听 ")]),s._v("\nnet.ipv4.ip_forward "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启IPv4转发 ")]),s._v("\nnet.ipv4.tcp_timestamps "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否开启数据包时间戳 ")]),s._v("\nnet.ipv4.tcp_tw_reuse "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#端⼝复⽤ ")]),s._v("\nnet.ipv4.tcp_tw_recycle "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#快速回收TIME_WAIT状态，⽤于⼤量TIME_OUT场景")]),s._v("\n\nfs.file-max "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#表⽰单个进程较⼤可以打开的句柄数")]),s._v("\nnet.ipv4.tcp_tw_reuse "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#参数设置为 1 ，表⽰允许将TIME_WAIT状态的socket重新⽤于新的TCP链接，这对于服务器来说意义重⼤，因为总 有⼤量TIME_WAIT状态的链接存在")]),s._v("\nnet.ipv4.tcp_keepalive_time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#当keepalive启动时，TCP发送keepalive消息的频度；默认是2⼩时，将其设置为10分钟，可更快的清理⽆效链接")]),s._v("\nnet.ipv4.tcp_fin_timeout "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#当服务器主动关闭链接时，socket保持在FIN_WAIT_2状态的较⼤时间")]),s._v("\nnet.ipv4.tcp_max_tw_buckets "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#表⽰操作系统允许TIME_WAIT套接字数量的较⼤值，如超过此值，TIME_WAIT套接字将⽴刻被清除并打印警告信息, 默认为8000，过多的TIME_WAIT套接字会使Web服务器变慢")]),s._v("\n\nnet.ipv4.tcp_rmem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10240")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("87380")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12582912")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义了TCP接受socket请求缓存的内存最⼩值、默认值、较⼤值")]),s._v("\nnet.ipv4.ip_local_port_range "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义UDP和TCP链接的本地端⼝的取值范围")]),s._v("\nnet.ipv4.tcp_wmem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10240")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("87380")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12582912")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义TCP发送缓存的最⼩值、默认值、较⼤值")]),s._v("\nnet.core.netdev_max_backlog "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8096")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#当⽹卡接收数据包的速度⼤于内核处理速度时，会有⼀个列队保存这些数据包。这个参数表⽰该列队的较⼤值")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("net.core.somaxconn")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("262114")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#选项默认值是128，这个参数⽤于调节系统同时发起的TCP连接数，在⾼并发的请求中，默认的值可能会导致链接超时 或者重传，因此需要结合⾼并发请求数来调节此值。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("net.ipv4.tcp_max_orphans")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("262114")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#选项⽤于设定系统中最多有多少个TCP套接字不被关联到任何⼀个⽤⼾⽂件句柄上。如果超过这个数字，孤⽴链接将⽴ 即被复位并输出警告信息。这个限制指⽰为了防⽌简单的DOS攻击，不⽤过分依靠这个限制甚⾄认为的减⼩这个值，更 多的情况是增加这个值")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h1",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[s._v("#")])])])}),[],!1,null,null,null);a.default=e.exports}}]);