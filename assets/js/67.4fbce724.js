(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{418:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"kubeadm高可用部署k8s集群1-20-0"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kubeadm高可用部署k8s集群1-20-0"}},[s._v("#")]),s._v(" kubeadm高可用部署k8s集群1.20.0")]),s._v(" "),t("h3",{attrs:{id:"基础环境配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基础环境配置"}},[s._v("#")]),s._v(" 基础环境配置")]),s._v(" "),t("h4",{attrs:{id:"集群规划"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集群规划"}},[s._v("#")]),s._v(" 集群规划")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".11")]),s._v("  k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),s._v("  k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master2\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".9")]),s._v("    k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master3\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".12")]),s._v("  k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".13")]),s._v("  k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".14")]),s._v("  keepalived虚拟IP\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h4",{attrs:{id:"修改hosts文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改hosts文件"}},[s._v("#")]),s._v(" 修改hosts文件")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 五台机器配置一样")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/hosts")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v("   localhost localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("localdomain localhost4 localhost4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("localdomain4\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("         localhost localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("localdomain localhost6 localhost6"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("localdomain6\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".11")]),s._v("  k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),s._v("  k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master2\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".9")]),s._v("   k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master3\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".15")]),s._v("  k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".13")]),s._v("  k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".14")]),s._v("  k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("lb\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h4",{attrs:{id:"配置yum源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置yum源"}},[s._v("#")]),s._v(" 配置yum源")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 五台机器配置一样")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install -y yum-utils device-mapper-persistent-data lvm2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  cat <<EOF > /etc/yum.repos.d/kubernetes.repo")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nname"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Kubernetes\nbaseurl"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("mirrors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyun"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yum"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("repos"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("el7"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x86_64"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\nenabled"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\ngpgcheck"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nrepo_gpgcheck"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\ngpgkey"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("mirrors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyun"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yum"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("doc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yum"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gpg https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("mirrors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyun"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yum"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("doc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("rpm"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("package"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gpg\nEOF\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sed -i -e '/mirrors.cloud.aliyuncs.com/d' -e '/mirrors.aliyuncs.com/d' /etc/yum.repos.d/CentOS-Base.repo")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h4",{attrs:{id:"安装依赖环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装依赖环境"}},[s._v("#")]),s._v(" 安装依赖环境")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 五台机器配置一样")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install wget jq psmisc vim net-tools telnet yum-utils device-mapper-persistent-data lvm2 git -y")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"关闭网络管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关闭网络管理"}},[s._v("#")]),s._v(" 关闭网络管理")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 五台机器配置一样")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl disable --now NetworkManager")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"关闭swap分区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关闭swap分区"}},[s._v("#")]),s._v(" 关闭swap分区")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 五台机器配置一样")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# swapoff -a && sysctl -w vm.swappiness=0")]),s._v("\nvm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("swappiness "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sed -ri '/^[^#]*swap/s@^@#@' /etc/fstab")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"同步时间"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#同步时间"}},[s._v("#")]),s._v(" 同步时间")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 五台机器配置一样")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install ntpdate -y")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo 'Asia/Shanghai' >/etc/timezone")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ntpdate time2.aliyun.com")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把同步时间加到计划任务里面")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# crontab -l")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sbin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ntpdate time2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyun"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h4",{attrs:{id:"所有节点配置limit"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#所有节点配置limit"}},[s._v("#")]),s._v(" 所有节点配置limit")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ulimit -SHn 65535")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/security/limits.conf")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" soft nofile "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" hard nofile "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" soft nproc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" hard nproc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("655350")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" soft memlock unlimited\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" hard memlock unlimited\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h4",{attrs:{id:"配置免密登录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置免密登录"}},[s._v("#")]),s._v(" 配置免密登录")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只在k8s-master1上执行")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-keygen -t rsa")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#for i in 10.2.32.11  10.2.32.12 10.2.32.13 10.2.32.9 10.2.32.10;do ssh-copy-id -i .ssh/id_rsa.pub $i;done;")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h4",{attrs:{id:"下载源码文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载源码文件"}},[s._v("#")]),s._v(" 下载源码文件")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# git clone https://github.com/dotbalo/k8s-ha-install.git")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"升级系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级系统"}},[s._v("#")]),s._v(" 升级系统")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全部节点都要升级")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#yum update -y --exclude=kernel* && reboot")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 升级完后查看系统版本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/redhat-release")]),s._v("\nCentOS Linux release "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.9")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2009")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Core"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"内核配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内核配置"}},[s._v("#")]),s._v(" 内核配置")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载内核源码包")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget http://193.49.22.109/elrepo/kernel/el7/x86_64/RPMS/kernel-ml-devel-4.19.12-1.el7.elrepo.x86_64.rpm")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget http://193.49.22.109/elrepo/kernel/el7/x86_64/RPMS/kernel-ml-4.19.12-1.el7.elrepo.x86_64.rpm")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拷贝源码包到其他节点")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#for i in k8s-master2 k8s-master3 k8s-node1 k8s-node2;do scp kernel-ml-4.19.12-1.el7.elrepo.x86_64.rpm kernel-ml-devel-4.19.12-1.el7.elrepo.x86_64.rpm $i:/root/ ; done")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#所有节点安装内核")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum localinstall -y kernel-ml*")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所有节点更改内核启动顺序")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# grub2-set-default  0 && grub2-mkconfig -o /etc/grub2.cfg")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看内核是否升级到4.19")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# grubby --default-kernel")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("boot"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("vmlinuz"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.19")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".12")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("el7"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("elrepo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("x86_64\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h4",{attrs:{id:"所有节点安装ipvsadm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#所有节点安装ipvsadm"}},[s._v("#")]),s._v(" 所有节点安装ipvsadm")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install ipvsadm ipset sysstat conntrack libseccomp -y")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/modules-load.d/ipvs.conf ")]),s._v("\nip_vs\nip_vs_lc\nip_vs_wlc\nip_vs_rr\nip_vs_wrr\nip_vs_lblc\nip_vs_lblcr\nip_vs_dh\nip_vs_sh\nip_vs_fo\nip_vs_nq\nip_vs_sed\nip_vs_ftp\nip_vs_sh\nnf_conntrack\nip_tables\nip_set\nxt_set\nipt_set\nipt_rpfilter\nipt_REJECT\nipip\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使配置文件生效")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable --now systemd-modules-load.service")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("h4",{attrs:{id:"所有节点配置k8s内核参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#所有节点配置k8s内核参数"}},[s._v("#")]),s._v(" 所有节点配置k8s内核参数")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat <<EOF > /etc/sysctl.d/k8s.conf")]),s._v("\nnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ipv4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ip_forward "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bridge"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bridge"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nf"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("call"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("iptables "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bridge"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bridge"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nf"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("call"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ip6tables "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("may_detach_mounts "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nvm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("overcommit_memory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nvm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("panic_on_oom"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("inotify"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("max_user_watches"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("89100")]),s._v("\nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("file")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("max")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("52706963")]),s._v("\nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("nr_open"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("52706963")]),s._v("\nnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("netfilter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("nf_conntrack_max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2310720")]),s._v("\n\nnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ipv4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tcp_keepalive_time "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v("\nnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ipv4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tcp_keepalive_probes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ipv4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tcp_keepalive_intvl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\nnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ipv4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tcp_max_tw_buckets "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("36000")]),s._v("\nnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ipv4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tcp_tw_reuse "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ipv4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tcp_max_orphans "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("327680")]),s._v("\nnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ipv4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tcp_orphan_retries "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ipv4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tcp_syncookies "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ipv4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tcp_max_syn_backlog "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("\nnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ipv4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ip_conntrack_max "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\nnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ipv4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tcp_max_syn_backlog "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("\nnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ipv4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tcp_timestamps "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("core"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("somaxconn "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("\nEOF\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sysctl --system")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证是否已经加载")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lsmod | grep --color=auto -e ip_vs -e nf_conntrack")]),s._v("\nnf_conntrack_netlink    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40960")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nnfnetlink              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" nf_conntrack_netlink"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ip_set\nip_vs_ftp              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nnf_nat                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" nf_nat_ipv4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ip_vs_ftp\nip_vs_sed              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nip_vs_nq               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nip_vs_fo               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nip_vs_sh               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nip_vs_dh               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nip_vs_lblcr            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nip_vs_lblc             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nip_vs_wrr              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nip_vs_rr               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nip_vs_wlc              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nip_vs_lc               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nip_vs                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("151552")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" ip_vs_wlc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ip_vs_rr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ip_vs_dh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ip_vs_lblcr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ip_vs_sh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ip_vs_fo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ip_vs_nq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ip_vs_lblc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ip_vs_wrr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ip_vs_lc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ip_vs_sed"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ip_vs_ftp\nnf_conntrack          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("143360")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" xt_conntrack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("nf_nat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ipt_MASQUERADE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("nf_nat_ipv4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("nf_conntrack_netlink"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ip_vs\nnf_defrag_ipv6         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20480")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" nf_conntrack\nnf_defrag_ipv4         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" nf_conntrack\nlibcrc32c              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" nf_conntrack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("nf_nat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("xfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ip_vs\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br")])]),t("h3",{attrs:{id:"基本组件安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基本组件安装"}},[s._v("#")]),s._v(" 基本组件安装")]),s._v(" "),t("h4",{attrs:{id:"安装docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装docker"}},[s._v("#")]),s._v(" 安装docker")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全部机器")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  yum -y  install epel-release")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install docker-ce-*  -y")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 由于新版kubelet建议使用systemd，所以可以把docker的CgroupDriver改成systemd")]),s._v("\nmkdir "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker\ncat "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("daemon"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v("EOF\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exec-opts"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"native.cgroupdriver=systemd"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nEOF\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 弄完重启一下")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h4",{attrs:{id:"安装k8s组件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装k8s组件"}},[s._v("#")]),s._v(" 安装k8s组件")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全部节点安装")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  yum install kubeadm-1.20* kubelet-1.20* kubectl-1.20* -y")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置镜像库")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat >/etc/sysconfig/kubelet<<EOF")]),s._v("\nKUBELET_EXTRA_ARGS"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--cgroup-driver=systemd --pod-infra-container-image=registry.cn-hangzhou.aliyuncs.com/google_containers/pause-amd64:3.2"')]),s._v("\nEOF\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h4",{attrs:{id:"设置kubelet开机自启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置kubelet开机自启动"}},[s._v("#")]),s._v(" 设置kubelet开机自启动")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl  daemon-reload && systemctl  enable kubelet")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"高可用组件安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#高可用组件安装"}},[s._v("#")]),s._v(" 高可用组件安装")]),s._v(" "),t("h4",{attrs:{id:"所有master节点安装ha"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#所有master节点安装ha"}},[s._v("#")]),s._v(" 所有Master节点安装ha")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  yum install keepalived haproxy -y")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"配置haproxy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置haproxy"}},[s._v("#")]),s._v(" 配置haproxy")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#三台配置一样")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  vim /etc/haproxy/haproxy.cfg")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v("\n  maxconn  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\n  ulimit"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("\n  log  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v(" local0 err\n  stats timeout 30s\n\ndefaults\n  log "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v("\n  mode  http\n  option  httplog\n  timeout connect "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\n  timeout client  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),s._v("\n  timeout server  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),s._v("\n  timeout http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("request 15s\n  timeout http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("keep"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("alive 15s\n\nfrontend monitor"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n  bind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33305")]),s._v("\n  mode http\n  option httplog\n  monitor"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("uri "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("monitor\n\nfrontend k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master\n  bind "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16443")]),s._v("\n  bind "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16443")]),s._v("\n  mode tcp\n  option tcplog\n  tcp"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("request inspect"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("delay 5s\n  default_backend k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master\n\nbackend k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master\n  mode tcp\n  option tcplog\n  option tcp"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("check\n  balance roundrobin\n  default"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server inter 10s downinter 5s rise "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" fall "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" slowstart 60s maxconn "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("250")]),s._v(" maxqueue "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v(" weight "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n  server k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v("  check\n  server k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master2\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v("  check\n  server k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master3\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v("  check\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br")])]),t("h4",{attrs:{id:"配置keepalived"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置keepalived"}},[s._v("#")]),s._v(" 配置keepalived")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/keepalived/keepalived.conf")]),s._v("\n! Configuration File "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" keepalived\nglobal_defs "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    router_id LVS_DEVEL\nscript_user root\n    enable_script_security\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nvrrp_script chk_apiserver "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    script "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/keepalived/check_apiserver.sh"')]),s._v("\n    interval "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n    weight "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n    fall "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nrise "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nvrrp_instance VI_1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    state MASTER\n    interface ens32\n    mcast_src_ip "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".11")]),s._v("\n    virtual_router_id "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v("\n    priority "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v("\n    advert_int "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n    authentication "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        auth_type PASS\n        auth_pass K8SHA_KA_AUTH\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    virtual_ipaddress "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".14")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    track_script "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       chk_apiserver\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim  /etc/keepalived/keepalived.conf")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat !$")]),s._v("\ncat "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("keepalived"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("keepalived"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\n! Configuration File "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" keepalived\nglobal_defs "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    router_id LVS_DEVEL\nscript_user root\n    enable_script_security\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nvrrp_script chk_apiserver "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    script "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/keepalived/check_apiserver.sh"')]),s._v("\n    interval "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n    weight "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n    fall "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nrise "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nvrrp_instance VI_1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    state MASTER\n    interface ens32\n    mcast_src_ip "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".12")]),s._v("\n    virtual_router_id "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v("\n    priority "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n    advert_int "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n    authentication "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        auth_type PASS\n        auth_pass K8SHA_KA_AUTH\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    virtual_ipaddress "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".14")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    track_script "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       chk_apiserver\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master3 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/keepalived/keepalived.conf")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master3 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat !$")]),s._v("\ncat "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("keepalived"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("keepalived"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\n! Configuration File "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" keepalived\nglobal_defs "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    router_id LVS_DEVEL\nscript_user root\n    enable_script_security\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nvrrp_script chk_apiserver "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    script "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/keepalived/check_apiserver.sh"')]),s._v("\n    interval "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n    weight "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n    fall "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nrise "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nvrrp_instance VI_1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    state MASTER\n    interface ens32\n    mcast_src_ip "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".9")]),s._v("\n    virtual_router_id "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v("\n    priority "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),s._v("\n    advert_int "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n    authentication "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        auth_type PASS\n        auth_pass K8SHA_KA_AUTH\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    virtual_ipaddress "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".14")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    track_script "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       chk_apiserver\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br")])]),t("h4",{attrs:{id:"配置keepalived健康检查文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置keepalived健康检查文件"}},[s._v("#")]),s._v(" 配置KeepAlived健康检查文件")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所有master都要配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/keepalived/check_apiserver.sh")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\n\nerr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" k "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("seq "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndo\n    check_code"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pgrep haproxy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" $check_code "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" then\n        err"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("expr $err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        sleep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        err"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),s._v("\n    fi\ndone\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" $err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" then\n    echo "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"systemctl stop keepalived"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("systemctl stop keepalived\n    exit "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n    exit "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nfi\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加执行权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod +x /etc/keepalived/check_apiserver.sh")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("h4",{attrs:{id:"启动haproxy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动haproxy"}},[s._v("#")]),s._v(" 启动haproxy")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全部master都要操作")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  systemctl enable --now haproxy")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"启动keepalived"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动keepalived"}},[s._v("#")]),s._v(" 启动keepalived")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl stop   keepalived")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start    keepalived")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"查看vip是否绑定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看vip是否绑定"}},[s._v("#")]),s._v(" 查看vip是否绑定")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/image12.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"集群初始化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集群初始化"}},[s._v("#")]),s._v(" 集群初始化")]),s._v(" "),t("h4",{attrs:{id:"所有节点配置初始化文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#所有节点配置初始化文件"}},[s._v("#")]),s._v(" 所有节点配置初始化文件")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  cat kubeadm-config.yaml")]),s._v("\napiVersion"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kubeadm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1beta2\nbootstrapTokens"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" groups"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" system"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("bootstrappers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("kubeadm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("default"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token\n  token"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 7t2weq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bjbawausm0jaxury\n  ttl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 24h0m0s\n  usages"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" signing\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" authentication\nkind"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" InitConfiguration\nlocalAPIEndpoint"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  advertiseAddress"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".11")]),s._v("\n  bindPort"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v("\nnodeRegistration"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  criSocket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dockershim"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sock\n  name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1\n  taints"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" effect"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NoSchedule\n    key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("role"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("master\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\napiServer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  certSANs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".14")]),s._v("\n  timeoutForControlPlane"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 4m0s\napiVersion"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kubeadm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1beta2\ncertificatesDir"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pki\nclusterName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kubernetes\ncontrolPlaneEndpoint"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".14")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16443")]),s._v("\ncontrollerManager"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\ndns"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CoreDNS\netcd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  local"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    dataDir"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd\nimageRepository"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" registry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hangzhou"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyuncs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("google_containers\nkind"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterConfiguration\nkubernetesVersion"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.0")]),s._v("\nnetworking"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  dnsDomain"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cluster"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("local\n  podSubnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.168")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("\n  serviceSubnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("\nscheduler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br")])]),t("h4",{attrs:{id:"更新kubeadm文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更新kubeadm文件"}},[s._v("#")]),s._v(" 更新kubeadm文件")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所有节点都要操作")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubeadm config migrate --old-config kubeadm-config.yaml --new-config new.yaml")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"提前下载镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#提前下载镜像"}},[s._v("#")]),s._v(" 提前下载镜像")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所有节点都要操作")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubeadm config images pull --config /root/new.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("config"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Pulled registry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hangzhou"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyuncs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("google_containers"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("config"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Pulled registry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hangzhou"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyuncs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("google_containers"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("config"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Pulled registry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hangzhou"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyuncs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("google_containers"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("config"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Pulled registry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hangzhou"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyuncs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("google_containers"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("config"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Pulled registry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hangzhou"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyuncs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("google_containers"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pause"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("config"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Pulled registry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hangzhou"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyuncs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("google_containers"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.4")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".13")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("config"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Pulled registry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hangzhou"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyuncs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("google_containers"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("coredns"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.7")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h4",{attrs:{id:"master01初始化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#master01初始化"}},[s._v("#")]),s._v(" master01初始化")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubeadm init --config new.yaml  --upload-certs")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h5",{attrs:{id:"初化完成的界面"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初化完成的界面"}},[s._v("#")]),s._v(" 初化完成的界面")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("endpoint"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" WARNING"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" port specified "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" controlPlaneEndpoint overrides bindPort "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the controlplane address\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Applied essential addon"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kube"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy\n\nYour Kubernetes control"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plane has initialized successfully!\n\nTo start using your cluster"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" you need to run the following "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" a regular user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n  mkdir "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p $HOME"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kube\n  sudo cp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("admin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf $HOME"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kube"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("config\n  sudo chown $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("g"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" $HOME"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kube"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("config\n\nAlternatively"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" you are the root user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" you can run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n  export KUBECONFIG"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("admin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\n\nYou should now deploy a pod network to the cluster"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nRun "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubectl apply -f [podnetwork].yaml"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" one of the options listed at"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("concepts"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cluster"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("administration"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("addons"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n\nYou can now join "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("any")]),s._v(" number of the control"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plane node running the following command on each "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n  kubeadm join "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".14")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16443")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token 7t2weq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bjbawausm0jaxury \\\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("discovery"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("hash")]),s._v(" sha256"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("c697e118de80596ce2db02bdf2401a54bfe7ef5b8a2eea3bfade093f15618e77 \\\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("control"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plane "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("certificate"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key d3cf12c2979e438a0c420e3060f132e15733ceb4da92ac37bdac0853269058c0\n\nPlease note that the certificate"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key gives access to cluster sensitive data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" keep it secret!\nAs a safeguard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" uploaded"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("certs will be deleted "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" two hours"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" If necessary"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" you can use\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubeadm init phase upload-certs --upload-certs"')]),s._v(" to "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("reload")]),s._v(" certs afterward"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\nThen you can join "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("any")]),s._v(" number of worker nodes by running the following on each "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\nkubeadm join "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".14")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16443")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token 7t2weq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bjbawausm0jaxury \\\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("discovery"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("hash")]),s._v(" sha256"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("c697e118de80596ce2db02bdf2401a54bfe7ef5b8a2eea3bfade093f15618e77\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br")])]),t("h4",{attrs:{id:"配置环境变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置环境变量"}},[s._v("#")]),s._v(" 配置环境变量")]),s._v(" "),t("p",[s._v("用于访问Kubernetes集群")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在k8s-master配置即可")]),s._v("\ncat "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v("EOF "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bashrc\nexport KUBECONFIG"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("admin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\nEOF\nsource "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bashrc\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"查看集群节点状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看集群节点状态"}},[s._v("#")]),s._v(" 查看集群节点状态")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl  get nodes")]),s._v("\nNAME          STATUS     ROLES                  AGE     VERSION\nk8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1   NotReady   control"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plane"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master   6m23s   v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.14")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h4",{attrs:{id:"查看pod状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看pod状态"}},[s._v("#")]),s._v(" 查看pod状态")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -n kube-system -o wide")]),s._v("\nNAME                                  READY   STATUS    RESTARTS   AGE     IP           NODE          NOMINATED NODE   READINESS GATES\ncoredns"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("54d67798b7"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("8dgr8              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Pending   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          6m59s   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ncoredns"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("54d67798b7"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("wz9z8              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Pending   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          6m59s   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\netcd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1                      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          6m58s   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".11")]),s._v("   k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          6m58s   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".11")]),s._v("   k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          6m58s   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".11")]),s._v("   k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dqc57                      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          6m59s   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".11")]),s._v("   k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          6m58s   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".11")]),s._v("   k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h4",{attrs:{id:"token过期"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#token过期"}},[s._v("#")]),s._v(" token过期")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Token过期后生成新的token：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubeadm token create --print-join-command")]),s._v("\nkubeadm join "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".14")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16443")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token 1c9vqz"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("p2gqce9hwl9c8bzk     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("discovery"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("hash")]),s._v(" sha256"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("c697e118de80596ce2db02bdf2401a54bfe7ef5b8a2eea3bfade093f15618e77\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Master需要生成--certificate-key")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubeadm init phase upload-certs  --upload-certs")]),s._v("\nI0112 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23.398423")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1336")]),s._v(" version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("go"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("254")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" remote version "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("is")]),s._v(" much newer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23.1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" falling back to"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.20")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("upload"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("certs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Storing the certificates "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" Secret "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubeadm-certs"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-system"')]),s._v(" Namespace\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("upload"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("certs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using certificate key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n6cc1f5774448d9af22b38869ae48423c3499e6484c5040822589b474a313f932\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h4",{attrs:{id:"初始化其他master节点加入集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化其他master节点加入集群"}},[s._v("#")]),s._v(" 初始化其他master节点加入集群")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubeadm join 10.2.32.14:16443 --token 1c9vqz.p2gqce9hwl9c8bzk     --discovery-token-ca-cert-hash sha256:c697e118de80596ce2db02bdf2401a54bfe7ef5b8a2eea3bfade093f15618e77 \\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("control"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plane "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("certificate"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key 6cc1f5774448d9af22b38869ae48423c3499e6484c5040822589b474a313f932\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"查看是否加入成功"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看是否加入成功"}},[s._v("#")]),s._v(" 查看是否加入成功")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl  get node")]),s._v("\nNAME          STATUS     ROLES                  AGE    VERSION\nk8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1   NotReady   control"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plane"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master   12h    v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.14")]),s._v("\nk8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master2   NotReady   control"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plane"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master   102s   v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.14")]),s._v("\nk8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master3   NotReady   control"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plane"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master   92s    v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.14")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"node节点加入"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#node节点加入"}},[s._v("#")]),s._v(" node节点加入")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("kubeadm join "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".14")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16443")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token 1c9vqz"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("p2gqce9hwl9c8bzk     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("discovery"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("hash")]),s._v(" sha256"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("c697e118de80596ce2db02bdf2401a54bfe7ef5b8a2eea3bfade093f15618e77\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"查看集群状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看集群状态"}},[s._v("#")]),s._v(" 查看集群状态")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 calico"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get po -n kube-system -o wide")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/image13.png",alt:""}})]),s._v(" "),t("p",[s._v("部署成功时的状态")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/image14.png",alt:""}})]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看报错原因")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl describe pod  kube-proxy-n6flb  -n kube-system")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 原因拉取不下来镜像")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/image15.png",alt:""}})]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  解决 找一台拉取下来好的导出来传到12上")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 备份镜像")]),s._v("\ndocker save "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("o "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tar    registry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hangzhou"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyuncs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("google_containers"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导入镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker load -i 7.tar")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导入完在node1查看是否导入完成")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/image16.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"calico组件的安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#calico组件的安装"}},[s._v("#")]),s._v(" Calico组件的安装")]),s._v(" "),t("h4",{attrs:{id:"编译部署python3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编译部署python3"}},[s._v("#")]),s._v(" 编译部署python3")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装依赖环境")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 calico"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum -y install make gcc gcc-c++ zlib-devel bzip2-devel gdbm-devel  xz-devel tk-devel readline-devel sqlite-devel ncurses-devel openssl-devel")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 calico"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  yum install -y zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel libffi-devel")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h5",{attrs:{id:"下载python源码包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载python源码包"}},[s._v("#")]),s._v(" 下载python源码包")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://www.python.org/ftp/python/3.7.7/Python-3.7.7.tar.xz")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h5",{attrs:{id:"创建安装目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建安装目录"}},[s._v("#")]),s._v(" 创建安装目录")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 calico"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir -p /usr/local/python3")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h5",{attrs:{id:"开始编译部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开始编译部署"}},[s._v("#")]),s._v(" 开始编译部署")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar -xvJf Python-3.7.7.tar.xz")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd Python-3.7.7")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开始编译")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 Python"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.7")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./configure --prefix=/usr/local/python3 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 Python"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.7")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# make &&  make install")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看是否编译安装成功")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# python3")]),s._v("\nPython "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.7")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".7")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("GCC "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.8")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20150623")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Red Hat "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.8")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".5")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" on linux\nType "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"help"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"copyright"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"credits"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("or")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"license"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" more information"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装pybase64")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  pip3 install pybase64")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("h5",{attrs:{id:"修改配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件"}},[s._v("#")]),s._v(" 修改配置文件")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 就在一台机器k8s-master1配置即可")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd k8s-ha-install/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ha"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("install"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# git checkout manual-installation-v1.20.x")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改配置文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ha"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("install"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd calico/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 calico"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# sed -i \'s#etcd_endpoints: "http://<ETCD_IP>:<ETCD_PORT>"#etcd_endpoints: "https://10.2.32.11:2379,https://10.2.32.10:2379,https:/10.2.32.9:2379"#g\' calico-etcd.yaml')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 calico"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ETCD_CA=`cat /etc/kubernetes/pki/etcd/ca.crt | base64 | tr -d '\\n'`")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 calico"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  ETCD_CERT=`cat /etc/kubernetes/pki/etcd/server.crt | base64 | tr -d '\\n'`")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 calico"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ETCD_KEY=`cat /etc/kubernetes/pki/etcd/server.key | base64 | tr -d '\\n'`")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 calico"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#  sed -i "s@# etcd-key: null@etcd-key: ${ETCD_KEY}@g; s@# etcd-cert: null@etcd-cert: ${ETCD_CERT}@g; s@# etcd-ca: null@etcd-ca: ${ETCD_CA}@g" calico-etcd.yaml')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 calico"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# sed -i \'s#etcd_ca: ""#etcd_ca: "/calico-secrets/etcd-ca"#g; s#etcd_cert: ""#etcd_cert: "/calico-secrets/etcd-cert"#g; s#etcd_key: "" #etcd_key: "/calico-secrets/etcd-key" #g\' calico-etcd.yaml')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 calico"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# POD_SUBNET=`cat /etc/kubernetes/manifests/kube-controller-manager.yaml | grep cluster-cidr= | awk -F= '{print $NF}'`")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 换成自已的集群网段名称")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 calico"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sed -i 's@# - name: CALICO_IPV4POOL_CIDR@- name: CALICO_IPV4POOL_CIDR@g; s@#   value: \"10.2.32.0/19\"@  value: '\"${POD_SUBNET}\"'@g' calico-etcd.yaml")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h4",{attrs:{id:"开始安装calico"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开始安装calico"}},[s._v("#")]),s._v(" 开始安装calico")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 calico"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f calico-etcd.yaml")]),s._v("\nsecret"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("calico"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("etcd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("secrets created\nconfigmap"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("calico"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config created\nclusterrole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("calico"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("kube"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controllers created\nclusterrolebinding"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("calico"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("kube"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controllers created\nclusterrole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("calico"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node created\nclusterrolebinding"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("calico"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node created\ndaemonset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apps"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("calico"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node created\nserviceaccount"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("calico"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node created\ndeployment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apps"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("calico"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("kube"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controllers created\nserviceaccount"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("calico"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("kube"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controllers created\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h4",{attrs:{id:"查看calico是否安装完成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看calico是否安装完成"}},[s._v("#")]),s._v(" 查看calico是否安装完成")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 calico"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   kubectl get pods -n kube-system -o wide")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/image17.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"metrics部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#metrics部署"}},[s._v("#")]),s._v(" Metrics部署")]),s._v(" "),t("p",[s._v("在新版的Kubernetes中系统资源的采集均使用Metrics-server，可以通过Metrics采集节点和Pod的内存、磁盘、CPU和网络的使用率")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将Master节点的front-proxy-ca.crt复制到所有Node节点")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 calico"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scp /etc/kubernetes/pki/front-proxy-ca.crt k8s-node1:/etc/kubernetes/pki/front-proxy-ca.crt")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 calico"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scp /etc/kubernetes/pki/front-proxy-ca.crt k8s-node2:/etc/kubernetes/pki/front-proxy-ca.crt")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h4",{attrs:{id:"安装metrics-server"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装metrics-server"}},[s._v("#")]),s._v(" 安装metrics server")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 calico"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /root/k8s-ha-install/metrics-server-0.4.x-kubeadm/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 metrics"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("kubeadm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f comp.yaml")]),s._v("\nserviceaccount"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("metrics"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server created\nclusterrole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("system"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("aggregated"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("metrics"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("reader created\nclusterrole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("system"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("metrics"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server created\nrolebinding"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("metrics"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("auth"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("reader created\nclusterrolebinding"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("metrics"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("system"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("auth"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("delegator created\nclusterrolebinding"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("system"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("metrics"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server created\nservice"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("metrics"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server created\ndeployment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apps"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("metrics"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server created\napiservice"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apiregistration"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1beta1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("metrics"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io created\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h4",{attrs:{id:"查看状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看状态"}},[s._v("#")]),s._v(" 查看状态")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 metrics"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("kubeadm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl top node")]),s._v("\nNAME          CPU"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cores"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   CPU"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("   MEMORY"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   MEMORY"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("\nk8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1   146m         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("     944Mi           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("\nk8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master2   228m         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("     895Mi           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("\nk8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master3   517m         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("    844Mi           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("\nk8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1     78m          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("     789Mi           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("\nk8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2     253m         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("     1021Mi          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"dashboard部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dashboard部署"}},[s._v("#")]),s._v(" Dashboard部署")]),s._v(" "),t("h4",{attrs:{id:"安装指定版本dashboard"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装指定版本dashboard"}},[s._v("#")]),s._v(" 安装指定版本dashboard")]),s._v(" "),t("p",[s._v("Dashboard用于展示集群中的各类资源，同时也可以通过Dashboard实时查看Pod的日志和在容器中执行一些命令等。")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd k8s-ha-install/dashboard/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ha"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("install"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd dashboard/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 dashboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\ndashboard"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml  dashboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 dashboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl  create -f .")]),s._v("\nserviceaccount"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("admin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("user created\nclusterrolebinding"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("admin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("user created\nnamespace"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard created\nserviceaccount"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard created\nservice"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard created\nsecret"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("certs created\nsecret"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csrf created\nsecret"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("holder created\nconfigmap"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("settings created\nrole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard created\nclusterrole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard created\nrolebinding"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard created\nclusterrolebinding"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard created\ndeployment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apps"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard created\nservice"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dashboard"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("metrics"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scraper created\ndeployment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apps"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dashboard"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("metrics"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scraper created\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("h4",{attrs:{id:"官方安装教程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#官方安装教程"}},[s._v("#")]),s._v(" 官方安装教程")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("官方GitHub地址：https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("github"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dashboard\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"修改配置文件-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件-2"}},[s._v("#")]),s._v(" 修改配置文件")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 dashboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl edit svc kubernetes-dashboard -n kubernetes-dashboard")]),s._v("\ndashboard\n  ports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n    protocol"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TCP\n    targetPort"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8443")]),s._v("\n  selector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard\n  sessionAffinity"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NodePort\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h4",{attrs:{id:"查看端口号"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看端口号"}},[s._v("#")]),s._v(" 查看端口号")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 dashboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc kubernetes-dashboard -n kubernetes-dashboard")]),s._v("\nNAME                   TYPE       CLUSTER"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP      EXTERNAL"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         AGE\nkubernetes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard   NodePort   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.99")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".104")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".174")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32581")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("TCP   2m44s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h4",{attrs:{id:"访问dashboard"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#访问dashboard"}},[s._v("#")]),s._v(" 访问Dashboard")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vip登录")]),s._v("\nhttps"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".14")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32581")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/image18.png",alt:""}})]),s._v(" "),t("p",[s._v("登录上去后选择token,查看到token值后就复制到浏览器上就可以登录进去了")]),s._v(" "),t("h4",{attrs:{id:"查看token值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看token值"}},[s._v("#")]),s._v(" 查看token值")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 dashboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk '{print $1}')")]),s._v("\nName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("         admin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c2tx7\nNamespace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("    kube"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("system\nLabels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nAnnotations"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  kubernetes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("service"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("account"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" admin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("user\n              kubernetes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("service"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("account"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("uid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 956609f6"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5692")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("42eb"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9069")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("7f3d918d38cd\n\nType"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  kubernetes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("service"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("account"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token\n\nData\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\nca"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("crt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1066")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v("\nnamespace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v("\ntoken"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("      eyJhbGciOiJSUzI1NiIsImtpZCI6IkdCcjZybGNicXJHdEJxVFZ5amVUSEEwU3duLWROODRLUVl3UmVtTDA4SHcifQ"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLWMydHg3Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI5NTY2MDlmNi01NjkyLTQyZWItOTA2OS03ZjNkOTE4ZDM4Y2QiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06YWRtaW4tdXNlciJ9"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DMBYaxiCc5672fdiqcfR_QzkpKs1M4Fjo3AbJAFV1taBGrHiZJ64qLKDEs2VuOO6E4jOykw6d7UHgofN"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("yChAkuVmBHZNYe9_RgWGCu8bTd5LmwZq1ora39amFyro0K5OzK"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("zFAG2JAg2iq0ZaJRYMFQpBlKQy6wXwkY_rVgBFHo7_lHFRpHlaui0YfA2e13x1qP65LhGHd4LTp"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("oDJCXwEJOW8eXiUyKIfHZiw0oia9aie724BIn9uOqAz2WkNejn4tBrhe90E54ADd1N76sQjUTnNYPzsM0G7MvaE16w2T3oA1m44BzaujSrFvlchWDF8qkx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("E7KOenYNULtILXA\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/image19.png",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"一些必须的配置更改"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一些必须的配置更改"}},[s._v("#")]),s._v(" 一些必须的配置更改")]),s._v(" "),t("p",[s._v("将Kube-proxy改为ipvs模式，因为在初始化集群的时候注释了ipvs配置，所以需要自行修改一下")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 dashboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl edit cm kube-proxy -n kube-system")]),s._v("\nmode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" “ipvs”\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新proxy ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 dashboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# kubectl patch daemonset kube-proxy -p "{\\"spec\\":{\\"template\\":{\\"metadata\\":{\\"annotations\\":{\\"date\\":\\"`date +\'%s\'`\\"}}}}}" -n kube-system')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h5",{attrs:{id:"验证kube-proxy模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证kube-proxy模式"}},[s._v("#")]),s._v(" 验证kube-proxy模式")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 dashboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl 127.0.0.1:10249/proxyMode")]),s._v("\nipvs\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);