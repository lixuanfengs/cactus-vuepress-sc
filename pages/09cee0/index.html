<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SpringBoot是如何实现自动配置的？ | Cactusli blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3077305_pt8umhrn4k9.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3129839_xft6cqs5gc.css">
    <noscript><meta http-equiv="refresh" content="0; url=https://www.youngkbt.cn/noscript/"><style>.theme-vdoing-content { display:none }</noscript>
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/artalk/2.5.5/Artalk.css">
    <script src="https://cdn.bootcdn.net/ajax/libs/artalk/2.5.5/Artalk.js"></script>
    <script>var _hmt = _hmt || [];
          (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?efc65c9365211267213266ca9b95b304"; 
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
          })();
          </script>
    <meta name="description" content="后端技术博客,专注前后端学习与总结。Java,JavaScript,js,ES6,TypeScript,vue,React,python,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="后端端博客,个人技术博客,后端,后端开发,前端框架,Java后端,后端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="codeva-nBtnwPHxXt">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/assets/css/0.styles.b8eeafc3.css" as="style"><link rel="preload" href="/assets/js/app.d73578e6.js" as="script"><link rel="preload" href="/assets/js/2.f6444e8b.js" as="script"><link rel="preload" href="/assets/js/127.e55d2fa9.js" as="script"><link rel="preload" href="/assets/js/13.9ca28764.js" as="script"><link rel="preload" href="/assets/js/6.0f00df03.js" as="script"><link rel="preload" href="/assets/js/5.1368437e.js" as="script"><link rel="preload" href="/assets/js/4.7c9e6596.js" as="script"><link rel="prefetch" href="/assets/js/10.af60255b.js"><link rel="prefetch" href="/assets/js/100.3ef796c4.js"><link rel="prefetch" href="/assets/js/101.aae7784e.js"><link rel="prefetch" href="/assets/js/102.8da091f1.js"><link rel="prefetch" href="/assets/js/103.ad0dd5b7.js"><link rel="prefetch" href="/assets/js/104.642836fc.js"><link rel="prefetch" href="/assets/js/105.f3c5bcec.js"><link rel="prefetch" href="/assets/js/106.85dad7d8.js"><link rel="prefetch" href="/assets/js/107.42b1c013.js"><link rel="prefetch" href="/assets/js/108.2a978b6c.js"><link rel="prefetch" href="/assets/js/109.46c8b7c6.js"><link rel="prefetch" href="/assets/js/11.372f8efb.js"><link rel="prefetch" href="/assets/js/110.2cb8a5dc.js"><link rel="prefetch" href="/assets/js/111.c68e8975.js"><link rel="prefetch" href="/assets/js/112.d89adde5.js"><link rel="prefetch" href="/assets/js/113.e52ab124.js"><link rel="prefetch" href="/assets/js/114.94f7a70b.js"><link rel="prefetch" href="/assets/js/115.68c55722.js"><link rel="prefetch" href="/assets/js/116.9cdf5c61.js"><link rel="prefetch" href="/assets/js/117.34a7707c.js"><link rel="prefetch" href="/assets/js/118.e9922234.js"><link rel="prefetch" href="/assets/js/119.61fe4a4e.js"><link rel="prefetch" href="/assets/js/12.1061ddb5.js"><link rel="prefetch" href="/assets/js/120.fe5311f5.js"><link rel="prefetch" href="/assets/js/121.905e8e51.js"><link rel="prefetch" href="/assets/js/122.8cd7cd0c.js"><link rel="prefetch" href="/assets/js/123.f4f98520.js"><link rel="prefetch" href="/assets/js/124.4e233943.js"><link rel="prefetch" href="/assets/js/125.092aa1bf.js"><link rel="prefetch" href="/assets/js/126.b9c11778.js"><link rel="prefetch" href="/assets/js/128.3197df92.js"><link rel="prefetch" href="/assets/js/129.0244ee9b.js"><link rel="prefetch" href="/assets/js/130.e0648777.js"><link rel="prefetch" href="/assets/js/131.94e0b948.js"><link rel="prefetch" href="/assets/js/132.8520ded5.js"><link rel="prefetch" href="/assets/js/133.034f0365.js"><link rel="prefetch" href="/assets/js/134.1ca4a150.js"><link rel="prefetch" href="/assets/js/135.bdfc5c00.js"><link rel="prefetch" href="/assets/js/136.4918fec8.js"><link rel="prefetch" href="/assets/js/137.2db62de4.js"><link rel="prefetch" href="/assets/js/138.87fd076f.js"><link rel="prefetch" href="/assets/js/139.eecbbecd.js"><link rel="prefetch" href="/assets/js/14.2c349983.js"><link rel="prefetch" href="/assets/js/140.40d4aa29.js"><link rel="prefetch" href="/assets/js/141.dc280dee.js"><link rel="prefetch" href="/assets/js/142.4fa6a57c.js"><link rel="prefetch" href="/assets/js/143.33b90797.js"><link rel="prefetch" href="/assets/js/144.180e147f.js"><link rel="prefetch" href="/assets/js/145.832bf539.js"><link rel="prefetch" href="/assets/js/146.71cc0cd4.js"><link rel="prefetch" href="/assets/js/147.4d966ac1.js"><link rel="prefetch" href="/assets/js/148.98ccdf6a.js"><link rel="prefetch" href="/assets/js/149.c6e90dd0.js"><link rel="prefetch" href="/assets/js/15.5bb38388.js"><link rel="prefetch" href="/assets/js/150.cb70fd12.js"><link rel="prefetch" href="/assets/js/151.2da07e43.js"><link rel="prefetch" href="/assets/js/152.65bb34e9.js"><link rel="prefetch" href="/assets/js/153.10ef087b.js"><link rel="prefetch" href="/assets/js/154.2b0c9bc8.js"><link rel="prefetch" href="/assets/js/155.e38977ec.js"><link rel="prefetch" href="/assets/js/156.02b0bba1.js"><link rel="prefetch" href="/assets/js/157.3ed0f21f.js"><link rel="prefetch" href="/assets/js/158.beda5a17.js"><link rel="prefetch" href="/assets/js/159.5bfbc4d9.js"><link rel="prefetch" href="/assets/js/16.a58fed94.js"><link rel="prefetch" href="/assets/js/160.408dbb35.js"><link rel="prefetch" href="/assets/js/161.c4344be4.js"><link rel="prefetch" href="/assets/js/162.f80a95f8.js"><link rel="prefetch" href="/assets/js/163.dc12b090.js"><link rel="prefetch" href="/assets/js/164.682e2b57.js"><link rel="prefetch" href="/assets/js/165.0af68775.js"><link rel="prefetch" href="/assets/js/166.6254b754.js"><link rel="prefetch" href="/assets/js/167.727b0d47.js"><link rel="prefetch" href="/assets/js/168.e3458b70.js"><link rel="prefetch" href="/assets/js/169.d6492dcd.js"><link rel="prefetch" href="/assets/js/17.2429b1e6.js"><link rel="prefetch" href="/assets/js/170.3677af86.js"><link rel="prefetch" href="/assets/js/171.fe866179.js"><link rel="prefetch" href="/assets/js/172.c7d611be.js"><link rel="prefetch" href="/assets/js/173.e535d27d.js"><link rel="prefetch" href="/assets/js/174.07646070.js"><link rel="prefetch" href="/assets/js/175.227bcdd6.js"><link rel="prefetch" href="/assets/js/176.d03f1195.js"><link rel="prefetch" href="/assets/js/177.7206380a.js"><link rel="prefetch" href="/assets/js/178.7bfc35c4.js"><link rel="prefetch" href="/assets/js/179.d990d8ea.js"><link rel="prefetch" href="/assets/js/18.a5d750b4.js"><link rel="prefetch" href="/assets/js/180.2e4eba32.js"><link rel="prefetch" href="/assets/js/181.cbd8f5ca.js"><link rel="prefetch" href="/assets/js/182.afd4c94b.js"><link rel="prefetch" href="/assets/js/183.e7ab48ce.js"><link rel="prefetch" href="/assets/js/184.5f21d13c.js"><link rel="prefetch" href="/assets/js/185.4a4fd3b0.js"><link rel="prefetch" href="/assets/js/186.2ff2b9cd.js"><link rel="prefetch" href="/assets/js/187.b325350e.js"><link rel="prefetch" href="/assets/js/188.2a18fad9.js"><link rel="prefetch" href="/assets/js/189.425c0eb4.js"><link rel="prefetch" href="/assets/js/19.6925fadc.js"><link rel="prefetch" href="/assets/js/190.372a786b.js"><link rel="prefetch" href="/assets/js/191.a6b816f2.js"><link rel="prefetch" href="/assets/js/192.2d46ba6c.js"><link rel="prefetch" href="/assets/js/193.9d886ea4.js"><link rel="prefetch" href="/assets/js/194.ec75fc6b.js"><link rel="prefetch" href="/assets/js/195.5688915a.js"><link rel="prefetch" href="/assets/js/196.fa745ec4.js"><link rel="prefetch" href="/assets/js/197.b389a9e8.js"><link rel="prefetch" href="/assets/js/198.66ebbff6.js"><link rel="prefetch" href="/assets/js/199.32103f1f.js"><link rel="prefetch" href="/assets/js/20.d4b6b23a.js"><link rel="prefetch" href="/assets/js/200.1b917b48.js"><link rel="prefetch" href="/assets/js/201.626e8295.js"><link rel="prefetch" href="/assets/js/202.3df66e9e.js"><link rel="prefetch" href="/assets/js/203.aff1d912.js"><link rel="prefetch" href="/assets/js/204.6306a828.js"><link rel="prefetch" href="/assets/js/205.320db987.js"><link rel="prefetch" href="/assets/js/206.b4488e77.js"><link rel="prefetch" href="/assets/js/207.d5f17556.js"><link rel="prefetch" href="/assets/js/208.37210f86.js"><link rel="prefetch" href="/assets/js/209.786c7af4.js"><link rel="prefetch" href="/assets/js/21.95dcd0d6.js"><link rel="prefetch" href="/assets/js/210.38e58d19.js"><link rel="prefetch" href="/assets/js/211.09b699bb.js"><link rel="prefetch" href="/assets/js/212.ffd8d260.js"><link rel="prefetch" href="/assets/js/213.2891f4a0.js"><link rel="prefetch" href="/assets/js/214.8c1a47e0.js"><link rel="prefetch" href="/assets/js/215.c0dec61f.js"><link rel="prefetch" href="/assets/js/216.c71c59ab.js"><link rel="prefetch" href="/assets/js/217.8891c004.js"><link rel="prefetch" href="/assets/js/218.a2075ffe.js"><link rel="prefetch" href="/assets/js/219.1e70631e.js"><link rel="prefetch" href="/assets/js/22.473284b6.js"><link rel="prefetch" href="/assets/js/220.1d012692.js"><link rel="prefetch" href="/assets/js/221.aa4a0d37.js"><link rel="prefetch" href="/assets/js/222.b512a429.js"><link rel="prefetch" href="/assets/js/223.9e6d42f2.js"><link rel="prefetch" href="/assets/js/224.e46f8d1d.js"><link rel="prefetch" href="/assets/js/225.d8083ae3.js"><link rel="prefetch" href="/assets/js/226.7730bb6a.js"><link rel="prefetch" href="/assets/js/227.3ec46626.js"><link rel="prefetch" href="/assets/js/228.0be929cb.js"><link rel="prefetch" href="/assets/js/229.d8da48e4.js"><link rel="prefetch" href="/assets/js/23.1a1a291a.js"><link rel="prefetch" href="/assets/js/230.f6b2bd82.js"><link rel="prefetch" href="/assets/js/231.c43852a4.js"><link rel="prefetch" href="/assets/js/232.0aa9bd8a.js"><link rel="prefetch" href="/assets/js/233.28899baa.js"><link rel="prefetch" href="/assets/js/234.37a56cac.js"><link rel="prefetch" href="/assets/js/235.57d1f2f2.js"><link rel="prefetch" href="/assets/js/236.10c15500.js"><link rel="prefetch" href="/assets/js/237.8ccfba13.js"><link rel="prefetch" href="/assets/js/238.072cdb99.js"><link rel="prefetch" href="/assets/js/239.a4042ce8.js"><link rel="prefetch" href="/assets/js/24.6f32ee5c.js"><link rel="prefetch" href="/assets/js/240.a4e8f29e.js"><link rel="prefetch" href="/assets/js/241.aec0fdc6.js"><link rel="prefetch" href="/assets/js/242.4e5a95cc.js"><link rel="prefetch" href="/assets/js/243.0ab57bd0.js"><link rel="prefetch" href="/assets/js/244.d5257ed9.js"><link rel="prefetch" href="/assets/js/245.747b1f48.js"><link rel="prefetch" href="/assets/js/246.f89916b2.js"><link rel="prefetch" href="/assets/js/247.9baf4f72.js"><link rel="prefetch" href="/assets/js/248.5878bead.js"><link rel="prefetch" href="/assets/js/249.0153ed9a.js"><link rel="prefetch" href="/assets/js/25.825806eb.js"><link rel="prefetch" href="/assets/js/250.4f47bd06.js"><link rel="prefetch" href="/assets/js/251.2c55f0ac.js"><link rel="prefetch" href="/assets/js/252.3171358b.js"><link rel="prefetch" href="/assets/js/253.3d927b62.js"><link rel="prefetch" href="/assets/js/254.56caa785.js"><link rel="prefetch" href="/assets/js/255.b75a0344.js"><link rel="prefetch" href="/assets/js/256.e449fa3a.js"><link rel="prefetch" href="/assets/js/257.a280fd63.js"><link rel="prefetch" href="/assets/js/258.85cacce2.js"><link rel="prefetch" href="/assets/js/259.220782f3.js"><link rel="prefetch" href="/assets/js/26.c2a73fa1.js"><link rel="prefetch" href="/assets/js/260.4cad83bd.js"><link rel="prefetch" href="/assets/js/261.cc01772f.js"><link rel="prefetch" href="/assets/js/262.31fb9ce0.js"><link rel="prefetch" href="/assets/js/263.95d45d4a.js"><link rel="prefetch" href="/assets/js/264.a23581c9.js"><link rel="prefetch" href="/assets/js/265.f4d45025.js"><link rel="prefetch" href="/assets/js/266.08c29ff3.js"><link rel="prefetch" href="/assets/js/267.f25d5c52.js"><link rel="prefetch" href="/assets/js/268.e4b83b3f.js"><link rel="prefetch" href="/assets/js/269.54e6f5d2.js"><link rel="prefetch" href="/assets/js/27.94b60768.js"><link rel="prefetch" href="/assets/js/270.477bbf01.js"><link rel="prefetch" href="/assets/js/271.eadefaf2.js"><link rel="prefetch" href="/assets/js/272.c77f20a4.js"><link rel="prefetch" href="/assets/js/273.86e57213.js"><link rel="prefetch" href="/assets/js/274.caf08186.js"><link rel="prefetch" href="/assets/js/275.843af577.js"><link rel="prefetch" href="/assets/js/276.bc7dfde0.js"><link rel="prefetch" href="/assets/js/277.a18aa211.js"><link rel="prefetch" href="/assets/js/278.25260976.js"><link rel="prefetch" href="/assets/js/279.0bc329e7.js"><link rel="prefetch" href="/assets/js/28.166f967e.js"><link rel="prefetch" href="/assets/js/280.c7eb5b22.js"><link rel="prefetch" href="/assets/js/281.78d4ed73.js"><link rel="prefetch" href="/assets/js/282.08dbc1ff.js"><link rel="prefetch" href="/assets/js/283.1a8ed58d.js"><link rel="prefetch" href="/assets/js/284.c67e1e75.js"><link rel="prefetch" href="/assets/js/285.6252305a.js"><link rel="prefetch" href="/assets/js/286.5c98afe5.js"><link rel="prefetch" href="/assets/js/287.bd42634c.js"><link rel="prefetch" href="/assets/js/288.1a692f6d.js"><link rel="prefetch" href="/assets/js/289.137dd607.js"><link rel="prefetch" href="/assets/js/29.69647249.js"><link rel="prefetch" href="/assets/js/290.6cb00ec4.js"><link rel="prefetch" href="/assets/js/291.4a6210f6.js"><link rel="prefetch" href="/assets/js/292.dedb1bb4.js"><link rel="prefetch" href="/assets/js/293.6e25fb34.js"><link rel="prefetch" href="/assets/js/294.c7f2e4eb.js"><link rel="prefetch" href="/assets/js/295.76fdbc3b.js"><link rel="prefetch" href="/assets/js/296.48999983.js"><link rel="prefetch" href="/assets/js/297.8d1c640d.js"><link rel="prefetch" href="/assets/js/298.9f5441b7.js"><link rel="prefetch" href="/assets/js/299.150b9208.js"><link rel="prefetch" href="/assets/js/3.461c0085.js"><link rel="prefetch" href="/assets/js/30.defdcb36.js"><link rel="prefetch" href="/assets/js/300.6b9057e3.js"><link rel="prefetch" href="/assets/js/301.74c659b3.js"><link rel="prefetch" href="/assets/js/302.6d8ebf64.js"><link rel="prefetch" href="/assets/js/303.21fe2025.js"><link rel="prefetch" href="/assets/js/304.3c05c7a6.js"><link rel="prefetch" href="/assets/js/305.7c3fb5eb.js"><link rel="prefetch" href="/assets/js/306.c1fa105b.js"><link rel="prefetch" href="/assets/js/307.48a1d678.js"><link rel="prefetch" href="/assets/js/308.4e58779a.js"><link rel="prefetch" href="/assets/js/309.9fac2cdc.js"><link rel="prefetch" href="/assets/js/31.77a45ce0.js"><link rel="prefetch" href="/assets/js/310.3a159c1e.js"><link rel="prefetch" href="/assets/js/311.603f45af.js"><link rel="prefetch" href="/assets/js/312.603c7885.js"><link rel="prefetch" href="/assets/js/313.69be703f.js"><link rel="prefetch" href="/assets/js/314.9054c9ab.js"><link rel="prefetch" href="/assets/js/315.e331ef4b.js"><link rel="prefetch" href="/assets/js/316.1d0a506f.js"><link rel="prefetch" href="/assets/js/317.1b787b88.js"><link rel="prefetch" href="/assets/js/318.86f787b0.js"><link rel="prefetch" href="/assets/js/319.a6921190.js"><link rel="prefetch" href="/assets/js/32.93f3bdf1.js"><link rel="prefetch" href="/assets/js/320.f0c26c43.js"><link rel="prefetch" href="/assets/js/321.a19c9ff4.js"><link rel="prefetch" href="/assets/js/322.01ba6221.js"><link rel="prefetch" href="/assets/js/323.978cd49f.js"><link rel="prefetch" href="/assets/js/324.fe310b5d.js"><link rel="prefetch" href="/assets/js/325.3244bcda.js"><link rel="prefetch" href="/assets/js/326.5c4f01a3.js"><link rel="prefetch" href="/assets/js/327.5db6522f.js"><link rel="prefetch" href="/assets/js/328.e220334a.js"><link rel="prefetch" href="/assets/js/329.df7c545b.js"><link rel="prefetch" href="/assets/js/33.f4982416.js"><link rel="prefetch" href="/assets/js/330.3f9cc52f.js"><link rel="prefetch" href="/assets/js/331.1661ec63.js"><link rel="prefetch" href="/assets/js/332.bdec065c.js"><link rel="prefetch" href="/assets/js/333.b663aa77.js"><link rel="prefetch" href="/assets/js/334.b1f6193f.js"><link rel="prefetch" href="/assets/js/335.cc7fedb2.js"><link rel="prefetch" href="/assets/js/336.35aa2903.js"><link rel="prefetch" href="/assets/js/337.a91aa873.js"><link rel="prefetch" href="/assets/js/338.ae795233.js"><link rel="prefetch" href="/assets/js/339.4582441a.js"><link rel="prefetch" href="/assets/js/34.deb0c8cd.js"><link rel="prefetch" href="/assets/js/340.c9e30c24.js"><link rel="prefetch" href="/assets/js/341.ab8bbf2f.js"><link rel="prefetch" href="/assets/js/342.4dcd40fe.js"><link rel="prefetch" href="/assets/js/343.04aa7b0e.js"><link rel="prefetch" href="/assets/js/344.cf12e221.js"><link rel="prefetch" href="/assets/js/345.851fea37.js"><link rel="prefetch" href="/assets/js/346.cd04ce92.js"><link rel="prefetch" href="/assets/js/347.cc13c5f8.js"><link rel="prefetch" href="/assets/js/348.e8149a34.js"><link rel="prefetch" href="/assets/js/349.8c615125.js"><link rel="prefetch" href="/assets/js/35.946b2b10.js"><link rel="prefetch" href="/assets/js/350.297c9452.js"><link rel="prefetch" href="/assets/js/351.c625eafe.js"><link rel="prefetch" href="/assets/js/352.21fc6d9a.js"><link rel="prefetch" href="/assets/js/353.0918e6c0.js"><link rel="prefetch" href="/assets/js/354.760beca2.js"><link rel="prefetch" href="/assets/js/355.ec756b28.js"><link rel="prefetch" href="/assets/js/356.c41182ab.js"><link rel="prefetch" href="/assets/js/357.3a762703.js"><link rel="prefetch" href="/assets/js/358.2c575e4a.js"><link rel="prefetch" href="/assets/js/359.7ce42976.js"><link rel="prefetch" href="/assets/js/36.22805e5a.js"><link rel="prefetch" href="/assets/js/360.ef9a8667.js"><link rel="prefetch" href="/assets/js/361.1511e3f4.js"><link rel="prefetch" href="/assets/js/362.d5fbab7c.js"><link rel="prefetch" href="/assets/js/363.976be7aa.js"><link rel="prefetch" href="/assets/js/364.1843f42a.js"><link rel="prefetch" href="/assets/js/365.dfde987d.js"><link rel="prefetch" href="/assets/js/366.b87a9cb5.js"><link rel="prefetch" href="/assets/js/367.8ba1f57c.js"><link rel="prefetch" href="/assets/js/368.8b96559b.js"><link rel="prefetch" href="/assets/js/369.2546100c.js"><link rel="prefetch" href="/assets/js/37.3525192b.js"><link rel="prefetch" href="/assets/js/370.4db8b482.js"><link rel="prefetch" href="/assets/js/371.0542b71b.js"><link rel="prefetch" href="/assets/js/372.4c9bde18.js"><link rel="prefetch" href="/assets/js/373.32bcd884.js"><link rel="prefetch" href="/assets/js/374.3793da0b.js"><link rel="prefetch" href="/assets/js/375.8297ec5b.js"><link rel="prefetch" href="/assets/js/376.e346176b.js"><link rel="prefetch" href="/assets/js/377.ac5d8c7f.js"><link rel="prefetch" href="/assets/js/378.e0b84ffc.js"><link rel="prefetch" href="/assets/js/379.663b7fb2.js"><link rel="prefetch" href="/assets/js/38.72fc1973.js"><link rel="prefetch" href="/assets/js/380.01abbbeb.js"><link rel="prefetch" href="/assets/js/381.445e4202.js"><link rel="prefetch" href="/assets/js/382.ff24e162.js"><link rel="prefetch" href="/assets/js/383.c8303f29.js"><link rel="prefetch" href="/assets/js/384.67496581.js"><link rel="prefetch" href="/assets/js/385.e206fb4d.js"><link rel="prefetch" href="/assets/js/386.1e324581.js"><link rel="prefetch" href="/assets/js/387.4b3c734b.js"><link rel="prefetch" href="/assets/js/388.89e3ad82.js"><link rel="prefetch" href="/assets/js/389.814cbc20.js"><link rel="prefetch" href="/assets/js/39.85d65742.js"><link rel="prefetch" href="/assets/js/390.3d2bc4b1.js"><link rel="prefetch" href="/assets/js/391.ad15e5c9.js"><link rel="prefetch" href="/assets/js/392.22ea3d28.js"><link rel="prefetch" href="/assets/js/393.dc925e8e.js"><link rel="prefetch" href="/assets/js/394.f758a517.js"><link rel="prefetch" href="/assets/js/395.bb8c0d77.js"><link rel="prefetch" href="/assets/js/396.8cc3e6cb.js"><link rel="prefetch" href="/assets/js/397.44dba438.js"><link rel="prefetch" href="/assets/js/398.76ebedbb.js"><link rel="prefetch" href="/assets/js/399.a6acb507.js"><link rel="prefetch" href="/assets/js/40.2ef6e1f7.js"><link rel="prefetch" href="/assets/js/400.a6d9d98e.js"><link rel="prefetch" href="/assets/js/401.0715bf66.js"><link rel="prefetch" href="/assets/js/402.fff59a65.js"><link rel="prefetch" href="/assets/js/403.9f58e94a.js"><link rel="prefetch" href="/assets/js/404.4817775f.js"><link rel="prefetch" href="/assets/js/405.1744cc09.js"><link rel="prefetch" href="/assets/js/406.a978bd4c.js"><link rel="prefetch" href="/assets/js/407.4fb1ac88.js"><link rel="prefetch" href="/assets/js/408.f1bb0f31.js"><link rel="prefetch" href="/assets/js/409.942c7d40.js"><link rel="prefetch" href="/assets/js/41.a4f19bba.js"><link rel="prefetch" href="/assets/js/410.66f0918b.js"><link rel="prefetch" href="/assets/js/411.6a5436f5.js"><link rel="prefetch" href="/assets/js/412.ec974a04.js"><link rel="prefetch" href="/assets/js/413.ba4fd119.js"><link rel="prefetch" href="/assets/js/414.55e59bef.js"><link rel="prefetch" href="/assets/js/415.412201ca.js"><link rel="prefetch" href="/assets/js/416.4b4ba217.js"><link rel="prefetch" href="/assets/js/417.a65d2f1b.js"><link rel="prefetch" href="/assets/js/418.bf142c63.js"><link rel="prefetch" href="/assets/js/419.65b0f04d.js"><link rel="prefetch" href="/assets/js/42.7f2b0b0f.js"><link rel="prefetch" href="/assets/js/420.ab0f7606.js"><link rel="prefetch" href="/assets/js/421.d9d2dc13.js"><link rel="prefetch" href="/assets/js/422.093a8290.js"><link rel="prefetch" href="/assets/js/423.041fc7be.js"><link rel="prefetch" href="/assets/js/424.410b1a8f.js"><link rel="prefetch" href="/assets/js/425.661237bb.js"><link rel="prefetch" href="/assets/js/426.c01ca04f.js"><link rel="prefetch" href="/assets/js/427.af6802e0.js"><link rel="prefetch" href="/assets/js/428.e255a9c4.js"><link rel="prefetch" href="/assets/js/429.3f62c79c.js"><link rel="prefetch" href="/assets/js/43.96eb08e4.js"><link rel="prefetch" href="/assets/js/430.86f8cd5f.js"><link rel="prefetch" href="/assets/js/431.89f717cb.js"><link rel="prefetch" href="/assets/js/432.606f5381.js"><link rel="prefetch" href="/assets/js/433.e2a7c92d.js"><link rel="prefetch" href="/assets/js/434.375d2ee0.js"><link rel="prefetch" href="/assets/js/435.10ac30b9.js"><link rel="prefetch" href="/assets/js/436.dfadd161.js"><link rel="prefetch" href="/assets/js/437.f92a1705.js"><link rel="prefetch" href="/assets/js/438.a924c254.js"><link rel="prefetch" href="/assets/js/439.6a8f7f89.js"><link rel="prefetch" href="/assets/js/44.af0f503b.js"><link rel="prefetch" href="/assets/js/440.6f41f087.js"><link rel="prefetch" href="/assets/js/441.296b6711.js"><link rel="prefetch" href="/assets/js/442.e82e2313.js"><link rel="prefetch" href="/assets/js/443.c46b8b7c.js"><link rel="prefetch" href="/assets/js/444.850b3f10.js"><link rel="prefetch" href="/assets/js/445.70fafa08.js"><link rel="prefetch" href="/assets/js/446.c2fd23e4.js"><link rel="prefetch" href="/assets/js/447.fac66885.js"><link rel="prefetch" href="/assets/js/448.5c8074d5.js"><link rel="prefetch" href="/assets/js/449.25db27ca.js"><link rel="prefetch" href="/assets/js/45.19ecb85c.js"><link rel="prefetch" href="/assets/js/450.8bc58614.js"><link rel="prefetch" href="/assets/js/451.69e35a33.js"><link rel="prefetch" href="/assets/js/452.a129daf9.js"><link rel="prefetch" href="/assets/js/453.4f696672.js"><link rel="prefetch" href="/assets/js/454.e2a1b328.js"><link rel="prefetch" href="/assets/js/455.b7037708.js"><link rel="prefetch" href="/assets/js/456.eda2adc0.js"><link rel="prefetch" href="/assets/js/457.5f0d7722.js"><link rel="prefetch" href="/assets/js/458.effcb970.js"><link rel="prefetch" href="/assets/js/459.48baddfb.js"><link rel="prefetch" href="/assets/js/46.88cbca22.js"><link rel="prefetch" href="/assets/js/460.c50fe2c5.js"><link rel="prefetch" href="/assets/js/461.55293f7a.js"><link rel="prefetch" href="/assets/js/462.682315f0.js"><link rel="prefetch" href="/assets/js/463.f4278aae.js"><link rel="prefetch" href="/assets/js/464.f140b938.js"><link rel="prefetch" href="/assets/js/465.392a08f4.js"><link rel="prefetch" href="/assets/js/466.90a32c46.js"><link rel="prefetch" href="/assets/js/467.d795bc61.js"><link rel="prefetch" href="/assets/js/468.6e663011.js"><link rel="prefetch" href="/assets/js/469.b7bffde5.js"><link rel="prefetch" href="/assets/js/47.7e31de19.js"><link rel="prefetch" href="/assets/js/470.388beea3.js"><link rel="prefetch" href="/assets/js/471.6ca5dbe5.js"><link rel="prefetch" href="/assets/js/472.9bc4c0a6.js"><link rel="prefetch" href="/assets/js/473.fd427e29.js"><link rel="prefetch" href="/assets/js/474.862fc10a.js"><link rel="prefetch" href="/assets/js/475.6e3893de.js"><link rel="prefetch" href="/assets/js/476.0f32dc93.js"><link rel="prefetch" href="/assets/js/477.8cb145a5.js"><link rel="prefetch" href="/assets/js/478.65a09f13.js"><link rel="prefetch" href="/assets/js/479.bee3f754.js"><link rel="prefetch" href="/assets/js/48.ca956f8d.js"><link rel="prefetch" href="/assets/js/480.f59f88af.js"><link rel="prefetch" href="/assets/js/481.8c5e02e6.js"><link rel="prefetch" href="/assets/js/482.7988ca13.js"><link rel="prefetch" href="/assets/js/483.6d1e171c.js"><link rel="prefetch" href="/assets/js/484.b3f3a54b.js"><link rel="prefetch" href="/assets/js/485.e97a72d8.js"><link rel="prefetch" href="/assets/js/49.4cf4b45c.js"><link rel="prefetch" href="/assets/js/50.9fdb4f1e.js"><link rel="prefetch" href="/assets/js/51.88f75159.js"><link rel="prefetch" href="/assets/js/52.1c372af0.js"><link rel="prefetch" href="/assets/js/53.e0e13d9a.js"><link rel="prefetch" href="/assets/js/54.231f6505.js"><link rel="prefetch" href="/assets/js/55.52b04941.js"><link rel="prefetch" href="/assets/js/56.91345e86.js"><link rel="prefetch" href="/assets/js/57.201a710e.js"><link rel="prefetch" href="/assets/js/58.6fb2ccb6.js"><link rel="prefetch" href="/assets/js/59.cb26cb6a.js"><link rel="prefetch" href="/assets/js/60.a5fc202b.js"><link rel="prefetch" href="/assets/js/61.0facb3f9.js"><link rel="prefetch" href="/assets/js/62.d00be571.js"><link rel="prefetch" href="/assets/js/63.d66d194b.js"><link rel="prefetch" href="/assets/js/64.4b34837d.js"><link rel="prefetch" href="/assets/js/65.c5eca227.js"><link rel="prefetch" href="/assets/js/66.f3bb4baa.js"><link rel="prefetch" href="/assets/js/67.4fbce724.js"><link rel="prefetch" href="/assets/js/68.39780014.js"><link rel="prefetch" href="/assets/js/69.523952df.js"><link rel="prefetch" href="/assets/js/7.d893eec0.js"><link rel="prefetch" href="/assets/js/70.33f89cfa.js"><link rel="prefetch" href="/assets/js/71.6b329e8e.js"><link rel="prefetch" href="/assets/js/72.90caac3a.js"><link rel="prefetch" href="/assets/js/73.2b7012a1.js"><link rel="prefetch" href="/assets/js/74.0076f1ec.js"><link rel="prefetch" href="/assets/js/75.1cbaf5cf.js"><link rel="prefetch" href="/assets/js/76.2461a9e9.js"><link rel="prefetch" href="/assets/js/77.be9e1732.js"><link rel="prefetch" href="/assets/js/78.a4825263.js"><link rel="prefetch" href="/assets/js/79.95c5e105.js"><link rel="prefetch" href="/assets/js/8.acf971e3.js"><link rel="prefetch" href="/assets/js/80.1a7c44e2.js"><link rel="prefetch" href="/assets/js/81.38ee2ba4.js"><link rel="prefetch" href="/assets/js/82.78220668.js"><link rel="prefetch" href="/assets/js/83.3dfead3b.js"><link rel="prefetch" href="/assets/js/84.7f1f743d.js"><link rel="prefetch" href="/assets/js/85.ab59a697.js"><link rel="prefetch" href="/assets/js/86.1888a97f.js"><link rel="prefetch" href="/assets/js/87.149a705f.js"><link rel="prefetch" href="/assets/js/88.8a53e92d.js"><link rel="prefetch" href="/assets/js/89.a68dd87b.js"><link rel="prefetch" href="/assets/js/9.c38b654d.js"><link rel="prefetch" href="/assets/js/90.c70af23c.js"><link rel="prefetch" href="/assets/js/91.58de9211.js"><link rel="prefetch" href="/assets/js/92.697a7ada.js"><link rel="prefetch" href="/assets/js/93.2a27830a.js"><link rel="prefetch" href="/assets/js/94.20be84f6.js"><link rel="prefetch" href="/assets/js/95.bc2120e0.js"><link rel="prefetch" href="/assets/js/96.5b3aa395.js"><link rel="prefetch" href="/assets/js/97.c4a15008.js"><link rel="prefetch" href="/assets/js/98.3e47fdce.js"><link rel="prefetch" href="/assets/js/99.4b101d54.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b8eeafc3.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Cactusli blog" class="logo"> <span class="site-name can-hide">Cactusli blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/Java/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java Study</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/Java/" class="nav-link">Java 基础</a></li><li class="dropdown-subitem"><a href="/note/design-pattern/" class="nav-link">Java 版设计模式</a></li></ul></li><li class="dropdown-item"><h4>阅读源码系列</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/32e50d/" class="nav-link">Spring Boot</a></li><li class="dropdown-subitem"><a href="/pages/d065c4/" class="nav-link">Netty</a></li><li class="dropdown-subitem"><a href="/pages/4d3c7f/" class="nav-link">Dubbo</a></li><li class="dropdown-subitem"><a href="/pages/920e2b/" class="nav-link">搭建rpc框架</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/SpringBoot/" class="nav-link">《SpringBoot教程》</a></li><li class="dropdown-subitem"><a href="/note/Docker/" class="nav-link">《Docker教程》</a></li><li class="dropdown-subitem"><a href="/note/Kubernetes/" class="nav-link">《Kubernetes教程》</a></li><li class="dropdown-subitem"><a href="/note/SpringCloud-febs/" class="nav-link">《SpringCloud微服务权限系统搭建》</a></li><li class="dropdown-subitem"><a href="/note/Netty/" class="nav-link">《Netty教程》</a></li><li class="dropdown-subitem"><a href="/note/Gateway/" class="nav-link">《API网关设计与实践》</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li><li class="dropdown-item"><h4>页面</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="手册" class="dropdown-title"><a href="/manual/" class="link-title">手册</a> <span class="title" style="display:none;">手册</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/d2639c/" class="nav-link">环境配置</a></li><li class="dropdown-item"><!----> <a href="/pages/39e2a1/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">手册记录</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://firework.cloudflaress.eu.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  看烟花
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/706328/" class="nav-link">英语学习</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/lixuanfengs/cactus-vuepress-sc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.statically.io/gh/lixuanfengs/blog-images/master/cactus-blogs/avatar3.gif"> <div class="blogger-info"><h3>Xuan Feng Li</h3> <span>学习老黄牛精神！</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/Java/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java Study</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/Java/" class="nav-link">Java 基础</a></li><li class="dropdown-subitem"><a href="/note/design-pattern/" class="nav-link">Java 版设计模式</a></li></ul></li><li class="dropdown-item"><h4>阅读源码系列</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/32e50d/" class="nav-link">Spring Boot</a></li><li class="dropdown-subitem"><a href="/pages/d065c4/" class="nav-link">Netty</a></li><li class="dropdown-subitem"><a href="/pages/4d3c7f/" class="nav-link">Dubbo</a></li><li class="dropdown-subitem"><a href="/pages/920e2b/" class="nav-link">搭建rpc框架</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/SpringBoot/" class="nav-link">《SpringBoot教程》</a></li><li class="dropdown-subitem"><a href="/note/Docker/" class="nav-link">《Docker教程》</a></li><li class="dropdown-subitem"><a href="/note/Kubernetes/" class="nav-link">《Kubernetes教程》</a></li><li class="dropdown-subitem"><a href="/note/SpringCloud-febs/" class="nav-link">《SpringCloud微服务权限系统搭建》</a></li><li class="dropdown-subitem"><a href="/note/Netty/" class="nav-link">《Netty教程》</a></li><li class="dropdown-subitem"><a href="/note/Gateway/" class="nav-link">《API网关设计与实践》</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li><li class="dropdown-item"><h4>页面</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="手册" class="dropdown-title"><a href="/manual/" class="link-title">手册</a> <span class="title" style="display:none;">手册</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/d2639c/" class="nav-link">环境配置</a></li><li class="dropdown-item"><!----> <a href="/pages/39e2a1/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">手册记录</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://firework.cloudflaress.eu.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  看烟花
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/706328/" class="nav-link">英语学习</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/lixuanfengs/cactus-vuepress-sc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java 基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>远程服务掉用框架rpc</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>学习笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>阅读源码系列</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Spring Boot</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/32e50d/" class="sidebar-link">如何搭建自己的SpringBoot源码调试环境？</a></li><li><a href="/pages/579f6f/" class="sidebar-link">如何分析SpringBoot源码模块及结构？</a></li><li><a href="/pages/83fe40/" class="sidebar-link">SpringBoot自动配置的条件注解原理</a></li><li><a href="/pages/09cee0/" aria-current="page" class="active sidebar-link">SpringBoot是如何实现自动配置的？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/09cee0/#_1-前言" class="sidebar-link">1 前言</a></li><li class="sidebar-sub-header level2"><a href="/pages/09cee0/#_2-springbootapplication-注解" class="sidebar-link">2 @SpringBootApplication 注解</a></li><li class="sidebar-sub-header level2"><a href="/pages/09cee0/#_3-如何去找-springboot-自动配置实现逻辑的入口方法" class="sidebar-link">3 如何去找 SpringBoot 自动配置实现逻辑的入口方法？</a></li><li class="sidebar-sub-header level2"><a href="/pages/09cee0/#_4-分析-springboot-自动配置原理" class="sidebar-link">4 分析 SpringBoot 自动配置原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/09cee0/#_4-1-分析自动配置的主要逻辑" class="sidebar-link">4.1 分析自动配置的主要逻辑</a></li><li class="sidebar-sub-header level3"><a href="/pages/09cee0/#_4-2-有选择的导入自动配置类" class="sidebar-link">4.2 有选择的导入自动配置类</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/09cee0/#_5-autoconfigurationimportfilter" class="sidebar-link">5 AutoConfigurationImportFilter</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/09cee0/#_5-1-onclasscondition" class="sidebar-link">5.1 OnClassCondition</a></li><li class="sidebar-sub-header level4"><a href="/pages/09cee0/#_5-1-1-createoutcomesresolver" class="sidebar-link">5.1.1 createOutcomesResolver</a></li><li class="sidebar-sub-header level4"><a href="/pages/09cee0/#_5-1-2-new-standardoutcomesresolver" class="sidebar-link">5.1.2 new StandardOutcomesResolver</a></li><li class="sidebar-sub-header level4"><a href="/pages/09cee0/#_5-1-3-standardoutcomesresolver-resolveoutcomes-方法" class="sidebar-link">5.1.3 StandardOutcomesResolver.resolveOutcomes 方法</a></li><li class="sidebar-sub-header level4"><a href="/pages/09cee0/#_5-1-4-threadedoutcomesresolver-resolveoutcomes-方法" class="sidebar-link">5.1.4 ThreadedOutcomesResolver.resolveOutcomes 方法</a></li><li class="sidebar-sub-header level3"><a href="/pages/09cee0/#_5-2-onbeancondition-和-onwebapplicationcondition" class="sidebar-link">5.2 OnBeanCondition 和 OnWebApplicationCondition</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/09cee0/#_6-autoconfigurationimportlistener" class="sidebar-link">6 AutoConfigurationImportListener</a></li><li class="sidebar-sub-header level2"><a href="/pages/09cee0/#_7-autoconfigurationpackages" class="sidebar-link">7 AutoConfigurationPackages</a></li></ul></li><li><a href="/pages/04160a/" class="sidebar-link">SpringBoot的配置属性值是如何绑定的？</a></li><li><a href="/pages/a30d58/" class="sidebar-link">SpringBoot内置的各种Starter是怎样构建的？</a></li><li><a href="/pages/0dbcc9/" class="sidebar-link">SpringBoot的启动流程是怎样的？</a></li><li><a href="/pages/6a857a/" class="sidebar-link">SpringApplication对象是如何构建的？</a></li><li><a href="/pages/c9edcd/" class="sidebar-link">SpringBoot事件监听机制</a></li><li><a href="/pages/d23c3e/" class="sidebar-link">SpringBoot内置生命周期事件详解</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Netty</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Dubbo</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/Java/#后端" data-v-06225672>后端</a></li><li data-v-06225672><a href="/Java/#阅读源码系列" data-v-06225672>阅读源码系列</a></li><li data-v-06225672><a href="/Java/#Spring Boot" data-v-06225672>Spring Boot</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/lixuanfengs" target="_blank" title="作者" class="beLink" data-v-06225672>cactusli</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-05-11</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><!---->SpringBoot是如何实现自动配置的？<!----></h1>  <div class="theme-vdoing-content content__default"><p><strong>注：该源码分析对应 SpringBoot 版本为 2.1.0.RELEASE</strong></p> <h2 id="_1-前言"><a href="#_1-前言" class="header-anchor">#</a> 1 前言</h2> <p>温故而知新，我们来简单回顾一下上篇的内容，上一篇我们分析了 SpringBoot 的条件注解<code>@ConditionalOnXxx</code> 的相关源码，现挑重点总结如下：</p> <ol><li>SpringBoot 的所有<code>@ConditionalOnXxx</code>的条件类<code>OnXxxCondition</code>都是继承于<code>SpringBootCondition</code>基类，而<code>SpringBootCondition</code>又实现了<code>Condition</code>接口。</li> <li><code>SpringBootCondition</code>基类主要用来打印一些条件注解评估报告的日志,这些条件评估信息全部来源于其子类注解条件类<code>OnXxxCondition</code>，因此其也抽象了一个模板方法<code>getMatchOutcome</code>留给子类去实现来评估其条件注解是否符合条件。</li> <li>前一篇我们也还有一个重要的知识点还没分析，那就是跟过滤自动配置类逻辑有关的<code>AutoConfigurationImportFilter</code>接口，这篇文章我们来填一下这个坑。</li></ol> <p>前面我们分析了跟 SpringBoot 的自动配置息息相关内置条件注解<code>@ConditionalOnXxx</code>后，现在我们就开始来撸 SpringBoot 自动配置的相关源码了。</p> <h2 id="_2-springbootapplication-注解"><a href="#_2-springbootapplication-注解" class="header-anchor">#</a> 2 @SpringBootApplication 注解</h2> <p>在开始前，我们先想一下，SpringBoot 为何一个标注有<code>@SpringBootApplication</code>注解的启动类通过执行一个简单的<code>run</code>方法就能实现 SpringBoot 大量<code>Starter</code>的自动配置呢？ 其实 SpringBoot 的自动配置就跟<code>@SpringBootApplication</code>这个注解有关，我们先来看下其这个注解的源码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@SpringBootConfiguration</span>
<span class="token annotation punctuation">@EnableAutoConfiguration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>excludeFilters <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span><span class="token constant">CUSTOM</span><span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">TypeExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span><span class="token constant">CUSTOM</span><span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">AutoConfigurationExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">SpringBootApplication</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...省略非关键代码</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><code>@SpringBootApplication</code>标注了很多注解，我们可以看到其中跟 SpringBoot 自动配置有关的注解就有一个即<code>@EnableAutoConfiguration</code>，因此，可以肯定的是 SpringBoot 的自动配置肯定跟<code>@EnableAutoConfiguration</code>息息相关(其中<code>@ComponentScan</code>注解的<code>excludeFilters</code>属性也有一个类<code>AutoConfigurationExcludeFilter</code>,这个类跟自动配置也有点关系，但不是我们关注的重点)。 现在我们来打开<code>@EnableAutoConfiguration</code>注解的源码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@AutoConfigurationPackage</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">EnableAutoConfiguration</span> <span class="token punctuation">{</span>
	<span class="token class-name">String</span> <span class="token constant">ENABLED_OVERRIDE_PROPERTY</span> <span class="token operator">=</span> <span class="token string">&quot;spring.boot.enableautoconfiguration&quot;</span><span class="token punctuation">;</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">exclude</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">excludeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>看到<code>@EnableAutoConfiguration</code>注解又标有<code>@AutoConfigurationPackage</code>和<code>@Import(AutoConfigurationImportSelector.class)</code>两个注解，顾名思义，<code>@AutoConfigurationPackage</code>注解肯定跟自动配置的包有关，而<code>AutoConfigurationImportSelector</code>则是跟 SpringBoot 的自动配置选择导入有关（Spring 中的<code>ImportSelector</code>是用来导入配置类的，通常是基于某些条件注解<code>@ConditionalOnXxxx</code>来决定是否导入某个配置类）。</p> <p>因此，可以看出<code>AutoConfigurationImportSelector</code>类是我们本篇的重点，因为 SpringBoot 的自动配置肯定有一个配置类，而这个配置类的导入则需要靠<code>AutoConfigurationImportSelector</code>这个哥们来实现。</p> <p>接下来我们重点来看<code>AutoConfigurationImportSelector</code>这个类，完了我们再简单分析下<code>@AutoConfigurationPackage</code>这个注解的逻辑。</p> <h2 id="_3-如何去找-springboot-自动配置实现逻辑的入口方法"><a href="#_3-如何去找-springboot-自动配置实现逻辑的入口方法" class="header-anchor">#</a> 3 如何去找 SpringBoot 自动配置实现逻辑的入口方法？</h2> <p>可以肯定的是 SpringBoot 的自动配置的逻辑肯定与 AutoConfigurationImportSelector 这个类有关，那么我们该如何去找到 SpringBoot 自动配置实现逻辑的入口方法呢？</p> <p>在找 SpringBoot 自动配置实现逻辑的入口方法前，我们先来看下<code>AutoConfigurationImportSelector</code>的相关类图，好有个整体的理解。看下图：</p> <p><img src="https://cdn.statically.io/gh/lixuanfengs/blog-images/master/cactus-blogs/7d8d9e3a2d5b02857cade81c1331b1d6.webp" alt="img"></p> <p>可以看到<code>AutoConfigurationImportSelector</code>重点是实现了<code>DeferredImportSelector</code>接口和各种<code>Aware</code>接口，然后<code>DeferredImportSelector</code>接口又继承了<code>ImportSelector</code>接口。</p> <p>自然而然的，我们会去关注<code>AutoConfigurationImportSelector</code>复写<code>DeferredImportSelector</code>接口的实现方法<code>selectImports</code>方法，因为<code>selectImports</code>方法跟导入自动配置类有关，而这个方法往往是程序执行的入口方法。经过调试发现<code>selectImports</code>方法很具有迷惑性，<code>selectImports</code>方法跟自动配置相关的逻辑有点关系，但实质关系不大。</p> <p>此时剧情的发展好像不太符合常理，此时我们又该如何来找到自动配置逻辑有关的入口方法呢？</p> <p>最简单的方法就是在<code>AutoConfigurationImportSelector</code>类的每个方法都打上断点，然后调试看先执行到哪个方法。但是我们可以不这么做，我们回想下，自定义一个<code>Starter</code>的时候我们是不是要在<code>spring.factories</code>配置文件中配置</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">EnableAutoConfiguration</span><span class="token operator">=</span><span class="token class-name">XxxAutoConfiguration</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>因此可以推断，SpringBoot 的自动配置原理肯定跟从<code>spring.factories</code>配置文件中加载自动配置类有关，于是结合<code>AutoConfigurationImportSelector</code>的方法注释，我们找到了<code>getAutoConfigurationEntry</code>方法。于是我们在这个方法里面打上一个断点，此时通过调用栈帧来看下更上层的入口方法在哪里，然后我们再从跟自动配置相关的更上层的入口方法开始分析。</p> <p><img src="https://cdn.statically.io/gh/lixuanfengs/blog-images/master/cactus-blogs/ba9bfd5a5b0d50713f24fc2efce5542b.webp" alt="img"></p> <p>通过图 1 我们可以看到，跟自动配置逻辑相关的入口方法在<code>DeferredImportSelectorGrouping</code>类的<code>getImports</code>方法处，因此我们就从<code>DeferredImportSelectorGrouping</code>类的<code>getImports</code>方法来开始分析 SpringBoot 的自动配置源码好了。</p> <h2 id="_4-分析-springboot-自动配置原理"><a href="#_4-分析-springboot-自动配置原理" class="header-anchor">#</a> 4 分析 SpringBoot 自动配置原理</h2> <p>既然找到<code>ConfigurationClassParser.getImports()方法</code>是自动配置相关的入口方法，那么下面我们就来真正分析 SpringBoot 自动配置的源码了。</p> <p>先看一下<code>getImports</code>方法代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// ConfigurationClassParser.java</span>
<span class="token keyword">public</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Group<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&gt;</span></span> <span class="token function">getImports</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 遍历DeferredImportSelectorHolder对象集合deferredImports，deferredImports集合装了各种ImportSelector，当然这里装的是AutoConfigurationImportSelector</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">DeferredImportSelectorHolder</span> deferredImport <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deferredImports<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token comment">// 【1】，利用AutoConfigurationGroup的process方法来处理自动配置的相关逻辑，决定导入哪些配置类（这个是我们分析的重点，自动配置的逻辑全在这了）</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>group<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>deferredImport<span class="token punctuation">.</span><span class="token function">getConfigurationClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    			deferredImport<span class="token punctuation">.</span><span class="token function">getImportSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 【2】，经过上面的处理后，然后再进行选择导入哪些配置类</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>group<span class="token punctuation">.</span><span class="token function">selectImports</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>标<code>【1】</code>处的的代码是我们分析的<strong>重中之重</strong>，自动配置的相关的绝大部分逻辑全在这里了，将在 4.1 分析自动配置的主要逻辑深入分析。那么<code>this.group.process(deferredImport.getConfigurationClass().getMetadata(), deferredImport.getImportSelector())</code>；主要做的事情就是在<code>this.group</code>即<code>AutoConfigurationGroup</code>对象的<code>process</code>方法中，传入的<code>AutoConfigurationImportSelector</code>对象来选择一些符合条件的自动配置类，过滤掉一些不符合条件的自动配置类，就是这么个事情，无他。</p> <p>注：</p> <ol><li><code>AutoConfigurationGroup</code>：是<code>AutoConfigurationImportSelector</code>的内部类，主要用来处理自动配置相关的逻辑，拥有<code>process</code>和<code>selectImports</code>方法，然后拥有<code>entries</code>和<code>autoConfigurationEntries</code>集合属性，这两个集合分别存储被处理后的符合条件的自动配置类，我们知道这些就足够了；</li> <li><code>AutoConfigurationImportSelector</code>：承担自动配置的绝大部分逻辑，负责选择一些符合条件的自动配置类；</li> <li><code>metadata</code>:标注在 SpringBoot 启动类上的<code>@SpringBootApplication</code>注解元数据</li></ol> <p>标<code>【2】</code>的<code>this.group.selectImports</code>的方法主要是针对前面的<code>process</code>方法处理后的自动配置类再进一步有选择的选择导入，将在 4.2 有选择的导入自动配置类这小节深入分析。</p> <h3 id="_4-1-分析自动配置的主要逻辑"><a href="#_4-1-分析自动配置的主要逻辑" class="header-anchor">#</a> 4.1 分析自动配置的主要逻辑</h3> <p>这里继续深究前面 4 分析 SpringBoot 自动配置原理这节标<code>【1】</code>处的 <code>this.group.process</code>方法是如何处理自动配置相关逻辑的。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// AutoConfigurationImportSelector$AutoConfigurationGroup.java</span>

<span class="token comment">// 这里用来处理自动配置类，比如过滤掉不符合匹配条件的自动配置类</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> annotationMetadata<span class="token punctuation">,</span>
		<span class="token class-name">DeferredImportSelector</span> deferredImportSelector<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span>
			deferredImportSelector <span class="token keyword">instanceof</span> <span class="token class-name">AutoConfigurationImportSelector</span><span class="token punctuation">,</span>
			<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Only %s implementations are supported, got %s&quot;</span><span class="token punctuation">,</span>
					<span class="token class-name">AutoConfigurationImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
					deferredImportSelector<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 【1】,调用getAutoConfigurationEntry方法得到自动配置类放入autoConfigurationEntry对象中</span>
	<span class="token class-name">AutoConfigurationEntry</span> autoConfigurationEntry <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationImportSelector</span><span class="token punctuation">)</span> deferredImportSelector<span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">getAutoConfigurationEntry</span><span class="token punctuation">(</span><span class="token function">getAutoConfigurationMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
					annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 【2】，又将封装了自动配置类的autoConfigurationEntry对象装进autoConfigurationEntries集合</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>autoConfigurationEntries<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>autoConfigurationEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 【3】，遍历刚获取的自动配置类</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> importClassName <span class="token operator">:</span> autoConfigurationEntry<span class="token punctuation">.</span><span class="token function">getConfigurations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 这里符合条件的自动配置类作为key，annotationMetadata作为值放进entries集合</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>entries<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span>importClassName<span class="token punctuation">,</span> annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>上面代码中我们再来看标<code>【1】</code>的方法<code>getAutoConfigurationEntry</code>，这个方法主要是用来获取自动配置类有关，承担了自动配置的主要逻辑。直接上代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// AutoConfigurationImportSelector.java</span>

<span class="token comment">// 获取符合条件的自动配置类，避免加载不必要的自动配置类从而造成内存浪费</span>
<span class="token keyword">protected</span> <span class="token class-name">AutoConfigurationEntry</span> <span class="token function">getAutoConfigurationEntry</span><span class="token punctuation">(</span>
		<span class="token class-name">AutoConfigurationMetadata</span> autoConfigurationMetadata<span class="token punctuation">,</span>
		<span class="token class-name">AnnotationMetadata</span> annotationMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 获取是否有配置spring.boot.enableautoconfiguration属性，默认返回true</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isEnabled</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token constant">EMPTY_ENTRY</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 获得@Congiguration标注的Configuration类即被审视introspectedClass的注解数据，</span>
	<span class="token comment">// 比如：@SpringBootApplication(exclude = FreeMarkerAutoConfiguration.class)</span>
	<span class="token comment">// 将会获取到exclude = FreeMarkerAutoConfiguration.class和excludeName=&quot;&quot;的注解数据</span>
	<span class="token class-name">AnnotationAttributes</span> attributes <span class="token operator">=</span> <span class="token function">getAttributes</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 【1】得到spring.factories文件配置的所有自动配置类</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> configurations <span class="token operator">=</span> <span class="token function">getCandidateConfigurations</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">,</span>
			attributes<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 利用LinkedHashSet移除重复的配置类</span>
	configurations <span class="token operator">=</span> <span class="token function">removeDuplicates</span><span class="token punctuation">(</span>configurations<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 得到要排除的自动配置类，比如注解属性exclude的配置类</span>
	<span class="token comment">// 比如：@SpringBootApplication(exclude = FreeMarkerAutoConfiguration.class)</span>
	<span class="token comment">// 将会获取到exclude = FreeMarkerAutoConfiguration.class的注解数据</span>
	<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> exclusions <span class="token operator">=</span> <span class="token function">getExclusions</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">,</span> attributes<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 检查要被排除的配置类，因为有些不是自动配置类，故要抛出异常</span>
	<span class="token function">checkExcludedClasses</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 【2】将要排除的配置类移除</span>
	configurations<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span>exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 【3】因为从spring.factories文件获取的自动配置类太多，如果有些不必要的自动配置类都加载进内存，会造成内存浪费，因此这里需要进行过滤</span>
	<span class="token comment">// 注意这里会调用AutoConfigurationImportFilter的match方法来判断是否符合@ConditionalOnBean,@ConditionalOnClass或@ConditionalOnWebApplication，后面会重点分析一下</span>
	configurations <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> autoConfigurationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 【4】获取了符合条件的自动配置类后，此时触发AutoConfigurationImportEvent事件，</span>
	<span class="token comment">// 目的是告诉ConditionEvaluationReport条件评估报告器对象来记录符合条件的自动配置类</span>
	<span class="token comment">// 该事件什么时候会被触发？--&gt; 在刷新容器时调用invokeBeanFactoryPostProcessors后置处理器时触发</span>
	<span class="token function">fireAutoConfigurationImportEvents</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 【5】将符合条件和要排除的自动配置类封装进AutoConfigurationEntry对象，并返回</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AutoConfigurationEntry</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p><code>AutoConfigurationEntry</code>方法主要做的事情就是获取符合条件的自动配置类，避免加载不必要的自动配置类从而造成内存浪费。我们下面总结下<code>AutoConfigurationEntry</code>方法主要做的事情：</p> <p>【1】从<code>spring.factories</code>配置文件中加载<code>EnableAutoConfiguration</code>自动配置类（注意此时是从<strong>缓存</strong>中拿到的哈）,获取的自动配置类如图 3 所示。这里我们知道该方法做了什么事情就行了，后面还会有一篇文章详述<code>spring.factories</code>的原理；</p> <p>【2】若<code>@EnableAutoConfiguration</code>等注解标有要<code>exclude</code>的自动配置类，那么再将这个自动配置类排除掉；</p> <p>【3】排除掉要<code>exclude</code>的自动配置类后，然后再调用<code>filter</code>方法进行进一步的过滤，再次排除一些不符合条件的自动配置类；<strong>这个在稍后会详细分析。</strong></p> <p>【4】经过重重过滤后，此时再触发<code>AutoConfigurationImportEvent</code>事件，告诉<code>ConditionEvaluationReport</code>条件评估报告器对象来记录符合条件的自动配置类；（这个在 6 AutoConfigurationImportListener 这小节详细分析。）</p> <p>【5】 最后再将符合条件的自动配置类返回。</p> <p><img src="https://cdn.statically.io/gh/lixuanfengs/blog-images/master/cactus-blogs/009b60cae4aadd4e1fed941c435b18c3.webp" alt="img"></p> <p>总结了<code>AutoConfigurationEntry</code>方法主要的逻辑后，我们再来细看一下<code>AutoConfigurationImportSelector</code>的<code>filter</code>方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// AutoConfigurationImportSelector.java</span>

<span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> configurations<span class="token punctuation">,</span>
			<span class="token class-name">AutoConfigurationMetadata</span> autoConfigurationMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 将从spring.factories中获取的自动配置类转出字符串数组</span>
	<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> candidates <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">toStringArray</span><span class="token punctuation">(</span>configurations<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 定义skip数组，是否需要跳过。注意skip数组与candidates数组顺序一一对应</span>
	<span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span> skip <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">boolean</span><span class="token punctuation">[</span>candidates<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">boolean</span> skipped <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token comment">// getAutoConfigurationImportFilters方法：拿到OnBeanCondition，OnClassCondition和OnWebApplicationCondition</span>
	<span class="token comment">// 然后遍历这三个条件类去过滤从spring.factories加载的大量配置类</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">AutoConfigurationImportFilter</span> filter <span class="token operator">:</span> <span class="token function">getAutoConfigurationImportFilters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 调用各种aware方法，将beanClassLoader,beanFactory等注入到filter对象中，</span>
		<span class="token comment">// 这里的filter对象即OnBeanCondition，OnClassCondition或OnWebApplicationCondition</span>
		<span class="token function">invokeAwareMethods</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 判断各种filter来判断每个candidate（这里实质要通过candidate(自动配置类)拿到其标注的</span>
		<span class="token comment">// @ConditionalOnClass,@ConditionalOnBean和@ConditionalOnWebApplication里面的注解值）是否匹配，</span>
		<span class="token comment">// 注意candidates数组与match数组一一对应</span>
		<span class="token comment">/**********************【主线，重点关注】********************************/</span>
		<span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span> match <span class="token operator">=</span> filter<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>candidates<span class="token punctuation">,</span> autoConfigurationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 遍历match数组，注意match顺序跟candidates的自动配置类一一对应</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> match<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// 若有不匹配的话</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>match<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// 不匹配的将记录在skip数组，标志skip[i]为true，也与candidates数组一一对应</span>
				skip<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token comment">// 因为不匹配，将相应的自动配置类置空</span>
				candidates<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
				<span class="token comment">// 标注skipped为true</span>
				skipped <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 这里表示若所有自动配置类经过OnBeanCondition，OnClassCondition和OnWebApplicationCondition过滤后，全部都匹配的话，则全部原样返回</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>skipped<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> configurations<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 建立result集合来装匹配的自动配置类</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>candidates<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> candidates<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 若skip[i]为false，则说明是符合条件的自动配置类，此时添加到result集合中</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>skip<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>candidates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 打印日志</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">int</span> numberFiltered <span class="token operator">=</span> configurations<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> result<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Filtered &quot;</span> <span class="token operator">+</span> numberFiltered <span class="token operator">+</span> <span class="token string">&quot; auto configuration class in &quot;</span>
				<span class="token operator">+</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">NANOSECONDS</span><span class="token punctuation">.</span><span class="token function">toMillis</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">)</span>
				<span class="token operator">+</span> <span class="token string">&quot; ms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 最后返回符合条件的自动配置类</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><p><code>AutoConfigurationImportSelector</code>的<code>filter</code>方法主要做的事情就是调用<code>AutoConfigurationImportFilter</code>接口的<code>match</code>方法来判断每一个自动配置类上的条件注解（若有的话）<code>@ConditionalOnClass</code>,<code>@ConditionalOnBean</code>或<code>@ConditionalOnWebApplication</code>是否满足条件，若满足，则返回 true，说明匹配，若不满足，则返回 false 说明不匹配。</p> <p>我们现在知道<code>AutoConfigurationImportSelector</code>的<code>filter</code>方法主要做了什么事情就行了，现在先不用研究的过深，至于<code>AutoConfigurationImportFilter</code>接口的<code>match</code>方法将在 5 AutoConfigurationImportFilter 这小节再详细分析，填补一下我们前一篇条件注解源码分析中留下的坑。</p> <p>注意：我们坚持主线优先的原则，其他枝节代码这里不深究，以免丢了主线哈。</p> <h3 id="_4-2-有选择的导入自动配置类"><a href="#_4-2-有选择的导入自动配置类" class="header-anchor">#</a> 4.2 有选择的导入自动配置类</h3> <p>这里继续深究前面 4 分析 SpringBoot 自动配置原理这节标<code>【2】</code>处的 <code>this.group.selectImports</code>方法是如何进一步有选择的导入自动配置类的。直接看代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// AutoConfigurationImportSelector$AutoConfigurationGroup.java</span>

<span class="token keyword">public</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Entry</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectImports</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>autoConfigurationEntries<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 这里得到所有要排除的自动配置类的set集合</span>
	<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> allExclusions <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>autoConfigurationEntries<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationEntry</span><span class="token operator">::</span><span class="token function">getExclusions</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token operator">::</span><span class="token function">stream</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 这里得到经过滤后所有符合条件的自动配置类的set集合</span>
	<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> processedConfigurations <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>autoConfigurationEntries<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationEntry</span><span class="token operator">::</span><span class="token function">getConfigurations</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token operator">::</span><span class="token function">stream</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toCollection</span><span class="token punctuation">(</span><span class="token class-name">LinkedHashSet</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 移除掉要排除的自动配置类</span>
	processedConfigurations<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span>allExclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 对标注有@Order注解的自动配置类进行排序，</span>
	<span class="token keyword">return</span> <span class="token function">sortAutoConfigurations</span><span class="token punctuation">(</span>processedConfigurations<span class="token punctuation">,</span>
			<span class="token function">getAutoConfigurationMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
					<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
					<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>importClassName<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token punctuation">(</span>
							<span class="token keyword">this</span><span class="token punctuation">.</span>entries<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>importClassName<span class="token punctuation">)</span><span class="token punctuation">,</span> importClassName<span class="token punctuation">)</span><span class="token punctuation">)</span>
					<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>可以看到，<code>selectImports</code>方法主要是针对经过排除掉<code>exclude</code>的和被<code>AutoConfigurationImportFilter</code>接口过滤后的满足条件的自动配置类再进一步排除<code>exclude</code>的自动配置类，然后再排序。逻辑很简单，不再详述。</p> <p>不过有个疑问，前面已经<code>exclude</code>过一次了，为何这里还要再<code>exclude</code>一次？</p> <h2 id="_5-autoconfigurationimportfilter"><a href="#_5-autoconfigurationimportfilter" class="header-anchor">#</a> 5 AutoConfigurationImportFilter</h2> <p>这里继续深究前面 4.1 节的 <code>AutoConfigurationImportSelector.filter</code>方法的过滤自动配置类的<code>boolean[] match = filter.match(candidates, autoConfigurationMetadata);</code>这句代码。</p> <p>因此我们继续分析<code>AutoConfigurationImportFilter</code>接口，分析其<code>match</code>方法，同时也是对前一篇<code>@ConditionalOnXxx</code>的源码分析文章中留下的坑进行填补。</p> <p><code>AutoConfigurationImportFilter</code>接口只有一个<code>match</code>方法用来过滤不符合条件的自动配置类。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AutoConfigurationImportFilter</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> autoConfigurationClasses<span class="token punctuation">,</span>
    		<span class="token class-name">AutoConfigurationMetadata</span> autoConfigurationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>同样，在分析<code>AutoConfigurationImportFilter</code>接口的<code>match</code>方法前，我们先来看下其类关系图：</p> <p><img src="https://cdn.statically.io/gh/lixuanfengs/blog-images/master/cactus-blogs/4e1ef693f61bf2e722831795501c98d8.webp" alt="img"></p> <p>可以看到,<code>AutoConfigurationImportFilter</code>接口有一个具体的实现类<code>FilteringSpringBootCondition</code>，<code>FilteringSpringBootCondition</code>又有三个具体的子类：<code>OnClassCondition</code>,<code>OnBeanCondtition</code>和<code>OnWebApplicationCondition</code>。</p> <p><strong>那么这几个类之间的关系是怎样的呢？</strong></p> <p><code>FilteringSpringBootCondition</code>实现了<code>AutoConfigurationImportFilter</code>接口的<code>match</code>方法，然后在<code>FilteringSpringBootCondition</code>的<code>match</code>方法调用<code>getOutcomes</code>这个抽象模板方法返回自动配置类的匹配与否的信息。同时，最重要的是<code>FilteringSpringBootCondition</code>的三个子类<code>OnClassCondition</code>,<code>OnBeanCondtition</code>和<code>OnWebApplicationCondition</code>将会复写这个模板方法实现自己的匹配判断逻辑。</p> <p>好了，<code>AutoConfigurationImportFilter</code>接口的整体关系已经清楚了，现在我们再进入其具体实现类<code>FilteringSpringBootCondition</code>的<code>match</code>方法看看是其如何根据条件过滤自动配置类的。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// FilteringSpringBootCondition.java</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> autoConfigurationClasses<span class="token punctuation">,</span>
		<span class="token class-name">AutoConfigurationMetadata</span> autoConfigurationMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 创建评估报告</span>
	<span class="token class-name">ConditionEvaluationReport</span> report <span class="token operator">=</span> <span class="token class-name">ConditionEvaluationReport</span>
			<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 注意getOutcomes是模板方法，将spring.factories文件种加载的所有自动配置类传入</span>
	<span class="token comment">// 子类（这里指的是OnClassCondition,OnBeanCondition和OnWebApplicationCondition类）去过滤</span>
	<span class="token comment">// 注意outcomes数组存储的是不匹配的结果，跟autoConfigurationClasses数组一一对应</span>
	<span class="token comment">/*****************************【主线，重点关注】*********************************************/</span>
	<span class="token class-name">ConditionOutcome</span><span class="token punctuation">[</span><span class="token punctuation">]</span> outcomes <span class="token operator">=</span> <span class="token function">getOutcomes</span><span class="token punctuation">(</span>autoConfigurationClasses<span class="token punctuation">,</span>
			autoConfigurationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span> match <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">boolean</span><span class="token punctuation">[</span>outcomes<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token comment">// 遍历outcomes,这里outcomes为null则表示匹配，不为null则表示不匹配</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> outcomes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">ConditionOutcome</span> outcome <span class="token operator">=</span> outcomes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		match<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>outcome <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> outcome<span class="token punctuation">.</span><span class="token function">isMatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>match<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> outcomes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// 这里若有某个类不匹配的话，此时调用父类SpringBootCondition的logOutcome方法打印日志</span>
			<span class="token function">logOutcome</span><span class="token punctuation">(</span>autoConfigurationClasses<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> outcomes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 并将不匹配情况记录到report</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>report <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				report<span class="token punctuation">.</span><span class="token function">recordConditionEvaluation</span><span class="token punctuation">(</span>autoConfigurationClasses<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span>
						outcomes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> match<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><code>FilteringSpringBootCondition</code>的<code>match</code>方法主要做的事情还是调用抽象模板方法<code>getOutcomes</code>来根据条件来过滤自动配置类，而复写<code>getOutcomes</code>模板方法的有三个子类，这里不再一一分析，<strong>只挑选</strong><code>**OnClassCondition**</code><strong>复写的</strong><code>**getOutcomes**</code><strong>方法进行分析。</strong></p> <h3 id="_5-1-onclasscondition"><a href="#_5-1-onclasscondition" class="header-anchor">#</a> 5.1 OnClassCondition</h3> <p>先直接上<code>OnClassCondition</code>复写的<code>getOutcomes</code>方法的代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// OnClassCondition.java</span>

<span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">ConditionOutcome</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getOutcomes</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> autoConfigurationClasses<span class="token punctuation">,</span>
		<span class="token class-name">AutoConfigurationMetadata</span> autoConfigurationMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// Split the work and perform half in a background thread. Using a single</span>
	<span class="token comment">// additional thread seems to offer the best performance. More threads make</span>
	<span class="token comment">// things worse</span>
	<span class="token comment">// 这里经过测试用两个线程去跑的话性能是最好的，大于两个线程性能反而变差</span>
	<span class="token keyword">int</span> split <span class="token operator">=</span> autoConfigurationClasses<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token comment">// 【1】开启一个新线程去扫描判断已经加载的一半自动配置类</span>
	<span class="token class-name">OutcomesResolver</span> firstHalfResolver <span class="token operator">=</span> <span class="token function">createOutcomesResolver</span><span class="token punctuation">(</span>
			autoConfigurationClasses<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> split<span class="token punctuation">,</span> autoConfigurationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 【2】这里用主线程去扫描判断已经加载的一半自动配置类</span>
	<span class="token class-name">OutcomesResolver</span> secondHalfResolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StandardOutcomesResolver</span><span class="token punctuation">(</span>
			autoConfigurationClasses<span class="token punctuation">,</span> split<span class="token punctuation">,</span> autoConfigurationClasses<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
			autoConfigurationMetadata<span class="token punctuation">,</span> <span class="token function">getBeanClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 【3】先让主线程去执行解析一半自动配置类是否匹配条件</span>
	<span class="token class-name">ConditionOutcome</span><span class="token punctuation">[</span><span class="token punctuation">]</span> secondHalf <span class="token operator">=</span> secondHalfResolver<span class="token punctuation">.</span><span class="token function">resolveOutcomes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 【4】这里用新开启的线程取解析另一半自动配置类是否匹配</span>
	<span class="token comment">// 注意为了防止主线程执行过快结束，resolveOutcomes方法里面调用了thread.join()来</span>
	<span class="token comment">// 让主线程等待新线程执行结束，因为后面要合并两个线程的解析结果</span>
	<span class="token class-name">ConditionOutcome</span><span class="token punctuation">[</span><span class="token punctuation">]</span> firstHalf <span class="token operator">=</span> firstHalfResolver<span class="token punctuation">.</span><span class="token function">resolveOutcomes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 新建一个ConditionOutcome数组来存储自动配置类的筛选结果</span>
	<span class="token class-name">ConditionOutcome</span><span class="token punctuation">[</span><span class="token punctuation">]</span> outcomes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConditionOutcome</span><span class="token punctuation">[</span>autoConfigurationClasses<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token comment">// 将前面两个线程的筛选结果分别拷贝进outcomes数组</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>firstHalf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> outcomes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> firstHalf<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>secondHalf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> outcomes<span class="token punctuation">,</span> split<span class="token punctuation">,</span> secondHalf<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 返回自动配置类的筛选结果</span>
	<span class="token keyword">return</span> outcomes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>可以看到，<code>OnClassCondition</code>的<code>getOutcomes</code>方法主要解析自动配置类是否符合匹配条件，当然这个匹配条件指自动配置类上的注解<code>@ConditionalOnClass</code>指定的类存不存在于<code>classpath</code>中，存在则返回匹配，不存在则返回不匹配。</p> <p>由于解析自动配置类是否匹配比较耗时，因此从上面代码中我们可以看到分别创建了<code>firstHalfResolver</code>和<code>secondHalfResolver</code>两个解析对象，这两个解析对象个分别对应一个线程去解析加载的自动配置类是否符合条件，最终将两个线程的解析自动配置类的匹配结果合并后返回。</p> <p>那么自动配置类是否符合条件的解析判断过程又是怎样的呢？现在我们分别来看一下上面代码注释标注的<code>【1】</code>，<code>【2】</code>，<code>【3】</code>和<code>【4】</code>处。</p> <h4 id="_5-1-1-createoutcomesresolver"><a href="#_5-1-1-createoutcomesresolver" class="header-anchor">#</a> 5.1.1 createOutcomesResolver</h4> <p>这里对应前面 5.1 节的代码注释标注<code>【1】</code>处的<code>OutcomesResolver firstHalfResolver = createOutcomesResolver(...);</code>的方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// OnClassCondition.java</span>

<span class="token keyword">private</span> <span class="token class-name">OutcomesResolver</span> <span class="token function">createOutcomesResolver</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> autoConfigurationClasses<span class="token punctuation">,</span>
		<span class="token keyword">int</span> start<span class="token punctuation">,</span> <span class="token keyword">int</span> end<span class="token punctuation">,</span> <span class="token class-name">AutoConfigurationMetadata</span> autoConfigurationMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 新建一个StandardOutcomesResolver对象</span>
	<span class="token class-name">OutcomesResolver</span> outcomesResolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StandardOutcomesResolver</span><span class="token punctuation">(</span>
			autoConfigurationClasses<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> autoConfigurationMetadata<span class="token punctuation">,</span>
			<span class="token function">getBeanClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		<span class="token comment">// new一个ThreadedOutcomesResolver对象，并将StandardOutcomesResolver类型的outcomesResolver对象作为构造器参数传入</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ThreadedOutcomesResolver</span><span class="token punctuation">(</span>outcomesResolver<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 若上面开启的线程抛出AccessControlException异常，则返回StandardOutcomesResolver对象</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AccessControlException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> outcomesResolver<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>可以看到<code>createOutcomesResolver</code>方法创建了一个封装了<code>StandardOutcomesResolver</code>类的<code>ThreadedOutcomesResolver</code>解析对象。 我们再来看下<code>ThreadedOutcomesResolver</code>这个线程解析类封装<code>StandardOutcomesResolver</code>这个对象的目的是什么？我们继续跟进代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// OnClassCondtion.java</span>

<span class="token keyword">private</span> <span class="token class-name">ThreadedOutcomesResolver</span><span class="token punctuation">(</span><span class="token class-name">OutcomesResolver</span> outcomesResolver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 这里开启一个新的线程，这个线程其实还是利用StandardOutcomesResolver的resolveOutcomes方法</span>
	<span class="token comment">// 对自动配置类进行解析判断是否匹配</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>
			<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>outcomes <span class="token operator">=</span> outcomesResolver<span class="token punctuation">.</span><span class="token function">resolveOutcomes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 开启线程</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>可以看到在构造<code>ThreadedOutcomesResolver</code>对象时候，原来是开启了一个线程，然后这个线程其实还是调用了刚传进来的<code>StandardOutcomesResolver</code>对象的<code>resolveOutcomes</code>方法去解析自动配置类。具体如何解析呢？稍后我们在分析<code>【3】</code>处代码<code>secondHalfResolver.resolveOutcomes();</code>的时候再深究。</p> <h4 id="_5-1-2-new-standardoutcomesresolver"><a href="#_5-1-2-new-standardoutcomesresolver" class="header-anchor">#</a> 5.1.2 new StandardOutcomesResolver</h4> <p>这里对应前面 5.1 节的<code>【2】</code>处的代码<code>OutcomesResolver secondHalfResolver = new StandardOutcomesResolver(...);</code>，逻辑很简单，就是创建了一个<code>StandardOutcomesResolver</code>对象，用于后面解析自动配置类是否匹配，同时，新建的一个线程也是利用它来完成自动配置类的解析的。</p> <h4 id="_5-1-3-standardoutcomesresolver-resolveoutcomes-方法"><a href="#_5-1-3-standardoutcomesresolver-resolveoutcomes-方法" class="header-anchor">#</a> 5.1.3 StandardOutcomesResolver.resolveOutcomes 方法</h4> <p>这里对应前面 5.1 节标注的<code>【3】</code>的代码<code>ConditionOutcome[] secondHalf = secondHalfResolver.resolveOutcomes();</code>。</p> <p>这里<code>StandardOutcomesResolver.resolveOutcomes</code>方法承担了解析自动配置类匹配与否的全部逻辑，是我们要重点分析的方法，<code>resolveOutcomes</code>方法最终把解析的自动配置类的结果赋给<code>secondHalf</code>数组。那么它是如何解析自动配置类是否匹配条件的呢？</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// OnClassCondition$StandardOutcomesResolver.java</span>

<span class="token keyword">public</span> <span class="token class-name">ConditionOutcome</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">resolveOutcomes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 再调用getOutcomes方法来解析</span>
	<span class="token keyword">return</span> <span class="token function">getOutcomes</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>autoConfigurationClasses<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>start<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>end<span class="token punctuation">,</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>autoConfigurationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">ConditionOutcome</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getOutcomes</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> autoConfigurationClasses<span class="token punctuation">,</span>
		<span class="token keyword">int</span> start<span class="token punctuation">,</span> <span class="token keyword">int</span> end<span class="token punctuation">,</span> <span class="token class-name">AutoConfigurationMetadata</span> autoConfigurationMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 只要autoConfigurationMetadata没有存储相关自动配置类，那么outcome默认为null，则说明匹配</span>
	<span class="token class-name">ConditionOutcome</span><span class="token punctuation">[</span><span class="token punctuation">]</span> outcomes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConditionOutcome</span><span class="token punctuation">[</span>end <span class="token operator">-</span> start<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token comment">// 遍历每一个自动配置类</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> end<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> autoConfigurationClass <span class="token operator">=</span> autoConfigurationClasses<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token comment">// TODO 对于autoConfigurationMetadata有个疑问：为何有些自动配置类的条件注解能被加载到autoConfigurationMetadata，而有些又不能，比如自己定义的一个自动配置类HelloWorldEnableAutoConfiguration就没有被存到autoConfigurationMetadata中</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>autoConfigurationClass <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// 这里取出注解在AutoConfiguration自动配置类类的@ConditionalOnClass注解的指定类的全限定名，</span>
			<span class="token comment">// 举个栗子，看下面的KafkaStreamsAnnotationDrivenConfiguration这个自动配置类</span>
			<span class="token comment">/**
			 * @ConditionalOnClass(StreamsBuilder.class)
			 * class KafkaStreamsAnnotationDrivenConfiguration {
			 * // 省略无关代码
			 * }
			 */</span>
			<span class="token comment">// 那么取出的就是StreamsBuilder类的全限定名即candidates = org.apache.kafka.streams.StreamsBuilder</span>
			<span class="token class-name">String</span> candidates <span class="token operator">=</span> autoConfigurationMetadata
					<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>autoConfigurationClass<span class="token punctuation">,</span> <span class="token string">&quot;ConditionalOnClass&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 因为这里是处理某个类是否存在于classpath中，所以传入的key是ConditionalOnClass</span>
			<span class="token comment">// 若自动配置类标有ConditionalOnClass注解且有值，此时调用getOutcome判断是否存在于类路径中</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>candidates <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// 拿到自动配置类注解@ConditionalOnClass的值后，再调用getOutcome方法去判断匹配结果,若该类存在于类路径，则getOutcome返回null，否则非null</span>
				<span class="token comment">/*******************【主线，重点关注】******************/</span>
				outcomes<span class="token punctuation">[</span>i <span class="token operator">-</span> start<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getOutcome</span><span class="token punctuation">(</span>candidates<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> outcomes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>可以看到<code>StandardOutcomesResolver.resolveOutcomes</code>的方法中再次调用<code>getOutcomes</code>方法，主要是从<code>autoConfigurationMetadata</code>对象中获取到自动配置类上的注解<code>@ConditionalOnClass</code>指定的类的全限定名，然后作为参数传入<code>getOutcome</code>方法用于去类路径加载该类，若能加载到则说明注解<code>@ConditionalOnClass</code>满足条件，此时说明自动配置类匹配成功。</p> <p>但是别忘了，这里只是过了<code>@ConditionalOnClass</code>注解这一关，若自动配置类还有其他注解比如<code>@ConditionalOnBean</code>，若该<code>@ConditionalOnBean</code>注解不满足条件的话，同样最终结果是不匹配的。这里扯的有点远，我们回到<code>OnClassCondtion</code>的判断逻辑，继续进入<code>getOutcome</code>方法看它是如何去判断<code>@ConditionalOnClass</code>注解满不满足条件的。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// OnClassCondition$StandardOutcomesResolver.java</span>

<span class="token comment">// 返回的outcome记录的是不匹配的情况，不为null，则说明不匹配；为null，则说明匹配</span>
<span class="token keyword">private</span> <span class="token class-name">ConditionOutcome</span> <span class="token function">getOutcome</span><span class="token punctuation">(</span><span class="token class-name">String</span> candidates<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// candidates的形式为“org.springframework.boot.autoconfigure.aop.AopAutoConfiguration.ConditionalOnClass=org.aspectj.lang.annotation.Aspect,org.aspectj.lang.reflect.Advice,org.aspectj.weaver.AnnotatedElement”</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token comment">// 自动配置类上@ConditionalOnClass的值只有一个的话，直接调用getOutcome方法判断是否匹配</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>candidates<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// 看到因为传入的参数是 ClassNameFilter.MISSING，因此可以猜测这里应该是得到不匹配的结果</span>
			<span class="token comment">/******************【主线，重点关注】********************/</span>
			<span class="token keyword">return</span> <span class="token function">getOutcome</span><span class="token punctuation">(</span>candidates<span class="token punctuation">,</span> <span class="token class-name">ClassNameFilter</span><span class="token punctuation">.</span><span class="token constant">MISSING</span><span class="token punctuation">,</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>beanClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 自动配置类上@ConditionalOnClass的值有多个的话，则遍历每个值（其值以逗号，分隔）</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> candidate <span class="token operator">:</span> <span class="token class-name">StringUtils</span>
				<span class="token punctuation">.</span><span class="token function">commaDelimitedListToStringArray</span><span class="token punctuation">(</span>candidates<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">ConditionOutcome</span> outcome <span class="token operator">=</span> <span class="token function">getOutcome</span><span class="token punctuation">(</span>candidate<span class="token punctuation">,</span>
					<span class="token class-name">ClassNameFilter</span><span class="token punctuation">.</span><span class="token constant">MISSING</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 可以看到，这里只要有一个不匹配的话，则返回不匹配结果</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>outcome <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> outcome<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// We'll get another chance later</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>可以看到，<code>getOutcome</code>方法再次调用重载方法<code>getOutcome</code>进一步去判断注解<code>@ConditionalOnClass</code>指定的类存不存在类路径中，跟着主线继续跟进去：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// OnClassCondition$StandardOutcomesResolver.java</span>

<span class="token keyword">private</span> <span class="token class-name">ConditionOutcome</span> <span class="token function">getOutcome</span><span class="token punctuation">(</span><span class="token class-name">String</span> className<span class="token punctuation">,</span>
		<span class="token class-name">ClassNameFilter</span> classNameFilter<span class="token punctuation">,</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 调用classNameFilter的matches方法来判断`@ConditionalOnClass`指定的类存不存在类路径中</span>
	<span class="token comment">/******************【主线，重点关注】********************/</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>classNameFilter<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 这里调用classNameFilter去判断className是否存在于类路径中，其中ClassNameFilter又分为PRESENT和MISSING两种;目前只看到ClassNameFilter为MISSING的调用情况，所以默认为true的话记录不匹配信息；若传入ClassNameFilter为PRESENT的话，估计还要再写一个else分支</span>
		<span class="token keyword">return</span> <span class="token class-name">ConditionOutcome</span><span class="token punctuation">.</span><span class="token function">noMatch</span><span class="token punctuation">(</span><span class="token class-name">ConditionMessage</span>
				<span class="token punctuation">.</span><span class="token function">forCondition</span><span class="token punctuation">(</span><span class="token class-name">ConditionalOnClass</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">didNotFind</span><span class="token punctuation">(</span><span class="token string">&quot;required class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">items</span><span class="token punctuation">(</span><span class="token class-name">Style</span><span class="token punctuation">.</span><span class="token constant">QUOTE</span><span class="token punctuation">,</span> className<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>我们一层一层的剥，最终剥到了最底层了，这个真的需要足够耐心，没办法，源码只能一点一点的啃，嘿嘿。可以看到最终是调用<code>ClassNameFilter</code>的<code>matches</code>方法来判断<code>@ConditionalOnClass</code>指定的类存不存在类路径中,若不存在的话，则返回不匹配。</p> <p>我们继续跟进<code>ClassNameFilter</code>的源码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// FilteringSpringBootCondition.java</span>

<span class="token keyword">protected</span> <span class="token keyword">enum</span> <span class="token class-name">ClassNameFilter</span> <span class="token punctuation">{</span>
	<span class="token comment">// 这里表示指定的类存在于类路径中，则返回true</span>
	<span class="token constant">PRESENT</span> <span class="token punctuation">{</span>

		<span class="token annotation punctuation">@Override</span>
		<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">String</span> className<span class="token punctuation">,</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">isPresent</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// 这里表示指定的类不存在于类路径中，则返回true</span>
	<span class="token constant">MISSING</span> <span class="token punctuation">{</span>

		<span class="token annotation punctuation">@Override</span>
		<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">String</span> className<span class="token punctuation">,</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">isPresent</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 若classpath不存在className这个类，则返回true</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token comment">// 这又是一个抽象方法，分别被PRESENT和MISSING枚举类实现</span>
	<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">String</span> className<span class="token punctuation">,</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 检查指定的类是否存在于类路径中</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token class-name">String</span> className<span class="token punctuation">,</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>classLoader <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			classLoader <span class="token operator">=</span> <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">getDefaultClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 利用类加载器去加载相应类，若没有抛出异常则说明类路径中存在该类，此时返回true</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token comment">// 若不存在于类路径中，此时抛出的异常将catch住，返回false。</span>
		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 利用类加载器去加载指定的类</span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">forName</span><span class="token punctuation">(</span><span class="token class-name">String</span> className<span class="token punctuation">,</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>classLoader <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> classLoader<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>可以看到<code>ClassNameFilter</code>原来是<code>FilteringSpringBootCondition</code>的一个内部枚举类，其实现了判断指定类是否存在于<code>classpath</code>中的逻辑，这个类很简单，这里不再详述。</p> <h4 id="_5-1-4-threadedoutcomesresolver-resolveoutcomes-方法"><a href="#_5-1-4-threadedoutcomesresolver-resolveoutcomes-方法" class="header-anchor">#</a> 5.1.4 ThreadedOutcomesResolver.resolveOutcomes 方法</h4> <p>这里对应前面 5.1 节的标注的<code>【4】</code>的代码<code>ConditionOutcome[] firstHalf = firstHalfResolver.resolveOutcomes()</code>。</p> <p>前面分析 5.1.3 StandardOutcomesResolver.resolveOutcomes 方法已经刨根追底，陷入细节比较深，现在我们需要跳出来继续看前面标注的<code>【4】</code>的代码<code>ConditionOutcome[] firstHalf = firstHalfResolver.resolveOutcomes()</code>的方法哈。</p> <p>这里是用新开启的线程去调用<code>StandardOutcomesResolver.resolveOutcomes</code>方法解析另一半自动配置类是否匹配，因为是新线程，这里很可能会出现这么一种情况：主线程解析完属于自己解析的一半自动配置类后，那么久继续往下跑了，此时不会等待新开启的子线程的。</p> <p>因此，为了让主线程解析完后，我们需要让主线程继续等待正在解析的子线程，直到子线程结束。那么我们继续跟进代码区看下<code>ThreadedOutcomesResolver.resolveOutcomes</code>方法是怎样实现让主线程等待子线程的：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// OnClassCondition$ThreadedOutcomesResolver.java</span>

<span class="token keyword">public</span> <span class="token class-name">ConditionOutcome</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">resolveOutcomes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		<span class="token comment">// 调用子线程的Join方法，让主线程等待</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>thread<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 若子线程结束后，此时返回子线程的解析结果</span>
	<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>outcomes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>可以看到用了<code>Thread.join()</code>方法来让主线程等待正在解析自动配置类的子线程，这里应该也可以用<code>CountDownLatch</code>来让主线程等待子线程结束。最终将子线程解析后的结果赋给<code>firstHalf</code>数组。</p> <h3 id="_5-2-onbeancondition-和-onwebapplicationcondition"><a href="#_5-2-onbeancondition-和-onwebapplicationcondition" class="header-anchor">#</a> 5.2 OnBeanCondition 和 OnWebApplicationCondition</h3> <p>前面 5.1 OnClassCondition 节深入分析了<code>OnClassCondition</code>是如何过滤自动配置类的，那么自动配置类除了要经过<code>OnClassCondition</code>的过滤，还要经过<code>OnBeanCondition</code>和<code>OnWebApplicationCondition</code>这两个条件类的过滤，这里不再详述，有兴趣的小伙伴可自行分析。</p> <h2 id="_6-autoconfigurationimportlistener"><a href="#_6-autoconfigurationimportlistener" class="header-anchor">#</a> 6 AutoConfigurationImportListener</h2> <p>这里继续深究前面 4.1 节的 <code>AutoConfigurationImportSelector.getAutoConfigurationEntry</code>方法的触发自动配置类过滤完毕的事件<code>fireAutoConfigurationImportEvents(configurations, exclusions);</code>这句代码。</p> <p>我们直接点进<code>fireAutoConfigurationImportEvents</code>方法看看其是如何触发事件的：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// AutoConfigurationImportSelector.java</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">fireAutoConfigurationImportEvents</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> configurations<span class="token punctuation">,</span>
		<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> exclusions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 从spring.factories总获取到AutoConfigurationImportListener即ConditionEvaluationReportAutoConfigurationImportListener</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AutoConfigurationImportListener</span><span class="token punctuation">&gt;</span></span> listeners <span class="token operator">=</span> <span class="token function">getAutoConfigurationImportListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>listeners<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 新建一个AutoConfigurationImportEvent事件</span>
		<span class="token class-name">AutoConfigurationImportEvent</span> event <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AutoConfigurationImportEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>
				configurations<span class="token punctuation">,</span> exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 遍历刚获取到的AutoConfigurationImportListener</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">AutoConfigurationImportListener</span> listener <span class="token operator">:</span> listeners<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// 这里调用各种Aware方法用于触发事件前赋值，比如设置factory,environment等</span>
			<span class="token function">invokeAwareMethods</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 真正触发AutoConfigurationImportEvent事件即回调listener的onXXXEveent方法。这里用于记录自动配置类的评估信息</span>
			listener<span class="token punctuation">.</span><span class="token function">onAutoConfigurationImportEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>如上，<code>fireAutoConfigurationImportEvents</code>方法做了以下两件事情：</p> <p>1、调用<code>getAutoConfigurationImportListeners</code>方法从<code>spring.factoris</code>配置文件获取实现<code>AutoConfigurationImportListener</code>接口的事件监听器；如下图，可以看到获取的是<code>ConditionEvaluationReportAutoConfigurationImportListener</code>：</p> <p><img src="https://cdn.statically.io/gh/lixuanfengs/blog-images/master/cactus-blogs/15df7bc9936ba041b3450f26bd702e1d.webp" alt="img"></p> <p>2、遍历获取的各个事件监听器，然后调用监听器各种<code>Aware</code>方法给监听器赋值，最后再依次回调事件监听器的<code>onAutoConfigurationImportEvent</code>方法，执行监听事件的逻辑。</p> <p>此时我们再来看下<code>ConditionEvaluationReportAutoConfigurationImportListener</code>监听器监听到事件后，它的<code>onAutoConfigurationImportEvent</code>方法究竟做了哪些事情：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// ConditionEvaluationReportAutoConfigurationImportListener.java</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAutoConfigurationImportEvent</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationImportEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 获取到条件评估报告器对象</span>
		<span class="token class-name">ConditionEvaluationReport</span> report <span class="token operator">=</span> <span class="token class-name">ConditionEvaluationReport</span>
				<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 将符合条件的自动配置类记录到unconditionalClasses集合中</span>
		report<span class="token punctuation">.</span><span class="token function">recordEvaluationCandidates</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getCandidateConfigurations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 将要exclude的自动配置类记录到exclusions集合中</span>
		report<span class="token punctuation">.</span><span class="token function">recordExclusions</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getExclusions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>可以看到，<code>ConditionEvaluationReportAutoConfigurationImportListener</code>监听器监听到事件后，做的事情很简单，只是分别记录下符合条件和被<code>exclude</code>的自动配置类。</p> <h2 id="_7-autoconfigurationpackages"><a href="#_7-autoconfigurationpackages" class="header-anchor">#</a> 7 AutoConfigurationPackages</h2> <p>前面已经详述了 SpringBoot 的自动配置原理了，最后的最后，跟 SpringBoot 自动配置有关的注解<code>@AutoConfigurationPackage</code>还没分析，我们来看下这个注解的源码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationPackages<span class="token punctuation">.</span>Registrar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">AutoConfigurationPackage</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>可以看到<code>@AutoConfigurationPackage</code>注解是跟 SpringBoot 自动配置所在的包相关的，即将 添加该注解的类所在的 package 作为 自动配置 package 进行管理。</p> <p>接下来我们再看看<code>AutoConfigurationPackages.Registrar</code>类是干嘛的，直接看源码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//AutoConfigurationPackages.Registrar.java</span>

<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Registrar</span> <span class="token keyword">implements</span> <span class="token class-name">ImportBeanDefinitionRegistrar</span><span class="token punctuation">,</span> <span class="token class-name">DeterminableImports</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> metadata<span class="token punctuation">,</span>
    		<span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token function">register</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PackageImport</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">determineImports</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singleton</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PackageImport</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>可以看到<code>Registrar</code>类是<code>AutoConfigurationPackages</code>的静态内部类，实现了<code>ImportBeanDefinitionRegistrar</code>和<code>DeterminableImports</code>两个接口。现在我们主要来关注下<code>Registrar</code>实现的<code>registerBeanDefinitions</code>方法,顾名思义，这个方法是注册<code>bean</code>定义的方法。看到它又调用了<code>AutoConfigurationPackages</code>的<code>register</code>方法，继续跟进源码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// AutoConfigurationPackages.java</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> packageNames<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>registry<span class="token punctuation">.</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span><span class="token constant">BEAN</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">BeanDefinition</span> beanDefinition <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">getBeanDefinition</span><span class="token punctuation">(</span><span class="token constant">BEAN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">ConstructorArgumentValues</span> constructorArguments <span class="token operator">=</span> beanDefinition
				<span class="token punctuation">.</span><span class="token function">getConstructorArgumentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		constructorArguments<span class="token punctuation">.</span><span class="token function">addIndexedArgumentValue</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>
				<span class="token function">addBasePackages</span><span class="token punctuation">(</span>constructorArguments<span class="token punctuation">,</span> packageNames<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token class-name">GenericBeanDefinition</span> beanDefinition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericBeanDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		beanDefinition<span class="token punctuation">.</span><span class="token function">setBeanClass</span><span class="token punctuation">(</span><span class="token class-name">BasePackages</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		beanDefinition<span class="token punctuation">.</span><span class="token function">getConstructorArgumentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addIndexedArgumentValue</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>
				packageNames<span class="token punctuation">)</span><span class="token punctuation">;</span>
		beanDefinition<span class="token punctuation">.</span><span class="token function">setRole</span><span class="token punctuation">(</span><span class="token class-name">BeanDefinition</span><span class="token punctuation">.</span><span class="token constant">ROLE_INFRASTRUCTURE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		registry<span class="token punctuation">.</span><span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span><span class="token constant">BEAN</span><span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>如上，可以看到<code>register</code>方法注册了一个<code>packageNames</code>即自动配置类注解<code>@EnableAutoConfiguration</code>所在的所在的包名相关的<code>bean</code>。那么注册这个<code>bean</code>的目的是为了什么呢？ 结合官网注释知道，注册这个自动配置包名相关的<code>bean</code>是为了被其他地方引用，比如<code>JPA entity scanner</code>，具体拿来干什么久不知道了，这里不再深究了。</p> <h1 id="_8-小结"><a href="#_8-小结" class="header-anchor">#</a> 8 小结</h1> <p>好了，SpringBoot 的自动配置的源码分析就到这里了，比较长，有些地方也很深入细节，读完需要一定的耐心。</p> <p>最后，我们再总结下 SpringBoot 自动配置的原理，主要做了以下事情：</p> <ol><li>从 <code>spring.factories</code> 配置文件中加载自动配置类；</li> <li>加载的自动配置类中排除掉<code>@EnableAutoConfiguration</code>注解的<code>exclude</code>属性指定的自动配置类；</li> <li>然后再用<code>AutoConfigurationImportFilter</code>接口去过滤自动配置类是否符合其标注注解（若有标注的话）<code>@ConditionalOnClass</code>,<code>@ConditionalOnBean</code>和<code>@ConditionalOnWebApplication</code>的条件，若都符合的话则返回匹配结果；</li> <li>然后触发<code>AutoConfigurationImportEvent</code>事件，告诉<code>ConditionEvaluationReport</code>条件评估报告器对象来分别记录符合条件和<code>exclude</code>的自动配置类。</li> <li>最后 spring 再将最后筛选后的自动配置类导入 IOC 容器中</li></ol></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/lixuanfengs/cactus-vuepress-sc/edit/master/docs/07.后端/110.阅读源码系列/10.Spring Boot/04.SpringBoot是如何实现自动配置的？.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/09/28, 17:04:39</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/83fe40/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">SpringBoot自动配置的条件注解原理</div></a> <a href="/pages/04160a/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">SpringBoot的配置属性值是如何绑定的？</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/83fe40/" class="prev">SpringBoot自动配置的条件注解原理</a></span> <span class="next"><a href="/pages/04160a/">SpringBoot的配置属性值是如何绑定的？</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/118ac7/"><div>
            深圳仪器平台-开发手册记录
            <!----></div></a> <span class="date">01-25</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/6254d2/"><div>
            👋 该怎样设计一套“百万级API网关?”
            <!----></div></a> <span class="date">10-12</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/d9cb43/"><div>
            功能完善(算力关联、接口上报、调用反馈)
            <!----></div></a> <span class="date">10-09</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1183895890@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/lixuanfengs" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://cactusli.net" title="网站首页" target="_blank" class="iconfont icon-rss"></a><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=1183895890&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" class="iconfont icon-QQ"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2018-2024
    <span>Cactusli | <a href="https://github.com/lixuanfengs/cactus-vuepress/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div><div></div><div></div><div class="artalk"></div><canvas id="vuepress-canvas-cursor"></canvas><div></div><!----></div></div>
    <script src="/assets/js/app.d73578e6.js" defer></script><script src="/assets/js/2.f6444e8b.js" defer></script><script src="/assets/js/127.e55d2fa9.js" defer></script><script src="/assets/js/13.9ca28764.js" defer></script><script src="/assets/js/6.0f00df03.js" defer></script><script src="/assets/js/5.1368437e.js" defer></script><script src="/assets/js/4.7c9e6596.js" defer></script>
  </body>
</html>
