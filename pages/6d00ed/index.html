<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Jenkins+gitlab持续集成学习 | Cactusli blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3077305_pt8umhrn4k9.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3129839_xft6cqs5gc.css">
    <noscript><meta http-equiv="refresh" content="0; url=https://www.youngkbt.cn/noscript/"><style>.theme-vdoing-content { display:none }</noscript>
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/artalk/2.5.5/Artalk.css">
    <script src="https://cdn.bootcdn.net/ajax/libs/artalk/2.5.5/Artalk.js"></script>
    <script>var _hmt = _hmt || [];
          (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?efc65c9365211267213266ca9b95b304"; 
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
          })();
          </script>
    <meta name="description" content="后端技术博客,专注前后端学习与总结。Java,JavaScript,js,ES6,TypeScript,vue,React,python,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="后端端博客,个人技术博客,后端,后端开发,前端框架,Java后端,后端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="codeva-nBtnwPHxXt">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/assets/css/0.styles.b8eeafc3.css" as="style"><link rel="preload" href="/assets/js/app.d73578e6.js" as="script"><link rel="preload" href="/assets/js/2.f6444e8b.js" as="script"><link rel="preload" href="/assets/js/71.6b329e8e.js" as="script"><link rel="preload" href="/assets/js/13.9ca28764.js" as="script"><link rel="preload" href="/assets/js/6.0f00df03.js" as="script"><link rel="preload" href="/assets/js/5.1368437e.js" as="script"><link rel="preload" href="/assets/js/4.7c9e6596.js" as="script"><link rel="prefetch" href="/assets/js/10.af60255b.js"><link rel="prefetch" href="/assets/js/100.3ef796c4.js"><link rel="prefetch" href="/assets/js/101.aae7784e.js"><link rel="prefetch" href="/assets/js/102.8da091f1.js"><link rel="prefetch" href="/assets/js/103.ad0dd5b7.js"><link rel="prefetch" href="/assets/js/104.642836fc.js"><link rel="prefetch" href="/assets/js/105.f3c5bcec.js"><link rel="prefetch" href="/assets/js/106.85dad7d8.js"><link rel="prefetch" href="/assets/js/107.42b1c013.js"><link rel="prefetch" href="/assets/js/108.2a978b6c.js"><link rel="prefetch" href="/assets/js/109.46c8b7c6.js"><link rel="prefetch" href="/assets/js/11.372f8efb.js"><link rel="prefetch" href="/assets/js/110.2cb8a5dc.js"><link rel="prefetch" href="/assets/js/111.c68e8975.js"><link rel="prefetch" href="/assets/js/112.d89adde5.js"><link rel="prefetch" href="/assets/js/113.e52ab124.js"><link rel="prefetch" href="/assets/js/114.94f7a70b.js"><link rel="prefetch" href="/assets/js/115.68c55722.js"><link rel="prefetch" href="/assets/js/116.9cdf5c61.js"><link rel="prefetch" href="/assets/js/117.34a7707c.js"><link rel="prefetch" href="/assets/js/118.e9922234.js"><link rel="prefetch" href="/assets/js/119.61fe4a4e.js"><link rel="prefetch" href="/assets/js/12.1061ddb5.js"><link rel="prefetch" href="/assets/js/120.fe5311f5.js"><link rel="prefetch" href="/assets/js/121.905e8e51.js"><link rel="prefetch" href="/assets/js/122.8cd7cd0c.js"><link rel="prefetch" href="/assets/js/123.f4f98520.js"><link rel="prefetch" href="/assets/js/124.4e233943.js"><link rel="prefetch" href="/assets/js/125.092aa1bf.js"><link rel="prefetch" href="/assets/js/126.b9c11778.js"><link rel="prefetch" href="/assets/js/127.e55d2fa9.js"><link rel="prefetch" href="/assets/js/128.3197df92.js"><link rel="prefetch" href="/assets/js/129.0244ee9b.js"><link rel="prefetch" href="/assets/js/130.e0648777.js"><link rel="prefetch" href="/assets/js/131.94e0b948.js"><link rel="prefetch" href="/assets/js/132.8520ded5.js"><link rel="prefetch" href="/assets/js/133.034f0365.js"><link rel="prefetch" href="/assets/js/134.1ca4a150.js"><link rel="prefetch" href="/assets/js/135.bdfc5c00.js"><link rel="prefetch" href="/assets/js/136.4918fec8.js"><link rel="prefetch" href="/assets/js/137.2db62de4.js"><link rel="prefetch" href="/assets/js/138.87fd076f.js"><link rel="prefetch" href="/assets/js/139.eecbbecd.js"><link rel="prefetch" href="/assets/js/14.2c349983.js"><link rel="prefetch" href="/assets/js/140.40d4aa29.js"><link rel="prefetch" href="/assets/js/141.dc280dee.js"><link rel="prefetch" href="/assets/js/142.4fa6a57c.js"><link rel="prefetch" href="/assets/js/143.33b90797.js"><link rel="prefetch" href="/assets/js/144.180e147f.js"><link rel="prefetch" href="/assets/js/145.832bf539.js"><link rel="prefetch" href="/assets/js/146.71cc0cd4.js"><link rel="prefetch" href="/assets/js/147.4d966ac1.js"><link rel="prefetch" href="/assets/js/148.98ccdf6a.js"><link rel="prefetch" href="/assets/js/149.c6e90dd0.js"><link rel="prefetch" href="/assets/js/15.5bb38388.js"><link rel="prefetch" href="/assets/js/150.cb70fd12.js"><link rel="prefetch" href="/assets/js/151.2da07e43.js"><link rel="prefetch" href="/assets/js/152.65bb34e9.js"><link rel="prefetch" href="/assets/js/153.10ef087b.js"><link rel="prefetch" href="/assets/js/154.2b0c9bc8.js"><link rel="prefetch" href="/assets/js/155.e38977ec.js"><link rel="prefetch" href="/assets/js/156.02b0bba1.js"><link rel="prefetch" href="/assets/js/157.3ed0f21f.js"><link rel="prefetch" href="/assets/js/158.beda5a17.js"><link rel="prefetch" href="/assets/js/159.5bfbc4d9.js"><link rel="prefetch" href="/assets/js/16.a58fed94.js"><link rel="prefetch" href="/assets/js/160.408dbb35.js"><link rel="prefetch" href="/assets/js/161.c4344be4.js"><link rel="prefetch" href="/assets/js/162.f80a95f8.js"><link rel="prefetch" href="/assets/js/163.dc12b090.js"><link rel="prefetch" href="/assets/js/164.682e2b57.js"><link rel="prefetch" href="/assets/js/165.0af68775.js"><link rel="prefetch" href="/assets/js/166.6254b754.js"><link rel="prefetch" href="/assets/js/167.727b0d47.js"><link rel="prefetch" href="/assets/js/168.e3458b70.js"><link rel="prefetch" href="/assets/js/169.d6492dcd.js"><link rel="prefetch" href="/assets/js/17.2429b1e6.js"><link rel="prefetch" href="/assets/js/170.3677af86.js"><link rel="prefetch" href="/assets/js/171.fe866179.js"><link rel="prefetch" href="/assets/js/172.c7d611be.js"><link rel="prefetch" href="/assets/js/173.e535d27d.js"><link rel="prefetch" href="/assets/js/174.07646070.js"><link rel="prefetch" href="/assets/js/175.227bcdd6.js"><link rel="prefetch" href="/assets/js/176.d03f1195.js"><link rel="prefetch" href="/assets/js/177.7206380a.js"><link rel="prefetch" href="/assets/js/178.7bfc35c4.js"><link rel="prefetch" href="/assets/js/179.d990d8ea.js"><link rel="prefetch" href="/assets/js/18.a5d750b4.js"><link rel="prefetch" href="/assets/js/180.2e4eba32.js"><link rel="prefetch" href="/assets/js/181.cbd8f5ca.js"><link rel="prefetch" href="/assets/js/182.afd4c94b.js"><link rel="prefetch" href="/assets/js/183.e7ab48ce.js"><link rel="prefetch" href="/assets/js/184.5f21d13c.js"><link rel="prefetch" href="/assets/js/185.4a4fd3b0.js"><link rel="prefetch" href="/assets/js/186.2ff2b9cd.js"><link rel="prefetch" href="/assets/js/187.b325350e.js"><link rel="prefetch" href="/assets/js/188.2a18fad9.js"><link rel="prefetch" href="/assets/js/189.425c0eb4.js"><link rel="prefetch" href="/assets/js/19.6925fadc.js"><link rel="prefetch" href="/assets/js/190.372a786b.js"><link rel="prefetch" href="/assets/js/191.a6b816f2.js"><link rel="prefetch" href="/assets/js/192.2d46ba6c.js"><link rel="prefetch" href="/assets/js/193.9d886ea4.js"><link rel="prefetch" href="/assets/js/194.ec75fc6b.js"><link rel="prefetch" href="/assets/js/195.5688915a.js"><link rel="prefetch" href="/assets/js/196.fa745ec4.js"><link rel="prefetch" href="/assets/js/197.b389a9e8.js"><link rel="prefetch" href="/assets/js/198.66ebbff6.js"><link rel="prefetch" href="/assets/js/199.32103f1f.js"><link rel="prefetch" href="/assets/js/20.d4b6b23a.js"><link rel="prefetch" href="/assets/js/200.1b917b48.js"><link rel="prefetch" href="/assets/js/201.626e8295.js"><link rel="prefetch" href="/assets/js/202.3df66e9e.js"><link rel="prefetch" href="/assets/js/203.aff1d912.js"><link rel="prefetch" href="/assets/js/204.6306a828.js"><link rel="prefetch" href="/assets/js/205.320db987.js"><link rel="prefetch" href="/assets/js/206.b4488e77.js"><link rel="prefetch" href="/assets/js/207.d5f17556.js"><link rel="prefetch" href="/assets/js/208.37210f86.js"><link rel="prefetch" href="/assets/js/209.786c7af4.js"><link rel="prefetch" href="/assets/js/21.95dcd0d6.js"><link rel="prefetch" href="/assets/js/210.38e58d19.js"><link rel="prefetch" href="/assets/js/211.09b699bb.js"><link rel="prefetch" href="/assets/js/212.ffd8d260.js"><link rel="prefetch" href="/assets/js/213.2891f4a0.js"><link rel="prefetch" href="/assets/js/214.8c1a47e0.js"><link rel="prefetch" href="/assets/js/215.c0dec61f.js"><link rel="prefetch" href="/assets/js/216.c71c59ab.js"><link rel="prefetch" href="/assets/js/217.8891c004.js"><link rel="prefetch" href="/assets/js/218.a2075ffe.js"><link rel="prefetch" href="/assets/js/219.1e70631e.js"><link rel="prefetch" href="/assets/js/22.473284b6.js"><link rel="prefetch" href="/assets/js/220.1d012692.js"><link rel="prefetch" href="/assets/js/221.aa4a0d37.js"><link rel="prefetch" href="/assets/js/222.b512a429.js"><link rel="prefetch" href="/assets/js/223.9e6d42f2.js"><link rel="prefetch" href="/assets/js/224.e46f8d1d.js"><link rel="prefetch" href="/assets/js/225.d8083ae3.js"><link rel="prefetch" href="/assets/js/226.7730bb6a.js"><link rel="prefetch" href="/assets/js/227.3ec46626.js"><link rel="prefetch" href="/assets/js/228.0be929cb.js"><link rel="prefetch" href="/assets/js/229.d8da48e4.js"><link rel="prefetch" href="/assets/js/23.1a1a291a.js"><link rel="prefetch" href="/assets/js/230.f6b2bd82.js"><link rel="prefetch" href="/assets/js/231.c43852a4.js"><link rel="prefetch" href="/assets/js/232.0aa9bd8a.js"><link rel="prefetch" href="/assets/js/233.28899baa.js"><link rel="prefetch" href="/assets/js/234.37a56cac.js"><link rel="prefetch" href="/assets/js/235.57d1f2f2.js"><link rel="prefetch" href="/assets/js/236.10c15500.js"><link rel="prefetch" href="/assets/js/237.8ccfba13.js"><link rel="prefetch" href="/assets/js/238.072cdb99.js"><link rel="prefetch" href="/assets/js/239.a4042ce8.js"><link rel="prefetch" href="/assets/js/24.6f32ee5c.js"><link rel="prefetch" href="/assets/js/240.a4e8f29e.js"><link rel="prefetch" href="/assets/js/241.aec0fdc6.js"><link rel="prefetch" href="/assets/js/242.4e5a95cc.js"><link rel="prefetch" href="/assets/js/243.0ab57bd0.js"><link rel="prefetch" href="/assets/js/244.d5257ed9.js"><link rel="prefetch" href="/assets/js/245.747b1f48.js"><link rel="prefetch" href="/assets/js/246.f89916b2.js"><link rel="prefetch" href="/assets/js/247.9baf4f72.js"><link rel="prefetch" href="/assets/js/248.5878bead.js"><link rel="prefetch" href="/assets/js/249.0153ed9a.js"><link rel="prefetch" href="/assets/js/25.825806eb.js"><link rel="prefetch" href="/assets/js/250.4f47bd06.js"><link rel="prefetch" href="/assets/js/251.2c55f0ac.js"><link rel="prefetch" href="/assets/js/252.3171358b.js"><link rel="prefetch" href="/assets/js/253.3d927b62.js"><link rel="prefetch" href="/assets/js/254.56caa785.js"><link rel="prefetch" href="/assets/js/255.b75a0344.js"><link rel="prefetch" href="/assets/js/256.e449fa3a.js"><link rel="prefetch" href="/assets/js/257.a280fd63.js"><link rel="prefetch" href="/assets/js/258.85cacce2.js"><link rel="prefetch" href="/assets/js/259.220782f3.js"><link rel="prefetch" href="/assets/js/26.c2a73fa1.js"><link rel="prefetch" href="/assets/js/260.4cad83bd.js"><link rel="prefetch" href="/assets/js/261.cc01772f.js"><link rel="prefetch" href="/assets/js/262.31fb9ce0.js"><link rel="prefetch" href="/assets/js/263.95d45d4a.js"><link rel="prefetch" href="/assets/js/264.a23581c9.js"><link rel="prefetch" href="/assets/js/265.f4d45025.js"><link rel="prefetch" href="/assets/js/266.08c29ff3.js"><link rel="prefetch" href="/assets/js/267.f25d5c52.js"><link rel="prefetch" href="/assets/js/268.e4b83b3f.js"><link rel="prefetch" href="/assets/js/269.54e6f5d2.js"><link rel="prefetch" href="/assets/js/27.94b60768.js"><link rel="prefetch" href="/assets/js/270.477bbf01.js"><link rel="prefetch" href="/assets/js/271.eadefaf2.js"><link rel="prefetch" href="/assets/js/272.c77f20a4.js"><link rel="prefetch" href="/assets/js/273.86e57213.js"><link rel="prefetch" href="/assets/js/274.caf08186.js"><link rel="prefetch" href="/assets/js/275.843af577.js"><link rel="prefetch" href="/assets/js/276.bc7dfde0.js"><link rel="prefetch" href="/assets/js/277.a18aa211.js"><link rel="prefetch" href="/assets/js/278.25260976.js"><link rel="prefetch" href="/assets/js/279.0bc329e7.js"><link rel="prefetch" href="/assets/js/28.166f967e.js"><link rel="prefetch" href="/assets/js/280.c7eb5b22.js"><link rel="prefetch" href="/assets/js/281.78d4ed73.js"><link rel="prefetch" href="/assets/js/282.08dbc1ff.js"><link rel="prefetch" href="/assets/js/283.1a8ed58d.js"><link rel="prefetch" href="/assets/js/284.c67e1e75.js"><link rel="prefetch" href="/assets/js/285.6252305a.js"><link rel="prefetch" href="/assets/js/286.5c98afe5.js"><link rel="prefetch" href="/assets/js/287.bd42634c.js"><link rel="prefetch" href="/assets/js/288.1a692f6d.js"><link rel="prefetch" href="/assets/js/289.137dd607.js"><link rel="prefetch" href="/assets/js/29.69647249.js"><link rel="prefetch" href="/assets/js/290.6cb00ec4.js"><link rel="prefetch" href="/assets/js/291.4a6210f6.js"><link rel="prefetch" href="/assets/js/292.dedb1bb4.js"><link rel="prefetch" href="/assets/js/293.6e25fb34.js"><link rel="prefetch" href="/assets/js/294.c7f2e4eb.js"><link rel="prefetch" href="/assets/js/295.76fdbc3b.js"><link rel="prefetch" href="/assets/js/296.48999983.js"><link rel="prefetch" href="/assets/js/297.8d1c640d.js"><link rel="prefetch" href="/assets/js/298.9f5441b7.js"><link rel="prefetch" href="/assets/js/299.150b9208.js"><link rel="prefetch" href="/assets/js/3.461c0085.js"><link rel="prefetch" href="/assets/js/30.defdcb36.js"><link rel="prefetch" href="/assets/js/300.6b9057e3.js"><link rel="prefetch" href="/assets/js/301.74c659b3.js"><link rel="prefetch" href="/assets/js/302.6d8ebf64.js"><link rel="prefetch" href="/assets/js/303.21fe2025.js"><link rel="prefetch" href="/assets/js/304.3c05c7a6.js"><link rel="prefetch" href="/assets/js/305.7c3fb5eb.js"><link rel="prefetch" href="/assets/js/306.c1fa105b.js"><link rel="prefetch" href="/assets/js/307.48a1d678.js"><link rel="prefetch" href="/assets/js/308.4e58779a.js"><link rel="prefetch" href="/assets/js/309.9fac2cdc.js"><link rel="prefetch" href="/assets/js/31.77a45ce0.js"><link rel="prefetch" href="/assets/js/310.3a159c1e.js"><link rel="prefetch" href="/assets/js/311.603f45af.js"><link rel="prefetch" href="/assets/js/312.603c7885.js"><link rel="prefetch" href="/assets/js/313.69be703f.js"><link rel="prefetch" href="/assets/js/314.9054c9ab.js"><link rel="prefetch" href="/assets/js/315.e331ef4b.js"><link rel="prefetch" href="/assets/js/316.1d0a506f.js"><link rel="prefetch" href="/assets/js/317.1b787b88.js"><link rel="prefetch" href="/assets/js/318.86f787b0.js"><link rel="prefetch" href="/assets/js/319.a6921190.js"><link rel="prefetch" href="/assets/js/32.93f3bdf1.js"><link rel="prefetch" href="/assets/js/320.f0c26c43.js"><link rel="prefetch" href="/assets/js/321.a19c9ff4.js"><link rel="prefetch" href="/assets/js/322.01ba6221.js"><link rel="prefetch" href="/assets/js/323.978cd49f.js"><link rel="prefetch" href="/assets/js/324.fe310b5d.js"><link rel="prefetch" href="/assets/js/325.3244bcda.js"><link rel="prefetch" href="/assets/js/326.5c4f01a3.js"><link rel="prefetch" href="/assets/js/327.5db6522f.js"><link rel="prefetch" href="/assets/js/328.e220334a.js"><link rel="prefetch" href="/assets/js/329.df7c545b.js"><link rel="prefetch" href="/assets/js/33.f4982416.js"><link rel="prefetch" href="/assets/js/330.3f9cc52f.js"><link rel="prefetch" href="/assets/js/331.1661ec63.js"><link rel="prefetch" href="/assets/js/332.bdec065c.js"><link rel="prefetch" href="/assets/js/333.b663aa77.js"><link rel="prefetch" href="/assets/js/334.b1f6193f.js"><link rel="prefetch" href="/assets/js/335.cc7fedb2.js"><link rel="prefetch" href="/assets/js/336.35aa2903.js"><link rel="prefetch" href="/assets/js/337.a91aa873.js"><link rel="prefetch" href="/assets/js/338.ae795233.js"><link rel="prefetch" href="/assets/js/339.4582441a.js"><link rel="prefetch" href="/assets/js/34.deb0c8cd.js"><link rel="prefetch" href="/assets/js/340.c9e30c24.js"><link rel="prefetch" href="/assets/js/341.ab8bbf2f.js"><link rel="prefetch" href="/assets/js/342.4dcd40fe.js"><link rel="prefetch" href="/assets/js/343.04aa7b0e.js"><link rel="prefetch" href="/assets/js/344.cf12e221.js"><link rel="prefetch" href="/assets/js/345.851fea37.js"><link rel="prefetch" href="/assets/js/346.cd04ce92.js"><link rel="prefetch" href="/assets/js/347.cc13c5f8.js"><link rel="prefetch" href="/assets/js/348.e8149a34.js"><link rel="prefetch" href="/assets/js/349.8c615125.js"><link rel="prefetch" href="/assets/js/35.946b2b10.js"><link rel="prefetch" href="/assets/js/350.297c9452.js"><link rel="prefetch" href="/assets/js/351.c625eafe.js"><link rel="prefetch" href="/assets/js/352.21fc6d9a.js"><link rel="prefetch" href="/assets/js/353.0918e6c0.js"><link rel="prefetch" href="/assets/js/354.760beca2.js"><link rel="prefetch" href="/assets/js/355.ec756b28.js"><link rel="prefetch" href="/assets/js/356.c41182ab.js"><link rel="prefetch" href="/assets/js/357.3a762703.js"><link rel="prefetch" href="/assets/js/358.2c575e4a.js"><link rel="prefetch" href="/assets/js/359.7ce42976.js"><link rel="prefetch" href="/assets/js/36.22805e5a.js"><link rel="prefetch" href="/assets/js/360.ef9a8667.js"><link rel="prefetch" href="/assets/js/361.1511e3f4.js"><link rel="prefetch" href="/assets/js/362.d5fbab7c.js"><link rel="prefetch" href="/assets/js/363.976be7aa.js"><link rel="prefetch" href="/assets/js/364.1843f42a.js"><link rel="prefetch" href="/assets/js/365.dfde987d.js"><link rel="prefetch" href="/assets/js/366.b87a9cb5.js"><link rel="prefetch" href="/assets/js/367.8ba1f57c.js"><link rel="prefetch" href="/assets/js/368.8b96559b.js"><link rel="prefetch" href="/assets/js/369.2546100c.js"><link rel="prefetch" href="/assets/js/37.3525192b.js"><link rel="prefetch" href="/assets/js/370.4db8b482.js"><link rel="prefetch" href="/assets/js/371.0542b71b.js"><link rel="prefetch" href="/assets/js/372.4c9bde18.js"><link rel="prefetch" href="/assets/js/373.32bcd884.js"><link rel="prefetch" href="/assets/js/374.3793da0b.js"><link rel="prefetch" href="/assets/js/375.8297ec5b.js"><link rel="prefetch" href="/assets/js/376.e346176b.js"><link rel="prefetch" href="/assets/js/377.ac5d8c7f.js"><link rel="prefetch" href="/assets/js/378.e0b84ffc.js"><link rel="prefetch" href="/assets/js/379.663b7fb2.js"><link rel="prefetch" href="/assets/js/38.72fc1973.js"><link rel="prefetch" href="/assets/js/380.01abbbeb.js"><link rel="prefetch" href="/assets/js/381.445e4202.js"><link rel="prefetch" href="/assets/js/382.ff24e162.js"><link rel="prefetch" href="/assets/js/383.c8303f29.js"><link rel="prefetch" href="/assets/js/384.67496581.js"><link rel="prefetch" href="/assets/js/385.e206fb4d.js"><link rel="prefetch" href="/assets/js/386.1e324581.js"><link rel="prefetch" href="/assets/js/387.4b3c734b.js"><link rel="prefetch" href="/assets/js/388.89e3ad82.js"><link rel="prefetch" href="/assets/js/389.814cbc20.js"><link rel="prefetch" href="/assets/js/39.85d65742.js"><link rel="prefetch" href="/assets/js/390.3d2bc4b1.js"><link rel="prefetch" href="/assets/js/391.ad15e5c9.js"><link rel="prefetch" href="/assets/js/392.22ea3d28.js"><link rel="prefetch" href="/assets/js/393.dc925e8e.js"><link rel="prefetch" href="/assets/js/394.f758a517.js"><link rel="prefetch" href="/assets/js/395.bb8c0d77.js"><link rel="prefetch" href="/assets/js/396.8cc3e6cb.js"><link rel="prefetch" href="/assets/js/397.44dba438.js"><link rel="prefetch" href="/assets/js/398.76ebedbb.js"><link rel="prefetch" href="/assets/js/399.a6acb507.js"><link rel="prefetch" href="/assets/js/40.2ef6e1f7.js"><link rel="prefetch" href="/assets/js/400.a6d9d98e.js"><link rel="prefetch" href="/assets/js/401.0715bf66.js"><link rel="prefetch" href="/assets/js/402.fff59a65.js"><link rel="prefetch" href="/assets/js/403.9f58e94a.js"><link rel="prefetch" href="/assets/js/404.4817775f.js"><link rel="prefetch" href="/assets/js/405.1744cc09.js"><link rel="prefetch" href="/assets/js/406.a978bd4c.js"><link rel="prefetch" href="/assets/js/407.4fb1ac88.js"><link rel="prefetch" href="/assets/js/408.f1bb0f31.js"><link rel="prefetch" href="/assets/js/409.942c7d40.js"><link rel="prefetch" href="/assets/js/41.a4f19bba.js"><link rel="prefetch" href="/assets/js/410.66f0918b.js"><link rel="prefetch" href="/assets/js/411.6a5436f5.js"><link rel="prefetch" href="/assets/js/412.ec974a04.js"><link rel="prefetch" href="/assets/js/413.ba4fd119.js"><link rel="prefetch" href="/assets/js/414.55e59bef.js"><link rel="prefetch" href="/assets/js/415.412201ca.js"><link rel="prefetch" href="/assets/js/416.4b4ba217.js"><link rel="prefetch" href="/assets/js/417.a65d2f1b.js"><link rel="prefetch" href="/assets/js/418.bf142c63.js"><link rel="prefetch" href="/assets/js/419.65b0f04d.js"><link rel="prefetch" href="/assets/js/42.7f2b0b0f.js"><link rel="prefetch" href="/assets/js/420.ab0f7606.js"><link rel="prefetch" href="/assets/js/421.d9d2dc13.js"><link rel="prefetch" href="/assets/js/422.093a8290.js"><link rel="prefetch" href="/assets/js/423.041fc7be.js"><link rel="prefetch" href="/assets/js/424.410b1a8f.js"><link rel="prefetch" href="/assets/js/425.661237bb.js"><link rel="prefetch" href="/assets/js/426.c01ca04f.js"><link rel="prefetch" href="/assets/js/427.af6802e0.js"><link rel="prefetch" href="/assets/js/428.e255a9c4.js"><link rel="prefetch" href="/assets/js/429.3f62c79c.js"><link rel="prefetch" href="/assets/js/43.96eb08e4.js"><link rel="prefetch" href="/assets/js/430.86f8cd5f.js"><link rel="prefetch" href="/assets/js/431.89f717cb.js"><link rel="prefetch" href="/assets/js/432.606f5381.js"><link rel="prefetch" href="/assets/js/433.e2a7c92d.js"><link rel="prefetch" href="/assets/js/434.375d2ee0.js"><link rel="prefetch" href="/assets/js/435.10ac30b9.js"><link rel="prefetch" href="/assets/js/436.dfadd161.js"><link rel="prefetch" href="/assets/js/437.f92a1705.js"><link rel="prefetch" href="/assets/js/438.a924c254.js"><link rel="prefetch" href="/assets/js/439.6a8f7f89.js"><link rel="prefetch" href="/assets/js/44.af0f503b.js"><link rel="prefetch" href="/assets/js/440.6f41f087.js"><link rel="prefetch" href="/assets/js/441.296b6711.js"><link rel="prefetch" href="/assets/js/442.e82e2313.js"><link rel="prefetch" href="/assets/js/443.c46b8b7c.js"><link rel="prefetch" href="/assets/js/444.850b3f10.js"><link rel="prefetch" href="/assets/js/445.70fafa08.js"><link rel="prefetch" href="/assets/js/446.c2fd23e4.js"><link rel="prefetch" href="/assets/js/447.fac66885.js"><link rel="prefetch" href="/assets/js/448.5c8074d5.js"><link rel="prefetch" href="/assets/js/449.25db27ca.js"><link rel="prefetch" href="/assets/js/45.19ecb85c.js"><link rel="prefetch" href="/assets/js/450.8bc58614.js"><link rel="prefetch" href="/assets/js/451.69e35a33.js"><link rel="prefetch" href="/assets/js/452.a129daf9.js"><link rel="prefetch" href="/assets/js/453.4f696672.js"><link rel="prefetch" href="/assets/js/454.e2a1b328.js"><link rel="prefetch" href="/assets/js/455.b7037708.js"><link rel="prefetch" href="/assets/js/456.eda2adc0.js"><link rel="prefetch" href="/assets/js/457.5f0d7722.js"><link rel="prefetch" href="/assets/js/458.effcb970.js"><link rel="prefetch" href="/assets/js/459.48baddfb.js"><link rel="prefetch" href="/assets/js/46.88cbca22.js"><link rel="prefetch" href="/assets/js/460.c50fe2c5.js"><link rel="prefetch" href="/assets/js/461.55293f7a.js"><link rel="prefetch" href="/assets/js/462.682315f0.js"><link rel="prefetch" href="/assets/js/463.f4278aae.js"><link rel="prefetch" href="/assets/js/464.f140b938.js"><link rel="prefetch" href="/assets/js/465.392a08f4.js"><link rel="prefetch" href="/assets/js/466.90a32c46.js"><link rel="prefetch" href="/assets/js/467.d795bc61.js"><link rel="prefetch" href="/assets/js/468.6e663011.js"><link rel="prefetch" href="/assets/js/469.b7bffde5.js"><link rel="prefetch" href="/assets/js/47.7e31de19.js"><link rel="prefetch" href="/assets/js/470.388beea3.js"><link rel="prefetch" href="/assets/js/471.6ca5dbe5.js"><link rel="prefetch" href="/assets/js/472.9bc4c0a6.js"><link rel="prefetch" href="/assets/js/473.fd427e29.js"><link rel="prefetch" href="/assets/js/474.862fc10a.js"><link rel="prefetch" href="/assets/js/475.6e3893de.js"><link rel="prefetch" href="/assets/js/476.0f32dc93.js"><link rel="prefetch" href="/assets/js/477.8cb145a5.js"><link rel="prefetch" href="/assets/js/478.65a09f13.js"><link rel="prefetch" href="/assets/js/479.bee3f754.js"><link rel="prefetch" href="/assets/js/48.ca956f8d.js"><link rel="prefetch" href="/assets/js/480.f59f88af.js"><link rel="prefetch" href="/assets/js/481.8c5e02e6.js"><link rel="prefetch" href="/assets/js/482.7988ca13.js"><link rel="prefetch" href="/assets/js/483.6d1e171c.js"><link rel="prefetch" href="/assets/js/484.b3f3a54b.js"><link rel="prefetch" href="/assets/js/485.e97a72d8.js"><link rel="prefetch" href="/assets/js/49.4cf4b45c.js"><link rel="prefetch" href="/assets/js/50.9fdb4f1e.js"><link rel="prefetch" href="/assets/js/51.88f75159.js"><link rel="prefetch" href="/assets/js/52.1c372af0.js"><link rel="prefetch" href="/assets/js/53.e0e13d9a.js"><link rel="prefetch" href="/assets/js/54.231f6505.js"><link rel="prefetch" href="/assets/js/55.52b04941.js"><link rel="prefetch" href="/assets/js/56.91345e86.js"><link rel="prefetch" href="/assets/js/57.201a710e.js"><link rel="prefetch" href="/assets/js/58.6fb2ccb6.js"><link rel="prefetch" href="/assets/js/59.cb26cb6a.js"><link rel="prefetch" href="/assets/js/60.a5fc202b.js"><link rel="prefetch" href="/assets/js/61.0facb3f9.js"><link rel="prefetch" href="/assets/js/62.d00be571.js"><link rel="prefetch" href="/assets/js/63.d66d194b.js"><link rel="prefetch" href="/assets/js/64.4b34837d.js"><link rel="prefetch" href="/assets/js/65.c5eca227.js"><link rel="prefetch" href="/assets/js/66.f3bb4baa.js"><link rel="prefetch" href="/assets/js/67.4fbce724.js"><link rel="prefetch" href="/assets/js/68.39780014.js"><link rel="prefetch" href="/assets/js/69.523952df.js"><link rel="prefetch" href="/assets/js/7.d893eec0.js"><link rel="prefetch" href="/assets/js/70.33f89cfa.js"><link rel="prefetch" href="/assets/js/72.90caac3a.js"><link rel="prefetch" href="/assets/js/73.2b7012a1.js"><link rel="prefetch" href="/assets/js/74.0076f1ec.js"><link rel="prefetch" href="/assets/js/75.1cbaf5cf.js"><link rel="prefetch" href="/assets/js/76.2461a9e9.js"><link rel="prefetch" href="/assets/js/77.be9e1732.js"><link rel="prefetch" href="/assets/js/78.a4825263.js"><link rel="prefetch" href="/assets/js/79.95c5e105.js"><link rel="prefetch" href="/assets/js/8.acf971e3.js"><link rel="prefetch" href="/assets/js/80.1a7c44e2.js"><link rel="prefetch" href="/assets/js/81.38ee2ba4.js"><link rel="prefetch" href="/assets/js/82.78220668.js"><link rel="prefetch" href="/assets/js/83.3dfead3b.js"><link rel="prefetch" href="/assets/js/84.7f1f743d.js"><link rel="prefetch" href="/assets/js/85.ab59a697.js"><link rel="prefetch" href="/assets/js/86.1888a97f.js"><link rel="prefetch" href="/assets/js/87.149a705f.js"><link rel="prefetch" href="/assets/js/88.8a53e92d.js"><link rel="prefetch" href="/assets/js/89.a68dd87b.js"><link rel="prefetch" href="/assets/js/9.c38b654d.js"><link rel="prefetch" href="/assets/js/90.c70af23c.js"><link rel="prefetch" href="/assets/js/91.58de9211.js"><link rel="prefetch" href="/assets/js/92.697a7ada.js"><link rel="prefetch" href="/assets/js/93.2a27830a.js"><link rel="prefetch" href="/assets/js/94.20be84f6.js"><link rel="prefetch" href="/assets/js/95.bc2120e0.js"><link rel="prefetch" href="/assets/js/96.5b3aa395.js"><link rel="prefetch" href="/assets/js/97.c4a15008.js"><link rel="prefetch" href="/assets/js/98.3e47fdce.js"><link rel="prefetch" href="/assets/js/99.4b101d54.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b8eeafc3.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Cactusli blog" class="logo"> <span class="site-name can-hide">Cactusli blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/Java/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java Study</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/Java/" class="nav-link">Java 基础</a></li><li class="dropdown-subitem"><a href="/note/design-pattern/" class="nav-link">Java 版设计模式</a></li></ul></li><li class="dropdown-item"><h4>阅读源码系列</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/32e50d/" class="nav-link">Spring Boot</a></li><li class="dropdown-subitem"><a href="/pages/d065c4/" class="nav-link">Netty</a></li><li class="dropdown-subitem"><a href="/pages/4d3c7f/" class="nav-link">Dubbo</a></li><li class="dropdown-subitem"><a href="/pages/920e2b/" class="nav-link">搭建rpc框架</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/SpringBoot/" class="nav-link">《SpringBoot教程》</a></li><li class="dropdown-subitem"><a href="/note/Docker/" class="nav-link">《Docker教程》</a></li><li class="dropdown-subitem"><a href="/note/Kubernetes/" class="nav-link">《Kubernetes教程》</a></li><li class="dropdown-subitem"><a href="/note/SpringCloud-febs/" class="nav-link">《SpringCloud微服务权限系统搭建》</a></li><li class="dropdown-subitem"><a href="/note/Netty/" class="nav-link">《Netty教程》</a></li><li class="dropdown-subitem"><a href="/note/Gateway/" class="nav-link">《API网关设计与实践》</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li><li class="dropdown-item"><h4>页面</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="手册" class="dropdown-title"><a href="/manual/" class="link-title">手册</a> <span class="title" style="display:none;">手册</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/d2639c/" class="nav-link">环境配置</a></li><li class="dropdown-item"><!----> <a href="/pages/39e2a1/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">手册记录</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://firework.cloudflaress.eu.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  看烟花
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/706328/" class="nav-link">英语学习</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/lixuanfengs/cactus-vuepress-sc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.statically.io/gh/lixuanfengs/blog-images/master/cactus-blogs/avatar3.gif"> <div class="blogger-info"><h3>Xuan Feng Li</h3> <span>学习老黄牛精神！</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/Java/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java Study</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/Java/" class="nav-link">Java 基础</a></li><li class="dropdown-subitem"><a href="/note/design-pattern/" class="nav-link">Java 版设计模式</a></li></ul></li><li class="dropdown-item"><h4>阅读源码系列</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/32e50d/" class="nav-link">Spring Boot</a></li><li class="dropdown-subitem"><a href="/pages/d065c4/" class="nav-link">Netty</a></li><li class="dropdown-subitem"><a href="/pages/4d3c7f/" class="nav-link">Dubbo</a></li><li class="dropdown-subitem"><a href="/pages/920e2b/" class="nav-link">搭建rpc框架</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/SpringBoot/" class="nav-link">《SpringBoot教程》</a></li><li class="dropdown-subitem"><a href="/note/Docker/" class="nav-link">《Docker教程》</a></li><li class="dropdown-subitem"><a href="/note/Kubernetes/" class="nav-link">《Kubernetes教程》</a></li><li class="dropdown-subitem"><a href="/note/SpringCloud-febs/" class="nav-link">《SpringCloud微服务权限系统搭建》</a></li><li class="dropdown-subitem"><a href="/note/Netty/" class="nav-link">《Netty教程》</a></li><li class="dropdown-subitem"><a href="/note/Gateway/" class="nav-link">《API网关设计与实践》</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li><li class="dropdown-item"><h4>页面</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="手册" class="dropdown-title"><a href="/manual/" class="link-title">手册</a> <span class="title" style="display:none;">手册</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/d2639c/" class="nav-link">环境配置</a></li><li class="dropdown-item"><!----> <a href="/pages/39e2a1/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">手册记录</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://firework.cloudflaress.eu.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  看烟花
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/706328/" class="nav-link">英语学习</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/lixuanfengs/cactus-vuepress-sc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>开发环境配置</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/d2639c/" class="sidebar-link">负载均衡和web服务</a></li><li><a href="/pages/d9927e/" class="sidebar-link">keepalibved安装与使用</a></li><li><a href="/pages/4e44e7/" class="sidebar-link">redis安装部署</a></li><li><a href="/pages/deb0c4/" class="sidebar-link">zookeeper-centos7安装使用</a></li><li><a href="/pages/d2862a/" class="sidebar-link">RabbitMQ学习</a></li><li><a href="/pages/7d1629/" class="sidebar-link">KeepAlived搭建MySQL双主</a></li><li><a href="/pages/75b405/" class="sidebar-link">sql语句的学习</a></li><li><a href="/pages/32abc1/" class="sidebar-link">MySQL8.0主从配置</a></li><li><a href="/pages/95874c/" class="sidebar-link">K8S基础入门</a></li><li><a href="/pages/10a196/" class="sidebar-link">k8s基础命令</a></li><li><a href="/pages/680317/" class="sidebar-link">Kubeadm安装k8s集群</a></li><li><a href="/pages/e6e664/" class="sidebar-link">二进制高可用安装k8集群</a></li><li><a href="/pages/cf68cc/" class="sidebar-link">rancher搭建k8s 集群</a></li><li><a href="/pages/93c7a0/" class="sidebar-link">Oracle 12c安装</a></li><li><a href="/pages/6d00ed/" aria-current="page" class="active sidebar-link">Jenkins+gitlab持续集成学习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/6d00ed/#jenkins部署使用" class="sidebar-link">Jenkins部署使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/6d00ed/#环境的基本概念" class="sidebar-link">环境的基本概念</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#测试环境" class="sidebar-link">测试环境</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#预发布环境" class="sidebar-link">预发布环境</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#生产环境" class="sidebar-link">生产环境</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#预生产与生产的区别" class="sidebar-link">预生产与生产的区别</a></li><li class="sidebar-sub-header level3"><a href="/pages/6d00ed/#什么是代码部署" class="sidebar-link">什么是代码部署</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#手动部署" class="sidebar-link">手动部署</a></li><li class="sidebar-sub-header level3"><a href="/pages/6d00ed/#ci与cd基本概念" class="sidebar-link">CI与CD基本概念</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#什么是持续集成" class="sidebar-link">什么是持续集成</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#什么是集成" class="sidebar-link">什么是集成</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#持续集成" class="sidebar-link">持续集成</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#持续集成的好处" class="sidebar-link">持续集成的好处</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#什么是交付" class="sidebar-link">什么是交付</a></li><li class="sidebar-sub-header level3"><a href="/pages/6d00ed/#git版本控制" class="sidebar-link">git版本控制</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#安装git" class="sidebar-link">安装git</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#初始化仓库" class="sidebar-link">初始化仓库</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#管理目录下的文件状态" class="sidebar-link">管理目录下的文件状态</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#管理文件" class="sidebar-link">管理文件</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#分支命令" class="sidebar-link">分支命令</a></li><li class="sidebar-sub-header level3"><a href="/pages/6d00ed/#gitlab基本介绍" class="sidebar-link">gitlab基本介绍</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#介绍" class="sidebar-link">介绍</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#功能" class="sidebar-link">功能</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#优势" class="sidebar-link">优势</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#gitlab与github的区别" class="sidebar-link">gitlab与github的区别</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#gitlab服务组成" class="sidebar-link">gitlab服务组成</a></li><li class="sidebar-sub-header level3"><a href="/pages/6d00ed/#gitlab安装" class="sidebar-link">gitlab安装</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#gitlab配置" class="sidebar-link">gitlab配置</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#初始化gitlab" class="sidebar-link">初始化gitlab</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#查看gitlab是否启动" class="sidebar-link">查看gitlab是否启动</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#测试访问" class="sidebar-link">测试访问</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#首页" class="sidebar-link">首页</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#开始汉化" class="sidebar-link">开始汉化</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#查看汉化效果" class="sidebar-link">查看汉化效果</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#汉化gitlab组件" class="sidebar-link">汉化gitlab组件</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#停止gitlab" class="sidebar-link">停止gitlab</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#重新启动gitlab" class="sidebar-link">重新启动gitlab</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#gitlab用户" class="sidebar-link">gitlab用户</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#案例1" class="sidebar-link">案例1</a></li><li class="sidebar-sub-header level3"><a href="/pages/6d00ed/#gitlab日常操作" class="sidebar-link">gitlab日常操作</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#关联远程仓库" class="sidebar-link">关联远程仓库</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#新成员加入项目组" class="sidebar-link">新成员加入项目组</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#合并代码" class="sidebar-link">合并代码</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#gitlab备份" class="sidebar-link">gitlab备份</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#gitlab恢复数据" class="sidebar-link">gitlab恢复数据</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#恢复成功" class="sidebar-link">恢复成功</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#gitlab迁移和升级" class="sidebar-link">gitlab迁移和升级</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#升级成功" class="sidebar-link">升级成功</a></li><li class="sidebar-sub-header level3"><a href="/pages/6d00ed/#jenkins的学习" class="sidebar-link">Jenkins的学习</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#什么是jenkins" class="sidebar-link">什么是Jenkins</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#部署安装" class="sidebar-link">部署安装</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#配置jenkins" class="sidebar-link">配置jenkins</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#启动jenkins" class="sidebar-link">启动jenkins</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#访问jenkins" class="sidebar-link">访问jenkins</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#查看admin的密码" class="sidebar-link">查看admin的密码</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#首页-2" class="sidebar-link">首页</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#优化jenkins" class="sidebar-link">优化jenkins</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#安装中文插件" class="sidebar-link">安装中文插件</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#创建一个项目" class="sidebar-link">创建一个项目</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#集成gitlab获取代码" class="sidebar-link">集成gitlab获取代码</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#创建项目" class="sidebar-link">创建项目</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#开始构建" class="sidebar-link">开始构建</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#集成shell部署代码" class="sidebar-link">集成shell部署代码</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#构建" class="sidebar-link">构建</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#集成ansible" class="sidebar-link">集成ansible</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#安装ansible" class="sidebar-link">安装ansible</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#配置清单" class="sidebar-link">配置清单</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#编写测试的playbook" class="sidebar-link">编写测试的playbook</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#创建项目调用ansible" class="sidebar-link">创建项目调用ansible</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#构建成功" class="sidebar-link">构建成功</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#基于shell构建ci实践" class="sidebar-link">基于shell构建ci实践</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#架构图" class="sidebar-link">架构图</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#搭建测试环境" class="sidebar-link">搭建测试环境</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#手动部署代码" class="sidebar-link">手动部署代码</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#实现shell自动部署" class="sidebar-link">实现shell自动部署</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#jenkins调用ansible" class="sidebar-link">jenkins调用ansible</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#整体思路" class="sidebar-link">整体思路</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#定义主机清单文件" class="sidebar-link">定义主机清单文件</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#playbook脚本" class="sidebar-link">playbook脚本</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#定时构建" class="sidebar-link">定时构建</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#scm轮询" class="sidebar-link">SCM轮询</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#wobhook" class="sidebar-link">wobhook</a></li><li class="sidebar-sub-header level3"><a href="/pages/6d00ed/#集成java-maven实践" class="sidebar-link">集成java maven实践</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#架构图-2" class="sidebar-link">架构图</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#基础环境搭建" class="sidebar-link">基础环境搭建</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#haproxy" class="sidebar-link">haproxy</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#部署tomcat" class="sidebar-link">部署tomcat</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#手动实现war包的ci" class="sidebar-link">手动实现war包的CI</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#上传源码包" class="sidebar-link">上传源码包</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#创建gitlab仓库" class="sidebar-link">创建gitlab仓库</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#拉取代码" class="sidebar-link">拉取代码</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#安装maven" class="sidebar-link">安装maven</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#配置maven" class="sidebar-link">配置maven</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#编译项目" class="sidebar-link">编译项目</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#部署代码" class="sidebar-link">部署代码</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#访问" class="sidebar-link">访问</a></li><li class="sidebar-sub-header level3"><a href="/pages/6d00ed/#自动实现war包项目的ci" class="sidebar-link">自动实现war包项目的CI</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#配置jenkins集成maven" class="sidebar-link">配置jenkins集成Maven</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#创建一个manven项目" class="sidebar-link">创建一个Manven项目</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#添加jdk参数" class="sidebar-link">添加jdk参数</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#添加maven参数" class="sidebar-link">添加maven参数</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#开始新建项目" class="sidebar-link">开始新建项目</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#编写shell脚本" class="sidebar-link">编写shell脚本</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#部署结果" class="sidebar-link">部署结果</a></li><li class="sidebar-sub-header level3"><a href="/pages/6d00ed/#自动实现war包部署-ansible" class="sidebar-link">自动实现war包部署-ansible</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#新建项目" class="sidebar-link">新建项目</a></li><li class="sidebar-sub-header level3"><a href="/pages/6d00ed/#集成nexus制品库" class="sidebar-link">集成Nexus制品库</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#nexus介绍" class="sidebar-link">Nexus介绍</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#优点" class="sidebar-link">优点</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#nexus安装" class="sidebar-link">Nexus安装</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#nexus仓库" class="sidebar-link">Nexus仓库</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#nexus启动" class="sidebar-link">Nexus启动</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#访问-2" class="sidebar-link">访问</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#配置nexus-web界面" class="sidebar-link">配置Nexus WEB界面</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#配置maven连接nexus" class="sidebar-link">配置maven连接Nexus</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#上传war包到nexus" class="sidebar-link">上传war包到Nexus</a></li><li class="sidebar-sub-header level3"><a href="/pages/6d00ed/#jenkins实现war包的ci与cd" class="sidebar-link">Jenkins实现war包的CI与CD</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#编写shell脚本-ci" class="sidebar-link">编写shell脚本（CI）</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#基于nexus实现自动ci" class="sidebar-link">基于Nexus实现自动CI</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#基于nexus实现cd任务" class="sidebar-link">基于Nexus实现CD任务</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#测试是否能连接" class="sidebar-link">测试是否能连接</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#编写shell脚本-2" class="sidebar-link">编写shell脚本</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#基于ansible实现部署" class="sidebar-link">基于ansible实现部署</a></li><li class="sidebar-sub-header level3"><a href="/pages/6d00ed/#实现jar包的ci与cd" class="sidebar-link">实现jar包的CI与CD</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#gitlab项目创建" class="sidebar-link">gitlab项目创建</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#创建ci" class="sidebar-link">创建CI</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#ci的shell脚本" class="sidebar-link">ci的shell脚本</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#负载均衡配置" class="sidebar-link">负载均衡配置</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#创建cd" class="sidebar-link">创建CD</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#shell脚本" class="sidebar-link">shell脚本</a></li><li class="sidebar-sub-header level3"><a href="/pages/6d00ed/#sonarqube" class="sidebar-link">SonarQube</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#sonarqube基本介绍" class="sidebar-link">SonarQube基本介绍</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#使用sonarqube前提" class="sidebar-link">使用Sonarqube前提</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#服务安装" class="sidebar-link">服务安装</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#安装sonarqube" class="sidebar-link">安装Sonarqube</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#修改sonarqube配置文件" class="sidebar-link">修改Sonarqube配置文件</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#启动sonarqube" class="sidebar-link">启动Sonarqube</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#访问sonarqube" class="sidebar-link">访问Sonarqube</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#生产token令牌" class="sidebar-link">生产token令牌</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#联网安装插件" class="sidebar-link">联网安装插件</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#jenkins集成sonarqube" class="sidebar-link">jenkins集成SonarQube</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#配置jenkins集成sonarqube" class="sidebar-link">配置jenkins集成sonarqube</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#集成sonar-scanner" class="sidebar-link">集成sonar-scanner</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#自动化部署测试环境" class="sidebar-link">自动化部署测试环境</a></li><li class="sidebar-sub-header level3"><a href="/pages/6d00ed/#项目通知阶段" class="sidebar-link">项目通知阶段</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#安装插件" class="sidebar-link">安装插件</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#配置钉钉" class="sidebar-link">配置钉钉</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#jenkins集成钉钉" class="sidebar-link">jenkins集成钉钉</a></li><li class="sidebar-sub-header level5"><a href="/pages/6d00ed/#添加机器人成功" class="sidebar-link">添加机器人成功</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#为项目添加机器人" class="sidebar-link">为项目添加机器人</a></li><li class="sidebar-sub-header level3"><a href="/pages/6d00ed/#权限管理" class="sidebar-link">权限管理</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#基本概念" class="sidebar-link">基本概念</a></li><li class="sidebar-sub-header level4"><a href="/pages/6d00ed/#全局角色配置实例" class="sidebar-link">全局角色配置实例</a></li></ul></li></ul></li><li><a href="/pages/528e32/" class="sidebar-link">CloudFlare Argo Tunnel免费内网穿透</a></li><li><a href="/pages/8ff689/" class="sidebar-link">Linux使用WireGuard来创建内网</a></li><li><a href="/pages/830e28/" class="sidebar-link">利用Cloudflare Zero Trust创建大内网</a></li><li><a href="/pages/a51cd8/" class="sidebar-link">Docker 相关的 Shell</a></li><li><a href="/pages/c7703f/" class="sidebar-link">VM虚拟机Ubuntu 20.04 LVM磁盘扩容</a></li><li><a href="/pages/118ac7/" class="sidebar-link">深圳仪器平台-开发手册记录</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GitHub技巧</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>博客搭建</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>手册记录</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/manual/#手册" data-v-06225672>手册</a></li><li data-v-06225672><a href="/manual/#开发环境配置" data-v-06225672>开发环境配置</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/lixuanfengs" target="_blank" title="作者" class="beLink" data-v-06225672>cactusli</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-08-16</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><!---->Jenkins+gitlab持续集成学习<!----></h1>  <div class="theme-vdoing-content content__default"><h2 id="jenkins部署使用"><a href="#jenkins部署使用" class="header-anchor">#</a> Jenkins部署使用</h2> <h3 id="环境的基本概念"><a href="#环境的基本概念" class="header-anchor">#</a> 环境的基本概念</h3> <p>一个软件产品从开发到用户使用涉及的开发环境、测试环境、预发布环境、生产环境;</p> <h4 id="测试环境"><a href="#测试环境" class="header-anchor">#</a> 测试环境</h4> <p>测试环境:一般会由测试人员来部署,然后将开发好的代码在此环境中进行集中测试;</p> <h4 id="预发布环境"><a href="#预发布环境" class="header-anchor">#</a> 预发布环境</h4> <p>预发布环境:测试环境到生产环境的过渡</p> <p>测试环境可能无法与生产环境保持高度一致,从而能够测试的数据不够完整,会造成很多流程没有测试到位,</p> <p>就可以在预发布环境进行测试,从而保证产品上线质量</p> <h4 id="生产环境"><a href="#生产环境" class="header-anchor">#</a> 生产环境</h4> <p>生产环境:即线上环境,对外提供给用户使用的环境,由运维人员来维护,其他人员几乎无权限</p> <h4 id="预生产与生产的区别"><a href="#预生产与生产的区别" class="header-anchor">#</a> 预生产与生产的区别</h4> <p>1、预发布环境中新功能为最新代码,其他功能代码和生产环境一致</p> <p>2、预发布环境和生产环境的访问域名不同</p> <p>注意事项:预发布环境一般会连接生产环境的数据库,测试时要注意.以免产生脏数据,从而影响生产环境</p> <h3 id="什么是代码部署"><a href="#什么是代码部署" class="header-anchor">#</a> 什么是代码部署</h3> <p>代码发布是指将开发写好的代码部署至指定的web服务器,然后对外提供服务</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639537901616-b43b0e94-b183-403d-83d6-4cad3f90f103.png" alt="img"></p> <p>只不过在部署的过程可以选择手动部署,自动部署</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639537953548-b498209a-65f7-4e2d-ae71-67ab4e4d2e91.png" alt="img"></p> <h4 id="手动部署"><a href="#手动部署" class="header-anchor">#</a> 手动部署</h4> <ul><li><p>手动发布有如下几种方式</p></li> <li><ul><li>开发通过QQ、weixin发送代码压缩包,rz上传,解压部署</li> <li>scp方式上线代码,xftp方式上线代码</li> <li>登录代码托管平台,手动执行git clone</li></ul></li> <li><p>手动上线的缺点</p></li> <li><ul><li>全程运维参与,占用大量时间</li> <li>如果节点多,上线速度慢</li> <li>人为失误多,目录管理混乱</li> <li>回滚不及时或者难以回滚</li></ul></li></ul> <h3 id="ci与cd基本概念"><a href="#ci与cd基本概念" class="header-anchor">#</a> CI与CD基本概念</h3> <h4 id="什么是持续集成"><a href="#什么是持续集成" class="header-anchor">#</a> 什么是持续集成</h4> <h5 id="什么是集成"><a href="#什么是集成" class="header-anchor">#</a> 什么是集成</h5> <p>在实际的软件开发中,常常会有如下两种场景:</p> <p>1、现在有一个电商平台需要开发,由于平台需要开发的模块较多,此时就需要不同的开发人员开发不同的模块,最后将所有人开发好的代码集成到一个系统中,集成完毕后需要对其进行部署上线</p> <p>2、随着时间的推移,该系统无论是bug修复、还是新功能开发,后续都需要对系统进行不断的更新迭代</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639543634667-1bd28530-ca1f-40ec-abd7-7a7fd808f099.png" alt="img"></p> <h5 id="持续集成"><a href="#持续集成" class="header-anchor">#</a> 持续集成</h5> <p>持续集成指的是,频繁地(一天多次)将代码集成到主干(重复如上集成的工作)</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639544181493-e6c213d1-bb0f-4313-8512-436c0337e19e.png" alt="img"></p> <h5 id="持续集成的好处"><a href="#持续集成的好处" class="header-anchor">#</a> 持续集成的好处</h5> <p>1、快速发现错误,(每完成一点更新就集成到主干,可以快速发现错误,定位错误也比较容易)</p> <p>2、节省人力成本</p> <p>3、加快软件开发进度</p> <p>使用持续集成能简化我们的工作,同时还能让我们的产品快速迭代,并且保持高质量的产出</p> <h4 id="什么是交付"><a href="#什么是交付" class="header-anchor">#</a> 什么是交付</h4> <p>持续交付:代码开发-&gt;单元测试-&gt;合并代码-&gt;测试-&gt;部署到预生产环境-&gt;交付给测试团队(不间断执行)</p> <h3 id="git版本控制"><a href="#git版本控制" class="header-anchor">#</a> git版本控制</h3> <h4 id="安装git"><a href="#安装git" class="header-anchor">#</a> 安装git</h4> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># yum -y  install git</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="初始化仓库"><a href="#初始化仓库" class="header-anchor">#</a> 初始化仓库</h4> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git init</span>
Initialized empty Git repository <span class="token keyword">in</span> <span class="token operator">/</span>root<span class="token operator">/</span>xiaomao<span class="token operator">/</span><span class="token punctuation">.</span>git<span class="token operator">/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="管理目录下的文件状态"><a href="#管理目录下的文件状态" class="header-anchor">#</a> 管理目录下的文件状态</h4> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git status</span>
<span class="token comment"># On branch master</span>
<span class="token comment">#</span>
<span class="token comment"># Initial commit</span>
<span class="token comment">#</span>
<span class="token comment"># Untracked files:</span>
<span class="token comment">#   (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span>
<span class="token comment">#</span>
<span class="token comment">#       index.html</span>
nothing added to commit but untracked files present <span class="token punctuation">(</span>use <span class="token string">&quot;git add&quot;</span> to track<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="管理文件"><a href="#管理文件" class="header-anchor">#</a> 管理文件</h4> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 提交文件</span>
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git add index.html</span>
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git config --global user.email &quot;you@example.com&quot;</span>
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git config --global user.name &quot;Your Name&quot;</span>
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git commit -m &quot;短视频开发完成百分之20% -- v1&quot;</span>
<span class="token punctuation">[</span>master <span class="token punctuation">(</span>root<span class="token operator">-</span>commit<span class="token punctuation">)</span> 3434c5e<span class="token punctuation">]</span> 短视频开发完成百分之<span class="token number">20</span><span class="token operator">%</span> <span class="token operator">-</span><span class="token operator">-</span> v1
 <span class="token number">1</span> <span class="token builtin">file</span> changed<span class="token punctuation">,</span> <span class="token number">1</span> insertion<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span>
 create mode <span class="token number">100644</span> index<span class="token punctuation">.</span>html
<span class="token comment"># 查看代码提交情况</span>
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git log</span>
commit 3434c5e10d0bfeba4c4e414a73ab6e72ade5a34f
Author<span class="token punctuation">:</span> Your Name <span class="token operator">&lt;</span>you@example<span class="token punctuation">.</span>com<span class="token operator">&gt;</span>
Date<span class="token punctuation">:</span>   Wed Dec <span class="token number">15</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">53</span><span class="token punctuation">:</span><span class="token number">53</span> <span class="token number">2021</span> <span class="token operator">+</span><span class="token number">0800</span>

    短视频开发完成百分之<span class="token number">20</span><span class="token operator">%</span> <span class="token operator">-</span><span class="token operator">-</span> v1
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git add  .</span>
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git commit -m &quot;约功能上线了   --v3&quot;</span>
<span class="token punctuation">[</span>master c521947<span class="token punctuation">]</span> 约功能上线了   <span class="token operator">-</span><span class="token operator">-</span>v3
 <span class="token number">1</span> <span class="token builtin">file</span> changed<span class="token punctuation">,</span> <span class="token number">3</span> insertions<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span>
<span class="token comment"># 代码回退</span>
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git reset --hard 3434c5e10d0b</span>
HEAD <span class="token keyword">is</span> now at 3434c5e 短视频开发完成百分之<span class="token number">20</span><span class="token operator">%</span> <span class="token operator">-</span><span class="token operator">-</span> v1
<span class="token comment"># 回退到第二次提交</span>
<span class="token comment"># 查看历史提交Log</span>
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git reflog</span>
3434c5e HEAD@<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">:</span> reset<span class="token punctuation">:</span> moving to 3434c5e10d0b
c521947 HEAD@<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">:</span> commit<span class="token punctuation">:</span> 约功能上线了 <span class="token operator">-</span><span class="token operator">-</span>v3
3434c5e HEAD@<span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">:</span> commit <span class="token punctuation">(</span>initial<span class="token punctuation">)</span><span class="token punctuation">:</span> 短视频开发完成百分之<span class="token number">20</span><span class="token operator">%</span> <span class="token operator">-</span><span class="token operator">-</span> v1
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git reset --hard c521947</span>
HEAD <span class="token keyword">is</span> now at c521947 约功能上线了   <span class="token operator">-</span><span class="token operator">-</span>v3
<span class="token comment"># 查看代码</span>
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># cat index.html</span>
<span class="token number">1.</span> 编写短视频功能完成百分之<span class="token number">20</span>
<span class="token number">2.</span> 编写短视频功能完成百分之<span class="token number">30</span>
<span class="token number">3.</span> 约功能上线了
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h4 id="分支命令"><a href="#分支命令" class="header-anchor">#</a> 分支命令</h4> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 查看分支</span>
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git branch</span>
<span class="token operator">*</span> master
<span class="token comment"># 创建分支</span>
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git branch dev</span>
<span class="token comment"># 切换分支</span>
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git checkout dev</span>
Switched to branch <span class="token string">'dev'</span>
<span class="token comment"># 合并分支</span>
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git branch bug</span>
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git checkout bug</span>
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># cat index.html</span>
<span class="token number">1.</span> 编写短视频功能完成百分之<span class="token number">20</span>
<span class="token number">2.</span> 编写短视频功能完成百分之<span class="token number">30</span>
<span class="token number">3.</span> 约功能上线了
<span class="token number">4.</span> 约功能上线了<span class="token operator">-</span>bug分支
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span> 开始操作合并分支 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git checkout master</span>
Switched to branch <span class="token string">'master'</span>
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git merge bug</span>
Updating c521947<span class="token punctuation">.</span><span class="token punctuation">.</span>cfc4355
Fast<span class="token operator">-</span>forward
 index<span class="token punctuation">.</span>html <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">+</span>
 show<span class="token punctuation">.</span>py    <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">+</span><span class="token operator">+</span>
 <span class="token number">2</span> files changed<span class="token punctuation">,</span> <span class="token number">3</span> insertions<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span>
 create mode <span class="token number">100644</span> show<span class="token punctuation">.</span>py
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># cat index.html</span>
<span class="token number">1.</span> 编写短视频功能完成百分之<span class="token number">20</span>
<span class="token number">2.</span> 编写短视频功能完成百分之<span class="token number">30</span>
<span class="token number">3.</span> 约功能上线了
<span class="token number">4.</span> 约功能上线了<span class="token operator">-</span>bug分支

<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git branch</span>
  bug
  dev
<span class="token operator">*</span> master
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h3 id="gitlab基本介绍"><a href="#gitlab基本介绍" class="header-anchor">#</a> gitlab基本介绍</h3> <h4 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h4> <p>GitLab 是一个用于仓库管理系统的开源项目，使用<a href="https://baike.baidu.com/item/Git" target="_blank" rel="noopener noreferrer">Git<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>作为代码管理工具，并在此基础上搭建起来的Web服务</p> <h4 id="功能"><a href="#功能" class="header-anchor">#</a> 功能</h4> <p>1、管理项目源代码</p> <p>2、对源代码进行版本控制</p> <h4 id="优势"><a href="#优势" class="header-anchor">#</a> 优势</h4> <p>1、开源免费,搭建简单,维护成本较低、适合中小型公司</p> <p>2、权限管理,能实现代码对部分人可见,确保项目的安全性</p> <p>3、离线同步,保证我们不在实时依赖网络环境进行代码提交</p> <h4 id="gitlab与github的区别"><a href="#gitlab与github的区别" class="header-anchor">#</a> gitlab与github的区别</h4> <p>1、相同点:两者都是提供代码托管服务,在很大程度上Gitlab是仿照github来做的</p> <p>2、不同点:github创建私有仓库收费,gitlab创建私有仓库免费</p> <h4 id="gitlab服务组成"><a href="#gitlab服务组成" class="header-anchor">#</a> gitlab服务组成</h4> <p>gitlab作为一个分布式代码托管软件,它必然有相关的服务组件去支持这个庞大系统</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639579762815-9a9dd4bd-71ab-4363-9704-dda190aa8e57.png" alt="img"></p> <p><strong>1、nginx:作为gitlab的proxy代理,处理http/https以及静态资源访问请求</strong></p> <p><strong>2、gitlab-workhorse:用于处理文件上传和下载</strong></p> <p><strong>3、gitlab-shell:用于处理日志的切割和打包等操作</strong></p> <p><strong>4、postgresql:用于保存所有的gitlab数据相关信息</strong></p> <p><strong>5、redis:用于缓存数据库的信息,加快前台访问速度,以及交互读写</strong></p> <p><strong>6</strong>**、<strong><strong>sidekiq</strong></strong>：用于在后台执行队列任务（异步执行）。**</p> <p><strong>7</strong>**、**<strong>unicorn：An HTTP server for Rack applications，GitLab Rails应用是托管在这个服务器上面的</strong></p> <h3 id="gitlab安装"><a href="#gitlab安装" class="header-anchor">#</a> gitlab安装</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># yum -y install gitlab-ce-12.3.9-ce.0.el7.x86_64.rpm</span>

       <span class="token operator">*</span><span class="token punctuation">.</span>                  <span class="token operator">*</span><span class="token punctuation">.</span>
      <span class="token operator">**</span><span class="token operator">*</span>                 <span class="token operator">**</span><span class="token operator">*</span>
     <span class="token operator">**</span><span class="token operator">**</span><span class="token operator">*</span>               <span class="token operator">**</span><span class="token operator">**</span><span class="token operator">*</span>
    <span class="token punctuation">.</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span>             <span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">*</span>
    <span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span>            <span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span>
   <span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">*</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span>
  <span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">*</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span>
  <span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">*</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span>
      <span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">*</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">.</span>
         <span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token operator">**</span><span class="token operator">**</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span>
            <span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token operator">**</span><span class="token operator">*</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span>
                <span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">,</span><span class="token punctuation">.</span>



     _______ __  __          __
    <span class="token operator">/</span> ____<span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">/</span>_<span class="token operator">/</span> <span class="token operator">/</span>   ____ _<span class="token operator">/</span> <span class="token operator">/</span>_
   <span class="token operator">/</span> <span class="token operator">/</span> __<span class="token operator">/</span> <span class="token operator">/</span> __<span class="token operator">/</span> <span class="token operator">/</span>   <span class="token operator">/</span> __ `<span class="token operator">/</span> __ \
  <span class="token operator">/</span> <span class="token operator">/</span>_<span class="token operator">/</span> <span class="token operator">/</span> <span class="token operator">/</span> <span class="token operator">/</span>_<span class="token operator">/</span> <span class="token operator">/</span>___<span class="token operator">/</span> <span class="token operator">/</span>_<span class="token operator">/</span> <span class="token operator">/</span> <span class="token operator">/</span>_<span class="token operator">/</span> <span class="token operator">/</span>
  \____<span class="token operator">/</span>_<span class="token operator">/</span>\__<span class="token operator">/</span>_____<span class="token operator">/</span>\__<span class="token punctuation">,</span>_<span class="token operator">/</span>_<span class="token punctuation">.</span>___<span class="token operator">/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="gitlab配置"><a href="#gitlab配置" class="header-anchor">#</a> gitlab配置</h4> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># vim /etc/gitlab/gitlab.rb</span>
<span class="token comment"># 配置邮箱 </span>
gitlab_rails<span class="token punctuation">[</span><span class="token string">'gitlab_email_enabled'</span><span class="token punctuation">]</span> <span class="token operator">=</span> true
gitlab_rails<span class="token punctuation">[</span><span class="token string">'gitlab_email_from'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'1249796886@qq.com'</span>
gitlab_rails<span class="token punctuation">[</span><span class="token string">'gitlab_email_display_name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'GitLAB-Admin'</span>
<span class="token comment"># 配置smtp</span>
gitlab_rails<span class="token punctuation">[</span><span class="token string">'smtp_enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span> true
gitlab_rails<span class="token punctuation">[</span><span class="token string">'smtp_address'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;smtp.qq.com&quot;</span>
gitlab_rails<span class="token punctuation">[</span><span class="token string">'smtp_port'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">465</span>
gitlab_rails<span class="token punctuation">[</span><span class="token string">'smtp_user_name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;1249796886@qq.com&quot;</span>
gitlab_rails<span class="token punctuation">[</span><span class="token string">'smtp_password'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;kxegpodbopkkgafc&quot;</span>
gitlab_rails<span class="token punctuation">[</span><span class="token string">'smtp_domain'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;qq.com&quot;</span>
gitlab_rails<span class="token punctuation">[</span><span class="token string">'smtp_authentication'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;login&quot;</span>
gitlab_rails<span class="token punctuation">[</span><span class="token string">'smtp_enable_starttls_auto'</span><span class="token punctuation">]</span> <span class="token operator">=</span> true
gitlab_rails<span class="token punctuation">[</span><span class="token string">'smtp_tls'</span><span class="token punctuation">]</span> <span class="token operator">=</span> true
<span class="token comment"># 配置域名</span>
external_url <span class="token string">'http://www.xiaomao.com'</span>
<span class="token comment"># 关闭不需要使用gitlab组件</span>
<span class="token number">1460</span> prometheus<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span> false
<span class="token number">1461</span> prometheus<span class="token punctuation">[</span><span class="token string">'monitor_kubernetes'</span><span class="token punctuation">]</span> <span class="token operator">=</span> false
<span class="token number">1528</span> alertmanager<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span> false
<span class="token number">1550</span> node_exporter<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span> false
<span class="token number">1569</span> redis_exporter<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span> false
<span class="token number">1587</span> postgres_exporter<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span> false
<span class="token number">1616</span> gitlab_exporter<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span> false
<span class="token number">1636</span> grafana<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span> false
<span class="token number">1629</span> prometheus_monitoring<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span> false
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h4 id="初始化gitlab"><a href="#初始化gitlab" class="header-anchor">#</a> 初始化gitlab</h4> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@xiaomao8 gitlab<span class="token punctuation">]</span><span class="token comment"># cd /var/opt/gitlab</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># gitlab-ctl  reconfigure</span>
<span class="token operator">-</span> restart service service<span class="token punctuation">[</span>gitaly<span class="token punctuation">]</span>
Recipe<span class="token punctuation">:</span> gitaly<span class="token punctuation">:</span><span class="token punctuation">:</span>enable
  <span class="token operator">*</span> runit_service<span class="token punctuation">[</span>gitaly<span class="token punctuation">]</span> action hup
    <span class="token operator">-</span> send hup to runit_service<span class="token punctuation">[</span>gitaly<span class="token punctuation">]</span>
Recipe<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Dynamically Defined Resource<span class="token operator">&gt;</span>
  <span class="token operator">*</span> service<span class="token punctuation">[</span>gitlab<span class="token operator">-</span>workhorse<span class="token punctuation">]</span> action restart
    <span class="token operator">-</span> restart service service<span class="token punctuation">[</span>gitlab<span class="token operator">-</span>workhorse<span class="token punctuation">]</span>

Running handlers<span class="token punctuation">:</span>
Running handlers complete
Chef Client finished<span class="token punctuation">,</span> <span class="token number">354</span><span class="token operator">/</span><span class="token number">899</span> resources updated <span class="token keyword">in</span> <span class="token number">01</span> minutes <span class="token number">32</span> seconds
gitlab Reconfigured!
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="查看gitlab是否启动"><a href="#查看gitlab是否启动" class="header-anchor">#</a> 查看gitlab是否启动</h4> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># gitlab-ctl  status</span>
run<span class="token punctuation">:</span> gitaly<span class="token punctuation">:</span> <span class="token punctuation">(</span>pid <span class="token number">14329</span><span class="token punctuation">)</span> 154s<span class="token punctuation">;</span> run<span class="token punctuation">:</span> log<span class="token punctuation">:</span> <span class="token punctuation">(</span>pid <span class="token number">13976</span><span class="token punctuation">)</span> 223s
run<span class="token punctuation">:</span> gitlab<span class="token operator">-</span>workhorse<span class="token punctuation">:</span> <span class="token punctuation">(</span>pid <span class="token number">14354</span><span class="token punctuation">)</span> 154s<span class="token punctuation">;</span> run<span class="token punctuation">:</span> log<span class="token punctuation">:</span> <span class="token punctuation">(</span>pid <span class="token number">14212</span><span class="token punctuation">)</span> 174s
run<span class="token punctuation">:</span> logrotate<span class="token punctuation">:</span> <span class="token punctuation">(</span>pid <span class="token number">14236</span><span class="token punctuation">)</span> 168s<span class="token punctuation">;</span> run<span class="token punctuation">:</span> log<span class="token punctuation">:</span> <span class="token punctuation">(</span>pid <span class="token number">14251</span><span class="token punctuation">)</span> 167s
run<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span> <span class="token punctuation">(</span>pid <span class="token number">14206</span><span class="token punctuation">)</span> 174s<span class="token punctuation">;</span> run<span class="token punctuation">:</span> log<span class="token punctuation">:</span> <span class="token punctuation">(</span>pid <span class="token number">14228</span><span class="token punctuation">)</span> 173s
run<span class="token punctuation">:</span> postgresql<span class="token punctuation">:</span> <span class="token punctuation">(</span>pid <span class="token number">13984</span><span class="token punctuation">)</span> 220s<span class="token punctuation">;</span> run<span class="token punctuation">:</span> log<span class="token punctuation">:</span> <span class="token punctuation">(</span>pid <span class="token number">13996</span><span class="token punctuation">)</span> 216s
run<span class="token punctuation">:</span> redis<span class="token punctuation">:</span> <span class="token punctuation">(</span>pid <span class="token number">13826</span><span class="token punctuation">)</span> 232s<span class="token punctuation">;</span> run<span class="token punctuation">:</span> log<span class="token punctuation">:</span> <span class="token punctuation">(</span>pid <span class="token number">13838</span><span class="token punctuation">)</span> 229s
run<span class="token punctuation">:</span> sidekiq<span class="token punctuation">:</span> <span class="token punctuation">(</span>pid <span class="token number">14173</span><span class="token punctuation">)</span> 181s<span class="token punctuation">;</span> run<span class="token punctuation">:</span> log<span class="token punctuation">:</span> <span class="token punctuation">(</span>pid <span class="token number">14191</span><span class="token punctuation">)</span> 178s
run<span class="token punctuation">:</span> unicorn<span class="token punctuation">:</span> <span class="token punctuation">(</span>pid <span class="token number">14142</span><span class="token punctuation">)</span> 187s<span class="token punctuation">;</span> run<span class="token punctuation">:</span> log<span class="token punctuation">:</span> <span class="token punctuation">(</span>pid <span class="token number">14169</span><span class="token punctuation">)</span> 184s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="测试访问"><a href="#测试访问" class="header-anchor">#</a> 测试访问</h4> <p>第一步就是修改密码</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639624676640-7ece2735-8a19-4399-948f-8091e2e6031f.png" alt="img"></p> <h4 id="首页"><a href="#首页" class="header-anchor">#</a> 首页</h4> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639624802239-df2ac52b-e6b4-425e-b57b-b20abbbaf356.png" alt="img"></p> <h4 id="开始汉化"><a href="#开始汉化" class="header-anchor">#</a> 开始汉化</h4> <p>点击setting--&gt;Preferences---&gt;Logcalization---&gt;选择简体中文</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639625071276-cc3a6cf9-c81b-41b5-bffa-ffb0782a2bba.png" alt="img"></p> <h4 id="查看汉化效果"><a href="#查看汉化效果" class="header-anchor">#</a> 查看汉化效果</h4> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639625148659-48f9cef1-6148-4923-856e-85df96895001.png" alt="img"></p> <h4 id="汉化gitlab组件"><a href="#汉化gitlab组件" class="header-anchor">#</a> 汉化gitlab组件</h4> <h5 id="停止gitlab"><a href="#停止gitlab" class="header-anchor">#</a> 停止gitlab</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># gitlab-ctl stop</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># unzip gitlab-v12.3.0-zh.zip</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># \cp -r gitlab-v12.3.0-zh/*  /opt/gitlab/embedded/service/gitlab-rails/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="重新启动gitlab"><a href="#重新启动gitlab" class="header-anchor">#</a> 重新启动gitlab</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># gitlab-ctl reconfigure</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># gitlab-ctl restart</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639626645551-002187b7-549b-4735-9025-2b8aded7f013.png" alt="img"></p> <h4 id="gitlab用户"><a href="#gitlab用户" class="header-anchor">#</a> gitlab用户</h4> <p>gitlab中的用户、用户组、项目仓库之间的关系是什么样的?</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639627066947-6546c473-9670-426c-93e0-345039ebb672.png" alt="img"></p> <p>注意:</p> <p>​      1、如果使用user创建一个仓库,那么这个用户就是这个仓库的owner</p> <p>​      2、如果使用group创建一个仓库,那么这个组下面添加的所有用户就是这个仓库的owner</p> <h5 id="案例1"><a href="#案例1" class="header-anchor">#</a> 案例1</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code>验证项目是不是隶属于该组的成员才可以看见<span class="token punctuation">:</span>
<span class="token number">1</span>、首先创建dev、ops两个组
<span class="token number">2</span>、然后基于组创建两个项目
<span class="token number">3</span>、最后创建用户、为用户分配组、以及组中的身份
<span class="token comment"># 创建组</span>
管理中心<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>仪表板<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>群组<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>新建群组
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639635925634-308c5786-ee12-47c5-8be8-8566cbcf6283.png" alt="img"></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 创建项目</span>
管理中心<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>仪表板<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>Projects<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>新建项目
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639636117648-38de6276-6d8a-4303-b1df-a2c034f8fe83.png" alt="img"></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 创建项目</span>
管理中心<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>仪表板<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>用户<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>新建用户
<span class="token comment"># 用户加入组</span>
管理中心<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>仪表板<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>群组<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>选择对应的群组
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639636637434-20e436ff-eebd-4610-94a9-c7652ddd46fd.png" alt="img"></p> <h3 id="gitlab日常操作"><a href="#gitlab日常操作" class="header-anchor">#</a> gitlab日常操作</h3> <h4 id="关联远程仓库"><a href="#关联远程仓库" class="header-anchor">#</a> 关联远程仓库</h4> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># mkdir shopping</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># cd shopping/</span>
<span class="token punctuation">[</span>root@xiaomao8 shopping<span class="token punctuation">]</span><span class="token comment"># git init</span>
Initialized empty Git repository <span class="token keyword">in</span> <span class="token operator">/</span>root<span class="token operator">/</span>shopping<span class="token operator">/</span><span class="token punctuation">.</span>git<span class="token operator">/</span>
<span class="token punctuation">[</span>root@xiaomao8 shopping<span class="token punctuation">]</span><span class="token comment"># cat README.md</span>
<span class="token number">1.</span>商城
<span class="token number">2.</span>美妆
<span class="token number">3.</span>视频
<span class="token punctuation">[</span>root@xiaomao8 shopping<span class="token punctuation">]</span><span class="token comment"># git add .</span>
<span class="token punctuation">[</span>root@xiaomao8 shopping<span class="token punctuation">]</span><span class="token comment"># git commit -m &quot;v1&quot;</span>
<span class="token punctuation">[</span>master <span class="token punctuation">(</span>root<span class="token operator">-</span>commit<span class="token punctuation">)</span> 3c34d73<span class="token punctuation">]</span> v1
 <span class="token number">1</span> <span class="token builtin">file</span> changed<span class="token punctuation">,</span> <span class="token number">3</span> insertions<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span>
 create mode <span class="token number">100644</span> README<span class="token punctuation">.</span>md
<span class="token comment"># 上传代码到远程仓库</span>
<span class="token punctuation">[</span>root@xiaomao8 shopping<span class="token punctuation">]</span><span class="token comment"># git remote add origin http://www.xiaomao.com/dev/shopping.git</span>
<span class="token punctuation">[</span>root@xiaomao8 shopping<span class="token punctuation">]</span><span class="token comment"># git push -u origin master</span>
Username <span class="token keyword">for</span> <span class="token string">'http://www.xiaomao.com'</span><span class="token punctuation">:</span> root
Password <span class="token keyword">for</span> <span class="token string">'http://root@www.xiaomao.com'</span><span class="token punctuation">:</span>
Counting objects<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> done<span class="token punctuation">.</span>
Writing objects<span class="token punctuation">:</span> <span class="token number">100</span><span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">233</span> <span class="token builtin">bytes</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token builtin">bytes</span><span class="token operator">/</span>s<span class="token punctuation">,</span> done<span class="token punctuation">.</span>
Total <span class="token number">3</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> reused <span class="token number">0</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>
To http<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>xiaomao<span class="token punctuation">.</span>com<span class="token operator">/</span>dev<span class="token operator">/</span>shopping<span class="token punctuation">.</span>git
 <span class="token operator">*</span> <span class="token punctuation">[</span>new branch<span class="token punctuation">]</span>      master <span class="token operator">-</span><span class="token operator">&gt;</span> master
Branch master <span class="token builtin">set</span> up to track remote branch master <span class="token keyword">from</span> origin<span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h4 id="新成员加入项目组"><a href="#新成员加入项目组" class="header-anchor">#</a> 新成员加入项目组</h4> <div class="language-python line-numbers-mode"><pre class="language-python"><code>如果有新成员需要加入该项目该怎么办?
<span class="token number">1</span>、先给新成员创建用户
<span class="token number">2</span>、将成员加入组<span class="token punctuation">,</span>此时该用户就能看到对应的项目
<span class="token number">3</span>、使用http方式<span class="token punctuation">,</span>输入用户名与密码<span class="token punctuation">,</span>测试能否获取项目代码
<span class="token number">4</span>、新建xiaomao用户加入shopping项目
<span class="token comment"># 测试拉取代码</span>
<span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># git clone http://www.xiaomao.com/dev/shopping.git</span>
Cloning into <span class="token string">'shopping'</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Username <span class="token keyword">for</span> <span class="token string">'http://www.xiaomao.com'</span><span class="token punctuation">:</span> xiaomao
Password <span class="token keyword">for</span> <span class="token string">'http://xiaomao@www.xiaomao.com'</span><span class="token punctuation">:</span>
remote<span class="token punctuation">:</span> Enumerating objects<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> done<span class="token punctuation">.</span>
remote<span class="token punctuation">:</span> Counting objects<span class="token punctuation">:</span> <span class="token number">100</span><span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> done<span class="token punctuation">.</span>
remote<span class="token punctuation">:</span> Total <span class="token number">3</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> reused <span class="token number">0</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>
Unpacking objects<span class="token punctuation">:</span> <span class="token number">100</span><span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> done<span class="token punctuation">.</span>
<span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># cd shopping/</span>
<span class="token punctuation">[</span>root@xiaomao8 shopping<span class="token punctuation">]</span><span class="token comment"># ls</span>
README<span class="token punctuation">.</span>md
<span class="token punctuation">[</span>root@xiaomao8 shopping<span class="token punctuation">]</span><span class="token comment"># git branch dev</span>
<span class="token punctuation">[</span>root@xiaomao8 shopping<span class="token punctuation">]</span><span class="token comment"># git checkout dev</span>
<span class="token punctuation">[</span>root@xiaomao8 shopping<span class="token punctuation">]</span><span class="token comment"># git add .</span>
<span class="token punctuation">[</span>root@xiaomao8 shopping<span class="token punctuation">]</span><span class="token comment"># git commit -m &quot;登录&quot;</span>
<span class="token punctuation">[</span>dev <span class="token number">5756709</span><span class="token punctuation">]</span> 登录
 <span class="token number">1</span> <span class="token builtin">file</span> changed<span class="token punctuation">,</span> <span class="token number">2</span> insertions<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@xiaomao8 shopping<span class="token punctuation">]</span><span class="token comment"># git push origin dev</span>
Username <span class="token keyword">for</span> <span class="token string">'http://www.xiaomao.com'</span><span class="token punctuation">:</span> xiaomao
Password <span class="token keyword">for</span> <span class="token string">'http://xiaomao@www.xiaomao.com'</span><span class="token punctuation">:</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="合并代码"><a href="#合并代码" class="header-anchor">#</a> 合并代码</h4> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639639390957-324adc62-60eb-4e44-9c14-0a7eadc5d492.png" alt="img"></p> <h4 id="gitlab备份"><a href="#gitlab备份" class="header-anchor">#</a> gitlab备份</h4> <p>1、修改默认存放备份站点目录,然后进行重新加载配置文件</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># vim /etc/gitlab/gitlab.rb</span>
gitlab_rails<span class="token punctuation">[</span><span class="token string">'backup_path'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;/data/backups&quot;</span>      <span class="token comment">#备份目录</span>
gitlab_rails<span class="token punctuation">[</span><span class="token string">'backup_archive_permissions'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0644</span>  <span class="token comment">#权限</span>
gitlab_rails<span class="token punctuation">[</span><span class="token string">'backup_keep_time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">604800</span>   <span class="token comment">#备份多少天后自动删除</span>
<span class="token comment"># 重载环境变量</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># gitlab-ctl reconfigure</span>
<span class="token comment"># 创建备份目录</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># mkdir -p /data/backups</span>
<span class="token comment">#执行备份动作</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># gitlab-rake gitlab:backup:create</span>
<span class="token comment"># 定时任务</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># crontab -l</span>
<span class="token number">00</span> <span class="token number">02</span>  <span class="token operator">*</span> <span class="token operator">*</span> <span class="token operator">*</span>   <span class="token operator">/</span>usr<span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>gitlab<span class="token operator">-</span>rake gitlab<span class="token punctuation">:</span>backup<span class="token punctuation">:</span>create
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="gitlab恢复数据"><a href="#gitlab恢复数据" class="header-anchor">#</a> gitlab恢复数据</h4> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 停止数据写入服务</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># gitlab-ctl  stop  unicorn</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># gitlab-ctl  stop  sidekiq</span>
<span class="token comment"># 开始执行恢复</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># ll /data/backups/</span>
total <span class="token number">144</span>
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>  <span class="token number">1</span> git git <span class="token number">143360</span> Dec <span class="token number">16</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">36</span> <span class="token number">1639661819_2021_12_16_12.3</span><span class="token punctuation">.</span>0_gitlab_backup<span class="token punctuation">.</span>tar
<span class="token comment"># 重启gitlab查看是否成功恢复</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># gitlab-ctl restart</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="恢复成功"><a href="#恢复成功" class="header-anchor">#</a> 恢复成功</h5> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639662690278-22733695-ec97-4cc4-836e-3eef8b2272a9.png" alt="img"></p> <h4 id="gitlab迁移和升级"><a href="#gitlab迁移和升级" class="header-anchor">#</a> gitlab迁移和升级</h4> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639663070999-c8918df9-0537-4266-9078-2f97570b5fa6.png" alt="img"></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 升级gitlab-ce到12.9.9版本</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># yum -y install gitlab-ce-12.9.9-ce.0.el7.x86_64.rpm</span>
ok<span class="token punctuation">:</span> run<span class="token punctuation">:</span> unicorn<span class="token punctuation">:</span> <span class="token punctuation">(</span>pid <span class="token number">66502</span><span class="token punctuation">)</span> 1s

     _______ __  __          __
    <span class="token operator">/</span> ____<span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">/</span>_<span class="token operator">/</span> <span class="token operator">/</span>   ____ _<span class="token operator">/</span> <span class="token operator">/</span>_
   <span class="token operator">/</span> <span class="token operator">/</span> __<span class="token operator">/</span> <span class="token operator">/</span> __<span class="token operator">/</span> <span class="token operator">/</span>   <span class="token operator">/</span> __ `<span class="token operator">/</span> __ \
  <span class="token operator">/</span> <span class="token operator">/</span>_<span class="token operator">/</span> <span class="token operator">/</span> <span class="token operator">/</span> <span class="token operator">/</span>_<span class="token operator">/</span> <span class="token operator">/</span>___<span class="token operator">/</span> <span class="token operator">/</span>_<span class="token operator">/</span> <span class="token operator">/</span> <span class="token operator">/</span>_<span class="token operator">/</span> <span class="token operator">/</span>
  \____<span class="token operator">/</span>_<span class="token operator">/</span>\__<span class="token operator">/</span>_____<span class="token operator">/</span>\__<span class="token punctuation">,</span>_<span class="token operator">/</span>_<span class="token punctuation">.</span>___<span class="token operator">/</span>


Updated<span class="token punctuation">:</span>
  gitlab<span class="token operator">-</span>ce<span class="token punctuation">.</span>x86_64 <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">12.9</span><span class="token number">.9</span><span class="token operator">-</span>ce<span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span>el7
<span class="token comment">#重载gitlab</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># gitlab-ctl reconfigure</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h5 id="升级成功"><a href="#升级成功" class="header-anchor">#</a> 升级成功</h5> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639664957386-33a3a185-fc53-4ff0-9414-bb01aebc4e68.png" alt="img"></p> <h3 id="jenkins的学习"><a href="#jenkins的学习" class="header-anchor">#</a> Jenkins的学习</h3> <h4 id="什么是jenkins"><a href="#什么是jenkins" class="header-anchor">#</a> 什么是Jenkins</h4> <p>Jenkins是一个开源提供友好操作界面的持续集成的工具,是由JAVA开发而成,Jenkins是一个调度平台，本身不处理任何事情,调用插件来完成所有的工作</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639830851993-6ac89bac-aed3-46cb-af5e-6fc00aa676b9.png" alt="img"></p> <h4 id="部署安装"><a href="#部署安装" class="header-anchor">#</a> 部署安装</h4> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 安装jdk环境</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># java -version</span>
java version <span class="token string">&quot;1.8.0_221&quot;</span>
Java<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> SE Runtime Environment <span class="token punctuation">(</span>build <span class="token number">1.8</span><span class="token number">.0_221</span><span class="token operator">-</span>b11<span class="token punctuation">)</span>
Java HotSpot<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> <span class="token number">64</span><span class="token operator">-</span>Bit Server VM <span class="token punctuation">(</span>build <span class="token number">25.221</span><span class="token operator">-</span>b11<span class="token punctuation">,</span> mixed mode<span class="token punctuation">)</span>
<span class="token comment">#开始安装jenkins</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># yum -y install jenkins-2.303-1.1.noarch.rpm</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="配置jenkins"><a href="#配置jenkins" class="header-anchor">#</a> 配置jenkins</h4> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># vim /etc/sysconfig/jenkins</span>
JENKINS_USER<span class="token operator">=</span><span class="token string">&quot;root&quot;</span>   <span class="token comment">#用户</span>
JENKINS_PORT<span class="token operator">=</span><span class="token string">&quot;9080&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="启动jenkins"><a href="#启动jenkins" class="header-anchor">#</a> 启动jenkins</h4> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># systemctl restart jenkins</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># systemctl enable jenkins</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="访问jenkins"><a href="#访问jenkins" class="header-anchor">#</a> 访问jenkins</h4> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639833137524-be80176f-7508-4dce-ae9e-892ca6499aa5.png" alt="img"></p> <h5 id="查看admin的密码"><a href="#查看admin的密码" class="header-anchor">#</a> 查看admin的密码</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># cat /var/lib/jenkins/secrets/initialAdminPassword</span>
d1abbd7e33004a549790bc52296e36ca
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="首页-2"><a href="#首页-2" class="header-anchor">#</a> 首页</h5> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639833362130-ccea328b-3d73-42b1-885e-16ccd0442b3b.png" alt="img"></p> <h4 id="优化jenkins"><a href="#优化jenkins" class="header-anchor">#</a> 优化jenkins</h4> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># sed -i 's#http://www.google.com/#https://www.baidu.com/#g' /var/lib/jenkins/updates/default.json</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># sed -i 's#updates.jenkins.io/download#mirror.tuna.tsinghua.edu.com/jenkins#g' /var/lib/jenkins/updates/default.json</span>
修改jenkins<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>插件升级站点<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>url地址，选择系统管理<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>插件管理<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>高级<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>升级站点
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639834425208-168aaabc-b674-42ec-a889-821b24d258b0.png" alt="img"></p> <p><strong>改成清华大学源</strong></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639834550679-cce7b9e9-a419-43b3-a038-c3236f102f5d.png" alt="img"></p> <h4 id="安装中文插件"><a href="#安装中文插件" class="header-anchor">#</a> 安装中文插件</h4> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639835052456-83e9cb66-ac55-41fa-9750-927ef85410f9.png" alt="img"></p> <h4 id="创建一个项目"><a href="#创建一个项目" class="header-anchor">#</a> 创建一个项目</h4> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639835436455-dbc97536-361f-44b4-ae9d-fb122895ea16.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639835469529-3fa5fd47-5076-40b7-93d9-e5063fb2ddbd.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639835819510-d98605ba-c90c-4c19-b5f6-17a5c08b4be2.png" alt="img"></p> <h4 id="集成gitlab获取代码"><a href="#集成gitlab获取代码" class="header-anchor">#</a> 集成gitlab获取代码</h4> <h5 id="创建项目"><a href="#创建项目" class="header-anchor">#</a> 创建项目</h5> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639837390896-8b9613ee-0a01-4e02-ae45-5cca446ec96a.png" alt="img"></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 上传源码包</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># tar xf monitor_html.tar.gz</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># cd monitor</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># git init</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># git remote add origin git@www.xiaomao.com:ops/monitor.git</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># git add .</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># git commit -m &quot;Initial commit&quot;</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># git push -u origin master</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639838139868-f02d40df-aa68-4cf0-be06-3f0e7d47b296.png" alt="img"></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 我这是gitlab和jenkins都部署在同一台机器上了</span>
<span class="token comment"># 私钥传到jenkins上</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># cat ~/.ssh/id_rsa</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>BEGIN RSA PRIVATE KEY<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
MIIEpAIBAAKCAQEAsvEtbGEFFyD7EMqhgHquBbbicN29Y94k650eOzT47WmeY1c7
cyx6DOMX<span class="token operator">/</span>4R<span class="token operator">/</span>qR8prxQ1hJ7Bzdf6Brj6uWUyGFISdAYbhNIN1UGCTnsmpuGUdJCN
vj5HjtceZFZ2YSlFiyCQWagMOHga54eDgE71YQdezyhVrrqCfNg3O8dT12XdHWbQ
<span class="token operator">+</span>14wxxgoY2390g1<span class="token operator">+</span>ZZAmvHiA5b7<span class="token operator">+</span>Lh05uWDtUGnQVc5Rw9i9QjXxWzVzL4Cz<span class="token operator">+</span>jjL
Afg0UKUDfkHqJ6AQhqMStzSSEFDwlO3teNGwiZt07fFK90RuJcCRUzy33CDvyazE
uFqM9viUXY99Ea6xp5sLjGNQWOp5ffvRNPoCRwIDAQABAoIBABip51Hd2X7Dm<span class="token operator">/</span>dH
hpUX066T84gM<span class="token operator">+</span>BKwxrP29vjAJ2NJwHv<span class="token operator">+</span>xQHt6nCmSGN<span class="token operator">+</span>lr3vvqYUCgBahWniz<span class="token operator">+</span>Jn
Up<span class="token operator">+</span>FFC<span class="token operator">+</span>H<span class="token operator">+</span>GUnhll7Pk7bdaNtk<span class="token operator">/</span>lCdFzQo8jJ<span class="token operator">+</span>sD0Y4r<span class="token operator">+</span>49gmgSBY<span class="token operator">/</span>6xr3itWWpb4
9aYUu<span class="token operator">/</span>uAsY<span class="token operator">+</span>qBo1LxbqBbrN9mM<span class="token operator">/</span>CTkxvpv8<span class="token operator">+</span>E86uYsGoVaFcWoriZla3aF18AH9y
sCBqEGM8ZBOQuFr9IHk6E91zAPPTywa7G14Fy<span class="token operator">/</span>J7FMnZ<span class="token operator">+</span>vem6HK82BKwGAVQs9ib
A4pVHpn3xnUQDbye6pAXsqvUrFT7dxSkAKt2evXykyVi7g5suTIV<span class="token operator">/</span>kyVQ3ZZYWQz
o217SQECgYEA6UqqFfLSorhThbmosV9aU5GKz<span class="token operator">+</span>i6Qq5FACWEfFaXNr<span class="token operator">/</span>iHMKMQq3u
RUvp<span class="token operator">+</span>OUSD6hRVRSF<span class="token operator">/</span>TvARHn7jMF9Hc3X<span class="token operator">/</span>kEFDOv8JInhft<span class="token operator">+</span>Pa3zvMBU4At3eCA9<span class="token operator">+</span>
4CCYr6Y<span class="token operator">+</span>LNyzhey37azmcpjrbED0qiGDK9Mq1mD4dUQ3MZV7<span class="token operator">+</span>zZ7m8cCgYEAxFww
sBGOKSwYV0awi5IvyIlYXt9etG2YtsXSMrZ43PxfQCyARMVUgXl4Ld5SXbHYQYzK
WhzoVET9p<span class="token operator">+</span>j8jJhN5HvTDZnKMQGq9GgA5RS4gMOPrE6i<span class="token operator">+</span>1rQ1D9qoVPpByOYfUX7
6pYl18FI5VexUFW<span class="token operator">/</span>q2Lt29LsHZtoRVdPWxPtZYECgYEAlQigzbK5Q0B0AwrPLLjY
kGh7AEURsIV6CRTupSwAH<span class="token operator">/</span>bHMU5LolFQ1S4hA2L7fcsuYibhThw8wMIYpBv7nO2i
XYgV<span class="token operator">/</span>OJIyuLWjmGtUqKWfuYfSR2JuSaFDBNm11dhgvFfMmA<span class="token operator">+</span>Q<span class="token operator">/</span>TfpzfvtdFtO756
<span class="token operator">+</span>KVHSXrbXra8d82iTaLJpoMCgYEAh4<span class="token operator">/</span>R<span class="token operator">+</span>SwVhi0wHMjrx1<span class="token operator">/</span>EZ2ESxmTVoCDtxnkq
FeLN7Fq7c7WFVHUbU0vGAXy0RoUqdI67gJzmdI8ww4RhHrtjQzONUJ107oJlQNiw
jXbRrevVO7MKaBeZhn7Fod0pSslzVEFFmv3P4HVLWzJAcuLQMYVaC2JBqmsJAJ43
ZfyK74ECgYBuh2Op9Nr804htdMRDQP9pKxWOF429KLrJgtLphNp4url48YVAaxl0
iyRS<span class="token operator">+</span>3kDOr3sau9wOB0<span class="token operator">/</span>mO7yGoZB5Qiw<span class="token operator">+</span>Sl1Ds<span class="token operator">+</span>F3n4YJIBClAVRxVklzBl5NAsS
Zo<span class="token operator">/</span>ApoNE<span class="token operator">+</span>RmtOF11aUtP7lkwaKeztyC<span class="token operator">/</span>U2CiRM9fWZgePNbUp8URYw<span class="token operator">==</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>END RSA PRIVATE KEY<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639838711281-b72c3779-a11d-49f6-8d6a-861cdfaa56b4.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639838784365-bcec64b8-710f-4b64-be88-297c0a70e9fa.png" alt="img"></p> <h5 id="开始构建"><a href="#开始构建" class="header-anchor">#</a> 开始构建</h5> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639838946335-c521b386-bd87-45d5-8ca7-1dd56477e496.png" alt="img"></p> <h4 id="集成shell部署代码"><a href="#集成shell部署代码" class="header-anchor">#</a> 集成shell部署代码</h4> <p>构建---&gt;增加构建步骤---&gt;选择执行shell命令</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># ssh-copy-id  -i ~/.ssh/id_rsa.pub  root@10.2.32.9</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># ssh-copy-id  -i ~/.ssh/id_rsa.pub  root@10.2.32.8</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>变量----&gt;下面的ip是压缩包要传到的主机提前做了变量的设置</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/imagessw2.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639841650230-40daabd1-c05b-4c87-891d-1866cdcd553f.png" alt="img"></p> <h5 id="构建"><a href="#构建" class="header-anchor">#</a> 构建</h5> <p>选择对应的主机，然后点击构建</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639841703421-c0ca65ba-cd59-4249-be9f-8a57195692b6.png" alt="img"></p> <h4 id="集成ansible"><a href="#集成ansible" class="header-anchor">#</a> 集成ansible</h4> <h5 id="安装ansible"><a href="#安装ansible" class="header-anchor">#</a> 安装ansible</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># yum -y install ansible</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="配置清单"><a href="#配置清单" class="header-anchor">#</a> 配置清单</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># cat /etc/ansible/hosts</span>
<span class="token punctuation">[</span>lbservers<span class="token punctuation">]</span>
<span class="token number">10.2</span><span class="token number">.32</span><span class="token number">.8</span>
<span class="token punctuation">[</span>webservers<span class="token punctuation">]</span>
<span class="token number">10.2</span><span class="token number">.32</span><span class="token number">.9</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="编写测试的playbook"><a href="#编写测试的playbook" class="header-anchor">#</a> 编写测试的playbook</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># cat test.yml</span>
<span class="token operator">-</span> hosts<span class="token punctuation">:</span> <span class="token string">&quot;webservers&quot;</span>
  tasks<span class="token punctuation">:</span>
    <span class="token operator">-</span> name<span class="token punctuation">:</span> Test Shell Command
      shell<span class="token punctuation">:</span>
        cmd<span class="token punctuation">:</span> df <span class="token operator">-</span>h
      register<span class="token punctuation">:</span> system_cmd
    <span class="token operator">-</span> name<span class="token punctuation">:</span> Debug System Command
      debug<span class="token punctuation">:</span>
        msg<span class="token punctuation">:</span> <span class="token string">&quot;{{ system_cmd }}&quot;</span>
<span class="token punctuation">[</span>root@xiaomao8 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># ansible-playbook test.yml</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h5 id="创建项目调用ansible"><a href="#创建项目调用ansible" class="header-anchor">#</a> 创建项目调用ansible</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 新建项目</span>
Dashboard<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>新建任务<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>输入一个任务名称<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>构建一个自由风格的软件项目<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>确定
<span class="token comment"># 集成ansible </span>
确定后跳转到第二个页面<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>构建<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>增加构建步骤<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>选择invoke ansible playbook
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>添加构建步骤,填写playbook路径,填写inventory清单文件路径</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639969279864-6d884f94-6c78-4068-8840-611436b1c7d3.png" alt="img"></p> <p>然后选择高级,定义ansible外置传参方式,传入主机组名称</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639968605199-b84834fe-2bc2-41ba-b976-9a1b1824777e.png" alt="img"></p> <p>定义外置传参的变量名称,以及变量值</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639968647354-87a48ef5-58de-41d5-bdf1-66b53c45edcb.png" alt="img"></p> <h5 id="构建成功"><a href="#构建成功" class="header-anchor">#</a> 构建成功</h5> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639968703529-1975b9d9-7190-4c6c-85d9-a19077da8c70.png" alt="img"></p> <h4 id="基于shell构建ci实践"><a href="#基于shell构建ci实践" class="header-anchor">#</a> 基于shell构建ci实践</h4> <h5 id="架构图"><a href="#架构图" class="header-anchor">#</a> 架构图</h5> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639970164529-d9e874e6-6bc8-4c28-a6c5-a8affcc48308.png" alt="img"></p> <h5 id="搭建测试环境"><a href="#搭建测试环境" class="header-anchor">#</a> 搭建测试环境</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 安装haproxy</span>
<span class="token punctuation">[</span>root@xiaomao6 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># yum -y install haproxy</span>
<span class="token punctuation">[</span>root@xiaomao6 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># yum -y install socat</span>
<span class="token comment">#配置haproxy </span>
<span class="token punctuation">[</span>root@xiaomao6 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># cat /etc/haproxy/haproxy.cfg</span>
<span class="token keyword">global</span>
    log         <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> local2

    chroot      <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>haproxy
    pidfile     <span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>haproxy<span class="token punctuation">.</span>pid
    maxconn     <span class="token number">4000</span>
    user        haproxy
    group       haproxy
    daemon

    <span class="token comment"># turn on stats unix socket</span>
    stats socket <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>haproxy<span class="token operator">/</span>stats level admin

<span class="token comment">#---------------------------------------------------------------------</span>
<span class="token comment"># common defaults that all the 'listen' and 'backend' sections will</span>
<span class="token comment"># use if not designated in their block</span>
<span class="token comment">#---------------------------------------------------------------------</span>
defaults
    mode                    http
    log                     <span class="token keyword">global</span>
    option                  httplog
    option                  dontlognull
    option http<span class="token operator">-</span>server<span class="token operator">-</span>close
    option forwardfor       <span class="token keyword">except</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">8</span>
    option                  redispatch
    retries                 <span class="token number">3</span>
    timeout http<span class="token operator">-</span>request    10s
    timeout queue           1m
    timeout connect         10s
    timeout client          1m
    timeout server          1m
    timeout http<span class="token operator">-</span>keep<span class="token operator">-</span>alive 10s
    timeout check           10s
    maxconn                 <span class="token number">3000</span>

<span class="token comment">#---------------------------------------------------------------------</span>
<span class="token comment"># main frontend which proxys to the backends</span>
<span class="token comment">#---------------------------------------------------------------------</span>
listen haproxy<span class="token operator">-</span>stats
        bind  <span class="token operator">*</span><span class="token punctuation">:</span><span class="token number">9999</span>
        stats  enable
        stats  hide<span class="token operator">-</span>version
        stats uri <span class="token operator">/</span>haproxy?stats
        stats realm  <span class="token string">&quot;HAProxy statistics&quot;</span>
        stats auth admin<span class="token punctuation">:</span><span class="token number">123456</span>
        stats admin <span class="token keyword">if</span> TRUE
frontend www
    bind <span class="token operator">*</span><span class="token punctuation">:</span><span class="token number">80</span>
    mode http
    acl html_web  hdr<span class="token punctuation">(</span>host<span class="token punctuation">)</span> <span class="token operator">-</span>i www<span class="token punctuation">.</span>xiaomao<span class="token punctuation">.</span>com
    use_backend web_cluster <span class="token keyword">if</span> html_web
backend web_cluster
    balance roundrobin
    server <span class="token number">10.2</span><span class="token number">.32</span><span class="token number">.9</span> <span class="token number">10.2</span><span class="token number">.32</span><span class="token number">.9</span><span class="token punctuation">:</span><span class="token number">88</span>   weight <span class="token number">3</span> check
    server <span class="token number">10.2</span><span class="token number">.32</span><span class="token number">.11</span>  <span class="token number">10.2</span><span class="token number">.32</span><span class="token number">.11</span><span class="token punctuation">:</span><span class="token number">88</span>  weight <span class="token number">3</span> check
<span class="token comment"># 重启haproxy</span>
<span class="token punctuation">[</span>root@xiaomao6 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># systemctl restart haproxy</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1639974319733-b1c3c324-5f9a-433f-85f0-c18baa99adab.png" alt="img"></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># nginx配置</span>
web1
<span class="token punctuation">[</span>root@xiaomao7 conf<span class="token punctuation">.</span>d<span class="token punctuation">]</span><span class="token comment"># cat linux39.conf</span>
server<span class="token punctuation">{</span>
        listen  <span class="token number">88</span><span class="token punctuation">;</span>
        server_name   www<span class="token punctuation">.</span>xiaomao<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
        charset  utf<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">;</span>


        location <span class="token operator">/</span> <span class="token punctuation">{</span>
            root   <span class="token operator">/</span>code<span class="token operator">/</span>web<span class="token punctuation">;</span>
            index  index<span class="token punctuation">.</span>html  index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@xiaomao7 conf<span class="token punctuation">.</span>d<span class="token punctuation">]</span><span class="token comment"># cat /code/web/index.html</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>小茂 官网<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>hello world<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
<span class="token comment">#web2</span>
<span class="token punctuation">[</span>root@xiaomao8 conf<span class="token punctuation">.</span>d<span class="token punctuation">]</span><span class="token comment"># cat test.conf</span>
server<span class="token punctuation">{</span>
        listen  <span class="token number">88</span><span class="token punctuation">;</span>
        server_name   www<span class="token punctuation">.</span>mobile<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
        charset  utf<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">;</span>


        location <span class="token operator">/</span> <span class="token punctuation">{</span>
            root   <span class="token operator">/</span>code<span class="token operator">/</span>web<span class="token punctuation">;</span>
            index  index<span class="token punctuation">.</span>html  index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@xiaomao8 conf<span class="token punctuation">.</span>d<span class="token punctuation">]</span><span class="token comment"># cat  /code/web/index.html</span>
mobile www
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h5 id="手动部署代码"><a href="#手动部署代码" class="header-anchor">#</a> 手动部署代码</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token number">1</span>、执行git clone下载代码
<span class="token punctuation">[</span>root@xiaomao8 xiaomao1<span class="token punctuation">]</span><span class="token comment"># git clone git@www.xiaomao.com:ops/monitor.git</span>
<span class="token number">2</span>、将下载好的代码进行打包
<span class="token punctuation">[</span>root@xiaomao8 monitor<span class="token punctuation">]</span><span class="token comment"># tar cfz /opt/web_monitor_$(date +%F).tar.gz  ./*</span>
<span class="token number">3</span>、将代码推送到远程的目录下
<span class="token punctuation">[</span>root@xiaomao8 opt<span class="token punctuation">]</span><span class="token comment"># scp /opt/web_monitor_2021-12-20.tar.gz   root@10.2.32.9:/opt/</span>
<span class="token punctuation">[</span>root@xiaomao8 opt<span class="token punctuation">]</span><span class="token comment"># scp /opt/web_monitor_2021-12-20.tar.gz   root@10.2.32.11:/opt/</span>
<span class="token number">4</span>、操作负载均衡<span class="token punctuation">,</span>下线节点然后在更新代码
<span class="token punctuation">[</span>root@xiaomao8 opt<span class="token punctuation">]</span><span class="token comment"># ssh root@10.2.32.8 &quot;echo 'disable server web_cluster/10.2.32.9' | socat stdio /var/lib/haproxy/stats&quot;</span>
<span class="token punctuation">[</span>root@xiaomao8 opt<span class="token punctuation">]</span><span class="token comment"># ssh root@10.2.32.8 &quot;echo 'disable server web_cluster/10.2.32.11' | socat stdio /var/lib/haproxy/stats&quot;</span>
<span class="token number">5</span>、在远程创建一个目录
<span class="token punctuation">[</span>root@xiaomao8 conf<span class="token punctuation">.</span>d<span class="token punctuation">]</span><span class="token comment"># ssh root@10.2.32.9 &quot;mkdir -p /opt/web_$(date +%F)&quot;</span>
<span class="token punctuation">[</span>root@xiaomao8 conf<span class="token punctuation">.</span>d<span class="token punctuation">]</span><span class="token comment"># ssh root@10.2.32.11 &quot;mkdir -p /opt/web_$(date +%F)&quot;</span>
<span class="token number">6</span>、在远程解压压缩包解压<span class="token punctuation">,</span>解压到<span class="token operator">/</span>opt<span class="token operator">/</span>web_$<span class="token punctuation">(</span>date <span class="token operator">+</span><span class="token operator">%</span>F<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@xiaomao8 conf<span class="token punctuation">.</span>d<span class="token punctuation">]</span><span class="token comment"># ssh root@10.2.32.9 &quot;tar xf /opt/web_monitor_2021-12-20.tar.gz  -C  /opt/web_$(date +%F)&quot;</span>
<span class="token punctuation">[</span>root@xiaomao8 conf<span class="token punctuation">.</span>d<span class="token punctuation">]</span><span class="token comment"># ssh root@10.2.32.11 &quot;tar xf /opt/web_monitor_2021-12-20.tar.gz  -C  /opt/web_$(date +%F)&quot;</span>
<span class="token number">7</span>、删除软链接<span class="token punctuation">,</span>然后重新做软链接 
<span class="token punctuation">[</span>root@xiaomao8 conf<span class="token punctuation">.</span>d<span class="token punctuation">]</span><span class="token comment"># ssh root@10.2.32.9  &quot;rm -f /opt/web &amp;&amp; ln -s /opt/web_$(date +%F)  /opt/web&quot;</span>
<span class="token punctuation">[</span>root@xiaomao8 conf<span class="token punctuation">.</span>d<span class="token punctuation">]</span><span class="token comment"># ssh root@10.2.32.11  &quot;rm -f /opt/web &amp;&amp; ln -s /opt/web_$(date +%F)  /opt/web&quot;</span>
<span class="token number">8</span>、上线节点
<span class="token punctuation">[</span>root@xiaomao8 conf<span class="token punctuation">.</span>d<span class="token punctuation">]</span><span class="token comment"># ssh root@10.2.32.8 &quot;echo 'enable server web_cluster/xiaomao7' | socat stdio /var/lib/haproxy/stats&quot;</span>
<span class="token punctuation">[</span>root@xiaomao8 conf<span class="token punctuation">.</span>d<span class="token punctuation">]</span><span class="token comment"># ssh root@10.2.32.8 &quot;echo 'enable server web_cluster/xiaomao8' | socat stdio /var/lib/haproxy/stats&quot;</span>
<span class="token number">9</span>、web界面访问
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640005591906-7d64afa0-7643-4cac-aefc-22023f8a854a.png" alt="img"></p> <h5 id="实现shell自动部署"><a href="#实现shell自动部署" class="header-anchor">#</a> 实现shell自动部署</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 新建项目</span>
Dashboard<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>新建任务<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>输入一个任务名称<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>构建一个自由风格的软件项目<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>确定
shell中定义的主机组地址都是写死的<span class="token punctuation">,</span>这样不够灵活<span class="token punctuation">,</span>希望通过传参让其变得更加灵活<span class="token punctuation">,</span>注释掉
脚本中的lb_servers、web_servers变量<span class="token punctuation">,</span>然后通过jenkins重新定义这两变量
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640068205415-f4b3d556-ac37-45fc-afa1-cc94e21dc08b.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640068188476-f87b8163-acb8-42ab-9eba-0cc29b362528.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640068224199-c0621d6a-3be1-4b85-9af9-3865576e042a.png" alt="img"></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 脚本</span>
<span class="token punctuation">[</span>root@xiaomao8 opt<span class="token punctuation">]</span><span class="token comment"># cat /scripts/deploy_html.sh</span>
<span class="token comment">#!/usr/bin/bash</span>

<span class="token comment"># vars</span>
web_name<span class="token operator">=</span>web
web_dir<span class="token operator">=</span><span class="token operator">/</span>opt
Date<span class="token operator">=</span>$<span class="token punctuation">(</span>date <span class="token operator">+</span><span class="token operator">%</span>F_<span class="token operator">%</span>H_<span class="token operator">%</span>M<span class="token punctuation">)</span>
lock_file<span class="token operator">=</span><span class="token operator">/</span>tmp<span class="token operator">/</span>deploy<span class="token punctuation">.</span>lock

<span class="token comment"># lock</span>
lock<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">-</span>f $lock_file <span class="token punctuation">]</span><span class="token punctuation">;</span> then
        echo <span class="token string">&quot;当前脚本正在执行,请不要反复执行;&quot;</span>
        exit
   fi
<span class="token punctuation">}</span>

un_lock<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        rm <span class="token operator">-</span>f $lock_file
<span class="token punctuation">}</span>

<span class="token comment"># 完成打包操作</span>
tar_code<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment"># 枷锁</span>
        touch $lock_file

        cd $<span class="token punctuation">{</span>WORKSPACE<span class="token punctuation">}</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> \
        tar czf $<span class="token punctuation">{</span>web_dir<span class="token punctuation">}</span><span class="token operator">/</span>$<span class="token punctuation">{</span>web_name<span class="token punctuation">}</span>_$<span class="token punctuation">{</span>Date<span class="token punctuation">}</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz  <span class="token punctuation">.</span><span class="token operator">/</span><span class="token operator">*</span>
<span class="token punctuation">}</span>



<span class="token comment"># 推送代码</span>
push_code<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> host <span class="token keyword">in</span>  $<span class="token punctuation">{</span>web_servers<span class="token punctuation">}</span>
        do
            scp $<span class="token punctuation">{</span>web_dir<span class="token punctuation">}</span><span class="token operator">/</span>$<span class="token punctuation">{</span>web_name<span class="token punctuation">}</span>_$<span class="token punctuation">{</span>Date<span class="token punctuation">}</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz root@$<span class="token punctuation">{</span>host<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>web_dir<span class="token punctuation">}</span>
        done
<span class="token punctuation">}</span>
<span class="token comment"># 下线节点</span>
lb_server_disable<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    ssh root@$<span class="token punctuation">{</span>lb_servers<span class="token punctuation">}</span> <span class="token string">&quot;echo 'disable server web_cluster/$1' | socat stdio /var/lib/haproxy/stats&quot;</span>
<span class="token punctuation">}</span>

lb_server_enable<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    ssh root@$<span class="token punctuation">{</span>lb_servers<span class="token punctuation">}</span> <span class="token string">&quot;echo 'enable  server web_cluster/$1' | socat stdio /var/lib/haproxy/stats&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment"># 部署操作</span>
deploy_code<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token keyword">for</span> host <span class="token keyword">in</span> $<span class="token punctuation">{</span>web_servers<span class="token punctuation">}</span>
do
    <span class="token comment">#下线节点</span>
    lb_server_disable $host
    <span class="token comment">#登录目标主机执行多种操作</span>
    ssh root@$<span class="token punctuation">{</span>host<span class="token punctuation">}</span> &quot;cd $<span class="token punctuation">{</span>web_dir<span class="token punctuation">}</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> mkdir <span class="token operator">-</span>p $<span class="token punctuation">{</span>web_dir<span class="token punctuation">}</span><span class="token operator">/</span>$<span class="token punctuation">{</span>web_name<span class="token punctuation">}</span>_$<span class="token punctuation">{</span>Date<span class="token punctuation">}</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> \
                      tar xf $<span class="token punctuation">{</span>web_name<span class="token punctuation">}</span>_$<span class="token punctuation">{</span>Date<span class="token punctuation">}</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz  <span class="token operator">-</span>C $<span class="token punctuation">{</span>web_name<span class="token punctuation">}</span>_$<span class="token punctuation">{</span>Date<span class="token punctuation">}</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> \
                      rm <span class="token operator">-</span>rf $<span class="token punctuation">{</span>web_name<span class="token punctuation">}</span>_$<span class="token punctuation">{</span>Date<span class="token punctuation">}</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz                         <span class="token operator">&amp;</span><span class="token operator">&amp;</span> \
                      ln <span class="token operator">-</span>s $<span class="token punctuation">{</span>web_dir<span class="token punctuation">}</span><span class="token operator">/</span>$<span class="token punctuation">{</span>web_name<span class="token punctuation">}</span>_$<span class="token punctuation">{</span>Date<span class="token punctuation">}</span> $<span class="token punctuation">{</span>web_dir<span class="token punctuation">}</span><span class="token operator">/</span>$<span class="token punctuation">{</span>web_name<span class="token punctuation">}</span>&quot;

    <span class="token comment"># 上线节点</span>
    lb_server_enable $host

    sleep <span class="token number">5</span>
done
<span class="token punctuation">}</span>
<span class="token comment"># 调用函数</span>
main <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   lock
   tar_code
   push_code
   deploy_code
   un_lock
<span class="token punctuation">}</span>
main
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br></div></div><h4 id="jenkins调用ansible"><a href="#jenkins调用ansible" class="header-anchor">#</a> jenkins调用ansible</h4> <p>创建一个项目,名称为:monitor-Ansible-CI,在执行构建阶段选择Invoke Ansible Playbook</p> <p>1、Playbook path: /scripts/deploy_html.yml,文件绝对路径</p> <p>2、Inventory: File or host list (/etc/ansible/hosts),主机清单文件路径</p> <h5 id="整体思路"><a href="#整体思路" class="header-anchor">#</a> 整体思路</h5> <p>1、设定时间变量,设定workspace变量,委派给jenkins节点执行</p> <p>2、代码进行打包,委派给Jenkins节点执行</p> <p>3、当web节点代码需要更新时,先下线节点,将任务委派给haproxy</p> <p>4、为web节点创建站点目录,并将代码推送至对应的目录中</p> <p>5、删除软链接,重新创建软链接</p> <p>6、当web节点代码更新成功后,需要上线节点,将任务委派给Haproxy</p> <p>7、然后依次循环,直到完成所有节点的代码更新与替换</p> <h5 id="定义主机清单文件"><a href="#定义主机清单文件" class="header-anchor">#</a> 定义主机清单文件</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@xiaomao8 opt<span class="token punctuation">]</span><span class="token comment"># cat /etc/ansible/hosts</span>
<span class="token punctuation">[</span>lbservers<span class="token punctuation">]</span>
<span class="token number">10.2</span><span class="token number">.32</span><span class="token number">.8</span>
<span class="token punctuation">[</span>webservers<span class="token punctuation">]</span>
<span class="token number">10.2</span><span class="token number">.32</span><span class="token number">.9</span>
<span class="token number">10.2</span><span class="token number">.32</span><span class="token number">.11</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>配置jenkins的参数化构建,这些参数会当作环境变量暴露给构建任务</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640091084712-de8684ad-518c-441d-a185-258a9eae534a.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640091100294-d9bf5924-e373-4a53-a384-22ae8a141a03.png" alt="img"></p> <p>在jenkins中配置Ansible的外置传参,value为一个变量,需要通过执行jenkins时进行传递</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640091181147-6a714ede-5c4a-4f87-b697-ae5efa65b8fb.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640091262875-db6ab644-37cb-4664-ae35-42c36fade74d.png" alt="img"></p> <h5 id="playbook脚本"><a href="#playbook脚本" class="header-anchor">#</a> playbook脚本</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@xiaomao8 opt<span class="token punctuation">]</span><span class="token comment"># cat !$</span>
<span class="token function">cat</span> /scripts/deploy_html.yml
- hosts: <span class="token string">&quot;webservers&quot;</span>
  vars:
    - work_dir: /opt
    - web_name: web
    - web_backend: web_clsuter
    - service_port: <span class="token number">88</span>
  serial: <span class="token number">1</span>
  tasks:
    <span class="token comment"># 获取一个时间,年-月-日-分 {{ date.stdout }}</span>
    - name: Get System Time
      shell:
        cmd: <span class="token string">&quot;echo <span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%F_%H_%M<span class="token variable">)</span></span>&quot;</span>
      register: <span class="token function">date</span>
      delegate_to: <span class="token string">&quot;127.0.0.1&quot;</span>
    <span class="token comment"># 获取项目的工作目录{{ workspace.stdout }}</span>
    - name: GetWorkSpace Work Path
      shell:
        cmd: <span class="token string">&quot;echo <span class="token variable">${WORKSPACE}</span>&quot;</span>
      register: workspace
      delegate_to: <span class="token number">127.0</span>.0.1
    <span class="token comment"># 执行打包操作</span>
    - name: Archive Workspace Code
      archive:
        path:  <span class="token string">&quot;{{ workspace.stdout }}/*&quot;</span>
        dest:  <span class="token string">&quot;{{ work_dir }}/{{ web_name }}_{{ date.stdout }}.tar.gz&quot;</span>
      delegate_to: <span class="token number">127.0</span>.0.1
    <span class="token comment"># 下线节点(委派给labservers)</span>
    - name: offline Haproxy <span class="token string">&quot;{{ inventory_hostname}}&quot;</span>
      haproxy:
        state: disabled
        host:  <span class="token string">&quot;{{ inventory_hostname }}&quot;</span>
        backend: <span class="token string">&quot;{{ web_backend }}&quot;</span>
        socket: /var/lib/haproxy/stats
      delegate_to: <span class="token string">&quot;{{ item }}&quot;</span>
      loop: <span class="token string">&quot;{{ groups['lbservers'] }}&quot;</span>
    <span class="token comment"># 关闭Nginx</span>
    - name: Systemd Nginx Stoppend
      systemd:
        name: nginx
        state: stopped
    <span class="token comment"># 检测端口是否存活</span>
    - name: Check Nginx Port
      wait_for:
        port: <span class="token string">&quot;{{ service_port }}&quot;</span>
        state: stopped
    <span class="token comment"># 为web集群创建站点目录</span>
    - name: Create Web Site Directory
      file:
       path: <span class="token string">&quot;{{ work_dir}}/{{ web_name }}_{{ date.stdout }}&quot;</span>
       state: directory
    <span class="token comment"># 解压目录</span>
    - name: Unarchive Web Code
      unarchive:
        src: <span class="token string">&quot;{{ work_dir }}/{{ web_name }}_{{ date.stdout }}.tar.gz&quot;</span>
        dest: <span class="token string">&quot;{{ work_dir }}/{{ web_name }}_{{ date.stdout }}&quot;</span>
    <span class="token comment"># 删除软链接</span>
    - name: Unlink Path
      file:
         path: <span class="token string">&quot;{{ work_dir }}/{{ web_name }}&quot;</span>
         state: absent
    <span class="token comment"># 重新创建链接</span>
    - name: Create Links Path
      file:
        src: <span class="token string">&quot;{{ work_dir}}/{{ web_name }}_{{ date.stdout }}&quot;</span>
        dest: <span class="token string">&quot;{{ work_dir }}/{{ web_name }}&quot;</span>
        state: <span class="token function">link</span>     <span class="token comment">#state是link的时候代表软连接</span>
    <span class="token comment"># 启动Nginx Server</span>
    - name: Systemd Nginx Started
      systemd:
        name: nginx
        state: started
    <span class="token comment"># 检测端口是否存活</span>
    - name: Check Nginx Port
      wait_for:
        port: <span class="token string">&quot;{{ service_port }}&quot;</span>
        state: started
    <span class="token comment"># 上线节点</span>
    - name: online Haproxy <span class="token string">&quot;{{ inventory_hostname}}&quot;</span>
      haproxy:
        state: enabled
        host:  <span class="token string">&quot;{{ inventory_hostname }}&quot;</span>
        backend: <span class="token string">&quot;{{ web_backend }}&quot;</span>
        socket: /var/lib/haproxy/stats
      delegate_to: <span class="token string">&quot;{{ item }}&quot;</span>
      loop: <span class="token string">&quot;{{ groups['lbservers'] }}&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br></div></div><h5 id="定时构建"><a href="#定时构建" class="header-anchor">#</a> 定时构建</h5> <p>定时构建,每间隔多久执行一次;无论代码是否更新,时间到了则会执行,类似于定时任务的功能</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640142697810-b35f2be8-071f-468f-8dbc-3fa8de77a473.png" alt="img"></p> <h5 id="scm轮询"><a href="#scm轮询" class="header-anchor">#</a> SCM轮询</h5> <p>SCM沦陷:可以每分钟检查代码是否更新,当检查到代码发生变更后,会触发构建,否则不执行</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640143935784-5c5d3e22-ef4b-4703-a283-d39a26915c72.png" alt="img"></p> <p><img src="https://cdn.nlark.com/yuque/0/2021/png/10358179/1640143914582-5ced7801-e947-4955-bafe-7aaf330af0b5.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_23%2Ctext_eGlhb21hbw%3D%3D%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10" alt="img"></p> <h5 id="wobhook"><a href="#wobhook" class="header-anchor">#</a> wobhook</h5> <p>wobhook就是当开发一提交代码,则立刻将代码部署至目标集群服务节点</p> <ul><li><p>配置jenkins项目</p></li> <li><ul><li>点击jenkins中对应的项目,找到构建触发器</li> <li>找到高级,然后找到Secret token,点击Generate生成token</li> <li>这样就可以通过外部程序调用jenkins,进而触发动作构建项目</li></ul></li></ul> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640143981663-4c44a16e-4ded-4cfd-ae60-3110930c467b.png" alt="img"></p> <p><img src="https://cdn.nlark.com/yuque/0/2021/png/10358179/1640144021253-3d553ddc-b717-42d7-b30d-9cacf7fa1221.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_27%2Ctext_eGlhb21hbw%3D%3D%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10" alt="img"></p> <p>最后应用保存</p> <ul><li>gitlab配置</li></ul> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640155510374-79d31b3f-2509-46d7-8448-4600fe72f18b.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640155693116-4f32ce3e-43e1-4079-8d86-1c38e1027081.png" alt="img"></p> <p><img src="https://cdn.nlark.com/yuque/0/2021/png/10358179/1640155709190-80ff62b4-2063-4d93-91a4-862a228c80fb.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_15%2Ctext_eGlhb21hbw%3D%3D%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10" alt="img"></p> <p>添加成功</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640156024819-e8434995-4957-41f0-92b9-4d647145bb3f.png" alt="img"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>解决gitlab添加webhook提示Url is blocked: Requests to the <span class="token builtin class-name">local</span> network are not allowed的问题
解决办法：Admin area <span class="token operator">=</span><span class="token operator">&gt;</span> Settings <span class="token operator">=</span><span class="token operator">&gt;</span> Network <span class="token operator">==</span><span class="token operator">&gt;</span> Outbound requests <span class="token operator">==</span><span class="token operator">&gt;</span> 两个勾都要打上
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="集成java-maven实践"><a href="#集成java-maven实践" class="header-anchor">#</a> 集成java maven实践</h3> <h4 id="架构图-2"><a href="#架构图-2" class="header-anchor">#</a> 架构图</h4> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640157884663-076d07c7-d42c-48ed-9adf-53b05c922359.png" alt="img"></p> <h4 id="基础环境搭建"><a href="#基础环境搭建" class="header-anchor">#</a> 基础环境搭建</h4> <h5 id="haproxy"><a href="#haproxy" class="header-anchor">#</a> haproxy</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@xiaomao6 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/haproxy/haproxy.cfg</span>
global
    <span class="token comment"># to have these messages end up in /var/log/haproxy.log you will</span>
    <span class="token comment"># need to:</span>
    <span class="token comment">#</span>
    <span class="token comment"># 1) configure syslog to accept network log events.  This is done</span>
    <span class="token comment">#    by adding the '-r' option to the SYSLOGD_OPTIONS in</span>
    <span class="token comment">#    /etc/sysconfig/syslog</span>
    <span class="token comment">#</span>
    <span class="token comment"># 2) configure local2 events to go to the /var/log/haproxy.log</span>
    <span class="token comment">#   file. A line like the following can be added to</span>
    <span class="token comment">#   /etc/sysconfig/syslog</span>
    <span class="token comment">#</span>
    <span class="token comment">#    local2.*                       /var/log/haproxy.log</span>
    <span class="token comment">#</span>
    log         <span class="token number">127.0</span>.0.1 local2

    <span class="token function">chroot</span>      /var/lib/haproxy
    pidfile     /var/run/haproxy.pid
    maxconn     <span class="token number">4000</span>
    user        haproxy
    group       haproxy
    daemon

    <span class="token comment"># turn on stats unix socket</span>
    stats socket /var/lib/haproxy/stats level admin

<span class="token comment">#---------------------------------------------------------------------</span>
<span class="token comment"># common defaults that all the 'listen' and 'backend' sections will</span>
<span class="token comment"># use if not designated in their block</span>
<span class="token comment">#---------------------------------------------------------------------</span>
defaults
    mode                    http
    log                     global
    option                  httplog
    option                  dontlognull
    option http-server-close
    option forwardfor       except <span class="token number">127.0</span>.0.0/8
    option                  redispatch
    retries                 <span class="token number">3</span>
    <span class="token function">timeout</span> http-request    10s
    <span class="token function">timeout</span> queue           1m
    <span class="token function">timeout</span> connect         10s
    <span class="token function">timeout</span> client          1m
    <span class="token function">timeout</span> server          1m
    <span class="token function">timeout</span> http-keep-alive 10s
    <span class="token function">timeout</span> check           10s
    maxconn                 <span class="token number">3000</span>

<span class="token comment">#---------------------------------------------------------------------</span>
<span class="token comment"># main frontend which proxys to the backends</span>
<span class="token comment">#---------------------------------------------------------------------</span>
listen haproxy-stats
        <span class="token builtin class-name">bind</span>  *:9999
        stats  <span class="token builtin class-name">enable</span>
        stats  hide-version
        stats uri /haproxy?stats
        stats realm  <span class="token string">&quot;HAProxy statistics&quot;</span>
        stats auth admin:123456
        stats admin <span class="token keyword">if</span> TRUE
frontend www
    <span class="token builtin class-name">bind</span> *:80
    mode http
    acl java_oldxu hdr<span class="token punctuation">(</span>host<span class="token punctuation">)</span> <span class="token parameter variable">-i</span> www.xiaomao.com
    use_backend  java_cluster <span class="token keyword">if</span> java_oldxu
backend java_cluster
    balance roundrobin
    server <span class="token number">10.2</span>.32.10 <span class="token number">10.2</span>.32.10:8010  check port <span class="token number">8010</span>
    server <span class="token number">10.2</span>.32.11  <span class="token number">10.2</span>.32.11:8010  check port <span class="token number">8010</span>
<span class="token comment"># 重启haproxy</span>
<span class="token punctuation">[</span>root@xiaomao6 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart haproxy</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><h5 id="部署tomcat"><a href="#部署tomcat" class="header-anchor">#</a> 部署tomcat</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 部署java</span>
<span class="token punctuation">[</span>root@xiaomao7 ~<span class="token punctuation">]</span><span class="token comment"># java -version</span>
<span class="token function">java</span> version <span class="token string">&quot;1.8.0_221&quot;</span>
Java<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> SE Runtime Environment <span class="token punctuation">(</span>build <span class="token number">1.8</span>.0_221-b11<span class="token punctuation">)</span>
Java HotSpot<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> <span class="token number">64</span>-Bit Server VM <span class="token punctuation">(</span>build <span class="token number">25.221</span>-b11, mixed mode<span class="token punctuation">)</span>
<span class="token comment"># 部署tomcat</span>
<span class="token punctuation">[</span>root@xiaomao7 ~<span class="token punctuation">]</span><span class="token comment"># mkdir /soft</span>
<span class="token punctuation">[</span>root@xiaomao7 ~<span class="token punctuation">]</span><span class="token comment"># tar xf apache-tomcat-7.0.92.tar.gz  -C /soft/</span>
<span class="token punctuation">[</span>root@xiaomao7 ~<span class="token punctuation">]</span><span class="token comment"># ln -sv  /soft/apache-tomcat-7.0.92/  /soft/tomcat</span>
‘/soft/tomcat’ -<span class="token operator">&gt;</span> ‘/soft/apache-tomcat-7.0.92/’
<span class="token comment">#  启动tomcat</span>
<span class="token punctuation">[</span>root@xiaomao7 ~<span class="token punctuation">]</span><span class="token comment"># /soft/tomcat/bin/startup.sh</span>
Using CATALINA_BASE:   /soft/tomcat
Using CATALINA_HOME:   /soft/tomcat
Using CATALINA_TMPDIR: /soft/tomcat/temp
Using JRE_HOME:        /usr/local/java
Using CLASSPATH:       /soft/tomcat/bin/bootstrap.jar:/soft/tomcat/bin/tomcat-juli.jar
Tomcat started.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640159709127-cde039f4-c2de-4ac4-b9a2-86c3fb91806e.png" alt="img"></p> <h4 id="手动实现war包的ci"><a href="#手动实现war包的ci" class="header-anchor">#</a> 手动实现war包的CI</h4> <h5 id="上传源码包"><a href="#上传源码包" class="header-anchor">#</a> 上传源码包</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@xiaomao8 ~<span class="token punctuation">]</span><span class="token comment"># tar xf hello-world-war.tar.gz  -C /test/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="创建gitlab仓库"><a href="#创建gitlab仓库" class="header-anchor">#</a> 创建gitlab仓库</h5> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640161342445-98ace4dc-19b6-4a4c-8e3f-32a30dfb3e6f.png" alt="img"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 推送代码到仓库中</span>
<span class="token punctuation">[</span>root@xiaomao8 hello-world-war<span class="token punctuation">]</span><span class="token comment"># git init</span>
<span class="token punctuation">[</span>root@xiaomao8 hello-world-war<span class="token punctuation">]</span><span class="token comment"># git remote add origin git@www.xiaomao.com:dev/spring-hello-world-war.git</span>
<span class="token punctuation">[</span>root@xiaomao8 hello-world-war<span class="token punctuation">]</span><span class="token comment"># git add .</span>
<span class="token punctuation">[</span>root@xiaomao8 hello-world-war<span class="token punctuation">]</span><span class="token comment"># git commit -m &quot;Initial commit&quot;</span>
<span class="token comment"># On branch master</span>
nothing to commit, working directory clean
<span class="token punctuation">[</span>root@xiaomao8 hello-world-war<span class="token punctuation">]</span><span class="token comment"># git push -u origin master</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="拉取代码"><a href="#拉取代码" class="header-anchor">#</a> 拉取代码</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># mkdir xiaomao</span>
<span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># cd xiaomao/</span>
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># git clone git@www.xiaomao.com:dev/spring-hello-world-war.git</span>
Cloning into <span class="token string">'spring-hello-world-war'</span><span class="token punctuation">..</span>.
remote: Enumerating objects: <span class="token number">19</span>, done.
remote: Counting objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">19</span>/19<span class="token punctuation">)</span>, done.
remote: Compressing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">12</span>/12<span class="token punctuation">)</span>, done.
remote: Total <span class="token number">19</span> <span class="token punctuation">(</span>delta <span class="token number">2</span><span class="token punctuation">)</span>, reused <span class="token number">0</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>, pack-reused <span class="token number">0</span>
Receiving objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">19</span>/19<span class="token punctuation">)</span>, done.
Resolving deltas: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">2</span>/2<span class="token punctuation">)</span>, done.
<span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># ls</span>
spring-hello-world-war
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h5 id="安装maven"><a href="#安装maven" class="header-anchor">#</a> 安装maven</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@xiaomao8 xiaomao<span class="token punctuation">]</span><span class="token comment"># yum -y install maven</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="配置maven"><a href="#配置maven" class="header-anchor">#</a> 配置maven</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 一定要进入到带有源码的仓库中目录进行修改</span>
<span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># vim /etc/maven/settings.xml</span>
<span class="token operator">&lt;</span>mirrors<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>mirror<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>id<span class="token operator">&gt;</span>alimaven<span class="token operator">&lt;</span>/id<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>aliyun maven<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>url<span class="token operator">&gt;</span>http://maven.aliyun.com/nexus/content/groups/public<span class="token operator">&lt;</span>/url<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>mirrorOf<span class="token operator">&gt;</span>central<span class="token operator">&lt;</span>/mirrorOf<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/mirror<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>/mirrors<span class="token operator">&gt;</span>
<span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># mvn clean</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h5 id="编译项目"><a href="#编译项目" class="header-anchor">#</a> 编译项目</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># mvn package</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="部署代码"><a href="#部署代码" class="header-anchor">#</a> 部署代码</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 拷贝war包</span>
<span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># for i in {10..11};do scp target/*.war root@10.2.32.$i:/opt/ROOT_$(date +%F-%H-%M).war;done</span>
<span class="token comment">#删除ROOT目录</span>
<span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># for i  in  {10..11};do ssh root@10.2.32.$i  &quot;rm -rf /soft/tomcat/webapss/ROOT&quot;;done</span>
<span class="token comment"># 解压war包</span>
<span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># for i in {10..11};do ssh root@10.2.32.$i &quot;mkdir /opt/ROOT_$(date +%F-%H-%M) &amp;&amp; unzip /opt/ROOT_$(date +%F-%H-%M).war -d /opt/ROOT_$(date +%F-%H-%M)&quot;;done</span>
<span class="token comment"># 建立软链接</span>
<span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># for i in {10..11};do ssh root@10.2.32.$i &quot; ln -s /opt/ROOT_$(date +%F-%H-%M)  /soft/tomcat/webapps/ROOT &quot;;done</span>
<span class="token comment"># 重启tomcat</span>
<span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># for i in {10..11};do ssh root@10.2.32.$i &quot;pkill  java &amp;&amp;  /soft/tomcat/bin/startup.sh &quot;;done</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="访问"><a href="#访问" class="header-anchor">#</a> 访问</h5> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640176835506-aff96dc2-4ee2-4e04-ae60-9272f77644ae.png" alt="img"></p> <h3 id="自动实现war包项目的ci"><a href="#自动实现war包项目的ci" class="header-anchor">#</a> 自动实现war包项目的CI</h3> <h4 id="配置jenkins集成maven"><a href="#配置jenkins集成maven" class="header-anchor">#</a> 配置jenkins集成Maven</h4> <p>1、安装Maven integrtion插件,这样才能使用jenkins构建一个Maven项目</p> <p>2、告诉jenkins,jDK的安装路径:点击系统---&gt;全局工具配置---&gt;新增JDK,然后填写JDK路径</p> <p>3、告诉jenkins,Maven的安装路径:点击系统--&gt;全局工具配置---&gt;新增Maven,然后填写Maven路径</p> <h4 id="创建一个manven项目"><a href="#创建一个manven项目" class="header-anchor">#</a> 创建一个Manven项目</h4> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640443798875-ce780001-fe57-441f-8ad3-d346175295ca.png" alt="img"></p> <h5 id="添加jdk参数"><a href="#添加jdk参数" class="header-anchor">#</a> 添加jdk参数</h5> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640443954230-be8ac58c-c598-4a7a-badb-a9c38339d419.png" alt="img"></p> <h5 id="添加maven参数"><a href="#添加maven参数" class="header-anchor">#</a> 添加maven参数</h5> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640444044099-eadb8037-3b04-454a-abde-961db6f5ec70.png" alt="img"></p> <h5 id="开始新建项目"><a href="#开始新建项目" class="header-anchor">#</a> 开始新建项目</h5> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640444212949-b5e324da-987f-4d66-a3a9-49846f7fe082.png" alt="img"></p> <p><img src="https://cdn.nlark.com/yuque/0/2021/png/10358179/1640445228586-b8a74407-ed3a-4031-b9ba-c25f0b875df6.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_21%2Ctext_eGlhb21hbw%3D%3D%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640445243476-d4eead3e-2abc-4268-9bd6-ee278ae6d043.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640512852437-d5ec66f2-0d0d-4837-baec-11922c9f87d5.png" alt="img"></p> <h4 id="编写shell脚本"><a href="#编写shell脚本" class="header-anchor">#</a> 编写shell脚本</h4> <p>1、通过Haproxy来关闭web节点</p> <p>2、停止web节点上的Tomcat服务</p> <p>3、进入工程目录中,将war包拷贝到被控端，并进行重新命名</p> <p>4、为被控制端创建目录,解压到指定的目录下</p> <p>5、删除软链接，重新创建软链接</p> <p>6、启动web节点上的tomcat服务</p> <p>7、通过Haproxy加入到集群中</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@xiaomao8 scripts<span class="token punctuation">]</span><span class="token comment"># cat deploy_java.sh</span>
<span class="token comment">#!/usr/bin/bash</span>

<span class="token comment"># vars</span>
<span class="token assign-left variable">web_name</span><span class="token operator">=</span>ROOT
<span class="token assign-left variable">web_dir</span><span class="token operator">=</span>/opt
<span class="token assign-left variable">tomcat_bin</span><span class="token operator">=</span>/soft/tomcat/bin
<span class="token assign-left variable">Date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%F_%H_%M<span class="token variable">)</span></span>
<span class="token assign-left variable">tomcat_site</span><span class="token operator">=</span>/soft/tomcat/webapps/ROOT


<span class="token comment"># 1.通过Haproxy来关闭web节点</span>
<span class="token function-name function">lb_server_disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">ssh</span> root@<span class="token variable">${lbservers}</span> <span class="token string">&quot;echo 'disable server java_cluster/<span class="token variable">$1</span>' | socat stdio /var/lib/haproxy/stats&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment"># 2.进入到工程目录中,将web包拷贝到被控端,并进行重新命名</span>
<span class="token function-name function">scp_code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token builtin class-name">cd</span> <span class="token variable">${WORKSPACE}</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
        <span class="token keyword">for</span> <span class="token for-or-select variable">host</span> <span class="token keyword">in</span>  <span class="token variable">${webservers}</span>
        <span class="token keyword">do</span>
                <span class="token function">scp</span> target/*.war root@<span class="token variable">${host}</span><span class="token builtin class-name">:</span><span class="token variable">${web_dir}</span>/<span class="token variable">${web_name}</span>_<span class="token variable">${Date}</span>.war
        <span class="token keyword">done</span>
<span class="token punctuation">}</span>
<span class="token comment"># 3.停止web节点上的tomcat服务</span>
<span class="token comment"># 4、为被控制端创建目录,解压到指定的目录下</span>
<span class="token comment"># 5、删除软链接，重新创建软链接</span>
<span class="token comment"># 6、启动web节点上的tomcat服务</span>
<span class="token function-name function">deploy_code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token for-or-select variable">host</span> <span class="token keyword">in</span> <span class="token variable">${webservers}</span>
        <span class="token keyword">do</span>
           lb_server_disable <span class="token variable">${host}</span>
           <span class="token function">ssh</span> root@<span class="token variable">${host}</span> <span class="token string">&quot;<span class="token variable">${tomcat_bin}</span>/shutdown.sh  &amp;&amp; \
                      cd <span class="token variable">${web_dir}</span> &amp;&amp;  rm -rf <span class="token variable">${tomcat_site}</span> &amp;&amp;  \
                      mkdir -p <span class="token variable">${web_name}</span>_<span class="token variable">${Date}</span> &amp;&amp; \
                      unzip <span class="token variable">${web_name}</span>_<span class="token variable">${Date}</span>.war -d <span class="token variable">${web_name}</span>_<span class="token variable">${Date}</span> &amp;&amp; \
                      ln -s <span class="token variable">${web_dir}</span>/<span class="token variable">${web_name}</span>_<span class="token variable">${Date}</span>  <span class="token variable">${tomcat_site}</span> &amp;&amp; <span class="token variable">${tomcat_bin}</span>/startup.sh &quot;</span>
          <span class="token function">sleep</span> <span class="token number">5</span>
          lb_server_enable <span class="token variable">${host}</span>
        <span class="token keyword">done</span>
<span class="token punctuation">}</span>
<span class="token function-name function">lb_server_enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">ssh</span> root@<span class="token variable">${lbservers}</span> <span class="token string">&quot;echo 'enable  server java_cluster/<span class="token variable">$1</span>' | socat stdio /var/lib/haproxy/stats&quot;</span>
<span class="token punctuation">}</span>

<span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   scp_code
   deploy_code

<span class="token punctuation">}</span>
   main
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><h5 id="部署结果"><a href="#部署结果" class="header-anchor">#</a> 部署结果</h5> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640512884502-64aaea1e-4471-4408-a973-5832e7d9f5c4.png" alt="img"></p> <h3 id="自动实现war包部署-ansible"><a href="#自动实现war包部署-ansible" class="header-anchor">#</a> 自动实现war包部署-ansible</h3> <h4 id="新建项目"><a href="#新建项目" class="header-anchor">#</a> 新建项目</h4> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640521509232-7e60e88c-e8bc-46c4-9573-138930510036.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640525043108-72f68451-0d12-41fd-8ff4-bcab8e014776.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640525025554-bd718d77-594d-4e58-ad68-23e36b312f7a.png" alt="img"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@xiaomao8 scripts<span class="token punctuation">]</span><span class="token comment"># cat deploy_xiaomao.yml</span>
- hosts: <span class="token string">&quot;webservers&quot;</span>
  vars:
    - work_dir: /opt
    - web_name: ROOT
    - tomcat_site: /soft/tomcat/webapps
    - web_backend: java_clsuter
    - service_port: <span class="token number">8080</span>
  serial: <span class="token number">1</span>    <span class="token comment">#控制每次仅操作一个主机</span>
  tasks:
    <span class="token comment"># 获取一个时间,年-月-日-分 {{ date.stdout }}</span>
    - name: Get System Time
      shell:
        cmd: <span class="token string">&quot;echo <span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%F_%H_%M<span class="token variable">)</span></span>&quot;</span>
      register: <span class="token function">date</span>
      delegate_to: <span class="token string">&quot;127.0.0.1&quot;</span>
    <span class="token comment"># 获取项目的war包名称{{ workspace.stdout }}</span>
    - name: GetWorkSpace Work Path
      shell:
       cmd: <span class="token string">&quot;echo <span class="token variable">${WORKSPACE}</span>/target/*.war&quot;</span>
      register: workspace
      delegate_to: <span class="token number">127.0</span>.0.1
    <span class="token comment"># 下线节点(委派给labservers)</span>
    - name: offline Haproxy <span class="token string">&quot;{{ inventory_hostname}}&quot;</span>
      haproxy:
        state: disabled
        host:  <span class="token string">&quot;{{ inventory_hostname }}&quot;</span>
        backend: <span class="token string">&quot;{{ web_backend }}&quot;</span>
        socket: /var/lib/haproxy/stats
      delegate_to: <span class="token string">&quot;{{ item }}&quot;</span>
      loop: <span class="token string">&quot;{{ groups['lbservers'] }}&quot;</span>
    <span class="token comment"># 关闭Tomcat</span>
    - name: Systemd Tomcat  Stoppend
      shell:
        cmd: <span class="token string">&quot;nohup /soft/tomcat/bin/shutdown.sh &amp;&quot;</span>
    <span class="token comment"># 检测端口是否存活</span>
    - name: Check Tomcat  Port
      wait_for:
        port: <span class="token string">&quot;{{ service_port }}&quot;</span>
        state: stopped
    <span class="token comment"># 为web集群创建站点目录</span>
    - name: Create Web Site Directory
      file:
       path: <span class="token string">&quot;{{ work_dir}}/{{ web_name }}_{{ date.stdout }}&quot;</span>
       state: directory
    <span class="token comment"># 解压目录</span>
    - name: Unarchive Web Code
      unarchive:
        src: <span class="token string">&quot;{{ workspace.stdout }}&quot;</span>
        dest: <span class="token string">&quot;{{ work_dir }}/{{ web_name }}_{{ date.stdout }}&quot;</span>
    <span class="token comment"># 删除软链接</span>
    - name: Unlink Path
      file:
         path: <span class="token string">&quot;{{ tomcat_site }}/{{ web_name }}&quot;</span>
         state: absent
    <span class="token comment"># 重新创建链接</span>
    - name: Create Links Path
      file:
        src: <span class="token string">&quot;{{ work_dir}}/{{ web_name }}_{{ date.stdout }}&quot;</span>
        dest: <span class="token string">&quot;{{ tomcat_site  }}/{{ web_name }}&quot;</span>
        state: <span class="token function">link</span>     <span class="token comment">#state是link的时候代表软连接</span>
    <span class="token comment"># 启动tomcat  Server</span>
    - name: Systemd Nginx Started
      shell:
        cmd: <span class="token string">&quot;nohup /soft/tomcat/bin/startup.sh &amp;&quot;</span>
    <span class="token comment"># 检测端口是否存活</span>
    - name: Check tomcat  Port
      wait_for:
        port: <span class="token string">&quot;{{ service_port }}&quot;</span>
        state: started
    <span class="token comment"># 上线节点</span>
    - name: online Haproxy <span class="token string">&quot;{{ inventory_hostname}}&quot;</span>
      haproxy:
        state: enabled
        host:  <span class="token string">&quot;{{ inventory_hostname }}&quot;</span>
        backend: <span class="token string">&quot;{{ web_backend }}&quot;</span>
        socket: /var/lib/haproxy/stats
      delegate_to: <span class="token string">&quot;{{ item }}&quot;</span>
      loop: <span class="token string">&quot;{{ groups['lbservers'] }}&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br></div></div><h3 id="集成nexus制品库"><a href="#集成nexus制品库" class="header-anchor">#</a> 集成Nexus制品库</h3> <h4 id="nexus介绍"><a href="#nexus介绍" class="header-anchor">#</a> Nexus介绍</h4> <p>nexus的全称是Nexus Repository Manager，是Sonatype公司的一个产品。它是一个强大的仓库管理器，极大地简化了内部仓库的维护和外部仓库的访问</p> <p>我们主要用它来搭建公司内部的maven私服。但是它的功能不仅仅是创建maven私有仓库这么简单，还可以作为nuget、docker、npm、bower、pypi、rubygems、git lfs、yum、go、apt等的私有仓库，功能非常强大</p> <h4 id="优点"><a href="#优点" class="header-anchor">#</a> 优点</h4> <p>1.节省外网带宽：大量对中央仓库的重复请求会消耗带宽，利用私服代理外部仓库，可以避免重复的公网下载降低带宽的压力。</p> <p>2.加速maven的构建：maven通过内网从私服拉取所需构件（私服存在此构件的情况下），获取构件的速度大大加快，从而加快打包构件的速度。</p> <p>3.部署第三方构件：开发人员自己封装的一些jar包（工具类），可以部署到私服，以便内部开发人员的maven项目使用。</p> <p>4.提高稳定性：当公网网络不稳定的时候，如果使用远程仓库，maven的构建也会变得不稳定。如果在私服存在所需的构件，即使没有公网，maven的构件也会顺利进行。</p> <p>5.降低中央仓库的负荷：使用私服，避免了从中央仓库的重复下载，可以减轻中央仓库的负荷。</p> <h4 id="nexus安装"><a href="#nexus安装" class="header-anchor">#</a> Nexus安装</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@xiaomao7 ~<span class="token punctuation">]</span><span class="token comment"># tar xf nexus-3.19.1-01-unix.tar.gz   -C  /usr/local/</span>
<span class="token punctuation">[</span>root@xiaomao7 ~<span class="token punctuation">]</span><span class="token comment"># ln -sv  /usr/local/nexus-3.19.1-01/  /usr/local/nexus</span>
‘/usr/local/nexus’ -<span class="token operator">&gt;</span> ‘/usr/local/nexus-3.19.1-01/’
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="nexus仓库"><a href="#nexus仓库" class="header-anchor">#</a> Nexus仓库</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@xiaomao7 ~<span class="token punctuation">]</span><span class="token comment"># cat /usr/local/nexus/bin/nexus.rc</span>
<span class="token comment">#run_as_user=&quot;&quot;</span>
<span class="token assign-left variable">run_as_user</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span>   <span class="token comment"># nexus进程运行用户</span>
<span class="token comment"># 修改监听端口和监听地址</span>
<span class="token punctuation">[</span>root@xiaomao7 ~<span class="token punctuation">]</span><span class="token comment"># vim /usr/local/nexus/etc/nexus-default.properties</span>
application-port<span class="token operator">=</span><span class="token number">8083</span>
application-host<span class="token operator">=</span><span class="token number">10.2</span>.32.10
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="nexus启动"><a href="#nexus启动" class="header-anchor">#</a> Nexus启动</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@xiaomao7 ~<span class="token punctuation">]</span><span class="token comment">#/usr/local/nexus/bin/nexus  restart</span>
<span class="token comment"># 查看端口是否启动</span>
<span class="token punctuation">[</span>root@xiaomao7 ~<span class="token punctuation">]</span><span class="token comment"># ss -ntl</span>
State       Recv-Q Send-Q                                                  Local Address:Port                                                                 Peer Address:Port
LISTEN      <span class="token number">0</span>      <span class="token number">50</span>                                                         <span class="token number">10.2</span>.32.10:8083                                                                            *:*
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="访问-2"><a href="#访问-2" class="header-anchor">#</a> 访问</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>http://10.2.32.10:8083/
<span class="token punctuation">[</span>root@xiaomao7 ~<span class="token punctuation">]</span><span class="token comment"># cat /usr/local/sonatype-work/nexus3/admin.password</span>
<span class="token comment"># 下面是密码    账号是admin</span>
d6481b4f-d7a9-4d82-a421-5e03b5583f24
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640697017941-4b184b09-b0e1-45a4-a001-b4abc2116a05.png" alt="img"></p> <h4 id="配置nexus-web界面"><a href="#配置nexus-web界面" class="header-anchor">#</a> 配置Nexus WEB界面</h4> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640697765513-387b3617-6280-4bbc-8853-2fd502fe5d40.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640697924404-30925e71-c3bc-4598-bbee-78057c46ac70.png" alt="img"></p> <h4 id="配置maven连接nexus"><a href="#配置maven连接nexus" class="header-anchor">#</a> 配置maven连接Nexus</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 装有maven的软件</span>
<span class="token punctuation">[</span>root@xiaomao8 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/maven/settings.xml</span>
<span class="token operator">&lt;</span>servers<span class="token operator">&gt;</span>
			 <span class="token operator">&lt;</span>server<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>id<span class="token operator">&gt;</span>nexus-snapshots<span class="token operator">&lt;</span>/id<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>admin<span class="token operator">&lt;</span>/username<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>password<span class="token operator">&gt;</span><span class="token number">12345</span><span class="token operator"><span class="token file-descriptor important">6</span>&lt;</span>/password<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/server<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>server<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>id<span class="token operator">&gt;</span>nexus-release<span class="token operator">&lt;</span>/id<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>admin<span class="token operator">&lt;</span>/username<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>password<span class="token operator">&gt;</span><span class="token number">12345</span><span class="token operator"><span class="token file-descriptor important">6</span>&lt;</span>/password<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/server<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>server<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>id<span class="token operator">&gt;</span>maven-central<span class="token operator">&lt;</span>/id<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>admin<span class="token operator">&lt;</span>/username<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>password<span class="token operator">&gt;</span><span class="token number">12345</span><span class="token operator"><span class="token file-descriptor important">6</span>&lt;</span>/password<span class="token operator">&gt;</span>  <span class="token comment">#nexus的密码</span>
    <span class="token operator">&lt;</span>/server<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/servers<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>mirrors<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>mirror<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>id<span class="token operator">&gt;</span>maven-central<span class="token operator">&lt;</span>/id<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>mirrorOf<span class="token operator">&gt;</span>*<span class="token operator">&lt;</span>/mirrorOf<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>url<span class="token operator">&gt;</span>http://10.2.32.10/repository/maven-central/<span class="token operator">&lt;</span>/url<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/mirror<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>mirror<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>id<span class="token operator">&gt;</span>nexus-snapshots<span class="token operator">&lt;</span>/id<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>mirrorOf<span class="token operator">&gt;</span>*<span class="token operator">&lt;</span>/mirrorOf<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>url<span class="token operator">&gt;</span>http://10.2.32.10/repository/maven-snapshots<span class="token operator">&lt;</span>/url<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/mirror<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>mirror<span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span>id<span class="token operator">&gt;</span>nexus-releases<span class="token operator">&lt;</span>/id<span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span>mirrorOf<span class="token operator">&gt;</span>*<span class="token operator">&lt;</span>/mirrorOf<span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span>url<span class="token operator">&gt;</span>http://10.2.32.10/repository/maven-releases<span class="token operator">&lt;</span>/url<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/mirror<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/mirrors<span class="token operator">&gt;</span>
<span class="token comment"># 测试是否链接成功</span>
<span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># mvn package</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h4 id="上传war包到nexus"><a href="#上传war包到nexus" class="header-anchor">#</a> 上传war包到Nexus</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#查看版本</span>
<span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># vim pom.xml</span>
<span class="token comment"># 上传war包</span>
<span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># mvn  deploy:deploy-file  \</span>
<span class="token parameter variable">-DgroupId</span><span class="token operator">=</span>com.efsavage <span class="token punctuation">\</span>
<span class="token parameter variable">-DartifactId</span><span class="token operator">=</span>hello-world-war <span class="token punctuation">\</span>
<span class="token parameter variable">-Dversion</span><span class="token operator">=</span><span class="token number">10.0</span>.0 <span class="token punctuation">\</span>
<span class="token parameter variable">-Dpackaging</span><span class="token operator">=</span>war <span class="token punctuation">\</span>
<span class="token parameter variable">-Dfile</span><span class="token operator">=</span>target/hello-world-war-10.0.0.war  <span class="token punctuation">\</span>
<span class="token parameter variable">-Durl</span><span class="token operator">=</span>http://10.2.32.10/repository/maven-releases/  <span class="token punctuation">\</span>
<span class="token parameter variable">-DrepositoryId</span><span class="token operator">=</span>nexus-releases <span class="token punctuation">\</span>
<span class="token parameter variable">-DgeneratePom</span><span class="token operator">=</span>true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>也可以手动上传</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640706866955-beb184e9-e1c7-4401-ab5d-d10fde8fd09e.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640706905329-1f57178f-27c2-44a6-90d3-d8fdba4793d7.png" alt="img"></p> <h3 id="jenkins实现war包的ci与cd"><a href="#jenkins实现war包的ci与cd" class="header-anchor">#</a> Jenkins实现war包的CI与CD</h3> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640778087207-7d27de74-5598-4a7e-a14c-b8ecf17154a8.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640778179726-18dad85c-1ee7-4b89-be93-936972b73293.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640778194940-ecb8d3fa-3956-46cb-8cef-020063d78682.png" alt="img"></p> <h4 id="编写shell脚本-ci"><a href="#编写shell脚本-ci" class="header-anchor">#</a> 编写shell脚本（CI）</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># cat /scripts/deploy_nexus.sh</span>
<span class="token assign-left variable">groupId</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>mvn  help:evaluate <span class="token parameter variable">-Dexpression</span><span class="token operator">=</span>project.groupId <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">&quot;[INFO]&quot;</span><span class="token variable">)</span></span>
<span class="token assign-left variable">artifactId</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>mvn  help:evaluate <span class="token parameter variable">-Dexpression</span><span class="token operator">=</span>project.artifactId <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">&quot;[INFO]&quot;</span><span class="token variable">)</span></span>
<span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>mvn  help:evaluate <span class="token parameter variable">-Dexpression</span><span class="token operator">=</span>project.version <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">&quot;[INFO]&quot;</span><span class="token variable">)</span></span>
<span class="token assign-left variable">packaging</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>mvn  help:evaluate <span class="token parameter variable">-Dexpression</span><span class="token operator">=</span>project.packaging <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">&quot;[INFO]&quot;</span><span class="token variable">)</span></span>

mvn  deploy:deploy-file  <span class="token punctuation">\</span>
<span class="token parameter variable">-DgroupId</span><span class="token operator">=</span><span class="token variable">${groupId}</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-DartifactId</span><span class="token operator">=</span><span class="token variable">${artifactId}</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-Dversion</span><span class="token operator">=</span><span class="token variable">${version}</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-Dpackaging</span><span class="token operator">=</span><span class="token variable">${packaging}</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-Dfile</span><span class="token operator">=</span>target/<span class="token variable">${artifactId}</span>-<span class="token variable">${version}</span><span class="token builtin class-name">.</span><span class="token variable">${packaging}</span>  <span class="token punctuation">\</span>
<span class="token parameter variable">-Durl</span><span class="token operator">=</span>http://10.2.32.10/repository/maven-releases/  <span class="token punctuation">\</span>
<span class="token parameter variable">-DrepositoryId</span><span class="token operator">=</span>nexus-releases  <span class="token punctuation">\</span>
<span class="token parameter variable">-DgeneratePom</span><span class="token operator">=</span>true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="基于nexus实现自动ci"><a href="#基于nexus实现自动ci" class="header-anchor">#</a> 基于Nexus实现自动CI</h4> <p>jenkins部分</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640879709933-be66bc2f-03bc-4855-b111-e42460f82bf7.png" alt="img"></p> <p><img src="https://cdn.nlark.com/yuque/0/2021/png/10358179/1640778491481-5cf58667-98d5-4072-aa76-8008dc44f91b.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_27%2Ctext_eGlhb21hbw%3D%3D%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640778509528-a4318b17-8e7a-42ac-b5bd-650a37eb8290.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640879746078-b9a2075b-22a9-489d-9597-17eb762ec487.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640879759080-c93cf8cf-2374-4cd2-9c7e-a6b8ffc0d30a.png" alt="img"></p> <p>gitlab配置</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640779601117-5b01841a-158e-43ed-ad6d-d90575020d74.png" alt="img">修改代码后会自动构建</p> <h4 id="基于nexus实现cd任务"><a href="#基于nexus实现cd任务" class="header-anchor">#</a> 基于Nexus实现CD任务</h4> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640781938839-63c543fd-d445-4efc-81b9-16a19ca14b58.png" alt="img"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>备注:要装好相关的插件
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640855567171-d5309476-a3be-4be4-9522-6a9b38682a75.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640855584832-103bc956-de6c-41fa-bf5d-7ed60c25c18d.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640783480610-c8e539d7-b94e-43e8-9de2-39dee3110dd1.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640783663340-00592192-f1e5-45ec-b007-d49390b98e33.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640783837156-96cd1ad8-e667-4cb1-b5e6-f1d9cb5c5b5c.png" alt="img"></p> <h5 id="测试是否能连接"><a href="#测试是否能连接" class="header-anchor">#</a> 测试是否能连接</h5> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640784121888-a9c4aba4-8c95-4848-8926-3944feb7d5c3.png" alt="img"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 修改代码做测试看看是否出现先的war包</span>
<span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># cat pom.xml</span>
<span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">5.0</span>.<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/version<span class="token operator">&gt;</span>
<span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># git add .</span>
<span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># git commit -m &quot;5.0.0&quot;</span>
<span class="token punctuation">[</span>master c5e9363<span class="token punctuation">]</span> <span class="token number">5.0</span>.0
 <span class="token number">1</span> <span class="token function">file</span> changed, <span class="token number">1</span> insertion<span class="token punctuation">(</span>+<span class="token punctuation">)</span>, <span class="token number">1</span> deletion<span class="token punctuation">(</span>-<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># git push origin master</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640784335608-7e1771b4-bdf3-4be8-9904-138bca7003d6.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640832855029-f5bd4221-e3de-434c-aee4-98c9509954cb.png" alt="img"></p> <h5 id="编写shell脚本-2"><a href="#编写shell脚本-2" class="header-anchor">#</a> 编写shell脚本</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@xiaomao8 ~<span class="token punctuation">]</span><span class="token comment"># cat /scripts/deploy_nexus_war.sh</span>
<span class="token comment">#!/usr/bin/bash</span>
<span class="token assign-left variable">web_dir</span><span class="token operator">=</span>/opt
<span class="token assign-left variable">web_name</span><span class="token operator">=</span>ROOT
<span class="token assign-left variable">tomcat_site</span><span class="token operator">=</span>/soft/tomcat/webapps
<span class="token assign-left variable">tomcat_bin</span><span class="token operator">=</span>/soft/tomcat/bin

<span class="token function-name function">lb_server_disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">ssh</span> root@<span class="token variable">${lbservers}</span> <span class="token string">&quot;echo 'disable server java_cluster/<span class="token variable">$1</span>' | socat stdio /var/lib/haproxy/stats&quot;</span>
<span class="token punctuation">}</span>


<span class="token function-name function">lb_server_enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">ssh</span> root@<span class="token variable">${lbservers}</span> <span class="token string">&quot;echo 'enable  server java_cluster/<span class="token variable">$1</span>' | socat stdio /var/lib/haproxy/stats&quot;</span>
<span class="token punctuation">}</span>



<span class="token comment">#1.提取包名称</span>
<span class="token assign-left variable">pkg_name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $<span class="token punctuation">{</span>java_deploy_package<span class="token comment">##*/}</span><span class="token variable">)</span></span>

<span class="token comment">#2.基于包名称提取创建的目录名称</span>
<span class="token assign-left variable">dir_name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $<span class="token punctuation">{</span>pkg_name%.*<span class="token punctuation">}</span><span class="token variable">)</span></span>

<span class="token comment">#3.下载编译后的包到指定的路径</span>
<span class="token function">wget</span> <span class="token parameter variable">-O</span> <span class="token variable">${web_dir}</span>/<span class="token variable">${pkg_name}</span> <span class="token parameter variable">--user</span><span class="token operator">=</span>admin <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token variable">${java_deploy_package}</span>

<span class="token comment">#4.推送war包</span>
<span class="token comment">#5.停止Tomcat,解压war包到指定的路径,然后删除软链接,重建软链接,启动Tomcat</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">host</span> <span class="token keyword">in</span> <span class="token variable">${webserver}</span>
<span class="token keyword">do</span>
        lb_server_disable <span class="token variable">${host}</span>
        <span class="token function">scp</span> <span class="token variable">${web_dir}</span>/<span class="token variable">${pkg_name}</span>  root@<span class="token variable">${host}</span><span class="token builtin class-name">:</span><span class="token variable">${web_dir}</span>/<span class="token variable">${pkg_name}</span>
        <span class="token function">ssh</span> root@<span class="token variable">${host}</span>  <span class="token string">&quot;<span class="token variable">${tomcat_bin}</span>/shutdown.sh  &amp;&amp; \
                         cd <span class="token variable">${web_dir}</span> &amp;&amp; mkdir -p <span class="token variable">${dir_name}</span> &amp;&amp; \
                         unzip <span class="token variable">${pkg_name}</span> -d <span class="token variable">${dir_name}</span> &amp;&amp; \
                         rm -rf <span class="token variable">${tomcat_site}</span>/<span class="token variable">${web_name}</span> &amp;&amp; \
                         ln -s <span class="token variable">${web_dir}</span>/<span class="token variable">${dir_name}</span>  <span class="token variable">${tomcat_site}</span>/<span class="token variable">${web_name}</span> &amp;&amp; \
                         <span class="token variable">${tomcat_bin}</span>/startup.sh&quot;</span>
       <span class="token function">sleep</span> <span class="token number">5</span>
       lb_server_enable <span class="token variable">${host}</span>
<span class="token keyword">done</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h4 id="基于ansible实现部署"><a href="#基于ansible实现部署" class="header-anchor">#</a> 基于ansible实现部署</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@xiaomao8 ~<span class="token punctuation">]</span><span class="token comment"># cat /scripts/deploy_nexus_war.yml</span>
- hosts: webservers
  vars:
    - work_dir: /opt
    - web_name: ROOT
    - tomcat_site: /soft/tomcat/webapps
    - web_backend: java_cluster
    - service_port: <span class="token number">8010</span>
  serial: <span class="token number">1</span>
  tasks:
   <span class="token comment"># 1.提取url地址 {{ java_deploy_package.stdout }}</span>
   - name: Get Packages Url Name
     shell:
       cmd: <span class="token string">&quot;echo <span class="token variable">${java_deploy_package}</span>&quot;</span>
     register: java_deploy_package
     delegate_to: <span class="token number">127.0</span>.0.1
   <span class="token comment"># 2. 提取url中包名称</span>
   - name: Get Package Name
     shell:
       cmd: <span class="token string">&quot;echo <span class="token variable">${java_deploy_package}</span> | awk 'BEGIN {FS=<span class="token entity" title="\&quot;">\&quot;</span>/<span class="token entity" title="\&quot;">\&quot;</span>} {print <span class="token variable">$NF</span>}'&quot;</span>
     register: java_deploy_pkg
     delegate_to: <span class="token number">127.0</span>.0.1
   <span class="token comment"># 3.下载war包到/opt目录</span>
   - name: Get Url
     get_url:
       url: <span class="token string">&quot;{{ java_deploy_package.stdout }}&quot;</span>
       dest: <span class="token string">&quot;{{ work_dir }}/{{ java_deploy_pkg.stdout }}&quot;</span>
       username: admin
       password: <span class="token number">123456</span>
     delegate_to: <span class="token number">127.0</span>.0.1

   <span class="token comment">#4.平滑下线web节点</span>
   - name: offline Haproxy <span class="token string">&quot;{{ inventory_hostname}}&quot;</span>
     haproxy:
        state: disabled
        host:  <span class="token string">&quot;{{ inventory_hostname }}&quot;</span>
        backend: <span class="token string">&quot;{{ web_backend }}&quot;</span>
        socket: /var/lib/haproxy/stats
     delegate_to: <span class="token string">&quot;{{ item }}&quot;</span>
     loop: <span class="token string">&quot;{{ groups['lbservers'] }}&quot;</span>
   <span class="token comment">#5.关闭Tomcat服务</span>
   - name: Shutdown Tomcat Server
     shell:
        cmd: <span class="token string">&quot;nohup /soft/tomcat/bin/shutdown.sh &amp;&quot;</span>

   - name: <span class="token function">wait</span> check Tomcat Port Shutdown
     wait_for:
        port: <span class="token number">8080</span>
        state: stopped
   <span class="token comment">#6.创建目录</span>
   - name: Create Tomcat Web Site Direcotry
     file:
        path: <span class="token string">&quot;{{ work_dir }}/{{ java_deploy_pkg.stdout }}&quot;</span>
        state: directory
   <span class="token comment">#7.解压包到指定的路径</span>
   - name: Unarchive Web Code
     unarchive:
        src: <span class="token string">&quot;{{ work_dir }}/{{ java_deploy_pkg.stdout }}&quot;</span>
        dest: <span class="token string">&quot;{{ work_dir }}/{{ java_deploy_pkg.stdout }}&quot;</span>
   <span class="token comment">#8. 删除软链接</span>
   - name: Unlink Path
     file:
         path: <span class="token string">&quot;{{ tomcat_site }}/{{ web_name }}&quot;</span>
         state: absent
   <span class="token comment">#9.重建软链接</span>
   - name: Create Links Path
     file:
        src: <span class="token string">&quot;{{ work_dir }}/{{ java_deploy_pkg.stdout }}&quot;</span>
        dest: <span class="token string">&quot;{{ tomcat_site  }}/{{ web_name }}&quot;</span>
        state: <span class="token function">link</span>
   <span class="token comment">#10.启动tomcat</span>
   - name: Systemd Nginx Started
     shell:
        cmd: <span class="token string">&quot;nohup /soft/tomcat/bin/startup.sh &amp;&quot;</span>
   <span class="token comment">#11.检测端口</span>
   - name: Check tomcat  Port
     wait_for:
        port: <span class="token string">&quot;{{ service_port }}&quot;</span>
        state: started
   <span class="token comment">#加入到负载均衡</span>
   - name: online Haproxy <span class="token string">&quot;{{ inventory_hostname}}&quot;</span>
     haproxy:
        state: enabled
        host:  <span class="token string">&quot;{{ inventory_hostname }}&quot;</span>
        backend: <span class="token string">&quot;{{ web_backend }}&quot;</span>
        socket: /var/lib/haproxy/stats
     delegate_to: <span class="token string">&quot;{{ item }}&quot;</span>
     loop: <span class="token string">&quot;{{ groups['lbservers'] }}&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br></div></div><p>到了这步就可以模拟开发更改代码,进行一次ci与cd的测试了,修改后nexus_sh(CI) 会自动构建和上传</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># vim src/main/webapp/index.jsp</span>
<span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># git  add .</span>
<span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># git commit -m &quot;6&quot;</span>
<span class="token punctuation">[</span>master d2c311a<span class="token punctuation">]</span> <span class="token number">6</span>
 <span class="token number">2</span> files changed, <span class="token number">2</span> insertions<span class="token punctuation">(</span>+<span class="token punctuation">)</span>, <span class="token number">2</span> deletions<span class="token punctuation">(</span>-<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># git push origin master</span>
Counting objects: <span class="token number">13</span>, done.
Delta compression using up to <span class="token number">4</span> threads.
Compressing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">5</span>/5<span class="token punctuation">)</span>, done.
Writing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">7</span>/7<span class="token punctuation">)</span>, <span class="token number">518</span> bytes <span class="token operator">|</span> <span class="token number">0</span> bytes/s, done.
Total <span class="token number">7</span> <span class="token punctuation">(</span>delta <span class="token number">3</span><span class="token punctuation">)</span>, reused <span class="token number">0</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>
To git@www.xiaomao.com:dev/spring-hello-world-war.git
   c5e9363<span class="token punctuation">..</span>d2c311a  master -<span class="token operator">&gt;</span> master
  <span class="token comment"># 修改版本 </span>
 <span class="token punctuation">[</span>root@xiaomao8 spring-hello-world-war<span class="token punctuation">]</span><span class="token comment"># cat pom.xml</span>
        <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">81.0</span>.<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/version<span class="token operator">&gt;</span>
  <span class="token comment"># 等一段时间后就看到版本出来了</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640879881594-813db53c-38e6-4740-92b9-98c6ba6ed115.png" alt="img"></p> <h3 id="实现jar包的ci与cd"><a href="#实现jar包的ci与cd" class="header-anchor">#</a> 实现jar包的CI与CD</h3> <h4 id="gitlab项目创建"><a href="#gitlab项目创建" class="header-anchor">#</a> gitlab项目创建</h4> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640932890395-28f9ec04-c18b-4fae-8164-5c806a54bf16.png" alt="img"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 提交代码</span>
<span class="token punctuation">[</span>root@xiaomao8 springboot-helloworld<span class="token punctuation">]</span><span class="token comment"># git init</span>
<span class="token punctuation">[</span>root@xiaomao8 springboot-helloworld<span class="token punctuation">]</span><span class="token comment"># git remote add origin git@www.xiaomao.com:dev/spring-hello-world-jar.git</span>
<span class="token punctuation">[</span>root@xiaomao8 springboot-helloworld<span class="token punctuation">]</span><span class="token comment"># git add .</span>
<span class="token punctuation">[</span>root@xiaomao8 springboot-helloworld<span class="token punctuation">]</span><span class="token comment"># git commit -m &quot;Initial commit&quot;</span>
<span class="token punctuation">[</span>root@xiaomao8 springboot-helloworld<span class="token punctuation">]</span><span class="token comment"># git push -u origin master</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="创建ci"><a href="#创建ci" class="header-anchor">#</a> 创建CI</h4> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640933262337-c094584c-e90f-4956-abeb-a9e261aa99fe.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640933379683-d2e60b3e-aad3-4b5a-bd35-b764112cb5e3.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640933561396-8ab07355-9299-481e-89a9-5b955cc338ef.png" alt="img"></p> <p>配置自动构建</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640934387867-ae8e0b33-723a-40a7-b389-bdc0ce5ee019.png" alt="img"></p> <p><img src="https://cdn.nlark.com/yuque/0/2021/png/10358179/1640934401673-f537cd77-59ce-4646-8954-493d4f9f1386.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_27%2Ctext_eGlhb21hbw%3D%3D%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10" alt="img"></p> <p>gitlab操作</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640934538405-f49e166e-3c03-46bf-aa99-ab3037074b42.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640934591933-691838b9-514a-46a0-9bf2-170ce4003688.png" alt="img"></p> <h5 id="ci的shell脚本"><a href="#ci的shell脚本" class="header-anchor">#</a> ci的shell脚本</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@xiaomao8 springboot-helloworld<span class="token punctuation">]</span><span class="token comment"># cat /scripts/deploy_nexus.sh</span>
<span class="token assign-left variable">groupId</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>mvn  help:evaluate <span class="token parameter variable">-Dexpression</span><span class="token operator">=</span>project.groupId <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">&quot;[INFO]&quot;</span><span class="token variable">)</span></span>
<span class="token assign-left variable">artifactId</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>mvn  help:evaluate <span class="token parameter variable">-Dexpression</span><span class="token operator">=</span>project.artifactId <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">&quot;[INFO]&quot;</span><span class="token variable">)</span></span>
<span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>mvn  help:evaluate <span class="token parameter variable">-Dexpression</span><span class="token operator">=</span>project.version <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">&quot;[INFO]&quot;</span><span class="token variable">)</span></span>
<span class="token assign-left variable">packaging</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>mvn  help:evaluate <span class="token parameter variable">-Dexpression</span><span class="token operator">=</span>project.packaging <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">&quot;[INFO]&quot;</span><span class="token variable">)</span></span>

mvn  deploy:deploy-file  <span class="token punctuation">\</span>
<span class="token parameter variable">-DgroupId</span><span class="token operator">=</span><span class="token variable">${groupId}</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-DartifactId</span><span class="token operator">=</span><span class="token variable">${artifactId}</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-Dversion</span><span class="token operator">=</span><span class="token variable">${version}</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-Dpackaging</span><span class="token operator">=</span><span class="token variable">${packaging}</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-Dfile</span><span class="token operator">=</span><span class="token variable">${WORKSPACE}</span>/target/<span class="token variable">${artifactId}</span>-<span class="token variable">${version}</span><span class="token builtin class-name">.</span><span class="token variable">${packaging}</span>  <span class="token punctuation">\</span>
<span class="token parameter variable">-Durl</span><span class="token operator">=</span>http://10.2.32.10/repository/maven-releases/  <span class="token punctuation">\</span>
<span class="token parameter variable">-DrepositoryId</span><span class="token operator">=</span>nexus-releases  <span class="token punctuation">\</span>
<span class="token parameter variable">-DgeneratePom</span><span class="token operator">=</span>true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>最后在下方点击添加即可</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 测试自动构建 修改代码</span>
<span class="token comment"># 修改版本</span>
<span class="token punctuation">[</span>root@xiaomao8 springboot-helloworld<span class="token punctuation">]</span><span class="token comment"># vim pom.xml</span>
  <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">2</span>.<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/version<span class="token operator">&gt;</span>
<span class="token comment"># 修改展示界面</span>
<span class="token punctuation">[</span>root@xiaomao8 springboot-helloworld<span class="token punctuation">]</span><span class="token comment"># vim src/main/java/com/oldxu/helloworld/controller/HomeController.java</span>
<span class="token comment"># 提交代码</span>
<span class="token punctuation">[</span>root@xiaomao8 springboot-helloworld<span class="token punctuation">]</span><span class="token comment"># git add .</span>
<span class="token punctuation">[</span>root@xiaomao8 springboot-helloworld<span class="token punctuation">]</span><span class="token comment"># git commit -m &quot;add&quot;</span>
<span class="token punctuation">[</span>root@xiaomao8 springboot-helloworld<span class="token punctuation">]</span><span class="token comment"># git push origin master</span>
<span class="token comment"># 提交完返回查看jenkins工程是否已经自动构建</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h5 id="负载均衡配置"><a href="#负载均衡配置" class="header-anchor">#</a> 负载均衡配置</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 提前配置jar包访问的端口，只要没有用过的端口就行</span>
<span class="token comment"># 负载均衡配置</span>
<span class="token punctuation">[</span>root@xiaomao6 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/haproxy/haproxy.cfg</span>
backend jar_cluster
    balance roundrobin
    server <span class="token number">10.2</span>.32.12  <span class="token number">10.2</span>.32.12:8899  check port <span class="token number">8899</span>
    server <span class="token number">10.2</span>.32.10  <span class="token number">10.2</span>.32.10:8899  check port <span class="token number">8899</span>
<span class="token comment"># 重启haproxy</span>
<span class="token punctuation">[</span>root@xiaomao6 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart haproxy</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="创建cd"><a href="#创建cd" class="header-anchor">#</a> 创建CD</h4> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640939853846-cfd1b830-4cd7-4dbf-b556-03d0ddf85361.png" alt="img"></p> <p>变量名称随便取</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640939951998-25153226-8bd9-49d4-b9d5-b78fc7c39471.png" alt="img"></p> <p>私有仓库的信息</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640939989770-221fd1a9-b7a3-4d97-9e33-62132be0982f.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640940036869-46b66811-3207-48d5-98a4-45d818505b7e.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640940053858-7fd23acf-facb-4e9f-a0bc-535811958276.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640940067859-ca517d7c-8f0e-4615-a184-a1acdf7cc205.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1640940106708-cd697afc-f901-4008-84bb-05299f221d76.png" alt="img"></p> <h4 id="shell脚本"><a href="#shell脚本" class="header-anchor">#</a> shell脚本</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@xiaomao8 scripts<span class="token punctuation">]</span><span class="token comment"># cat deploy_nexus_jar.sh</span>
<span class="token comment">#!/usr/bin/bash</span>
<span class="token assign-left variable">web_dir</span><span class="token operator">=</span>/opt
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">1809</span>

<span class="token function-name function">lb_server_disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">ssh</span> root@<span class="token variable">${lbservers}</span> <span class="token string">&quot;echo 'disable server java_cluster/<span class="token variable">$1</span>' | socat stdio /var/lib/haproxy/stats&quot;</span>
<span class="token punctuation">}</span>


<span class="token function-name function">lb_server_enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">ssh</span> root@<span class="token variable">${lbservers}</span> <span class="token string">&quot;echo 'enable  server java_cluster/<span class="token variable">$1</span>' | socat stdio /var/lib/haproxy/stats&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment">#1.提取包名称</span>
<span class="token assign-left variable">pkg_name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $<span class="token punctuation">{</span>java_deploy_package<span class="token comment">##*/}</span><span class="token variable">)</span></span>

<span class="token comment">#2.基于包名称提取创建的目录名称</span>
<span class="token assign-left variable">pkg_process</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $<span class="token punctuation">{</span>pkg_name%-*<span class="token punctuation">}</span><span class="token variable">)</span></span>

<span class="token comment">#3.下载编译后的包到指定的路径</span>
<span class="token function">wget</span> <span class="token parameter variable">-O</span> <span class="token variable">${web_dir}</span>/<span class="token variable">${pkg_name}</span> <span class="token parameter variable">--user</span><span class="token operator">=</span>admin <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token variable">${java_deploy_package}</span>

<span class="token comment">#4.推送jar包,停止jar,启动jar</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">host</span> <span class="token keyword">in</span> <span class="token variable">${webserver}</span>
<span class="token keyword">do</span>
        lb_server_disable <span class="token variable">${host}</span>
        <span class="token function">scp</span> <span class="token variable">${web_dir}</span>/<span class="token variable">${pkg_name}</span>  root@<span class="token variable">${host}</span><span class="token builtin class-name">:</span><span class="token variable">${web_dir}</span>/<span class="token variable">${pkg_name}</span>
        <span class="token function">ssh</span> root@<span class="token variable">${host}</span>   <span class="token string">'jar_status=$(ps aux | grep demo-service | grep -v grep | awk &quot;{print \$2}&quot;) &amp;&amp; \
                            kill -9 ${jar_status}'</span>
        <span class="token function">ssh</span> root@<span class="token variable">${host}</span>   <span class="token string">&quot;nohup java -jar <span class="token variable">${web_dir}</span>/<span class="token variable">${pkg_name}</span> --server.port=<span class="token variable">${port}</span>  &amp;&gt;/dev/null &amp;&quot;</span>
        <span class="token function">sleep</span> <span class="token number">5</span>
        lb_server_enable <span class="token variable">${host}</span>
<span class="token keyword">done</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="sonarqube"><a href="#sonarqube" class="header-anchor">#</a> SonarQube</h3> <h4 id="sonarqube基本介绍"><a href="#sonarqube基本介绍" class="header-anchor">#</a> SonarQube基本介绍</h4> <p>SonarQube是一个开源的代码质量管理系统，用于检测代码中的错误,漏洞,它可以与Jenkins集成，</p> <p>让我们进行自动化代码质量扫描</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641061651312-fcbe4a22-7383-4ad4-936e-adb3f30c5972.png" alt="img"></p> <h4 id="使用sonarqube前提"><a href="#使用sonarqube前提" class="header-anchor">#</a> 使用Sonarqube前提</h4> <p>1、SonarQube基于Java开发,所以需要安装Open Jdk8版本</p> <p>2、SonarQube需要依赖于MySQL数据库,至少5.6版本以上</p> <p>3、SonarQube的小型实例至少需要4GB内存,如果是大型实例需要16GB</p> <h4 id="服务安装"><a href="#服务安装" class="header-anchor">#</a> 服务安装</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 安装数据库</span>
<span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># ls</span>
mysql-community-client-5.6.45-2.el7.x86_64.rpm  mysql-community-libs-5.6.45-2.el7.x86_64.rpm    sonar_plugins.tar.gz  sonar-scanner-cli-4.0.0.1744-linux.zip
mysql-community-common-5.6.45-2.el7.x86_64.rpm  mysql-community-server-5.6.45-2.el7.x86_64.rpm  sonarqube-7.0.zip
<span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># yum -y install mysql-community-*</span>
<span class="token comment"># 启动MySQL数据库</span>
<span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># systemctl start mysqld</span>
<span class="token comment"># 为数据库设置密码</span>
<span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># mysqladmin password xiaomao.net</span>
<span class="token comment">#创建sonar库,设定字符集为utf8</span>
<span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># mysql -uroot -pxiaomao.net</span>
mysql<span class="token operator">&gt;</span> CREATE DATABASE sonar  DEFAULT CHARACTER SET utf8<span class="token punctuation">;</span>
Query OK, <span class="token number">1</span> row affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> SHOW DATABASES<span class="token punctuation">;</span>
+--------------------+
<span class="token operator">|</span> Database           <span class="token operator">|</span>
+--------------------+
<span class="token operator">|</span> information_schema <span class="token operator">|</span>
<span class="token operator">|</span> mysql              <span class="token operator">|</span>
<span class="token operator">|</span> performance_schema <span class="token operator">|</span>
<span class="token operator">|</span> sonar              <span class="token operator">|</span>
+--------------------+
<span class="token number">4</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h5 id="安装sonarqube"><a href="#安装sonarqube" class="header-anchor">#</a> 安装Sonarqube</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 解压源码包</span>
<span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># unzip sonarqube-7.0.zip  -d /usr/local/</span>
<span class="token comment"># 设置软链接</span>
<span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># ln -s  /usr/local/sonarqube-7.0/  /usr/local/sonarqube</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="修改sonarqube配置文件"><a href="#修改sonarqube配置文件" class="header-anchor">#</a> 修改Sonarqube配置文件</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code> <span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># vim /usr/local/sonarqube/conf/sonar.properties</span>
 <span class="token number">16</span> <span class="token assign-left variable">sonar.jdbc.username</span><span class="token operator">=</span>root
 <span class="token number">17</span> <span class="token assign-left variable">sonar.jdbc.password</span><span class="token operator">=</span>xiaomao.net
<span class="token number">26</span> <span class="token assign-left variable">sonar.jdbc.url</span><span class="token operator">=</span>jdbc:mysql://localhost:3306/sonar?useUnicode<span class="token operator">=</span>true<span class="token operator">&amp;</span><span class="token assign-left variable">characterEncoding</span><span class="token operator">=</span>utf8<span class="token operator">&amp;</span><span class="token assign-left variable">rewriteBatchedStatements</span><span class="token operator">=</span>true<span class="token operator">&amp;</span><span class="token assign-left variable">useConfigs</span><span class="token operator">=</span>maxPerformance<span class="token operator">&amp;</span><span class="token assign-left variable">useSSL</span><span class="token operator">=</span>false
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="启动sonarqube"><a href="#启动sonarqube" class="header-anchor">#</a> 启动Sonarqube</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 启动sonarqube服务需要使用普通用户运行,如果使用root则会启动失败</span>
<span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># useradd sonar</span>
<span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># chown -R sonar.sonar /usr/local/sonarqube-7.0/</span>
<span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># su - sonar -c &quot;/usr/local/sonarqube/bin/linux-x86-64/sonar.sh start&quot;</span>
Starting SonarQube<span class="token punctuation">..</span>.
Started SonarQube.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="访问sonarqube"><a href="#访问sonarqube" class="header-anchor">#</a> 访问Sonarqube</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>http://10.2.32.11:9000/about
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641063951121-1ce4c6f2-5edc-458b-ac8b-05f04a8cbf4b.png" alt="img"></p> <h5 id="生产token令牌"><a href="#生产token令牌" class="header-anchor">#</a> 生产token令牌</h5> <p>sonarqube初始化操作,配置认证token，使用Token访问sonar无需密码</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641064033800-d606f4c9-7316-4581-ad9d-c781de3611ae.png" alt="img"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#jenkins的时候需要配置</span>
993a70cb6dd50f9755bbecc183a38186811cab07
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641064054378-569e9a3e-ad63-47cd-a6bf-336af03f45e0.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641064260478-b8a524ee-f144-4f04-a346-c8f4c1663042.png" alt="img"></p> <h5 id="联网安装插件"><a href="#联网安装插件" class="header-anchor">#</a> 联网安装插件</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 安装好插件的路径</span>
<span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># ll /usr/local/sonarqube/extensions/plugins/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641064563815-e311921e-0804-4673-a9d4-fa9316988f40.png" alt="img"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 离线安装插件</span>
<span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># rm -rf  /usr/local/sonarqube/extensions/plugins/</span>
<span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># tar xf sonar_plugins.tar.gz  -C /usr/local/sonarqube/extensions/</span>
<span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># chown -R sonar.sonar /usr/local/sonarqube/extensions/plugins/[root@xiaomao8 test]# su - sonar -c  &quot;/usr/local/sonarqube/bin/linux-x86-64/sonar.sh restart&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="jenkins集成sonarqube"><a href="#jenkins集成sonarqube" class="header-anchor">#</a> jenkins集成SonarQube</h4> <p>jenkins需要知道Sonarqube服务;以便能将代码推送指定服务节点</p> <p>jenkins需要知道Sonar-Scanner客户端工具,以便能正常调用</p> <p>插件安装:系统管理---&gt;插件管理---&gt;SonarQube Scanner</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641065572016-e29affd1-4e9c-45cd-b2f9-2759c2bac298.png" alt="img"></p> <h5 id="配置jenkins集成sonarqube"><a href="#配置jenkins集成sonarqube" class="header-anchor">#</a> 配置jenkins集成sonarqube</h5> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641065723862-d3fce709-4a7a-4eb0-8c70-b99acb896615.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641065961545-3e653bfe-9910-45d9-bb0d-7574f7fc1556.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641065941445-3b498416-fd51-4f02-9df9-438a9bbab305.png" alt="img"></p> <h5 id="集成sonar-scanner"><a href="#集成sonar-scanner" class="header-anchor">#</a> 集成sonar-scanner</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># unzip sonar-scanner-cli-4.0.0.1744-linux.zip   -d  /usr/local/</span>
<span class="token punctuation">[</span>root@xiaomao8 test<span class="token punctuation">]</span><span class="token comment"># ln -sv /usr/local/sonar-scanner-4.0.0.1744-linux/  /usr/local/sonar-scanner</span>
‘/usr/local/sonar-scanner’ -<span class="token operator">&gt;</span> ‘/usr/local/sonar-scanner-4.0.0.1744-linux/’
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641066290250-710ef6d1-4bf5-4512-998b-6875f89ac6cf.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641066261771-bb47fc38-55f9-40f5-b1e8-5bbd68cf7d97.png" alt="img"></p> <p>为项目添加测试阶段</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641068629221-0b4ed21c-3809-4f9f-ae04-02c61400a37d.png" alt="img"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token assign-left variable">sonar.projectName</span><span class="token operator">=</span><span class="token variable">${JOB_NAME}</span>   <span class="token comment">#显示名称</span>
<span class="token assign-left variable">sonar.projectKey</span><span class="token operator">=</span><span class="token variable">${JOB_NAME}</span>    <span class="token comment">#唯一标识,不能重复</span>
<span class="token assign-left variable">sonar.sources</span><span class="token operator">=</span>.                            <span class="token comment">#扫描哪个项目的源码</span>
<span class="token assign-left variable">sonar.java.binaries</span><span class="token operator">=</span>target/classes  <span class="token comment">#路径</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641068659496-e7c08d97-c776-4253-a1a0-48e6f4c807c7.png" alt="img"></p> <p>检查结果查看</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641068676971-38b9dc44-e1a6-4a8b-8423-63093210f79e.png" alt="img"></p> <h5 id="自动化部署测试环境"><a href="#自动化部署测试环境" class="header-anchor">#</a> 自动化部署测试环境</h5> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641068876000-2a84600f-5336-495e-ad7d-b9d4424d40df.png" alt="img"></p> <p>拉取完代码自动构建打包上传到仓库,然后在自动部署到测试环境中</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641068934669-f3d1970e-4061-4583-867b-f4159a08f38e.png" alt="img"></p> <h3 id="项目通知阶段"><a href="#项目通知阶段" class="header-anchor">#</a> 项目通知阶段</h3> <h4 id="安装插件"><a href="#安装插件" class="header-anchor">#</a> 安装插件</h4> <p>jenkins安装dingding插件</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641215169452-e65e4266-db29-4f89-8784-0c2a19fc20f3.png" alt="img"></p> <h4 id="配置钉钉"><a href="#配置钉钉" class="header-anchor">#</a> 配置钉钉</h4> <p>1、打开钉钉群组,点击群机器人(必须是群组,才可以创建机器人)</p> <p>2、添加一个自定义的机器人</p> <p>3、可以修改机器人名称,以及机器人的名字</p> <p>4、机器人修改成功后,会给出一个webhook地址(此处的webhook后续jenkins需要使用)</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641216245545-89ae2cc8-92b7-488c-8e63-26ab764b6b54.png" alt="img"></p> <h4 id="jenkins集成钉钉"><a href="#jenkins集成钉钉" class="header-anchor">#</a> jenkins集成钉钉</h4> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641216377293-03f9697a-b92f-4869-b0fb-637ed154043d.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641216520298-578f405d-37cb-4ed2-b43a-644c1281052c.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641216543499-c8594404-7976-4075-9b20-cd198baba976.png" alt="img"></p> <h5 id="添加机器人成功"><a href="#添加机器人成功" class="header-anchor">#</a> 添加机器人成功</h5> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641216571071-ba961a20-ba7e-40a2-9b83-24c427385c65.png" alt="img"></p> <h4 id="为项目添加机器人"><a href="#为项目添加机器人" class="header-anchor">#</a> 为项目添加机器人</h4> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641225673654-103c0bb7-cb12-4a51-8b69-776f7f04f1df.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641225686582-76a34b02-2428-457c-beb7-4877fe3c60ab.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641225704325-864f83f1-3532-416e-bee2-c9ecc7333aa1.png" alt="img"></p> <h3 id="权限管理"><a href="#权限管理" class="header-anchor">#</a> 权限管理</h3> <h4 id="基本概念"><a href="#基本概念" class="header-anchor">#</a> 基本概念</h4> <p>基于角色的访问控制可以设定更加详细的访问控制,需要role-based authorization strategy插件</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641280902906-0768257c-4569-4eb5-bb54-11b228607a3e.png" alt="img"></p> <ul><li><p>全局角色配置(控制登陆用户能操作jenkins的那些资源)</p></li> <li><ul><li>首先创建角色,设定好对应的权限</li> <li>创建用户</li> <li>最后将用户与角色进行关联</li></ul></li> <li><p>项目角色配置方式(控制用户能看到哪些项目,并且有什么样的权限)</p></li> <li><ul><li>首先创建角色,然后将角色与项目名进行关联</li> <li>其次给角色分配对应的权限</li> <li>最后将用户关联至该角色</li></ul></li></ul> <h4 id="全局角色配置实例"><a href="#全局角色配置实例" class="header-anchor">#</a> 全局角色配置实例</h4> <p>1、启用创建</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641281807077-e1c88b4e-c5ff-42ce-8b4c-39a77c41ab6f.png" alt="img"></p> <p>2、创建角色,并为角色分配权限</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641281890204-a2c4ac8b-9deb-4351-9999-ca755f1f5ca5.png" alt="img"></p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641281998378-6e53c5eb-7d09-4f3a-8396-48a5d0323f19.png" alt="img"></p> <p>3、创建用户,并将用户关联该角色</p> <p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/1641282284790-5feeb77e-e02b-4862-8307-478ff448cf84.png" alt="img"></p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/lixuanfengs/cactus-vuepress-sc/edit/master/docs/03.手册/01.开发环境配置/15.Jenkins+gitlab持续集成学习.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/06/22, 19:16:34</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/93c7a0/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Oracle 12c安装</div></a> <a href="/pages/528e32/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">CloudFlare Argo Tunnel免费内网穿透</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/93c7a0/" class="prev">Oracle 12c安装</a></span> <span class="next"><a href="/pages/528e32/">CloudFlare Argo Tunnel免费内网穿透</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/118ac7/"><div>
            深圳仪器平台-开发手册记录
            <!----></div></a> <span class="date">01-25</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/6254d2/"><div>
            👋 该怎样设计一套“百万级API网关?”
            <!----></div></a> <span class="date">10-12</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/d9cb43/"><div>
            功能完善(算力关联、接口上报、调用反馈)
            <!----></div></a> <span class="date">10-09</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1183895890@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/lixuanfengs" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://cactusli.net" title="网站首页" target="_blank" class="iconfont icon-rss"></a><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=1183895890&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" class="iconfont icon-QQ"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2018-2024
    <span>Cactusli | <a href="https://github.com/lixuanfengs/cactus-vuepress/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div><div></div><div></div><div class="artalk"></div><canvas id="vuepress-canvas-cursor"></canvas><div></div><!----></div></div>
    <script src="/assets/js/app.d73578e6.js" defer></script><script src="/assets/js/2.f6444e8b.js" defer></script><script src="/assets/js/71.6b329e8e.js" defer></script><script src="/assets/js/13.9ca28764.js" defer></script><script src="/assets/js/6.0f00df03.js" defer></script><script src="/assets/js/5.1368437e.js" defer></script><script src="/assets/js/4.7c9e6596.js" defer></script>
  </body>
</html>
