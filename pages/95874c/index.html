<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>K8S基础入门 | Cactusli blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3077305_pt8umhrn4k9.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3129839_xft6cqs5gc.css">
    <noscript><meta http-equiv="refresh" content="0; url=https://www.youngkbt.cn/noscript/"><style>.theme-vdoing-content { display:none }</noscript>
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/artalk/2.5.5/Artalk.css">
    <script src="https://cdn.bootcdn.net/ajax/libs/artalk/2.5.5/Artalk.js"></script>
    <script>var _hmt = _hmt || [];
          (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?efc65c9365211267213266ca9b95b304"; 
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
          })();
          </script>
    <meta name="description" content="后端技术博客,专注前后端学习与总结。Java,JavaScript,js,ES6,TypeScript,vue,React,python,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="后端端博客,个人技术博客,后端,后端开发,前端框架,Java后端,后端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="codeva-nBtnwPHxXt">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/assets/css/0.styles.b8eeafc3.css" as="style"><link rel="preload" href="/assets/js/app.d73578e6.js" as="script"><link rel="preload" href="/assets/js/2.f6444e8b.js" as="script"><link rel="preload" href="/assets/js/65.c5eca227.js" as="script"><link rel="preload" href="/assets/js/13.9ca28764.js" as="script"><link rel="preload" href="/assets/js/6.0f00df03.js" as="script"><link rel="preload" href="/assets/js/5.1368437e.js" as="script"><link rel="preload" href="/assets/js/4.7c9e6596.js" as="script"><link rel="prefetch" href="/assets/js/10.af60255b.js"><link rel="prefetch" href="/assets/js/100.3ef796c4.js"><link rel="prefetch" href="/assets/js/101.aae7784e.js"><link rel="prefetch" href="/assets/js/102.8da091f1.js"><link rel="prefetch" href="/assets/js/103.ad0dd5b7.js"><link rel="prefetch" href="/assets/js/104.642836fc.js"><link rel="prefetch" href="/assets/js/105.f3c5bcec.js"><link rel="prefetch" href="/assets/js/106.85dad7d8.js"><link rel="prefetch" href="/assets/js/107.42b1c013.js"><link rel="prefetch" href="/assets/js/108.2a978b6c.js"><link rel="prefetch" href="/assets/js/109.46c8b7c6.js"><link rel="prefetch" href="/assets/js/11.372f8efb.js"><link rel="prefetch" href="/assets/js/110.2cb8a5dc.js"><link rel="prefetch" href="/assets/js/111.c68e8975.js"><link rel="prefetch" href="/assets/js/112.d89adde5.js"><link rel="prefetch" href="/assets/js/113.e52ab124.js"><link rel="prefetch" href="/assets/js/114.94f7a70b.js"><link rel="prefetch" href="/assets/js/115.68c55722.js"><link rel="prefetch" href="/assets/js/116.9cdf5c61.js"><link rel="prefetch" href="/assets/js/117.34a7707c.js"><link rel="prefetch" href="/assets/js/118.e9922234.js"><link rel="prefetch" href="/assets/js/119.61fe4a4e.js"><link rel="prefetch" href="/assets/js/12.1061ddb5.js"><link rel="prefetch" href="/assets/js/120.fe5311f5.js"><link rel="prefetch" href="/assets/js/121.905e8e51.js"><link rel="prefetch" href="/assets/js/122.8cd7cd0c.js"><link rel="prefetch" href="/assets/js/123.f4f98520.js"><link rel="prefetch" href="/assets/js/124.4e233943.js"><link rel="prefetch" href="/assets/js/125.092aa1bf.js"><link rel="prefetch" href="/assets/js/126.b9c11778.js"><link rel="prefetch" href="/assets/js/127.e55d2fa9.js"><link rel="prefetch" href="/assets/js/128.3197df92.js"><link rel="prefetch" href="/assets/js/129.0244ee9b.js"><link rel="prefetch" href="/assets/js/130.e0648777.js"><link rel="prefetch" href="/assets/js/131.94e0b948.js"><link rel="prefetch" href="/assets/js/132.8520ded5.js"><link rel="prefetch" href="/assets/js/133.034f0365.js"><link rel="prefetch" href="/assets/js/134.1ca4a150.js"><link rel="prefetch" href="/assets/js/135.bdfc5c00.js"><link rel="prefetch" href="/assets/js/136.4918fec8.js"><link rel="prefetch" href="/assets/js/137.2db62de4.js"><link rel="prefetch" href="/assets/js/138.87fd076f.js"><link rel="prefetch" href="/assets/js/139.eecbbecd.js"><link rel="prefetch" href="/assets/js/14.2c349983.js"><link rel="prefetch" href="/assets/js/140.40d4aa29.js"><link rel="prefetch" href="/assets/js/141.dc280dee.js"><link rel="prefetch" href="/assets/js/142.4fa6a57c.js"><link rel="prefetch" href="/assets/js/143.33b90797.js"><link rel="prefetch" href="/assets/js/144.180e147f.js"><link rel="prefetch" href="/assets/js/145.832bf539.js"><link rel="prefetch" href="/assets/js/146.71cc0cd4.js"><link rel="prefetch" href="/assets/js/147.4d966ac1.js"><link rel="prefetch" href="/assets/js/148.98ccdf6a.js"><link rel="prefetch" href="/assets/js/149.c6e90dd0.js"><link rel="prefetch" href="/assets/js/15.5bb38388.js"><link rel="prefetch" href="/assets/js/150.cb70fd12.js"><link rel="prefetch" href="/assets/js/151.2da07e43.js"><link rel="prefetch" href="/assets/js/152.65bb34e9.js"><link rel="prefetch" href="/assets/js/153.10ef087b.js"><link rel="prefetch" href="/assets/js/154.2b0c9bc8.js"><link rel="prefetch" href="/assets/js/155.e38977ec.js"><link rel="prefetch" href="/assets/js/156.02b0bba1.js"><link rel="prefetch" href="/assets/js/157.3ed0f21f.js"><link rel="prefetch" href="/assets/js/158.beda5a17.js"><link rel="prefetch" href="/assets/js/159.5bfbc4d9.js"><link rel="prefetch" href="/assets/js/16.a58fed94.js"><link rel="prefetch" href="/assets/js/160.408dbb35.js"><link rel="prefetch" href="/assets/js/161.c4344be4.js"><link rel="prefetch" href="/assets/js/162.f80a95f8.js"><link rel="prefetch" href="/assets/js/163.dc12b090.js"><link rel="prefetch" href="/assets/js/164.682e2b57.js"><link rel="prefetch" href="/assets/js/165.0af68775.js"><link rel="prefetch" href="/assets/js/166.6254b754.js"><link rel="prefetch" href="/assets/js/167.727b0d47.js"><link rel="prefetch" href="/assets/js/168.e3458b70.js"><link rel="prefetch" href="/assets/js/169.d6492dcd.js"><link rel="prefetch" href="/assets/js/17.2429b1e6.js"><link rel="prefetch" href="/assets/js/170.3677af86.js"><link rel="prefetch" href="/assets/js/171.fe866179.js"><link rel="prefetch" href="/assets/js/172.c7d611be.js"><link rel="prefetch" href="/assets/js/173.e535d27d.js"><link rel="prefetch" href="/assets/js/174.07646070.js"><link rel="prefetch" href="/assets/js/175.227bcdd6.js"><link rel="prefetch" href="/assets/js/176.d03f1195.js"><link rel="prefetch" href="/assets/js/177.7206380a.js"><link rel="prefetch" href="/assets/js/178.7bfc35c4.js"><link rel="prefetch" href="/assets/js/179.d990d8ea.js"><link rel="prefetch" href="/assets/js/18.a5d750b4.js"><link rel="prefetch" href="/assets/js/180.2e4eba32.js"><link rel="prefetch" href="/assets/js/181.cbd8f5ca.js"><link rel="prefetch" href="/assets/js/182.afd4c94b.js"><link rel="prefetch" href="/assets/js/183.e7ab48ce.js"><link rel="prefetch" href="/assets/js/184.5f21d13c.js"><link rel="prefetch" href="/assets/js/185.4a4fd3b0.js"><link rel="prefetch" href="/assets/js/186.2ff2b9cd.js"><link rel="prefetch" href="/assets/js/187.b325350e.js"><link rel="prefetch" href="/assets/js/188.2a18fad9.js"><link rel="prefetch" href="/assets/js/189.425c0eb4.js"><link rel="prefetch" href="/assets/js/19.6925fadc.js"><link rel="prefetch" href="/assets/js/190.372a786b.js"><link rel="prefetch" href="/assets/js/191.a6b816f2.js"><link rel="prefetch" href="/assets/js/192.2d46ba6c.js"><link rel="prefetch" href="/assets/js/193.9d886ea4.js"><link rel="prefetch" href="/assets/js/194.ec75fc6b.js"><link rel="prefetch" href="/assets/js/195.5688915a.js"><link rel="prefetch" href="/assets/js/196.fa745ec4.js"><link rel="prefetch" href="/assets/js/197.b389a9e8.js"><link rel="prefetch" href="/assets/js/198.66ebbff6.js"><link rel="prefetch" href="/assets/js/199.32103f1f.js"><link rel="prefetch" href="/assets/js/20.d4b6b23a.js"><link rel="prefetch" href="/assets/js/200.1b917b48.js"><link rel="prefetch" href="/assets/js/201.626e8295.js"><link rel="prefetch" href="/assets/js/202.3df66e9e.js"><link rel="prefetch" href="/assets/js/203.aff1d912.js"><link rel="prefetch" href="/assets/js/204.6306a828.js"><link rel="prefetch" href="/assets/js/205.320db987.js"><link rel="prefetch" href="/assets/js/206.b4488e77.js"><link rel="prefetch" href="/assets/js/207.d5f17556.js"><link rel="prefetch" href="/assets/js/208.37210f86.js"><link rel="prefetch" href="/assets/js/209.786c7af4.js"><link rel="prefetch" href="/assets/js/21.95dcd0d6.js"><link rel="prefetch" href="/assets/js/210.38e58d19.js"><link rel="prefetch" href="/assets/js/211.09b699bb.js"><link rel="prefetch" href="/assets/js/212.ffd8d260.js"><link rel="prefetch" href="/assets/js/213.2891f4a0.js"><link rel="prefetch" href="/assets/js/214.8c1a47e0.js"><link rel="prefetch" href="/assets/js/215.c0dec61f.js"><link rel="prefetch" href="/assets/js/216.c71c59ab.js"><link rel="prefetch" href="/assets/js/217.8891c004.js"><link rel="prefetch" href="/assets/js/218.a2075ffe.js"><link rel="prefetch" href="/assets/js/219.1e70631e.js"><link rel="prefetch" href="/assets/js/22.473284b6.js"><link rel="prefetch" href="/assets/js/220.1d012692.js"><link rel="prefetch" href="/assets/js/221.aa4a0d37.js"><link rel="prefetch" href="/assets/js/222.b512a429.js"><link rel="prefetch" href="/assets/js/223.9e6d42f2.js"><link rel="prefetch" href="/assets/js/224.e46f8d1d.js"><link rel="prefetch" href="/assets/js/225.d8083ae3.js"><link rel="prefetch" href="/assets/js/226.7730bb6a.js"><link rel="prefetch" href="/assets/js/227.3ec46626.js"><link rel="prefetch" href="/assets/js/228.0be929cb.js"><link rel="prefetch" href="/assets/js/229.d8da48e4.js"><link rel="prefetch" href="/assets/js/23.1a1a291a.js"><link rel="prefetch" href="/assets/js/230.f6b2bd82.js"><link rel="prefetch" href="/assets/js/231.c43852a4.js"><link rel="prefetch" href="/assets/js/232.0aa9bd8a.js"><link rel="prefetch" href="/assets/js/233.28899baa.js"><link rel="prefetch" href="/assets/js/234.37a56cac.js"><link rel="prefetch" href="/assets/js/235.57d1f2f2.js"><link rel="prefetch" href="/assets/js/236.10c15500.js"><link rel="prefetch" href="/assets/js/237.8ccfba13.js"><link rel="prefetch" href="/assets/js/238.072cdb99.js"><link rel="prefetch" href="/assets/js/239.a4042ce8.js"><link rel="prefetch" href="/assets/js/24.6f32ee5c.js"><link rel="prefetch" href="/assets/js/240.a4e8f29e.js"><link rel="prefetch" href="/assets/js/241.aec0fdc6.js"><link rel="prefetch" href="/assets/js/242.4e5a95cc.js"><link rel="prefetch" href="/assets/js/243.0ab57bd0.js"><link rel="prefetch" href="/assets/js/244.d5257ed9.js"><link rel="prefetch" href="/assets/js/245.747b1f48.js"><link rel="prefetch" href="/assets/js/246.f89916b2.js"><link rel="prefetch" href="/assets/js/247.9baf4f72.js"><link rel="prefetch" href="/assets/js/248.5878bead.js"><link rel="prefetch" href="/assets/js/249.0153ed9a.js"><link rel="prefetch" href="/assets/js/25.825806eb.js"><link rel="prefetch" href="/assets/js/250.4f47bd06.js"><link rel="prefetch" href="/assets/js/251.2c55f0ac.js"><link rel="prefetch" href="/assets/js/252.3171358b.js"><link rel="prefetch" href="/assets/js/253.3d927b62.js"><link rel="prefetch" href="/assets/js/254.56caa785.js"><link rel="prefetch" href="/assets/js/255.b75a0344.js"><link rel="prefetch" href="/assets/js/256.e449fa3a.js"><link rel="prefetch" href="/assets/js/257.a280fd63.js"><link rel="prefetch" href="/assets/js/258.85cacce2.js"><link rel="prefetch" href="/assets/js/259.220782f3.js"><link rel="prefetch" href="/assets/js/26.c2a73fa1.js"><link rel="prefetch" href="/assets/js/260.4cad83bd.js"><link rel="prefetch" href="/assets/js/261.cc01772f.js"><link rel="prefetch" href="/assets/js/262.31fb9ce0.js"><link rel="prefetch" href="/assets/js/263.95d45d4a.js"><link rel="prefetch" href="/assets/js/264.a23581c9.js"><link rel="prefetch" href="/assets/js/265.f4d45025.js"><link rel="prefetch" href="/assets/js/266.08c29ff3.js"><link rel="prefetch" href="/assets/js/267.f25d5c52.js"><link rel="prefetch" href="/assets/js/268.e4b83b3f.js"><link rel="prefetch" href="/assets/js/269.54e6f5d2.js"><link rel="prefetch" href="/assets/js/27.94b60768.js"><link rel="prefetch" href="/assets/js/270.477bbf01.js"><link rel="prefetch" href="/assets/js/271.eadefaf2.js"><link rel="prefetch" href="/assets/js/272.c77f20a4.js"><link rel="prefetch" href="/assets/js/273.86e57213.js"><link rel="prefetch" href="/assets/js/274.caf08186.js"><link rel="prefetch" href="/assets/js/275.843af577.js"><link rel="prefetch" href="/assets/js/276.bc7dfde0.js"><link rel="prefetch" href="/assets/js/277.a18aa211.js"><link rel="prefetch" href="/assets/js/278.25260976.js"><link rel="prefetch" href="/assets/js/279.0bc329e7.js"><link rel="prefetch" href="/assets/js/28.166f967e.js"><link rel="prefetch" href="/assets/js/280.c7eb5b22.js"><link rel="prefetch" href="/assets/js/281.78d4ed73.js"><link rel="prefetch" href="/assets/js/282.08dbc1ff.js"><link rel="prefetch" href="/assets/js/283.1a8ed58d.js"><link rel="prefetch" href="/assets/js/284.c67e1e75.js"><link rel="prefetch" href="/assets/js/285.6252305a.js"><link rel="prefetch" href="/assets/js/286.5c98afe5.js"><link rel="prefetch" href="/assets/js/287.bd42634c.js"><link rel="prefetch" href="/assets/js/288.1a692f6d.js"><link rel="prefetch" href="/assets/js/289.137dd607.js"><link rel="prefetch" href="/assets/js/29.69647249.js"><link rel="prefetch" href="/assets/js/290.6cb00ec4.js"><link rel="prefetch" href="/assets/js/291.4a6210f6.js"><link rel="prefetch" href="/assets/js/292.dedb1bb4.js"><link rel="prefetch" href="/assets/js/293.6e25fb34.js"><link rel="prefetch" href="/assets/js/294.c7f2e4eb.js"><link rel="prefetch" href="/assets/js/295.76fdbc3b.js"><link rel="prefetch" href="/assets/js/296.48999983.js"><link rel="prefetch" href="/assets/js/297.8d1c640d.js"><link rel="prefetch" href="/assets/js/298.9f5441b7.js"><link rel="prefetch" href="/assets/js/299.150b9208.js"><link rel="prefetch" href="/assets/js/3.461c0085.js"><link rel="prefetch" href="/assets/js/30.defdcb36.js"><link rel="prefetch" href="/assets/js/300.6b9057e3.js"><link rel="prefetch" href="/assets/js/301.74c659b3.js"><link rel="prefetch" href="/assets/js/302.6d8ebf64.js"><link rel="prefetch" href="/assets/js/303.21fe2025.js"><link rel="prefetch" href="/assets/js/304.3c05c7a6.js"><link rel="prefetch" href="/assets/js/305.7c3fb5eb.js"><link rel="prefetch" href="/assets/js/306.c1fa105b.js"><link rel="prefetch" href="/assets/js/307.48a1d678.js"><link rel="prefetch" href="/assets/js/308.4e58779a.js"><link rel="prefetch" href="/assets/js/309.9fac2cdc.js"><link rel="prefetch" href="/assets/js/31.77a45ce0.js"><link rel="prefetch" href="/assets/js/310.3a159c1e.js"><link rel="prefetch" href="/assets/js/311.603f45af.js"><link rel="prefetch" href="/assets/js/312.603c7885.js"><link rel="prefetch" href="/assets/js/313.69be703f.js"><link rel="prefetch" href="/assets/js/314.9054c9ab.js"><link rel="prefetch" href="/assets/js/315.e331ef4b.js"><link rel="prefetch" href="/assets/js/316.1d0a506f.js"><link rel="prefetch" href="/assets/js/317.1b787b88.js"><link rel="prefetch" href="/assets/js/318.86f787b0.js"><link rel="prefetch" href="/assets/js/319.a6921190.js"><link rel="prefetch" href="/assets/js/32.93f3bdf1.js"><link rel="prefetch" href="/assets/js/320.f0c26c43.js"><link rel="prefetch" href="/assets/js/321.a19c9ff4.js"><link rel="prefetch" href="/assets/js/322.01ba6221.js"><link rel="prefetch" href="/assets/js/323.978cd49f.js"><link rel="prefetch" href="/assets/js/324.fe310b5d.js"><link rel="prefetch" href="/assets/js/325.3244bcda.js"><link rel="prefetch" href="/assets/js/326.5c4f01a3.js"><link rel="prefetch" href="/assets/js/327.5db6522f.js"><link rel="prefetch" href="/assets/js/328.e220334a.js"><link rel="prefetch" href="/assets/js/329.df7c545b.js"><link rel="prefetch" href="/assets/js/33.f4982416.js"><link rel="prefetch" href="/assets/js/330.3f9cc52f.js"><link rel="prefetch" href="/assets/js/331.1661ec63.js"><link rel="prefetch" href="/assets/js/332.bdec065c.js"><link rel="prefetch" href="/assets/js/333.b663aa77.js"><link rel="prefetch" href="/assets/js/334.b1f6193f.js"><link rel="prefetch" href="/assets/js/335.cc7fedb2.js"><link rel="prefetch" href="/assets/js/336.35aa2903.js"><link rel="prefetch" href="/assets/js/337.a91aa873.js"><link rel="prefetch" href="/assets/js/338.ae795233.js"><link rel="prefetch" href="/assets/js/339.4582441a.js"><link rel="prefetch" href="/assets/js/34.deb0c8cd.js"><link rel="prefetch" href="/assets/js/340.c9e30c24.js"><link rel="prefetch" href="/assets/js/341.ab8bbf2f.js"><link rel="prefetch" href="/assets/js/342.4dcd40fe.js"><link rel="prefetch" href="/assets/js/343.04aa7b0e.js"><link rel="prefetch" href="/assets/js/344.cf12e221.js"><link rel="prefetch" href="/assets/js/345.851fea37.js"><link rel="prefetch" href="/assets/js/346.cd04ce92.js"><link rel="prefetch" href="/assets/js/347.cc13c5f8.js"><link rel="prefetch" href="/assets/js/348.e8149a34.js"><link rel="prefetch" href="/assets/js/349.8c615125.js"><link rel="prefetch" href="/assets/js/35.946b2b10.js"><link rel="prefetch" href="/assets/js/350.297c9452.js"><link rel="prefetch" href="/assets/js/351.c625eafe.js"><link rel="prefetch" href="/assets/js/352.21fc6d9a.js"><link rel="prefetch" href="/assets/js/353.0918e6c0.js"><link rel="prefetch" href="/assets/js/354.760beca2.js"><link rel="prefetch" href="/assets/js/355.ec756b28.js"><link rel="prefetch" href="/assets/js/356.c41182ab.js"><link rel="prefetch" href="/assets/js/357.3a762703.js"><link rel="prefetch" href="/assets/js/358.2c575e4a.js"><link rel="prefetch" href="/assets/js/359.7ce42976.js"><link rel="prefetch" href="/assets/js/36.22805e5a.js"><link rel="prefetch" href="/assets/js/360.ef9a8667.js"><link rel="prefetch" href="/assets/js/361.1511e3f4.js"><link rel="prefetch" href="/assets/js/362.d5fbab7c.js"><link rel="prefetch" href="/assets/js/363.976be7aa.js"><link rel="prefetch" href="/assets/js/364.1843f42a.js"><link rel="prefetch" href="/assets/js/365.dfde987d.js"><link rel="prefetch" href="/assets/js/366.b87a9cb5.js"><link rel="prefetch" href="/assets/js/367.8ba1f57c.js"><link rel="prefetch" href="/assets/js/368.8b96559b.js"><link rel="prefetch" href="/assets/js/369.2546100c.js"><link rel="prefetch" href="/assets/js/37.3525192b.js"><link rel="prefetch" href="/assets/js/370.4db8b482.js"><link rel="prefetch" href="/assets/js/371.0542b71b.js"><link rel="prefetch" href="/assets/js/372.4c9bde18.js"><link rel="prefetch" href="/assets/js/373.32bcd884.js"><link rel="prefetch" href="/assets/js/374.3793da0b.js"><link rel="prefetch" href="/assets/js/375.8297ec5b.js"><link rel="prefetch" href="/assets/js/376.e346176b.js"><link rel="prefetch" href="/assets/js/377.ac5d8c7f.js"><link rel="prefetch" href="/assets/js/378.e0b84ffc.js"><link rel="prefetch" href="/assets/js/379.663b7fb2.js"><link rel="prefetch" href="/assets/js/38.72fc1973.js"><link rel="prefetch" href="/assets/js/380.01abbbeb.js"><link rel="prefetch" href="/assets/js/381.445e4202.js"><link rel="prefetch" href="/assets/js/382.ff24e162.js"><link rel="prefetch" href="/assets/js/383.c8303f29.js"><link rel="prefetch" href="/assets/js/384.67496581.js"><link rel="prefetch" href="/assets/js/385.e206fb4d.js"><link rel="prefetch" href="/assets/js/386.1e324581.js"><link rel="prefetch" href="/assets/js/387.4b3c734b.js"><link rel="prefetch" href="/assets/js/388.89e3ad82.js"><link rel="prefetch" href="/assets/js/389.814cbc20.js"><link rel="prefetch" href="/assets/js/39.85d65742.js"><link rel="prefetch" href="/assets/js/390.3d2bc4b1.js"><link rel="prefetch" href="/assets/js/391.ad15e5c9.js"><link rel="prefetch" href="/assets/js/392.22ea3d28.js"><link rel="prefetch" href="/assets/js/393.dc925e8e.js"><link rel="prefetch" href="/assets/js/394.f758a517.js"><link rel="prefetch" href="/assets/js/395.bb8c0d77.js"><link rel="prefetch" href="/assets/js/396.8cc3e6cb.js"><link rel="prefetch" href="/assets/js/397.44dba438.js"><link rel="prefetch" href="/assets/js/398.76ebedbb.js"><link rel="prefetch" href="/assets/js/399.a6acb507.js"><link rel="prefetch" href="/assets/js/40.2ef6e1f7.js"><link rel="prefetch" href="/assets/js/400.a6d9d98e.js"><link rel="prefetch" href="/assets/js/401.0715bf66.js"><link rel="prefetch" href="/assets/js/402.fff59a65.js"><link rel="prefetch" href="/assets/js/403.9f58e94a.js"><link rel="prefetch" href="/assets/js/404.4817775f.js"><link rel="prefetch" href="/assets/js/405.1744cc09.js"><link rel="prefetch" href="/assets/js/406.a978bd4c.js"><link rel="prefetch" href="/assets/js/407.4fb1ac88.js"><link rel="prefetch" href="/assets/js/408.f1bb0f31.js"><link rel="prefetch" href="/assets/js/409.942c7d40.js"><link rel="prefetch" href="/assets/js/41.a4f19bba.js"><link rel="prefetch" href="/assets/js/410.66f0918b.js"><link rel="prefetch" href="/assets/js/411.6a5436f5.js"><link rel="prefetch" href="/assets/js/412.ec974a04.js"><link rel="prefetch" href="/assets/js/413.ba4fd119.js"><link rel="prefetch" href="/assets/js/414.55e59bef.js"><link rel="prefetch" href="/assets/js/415.412201ca.js"><link rel="prefetch" href="/assets/js/416.4b4ba217.js"><link rel="prefetch" href="/assets/js/417.a65d2f1b.js"><link rel="prefetch" href="/assets/js/418.bf142c63.js"><link rel="prefetch" href="/assets/js/419.65b0f04d.js"><link rel="prefetch" href="/assets/js/42.7f2b0b0f.js"><link rel="prefetch" href="/assets/js/420.ab0f7606.js"><link rel="prefetch" href="/assets/js/421.d9d2dc13.js"><link rel="prefetch" href="/assets/js/422.093a8290.js"><link rel="prefetch" href="/assets/js/423.041fc7be.js"><link rel="prefetch" href="/assets/js/424.410b1a8f.js"><link rel="prefetch" href="/assets/js/425.661237bb.js"><link rel="prefetch" href="/assets/js/426.c01ca04f.js"><link rel="prefetch" href="/assets/js/427.af6802e0.js"><link rel="prefetch" href="/assets/js/428.e255a9c4.js"><link rel="prefetch" href="/assets/js/429.3f62c79c.js"><link rel="prefetch" href="/assets/js/43.96eb08e4.js"><link rel="prefetch" href="/assets/js/430.86f8cd5f.js"><link rel="prefetch" href="/assets/js/431.89f717cb.js"><link rel="prefetch" href="/assets/js/432.606f5381.js"><link rel="prefetch" href="/assets/js/433.e2a7c92d.js"><link rel="prefetch" href="/assets/js/434.375d2ee0.js"><link rel="prefetch" href="/assets/js/435.10ac30b9.js"><link rel="prefetch" href="/assets/js/436.dfadd161.js"><link rel="prefetch" href="/assets/js/437.f92a1705.js"><link rel="prefetch" href="/assets/js/438.a924c254.js"><link rel="prefetch" href="/assets/js/439.6a8f7f89.js"><link rel="prefetch" href="/assets/js/44.af0f503b.js"><link rel="prefetch" href="/assets/js/440.6f41f087.js"><link rel="prefetch" href="/assets/js/441.296b6711.js"><link rel="prefetch" href="/assets/js/442.e82e2313.js"><link rel="prefetch" href="/assets/js/443.c46b8b7c.js"><link rel="prefetch" href="/assets/js/444.850b3f10.js"><link rel="prefetch" href="/assets/js/445.70fafa08.js"><link rel="prefetch" href="/assets/js/446.c2fd23e4.js"><link rel="prefetch" href="/assets/js/447.fac66885.js"><link rel="prefetch" href="/assets/js/448.5c8074d5.js"><link rel="prefetch" href="/assets/js/449.25db27ca.js"><link rel="prefetch" href="/assets/js/45.19ecb85c.js"><link rel="prefetch" href="/assets/js/450.8bc58614.js"><link rel="prefetch" href="/assets/js/451.69e35a33.js"><link rel="prefetch" href="/assets/js/452.a129daf9.js"><link rel="prefetch" href="/assets/js/453.4f696672.js"><link rel="prefetch" href="/assets/js/454.e2a1b328.js"><link rel="prefetch" href="/assets/js/455.b7037708.js"><link rel="prefetch" href="/assets/js/456.eda2adc0.js"><link rel="prefetch" href="/assets/js/457.5f0d7722.js"><link rel="prefetch" href="/assets/js/458.effcb970.js"><link rel="prefetch" href="/assets/js/459.48baddfb.js"><link rel="prefetch" href="/assets/js/46.88cbca22.js"><link rel="prefetch" href="/assets/js/460.c50fe2c5.js"><link rel="prefetch" href="/assets/js/461.55293f7a.js"><link rel="prefetch" href="/assets/js/462.682315f0.js"><link rel="prefetch" href="/assets/js/463.f4278aae.js"><link rel="prefetch" href="/assets/js/464.f140b938.js"><link rel="prefetch" href="/assets/js/465.392a08f4.js"><link rel="prefetch" href="/assets/js/466.90a32c46.js"><link rel="prefetch" href="/assets/js/467.d795bc61.js"><link rel="prefetch" href="/assets/js/468.6e663011.js"><link rel="prefetch" href="/assets/js/469.b7bffde5.js"><link rel="prefetch" href="/assets/js/47.7e31de19.js"><link rel="prefetch" href="/assets/js/470.388beea3.js"><link rel="prefetch" href="/assets/js/471.6ca5dbe5.js"><link rel="prefetch" href="/assets/js/472.9bc4c0a6.js"><link rel="prefetch" href="/assets/js/473.fd427e29.js"><link rel="prefetch" href="/assets/js/474.862fc10a.js"><link rel="prefetch" href="/assets/js/475.6e3893de.js"><link rel="prefetch" href="/assets/js/476.0f32dc93.js"><link rel="prefetch" href="/assets/js/477.8cb145a5.js"><link rel="prefetch" href="/assets/js/478.65a09f13.js"><link rel="prefetch" href="/assets/js/479.bee3f754.js"><link rel="prefetch" href="/assets/js/48.ca956f8d.js"><link rel="prefetch" href="/assets/js/480.f59f88af.js"><link rel="prefetch" href="/assets/js/481.8c5e02e6.js"><link rel="prefetch" href="/assets/js/482.7988ca13.js"><link rel="prefetch" href="/assets/js/483.6d1e171c.js"><link rel="prefetch" href="/assets/js/484.b3f3a54b.js"><link rel="prefetch" href="/assets/js/485.e97a72d8.js"><link rel="prefetch" href="/assets/js/49.4cf4b45c.js"><link rel="prefetch" href="/assets/js/50.9fdb4f1e.js"><link rel="prefetch" href="/assets/js/51.88f75159.js"><link rel="prefetch" href="/assets/js/52.1c372af0.js"><link rel="prefetch" href="/assets/js/53.e0e13d9a.js"><link rel="prefetch" href="/assets/js/54.231f6505.js"><link rel="prefetch" href="/assets/js/55.52b04941.js"><link rel="prefetch" href="/assets/js/56.91345e86.js"><link rel="prefetch" href="/assets/js/57.201a710e.js"><link rel="prefetch" href="/assets/js/58.6fb2ccb6.js"><link rel="prefetch" href="/assets/js/59.cb26cb6a.js"><link rel="prefetch" href="/assets/js/60.a5fc202b.js"><link rel="prefetch" href="/assets/js/61.0facb3f9.js"><link rel="prefetch" href="/assets/js/62.d00be571.js"><link rel="prefetch" href="/assets/js/63.d66d194b.js"><link rel="prefetch" href="/assets/js/64.4b34837d.js"><link rel="prefetch" href="/assets/js/66.f3bb4baa.js"><link rel="prefetch" href="/assets/js/67.4fbce724.js"><link rel="prefetch" href="/assets/js/68.39780014.js"><link rel="prefetch" href="/assets/js/69.523952df.js"><link rel="prefetch" href="/assets/js/7.d893eec0.js"><link rel="prefetch" href="/assets/js/70.33f89cfa.js"><link rel="prefetch" href="/assets/js/71.6b329e8e.js"><link rel="prefetch" href="/assets/js/72.90caac3a.js"><link rel="prefetch" href="/assets/js/73.2b7012a1.js"><link rel="prefetch" href="/assets/js/74.0076f1ec.js"><link rel="prefetch" href="/assets/js/75.1cbaf5cf.js"><link rel="prefetch" href="/assets/js/76.2461a9e9.js"><link rel="prefetch" href="/assets/js/77.be9e1732.js"><link rel="prefetch" href="/assets/js/78.a4825263.js"><link rel="prefetch" href="/assets/js/79.95c5e105.js"><link rel="prefetch" href="/assets/js/8.acf971e3.js"><link rel="prefetch" href="/assets/js/80.1a7c44e2.js"><link rel="prefetch" href="/assets/js/81.38ee2ba4.js"><link rel="prefetch" href="/assets/js/82.78220668.js"><link rel="prefetch" href="/assets/js/83.3dfead3b.js"><link rel="prefetch" href="/assets/js/84.7f1f743d.js"><link rel="prefetch" href="/assets/js/85.ab59a697.js"><link rel="prefetch" href="/assets/js/86.1888a97f.js"><link rel="prefetch" href="/assets/js/87.149a705f.js"><link rel="prefetch" href="/assets/js/88.8a53e92d.js"><link rel="prefetch" href="/assets/js/89.a68dd87b.js"><link rel="prefetch" href="/assets/js/9.c38b654d.js"><link rel="prefetch" href="/assets/js/90.c70af23c.js"><link rel="prefetch" href="/assets/js/91.58de9211.js"><link rel="prefetch" href="/assets/js/92.697a7ada.js"><link rel="prefetch" href="/assets/js/93.2a27830a.js"><link rel="prefetch" href="/assets/js/94.20be84f6.js"><link rel="prefetch" href="/assets/js/95.bc2120e0.js"><link rel="prefetch" href="/assets/js/96.5b3aa395.js"><link rel="prefetch" href="/assets/js/97.c4a15008.js"><link rel="prefetch" href="/assets/js/98.3e47fdce.js"><link rel="prefetch" href="/assets/js/99.4b101d54.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b8eeafc3.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Cactusli blog" class="logo"> <span class="site-name can-hide">Cactusli blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/Java/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java Study</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/Java/" class="nav-link">Java 基础</a></li><li class="dropdown-subitem"><a href="/note/design-pattern/" class="nav-link">Java 版设计模式</a></li></ul></li><li class="dropdown-item"><h4>阅读源码系列</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/32e50d/" class="nav-link">Spring Boot</a></li><li class="dropdown-subitem"><a href="/pages/d065c4/" class="nav-link">Netty</a></li><li class="dropdown-subitem"><a href="/pages/4d3c7f/" class="nav-link">Dubbo</a></li><li class="dropdown-subitem"><a href="/pages/920e2b/" class="nav-link">搭建rpc框架</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/SpringBoot/" class="nav-link">《SpringBoot教程》</a></li><li class="dropdown-subitem"><a href="/note/Docker/" class="nav-link">《Docker教程》</a></li><li class="dropdown-subitem"><a href="/note/Kubernetes/" class="nav-link">《Kubernetes教程》</a></li><li class="dropdown-subitem"><a href="/note/SpringCloud-febs/" class="nav-link">《SpringCloud微服务权限系统搭建》</a></li><li class="dropdown-subitem"><a href="/note/Netty/" class="nav-link">《Netty教程》</a></li><li class="dropdown-subitem"><a href="/note/Gateway/" class="nav-link">《API网关设计与实践》</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li><li class="dropdown-item"><h4>页面</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="手册" class="dropdown-title"><a href="/manual/" class="link-title">手册</a> <span class="title" style="display:none;">手册</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/d2639c/" class="nav-link">环境配置</a></li><li class="dropdown-item"><!----> <a href="/pages/39e2a1/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">手册记录</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://firework.cloudflaress.eu.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  看烟花
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/706328/" class="nav-link">英语学习</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/lixuanfengs/cactus-vuepress-sc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.statically.io/gh/lixuanfengs/blog-images/master/cactus-blogs/avatar3.gif"> <div class="blogger-info"><h3>Xuan Feng Li</h3> <span>学习老黄牛精神！</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/Java/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java Study</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/Java/" class="nav-link">Java 基础</a></li><li class="dropdown-subitem"><a href="/note/design-pattern/" class="nav-link">Java 版设计模式</a></li></ul></li><li class="dropdown-item"><h4>阅读源码系列</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/32e50d/" class="nav-link">Spring Boot</a></li><li class="dropdown-subitem"><a href="/pages/d065c4/" class="nav-link">Netty</a></li><li class="dropdown-subitem"><a href="/pages/4d3c7f/" class="nav-link">Dubbo</a></li><li class="dropdown-subitem"><a href="/pages/920e2b/" class="nav-link">搭建rpc框架</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/SpringBoot/" class="nav-link">《SpringBoot教程》</a></li><li class="dropdown-subitem"><a href="/note/Docker/" class="nav-link">《Docker教程》</a></li><li class="dropdown-subitem"><a href="/note/Kubernetes/" class="nav-link">《Kubernetes教程》</a></li><li class="dropdown-subitem"><a href="/note/SpringCloud-febs/" class="nav-link">《SpringCloud微服务权限系统搭建》</a></li><li class="dropdown-subitem"><a href="/note/Netty/" class="nav-link">《Netty教程》</a></li><li class="dropdown-subitem"><a href="/note/Gateway/" class="nav-link">《API网关设计与实践》</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li><li class="dropdown-item"><h4>页面</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="手册" class="dropdown-title"><a href="/manual/" class="link-title">手册</a> <span class="title" style="display:none;">手册</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/d2639c/" class="nav-link">环境配置</a></li><li class="dropdown-item"><!----> <a href="/pages/39e2a1/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">手册记录</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://firework.cloudflaress.eu.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  看烟花
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/706328/" class="nav-link">英语学习</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/lixuanfengs/cactus-vuepress-sc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>开发环境配置</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/d2639c/" class="sidebar-link">负载均衡和web服务</a></li><li><a href="/pages/d9927e/" class="sidebar-link">keepalibved安装与使用</a></li><li><a href="/pages/4e44e7/" class="sidebar-link">redis安装部署</a></li><li><a href="/pages/deb0c4/" class="sidebar-link">zookeeper-centos7安装使用</a></li><li><a href="/pages/d2862a/" class="sidebar-link">RabbitMQ学习</a></li><li><a href="/pages/7d1629/" class="sidebar-link">KeepAlived搭建MySQL双主</a></li><li><a href="/pages/75b405/" class="sidebar-link">sql语句的学习</a></li><li><a href="/pages/32abc1/" class="sidebar-link">MySQL8.0主从配置</a></li><li><a href="/pages/95874c/" aria-current="page" class="active sidebar-link">K8S基础入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/95874c/#k8s入门" class="sidebar-link">K8S入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/95874c/#k8s名字组成" class="sidebar-link">K8S名字组成</a></li><li class="sidebar-sub-header level3"><a href="/pages/95874c/#k8s的简介" class="sidebar-link">K8S的简介</a></li><li class="sidebar-sub-header level3"><a href="/pages/95874c/#master节点概念" class="sidebar-link">Master节点概念</a></li><li class="sidebar-sub-header level3"><a href="/pages/95874c/#node概念" class="sidebar-link">Node概念</a></li><li class="sidebar-sub-header level3"><a href="/pages/95874c/#pod介绍" class="sidebar-link">POD介绍</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#什么是pod" class="sidebar-link">什么是POD</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#创建一个pod" class="sidebar-link">创建一个POD</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#创建资源" class="sidebar-link">创建资源</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#查看是否创建成功" class="sidebar-link">查看是否创建成功</a></li><li class="sidebar-sub-header level3"><a href="/pages/95874c/#pod三种探针" class="sidebar-link">POD三种探针</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#探针的检测方式" class="sidebar-link">探针的检测方式</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#startupprobe" class="sidebar-link">StartupProbe</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#pod退出流程" class="sidebar-link">pod退出流程</a></li><li class="sidebar-sub-header level3"><a href="/pages/95874c/#资源调度" class="sidebar-link">资源调度</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#无状态服务deployment" class="sidebar-link">无状态服务Deployment</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#创建一个deployment" class="sidebar-link">创建一个Deployment</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#查看是否创建成功-2" class="sidebar-link">查看是否创建成功</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#导出一个yaml文件" class="sidebar-link">导出一个yaml文件</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#状态解析" class="sidebar-link">状态解析</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#deployment更新" class="sidebar-link">Deployment更新</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#deployment回滚" class="sidebar-link">Deployment回滚</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#deployment扩容" class="sidebar-link">deployment扩容</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#deployment缩容" class="sidebar-link">deployment缩容</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#暂停更新" class="sidebar-link">暂停更新</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#恢复更新" class="sidebar-link">恢复更新</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#deploy更新注意事项" class="sidebar-link">Deploy更新注意事项</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#有状态应用管理" class="sidebar-link">有状态应用管理</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#基本概念" class="sidebar-link">基本概念</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#注意事项" class="sidebar-link">注意事项</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#创建一个statefulset" class="sidebar-link">创建一个StatefulSet</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#验证服务之间是否通的" class="sidebar-link">验证服务之间是否通的</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#sts扩容" class="sidebar-link">sts扩容</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#statefulset更新策略" class="sidebar-link">StatefulSet更新策略</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#灰度发布" class="sidebar-link">灰度发布</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#级联删除和非级联删除" class="sidebar-link">级联删除和非级联删除</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#守护进程服务daemonset" class="sidebar-link">守护进程服务DaemonSet</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#简介-2" class="sidebar-link">简介</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#创建daemonset" class="sidebar-link">创建DaemonSet</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#daemonset更新和回滚" class="sidebar-link">DaemonSet更新和回滚</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#label-selector" class="sidebar-link">Label&amp;Selector</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#介绍" class="sidebar-link">介绍</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#实践" class="sidebar-link">实践</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#删除标签" class="sidebar-link">删除标签</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#修改标签" class="sidebar-link">修改标签</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#什么是hpa" class="sidebar-link">什么是HPA</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#简介-3" class="sidebar-link">简介</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#hpa实践" class="sidebar-link">HPA实践</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#什么是service" class="sidebar-link">什么是service</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#自定义一个service" class="sidebar-link">自定义一个service</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#测试" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#使用service代理k8s外部服务" class="sidebar-link">使用Service代理k8s外部服务</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#反代外部域名" class="sidebar-link">反代外部域名</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#service常用类型" class="sidebar-link">service常用类型</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#什么是ingress" class="sidebar-link">什么是ingress</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#安装ingress" class="sidebar-link">安装ingress</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#查看是否安装完成" class="sidebar-link">查看是否安装完成</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#添加helm仓库" class="sidebar-link">添加helm仓库</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#查看是否添加成功" class="sidebar-link">查看是否添加成功</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#搜索软件版本" class="sidebar-link">搜索软件版本</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#下载源码包" class="sidebar-link">下载源码包</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#修改配置文件" class="sidebar-link">修改配置文件</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#开始执行安装" class="sidebar-link">开始执行安装</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#查看是否安装完成-2" class="sidebar-link">查看是否安装完成</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#扩充节点" class="sidebar-link">扩充节点</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#缩容" class="sidebar-link">缩容</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#ingress简单使用" class="sidebar-link">ingress简单使用</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#创建一个ingress" class="sidebar-link">创建一个ingress</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#测试-2" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#configmap介绍" class="sidebar-link">ConfigMap介绍</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#基于目录创建configmap" class="sidebar-link">基于目录创建ConfigMap</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#基于文件创建configmap" class="sidebar-link">基于文件创建ConfigMap</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#自定义configmap的key名称" class="sidebar-link">自定义ConfigMap的key名称</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#基于env创建configmap" class="sidebar-link">基于env创建CoNfigMap</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#创建多个configmap" class="sidebar-link">创建多个ConfigMap</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#使用valuefrom定义环境变量" class="sidebar-link">使用valueFrom定义环境变量</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#使用envfrom定义环境变量" class="sidebar-link">使用envFrom定义环境变量</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#以文件的形式挂载configmap" class="sidebar-link">以文件的形式挂载ConfigMap</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#自定义挂载权限及名称" class="sidebar-link">自定义挂载权限及名称</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#secret的介绍" class="sidebar-link">Secret的介绍</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#创建secret" class="sidebar-link">创建Secret</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#使用配置文件创建secret" class="sidebar-link">使用配置文件创建Secret</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#使用secret拉取私有仓库镜像" class="sidebar-link">使用Secret拉取私有仓库镜像</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#使用subpath解决挂载覆盖" class="sidebar-link">使用SubPath解决挂载覆盖</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#configmap热更新" class="sidebar-link">ConfigMap热更新</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#使用限制" class="sidebar-link">使用限制</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#volumes介绍" class="sidebar-link">Volumes介绍</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#emptydir" class="sidebar-link">emptyDir</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#hostpath" class="sidebar-link">hostPath</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#nfs" class="sidebar-link">NFS</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#挂载到容器" class="sidebar-link">挂载到容器</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#pv和pvc" class="sidebar-link">PV和PVC</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#pv和pvc的介绍" class="sidebar-link">PV和PVC的介绍</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#pv的回收策略" class="sidebar-link">PV的回收策略</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#pv访问策略" class="sidebar-link">PV访问策略</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#文件存储、块存储、对象存储区别" class="sidebar-link">文件存储、块存储、对象存储区别</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#创建pv连接nfs" class="sidebar-link">创建pv连接nfs</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#pv的状态" class="sidebar-link">PV的状态</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#创建hostpath类型的pv" class="sidebar-link">创建HostPath类型的PV</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#pvc绑定pv" class="sidebar-link">PVC绑定PV</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#pod容器使用pvc" class="sidebar-link">pod容器使用PVC</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#pvc创建和挂载失败的原因" class="sidebar-link">PVC创建和挂载失败的原因</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#什么是job" class="sidebar-link">什么是JOB</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#配置参数详解" class="sidebar-link">配置参数详解</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#cronjob" class="sidebar-link">CronJob</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#cronjobe参数详解" class="sidebar-link">CronJobe参数详解</a></li><li class="sidebar-sub-header level4"><a href="/pages/95874c/#initcontainer" class="sidebar-link">InitContainer</a></li><li class="sidebar-sub-header level5"><a href="/pages/95874c/#用途" class="sidebar-link">用途</a></li></ul></li></ul></li><li><a href="/pages/10a196/" class="sidebar-link">k8s基础命令</a></li><li><a href="/pages/680317/" class="sidebar-link">Kubeadm安装k8s集群</a></li><li><a href="/pages/e6e664/" class="sidebar-link">二进制高可用安装k8集群</a></li><li><a href="/pages/cf68cc/" class="sidebar-link">rancher搭建k8s 集群</a></li><li><a href="/pages/93c7a0/" class="sidebar-link">Oracle 12c安装</a></li><li><a href="/pages/6d00ed/" class="sidebar-link">Jenkins+gitlab持续集成学习</a></li><li><a href="/pages/528e32/" class="sidebar-link">CloudFlare Argo Tunnel免费内网穿透</a></li><li><a href="/pages/8ff689/" class="sidebar-link">Linux使用WireGuard来创建内网</a></li><li><a href="/pages/830e28/" class="sidebar-link">利用Cloudflare Zero Trust创建大内网</a></li><li><a href="/pages/a51cd8/" class="sidebar-link">Docker 相关的 Shell</a></li><li><a href="/pages/c7703f/" class="sidebar-link">VM虚拟机Ubuntu 20.04 LVM磁盘扩容</a></li><li><a href="/pages/118ac7/" class="sidebar-link">深圳仪器平台-开发手册记录</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GitHub技巧</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>博客搭建</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>手册记录</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/manual/#手册" data-v-06225672>手册</a></li><li data-v-06225672><a href="/manual/#开发环境配置" data-v-06225672>开发环境配置</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/lixuanfengs" target="_blank" title="作者" class="beLink" data-v-06225672>cactusli</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-07-20</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><!---->K8S基础入门<!----></h1>  <div class="theme-vdoing-content content__default"><h2 id="k8s入门"><a href="#k8s入门" class="header-anchor">#</a> K8S入门</h2> <h3 id="k8s名字组成"><a href="#k8s名字组成" class="header-anchor">#</a> K8S名字组成</h3> <p>Kubernetes全称K到S中间相隔8个字母,所以叫K8S</p> <h3 id="k8s的简介"><a href="#k8s的简介" class="header-anchor">#</a> K8S的简介</h3> <p>Kubernetes是谷歌以Borg为前身,基于谷歌15年生产环境经验的基础上开源的一个项目,Kubernetes致力于提供跨主机集群的自动部署、扩展、高可用以及运行应用程序的平台</p> <h3 id="master节点概念"><a href="#master节点概念" class="header-anchor">#</a> Master节点概念</h3> <ol><li>Master节点:整个集群的控制中</li> <li>kube-apiserver:集群的控制中枢,各个模块之间信息交互都需要经过Kube-APIServer,同时</li></ol> <p>它也是集群管理、资源配置、整个集群安全机制的入口</p> <p>3、Controller-Manger:集群的状态管理器,保证Pod或其他资源达到期望值,也是需要和APIServer进行通信</p> <p>在需要的时候创建、更新或删除它所管理的资源</p> <p>4、Scheduler:集群的调度中心,它会根据指定的一系列条件,选择一个或一批最佳的节点,然后部署我们的pod</p> <p>5、Etcd键值数据库,报错一些集群的信息,一般生产环境中建议部署三个以上节点(奇数个)</p> <h3 id="node概念"><a href="#node概念" class="header-anchor">#</a> Node概念</h3> <p>Node节点:工作节点</p> <p>Worker、node节点、minion节点</p> <p>1、Kubelet:负责监听节点上的Pod的状态,同时负责上报节点和节点上面Pod的状态,负责与</p> <p>Master节点通信,并管理节点上面的Pod</p> <p>2、Kube-proxy：负责Pod之间的通信和负载均衡,将指定的流量分发到后端正确的机器上</p> <p>3、查看Kube-proxy工作模式:curl 127.0.0.1:10249/proxyMode</p> <p>4、ipvs:监听Master节点增加和删除service以及endpoint的消息,调用Netlink接口创建想要的</p> <p>ipvs规则,通过IPVS规则,将流量转发至相应的Pod上</p> <p>5、iptables:监听Master节点增加和删除service以及endpoint的消息,对于每一个Service,它都创建</p> <p>一个iptables规则,将service的clusterIP代理到后端对应的Pod上</p> <p>6、Calico:符合CNI标准的网络插件,给每个Pod生成一个唯一的IP地址,并且把每个节点当作一个路由器</p> <p>7、CoreDNS:用于Kubernetes集群内部Service的解析,可以让Pod把Service名称解析成 IP地址,然后通过Service的IP地址进行连接到对应的应用上</p> <p>8、Docker：容器引擎,负责对容器的管理</p> <h3 id="pod介绍"><a href="#pod介绍" class="header-anchor">#</a> POD介绍</h3> <h4 id="什么是pod"><a href="#什么是pod" class="header-anchor">#</a> 什么是POD</h4> <p>Pod 是Kubernetes中最小的单元,它由一组、一个或多个容器组成,每个Pod还包含了一个Pause容器,Pause容器是Pod的父容器，主要负责僵尸进程的回收管理,通过Pause容器可以使同一个Pod里面的多个容器共享存储、网络、PID、IPC等</p> <h4 id="创建一个pod"><a href="#创建一个pod" class="header-anchor">#</a> 创建一个POD</h4> <div class="language-python line-numbers-mode"><pre class="language-python"><code>apiVersion<span class="token punctuation">:</span> v1 <span class="token comment"># 必选，API的版本号</span>
kind<span class="token punctuation">:</span> Pod       <span class="token comment"># 必选，类型Pod</span>
metadata<span class="token punctuation">:</span>       <span class="token comment"># 必选，元数据</span>
  name<span class="token punctuation">:</span> nginx   <span class="token comment"># 必选，符合RFC 1035规范的Pod名称</span>
  namespace<span class="token punctuation">:</span> default <span class="token comment"># 可选，Pod所在的命名空间，不指定默认为default，可以使用-n 指定namespace </span>
  labels<span class="token punctuation">:</span>       <span class="token comment"># 可选，标签选择器，一般用于过滤和区分Pod</span>
    app<span class="token punctuation">:</span> nginx
    role<span class="token punctuation">:</span> frontend <span class="token comment"># 可以写多个</span>
  annotations<span class="token punctuation">:</span>  <span class="token comment"># 可选，注释列表，可以写多个</span>
    app<span class="token punctuation">:</span> nginx
spec<span class="token punctuation">:</span>   <span class="token comment"># 必选，用于定义容器的详细信息</span>
  initContainers<span class="token punctuation">:</span> <span class="token comment"># 初始化容器，在容器启动之前执行的一些初始化操作</span>
  <span class="token operator">-</span> command<span class="token punctuation">:</span>
    <span class="token operator">-</span> sh
    <span class="token operator">-</span> <span class="token operator">-</span>c
    <span class="token operator">-</span> echo <span class="token string">&quot;I am InitContainer for init some configuration&quot;</span>
    image<span class="token punctuation">:</span> busybox
    imagePullPolicy<span class="token punctuation">:</span> IfNotPresent
    name<span class="token punctuation">:</span> init<span class="token operator">-</span>container
  containers<span class="token punctuation">:</span>   <span class="token comment"># 必选，容器列表</span>
  <span class="token operator">-</span> name<span class="token punctuation">:</span> nginx <span class="token comment"># 必选，符合RFC 1035规范的容器名称</span>
    image<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest    <span class="token comment"># 必选，容器所用的镜像的地址</span>
    imagePullPolicy<span class="token punctuation">:</span> Always     <span class="token comment"># 可选,镜像拉取策略,IfNotPresent:如果宿主机有这个镜像,那就不需要在拉取了，那就不需要拉取了</span>
    command<span class="token punctuation">:</span> <span class="token comment"># 可选，容器启动执行的命令</span>
    <span class="token operator">-</span> nginx 
    <span class="token operator">-</span> <span class="token operator">-</span>g
    <span class="token operator">-</span> <span class="token string">&quot;daemon off;&quot;</span>
    workingDir<span class="token punctuation">:</span> <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html       <span class="token comment"># 可选，容器的工作目录</span>
    volumeMounts<span class="token punctuation">:</span>   <span class="token comment"># 可选，存储卷配置，可以配置多个</span>
    <span class="token operator">-</span> name<span class="token punctuation">:</span> webroot <span class="token comment"># 存储卷名称</span>
      mountPath<span class="token punctuation">:</span> <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html <span class="token comment"># 挂载目录</span>
      readOnly<span class="token punctuation">:</span> true        <span class="token comment"># 只读</span>
    ports<span class="token punctuation">:</span>  <span class="token comment"># 可选，容器需要暴露的端口号列表</span>
    <span class="token operator">-</span> name<span class="token punctuation">:</span> http    <span class="token comment"># 端口名称</span>
      containerPort<span class="token punctuation">:</span> <span class="token number">80</span>     <span class="token comment"># 端口号</span>
      protocol<span class="token punctuation">:</span> TCP <span class="token comment"># 端口协议，默认TCP</span>
    env<span class="token punctuation">:</span>    <span class="token comment"># 可选，环境变量配置列表</span>
    <span class="token operator">-</span> name<span class="token punctuation">:</span> TZ      <span class="token comment"># 变量名</span>
      value<span class="token punctuation">:</span> Asia<span class="token operator">/</span>Shanghai <span class="token comment"># 变量的值</span>
    <span class="token operator">-</span> name<span class="token punctuation">:</span> LANG
      value<span class="token punctuation">:</span> en_US<span class="token punctuation">.</span>utf8
    resources<span class="token punctuation">:</span>      <span class="token comment"># 可选，资源限制和资源请求限制</span>
      limits<span class="token punctuation">:</span>       <span class="token comment"># 最大限制设置</span>
        cpu<span class="token punctuation">:</span> 1000m
        memory<span class="token punctuation">:</span> 1024Mi
      requests<span class="token punctuation">:</span>     <span class="token comment"># 启动所需的资源</span>
        cpu<span class="token punctuation">:</span> 100m
        memory<span class="token punctuation">:</span> 512Mi
    startupProbe<span class="token punctuation">:</span> <span class="token comment"># 可选，检测容器内进程是否完成启动。注意三种检查方式同时只能使用一种。</span>
      httpGet<span class="token punctuation">:</span>      <span class="token comment"># httpGet检测方式，生产环境建议使用httpGet实现接口级健康检查，健康检查由应用程序提供。</span>
           path<span class="token punctuation">:</span> <span class="token operator">/</span>api<span class="token operator">/</span>successStart <span class="token comment"># 检查路径</span>
            port<span class="token punctuation">:</span> <span class="token number">80</span>
    readinessProbe<span class="token punctuation">:</span> <span class="token comment"># 可选，健康检查。注意三种检查方式同时只能使用一种。</span>
      httpGet<span class="token punctuation">:</span>      <span class="token comment"># httpGet检测方式，生产环境建议使用httpGet实现接口级健康检查，健康检查由应用程序提供。</span>
            path<span class="token punctuation">:</span> <span class="token operator">/</span> <span class="token comment"># 检查路径</span>
            port<span class="token punctuation">:</span> <span class="token number">80</span>        <span class="token comment"># 监控端口</span>
    livenessProbe<span class="token punctuation">:</span>  <span class="token comment"># 可选，健康检查</span>
      <span class="token comment">#exec:        # 执行容器命令检测方式</span>
            <span class="token comment">#command: </span>
            <span class="token comment">#- cat</span>
            <span class="token comment">#- /health</span>
    <span class="token comment">#httpGet:       # httpGet检测方式</span>
    <span class="token comment">#   path: /_health # 检查路径</span>
    <span class="token comment">#   port: 8080</span>
    <span class="token comment">#   httpHeaders: # 检查的请求头</span>
    <span class="token comment">#   - name: end-user</span>
    <span class="token comment">#     value: Jason </span>
      tcpSocket<span class="token punctuation">:</span>    <span class="token comment"># 端口检测方式</span>
            port<span class="token punctuation">:</span> <span class="token number">80</span>
      initialDelaySeconds<span class="token punctuation">:</span> <span class="token number">60</span>       <span class="token comment"># 初始化时间</span>
      timeoutSeconds<span class="token punctuation">:</span> <span class="token number">2</span>     <span class="token comment"># 超时时间</span>
      periodSeconds<span class="token punctuation">:</span> <span class="token number">5</span>      <span class="token comment"># 检测间隔</span>
      successThreshold<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># 检查成功为2次表示就绪</span>
      failureThreshold<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment"># 检测失败1次表示未就绪</span>
    lifecycle<span class="token punctuation">:</span>
      postStart<span class="token punctuation">:</span> <span class="token comment"># 容器创建完成后执行的指令, 可以是exec httpGet TCPSocket</span>
        <span class="token keyword">exec</span><span class="token punctuation">:</span>
          command<span class="token punctuation">:</span>
          <span class="token operator">-</span> sh
          <span class="token operator">-</span> <span class="token operator">-</span>c
          <span class="token operator">-</span> <span class="token string">'mkdir /data/ '</span>
      preStop<span class="token punctuation">:</span>
        httpGet<span class="token punctuation">:</span>      
              path<span class="token punctuation">:</span> <span class="token operator">/</span>
              port<span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token comment">#  exec:</span>
      <span class="token comment">#    command:</span>
      <span class="token comment">#    - sh</span>
      <span class="token comment">#    - -c</span>
      <span class="token comment">#    - sleep 9</span>
  restartPolicy<span class="token punctuation">:</span> Always   <span class="token comment"># alwayes:容器故障或者没有启动成功,那就自动重启该容器,Onfailure:容器以不为0的状态终止,自动重启该容器,Never:无论何种状态,都不会重启 </span>
  <span class="token comment">#nodeSelector: # 可选，指定Node节点</span>
  <span class="token comment">#      region: subnet7</span>
  imagePullSecrets<span class="token punctuation">:</span>     <span class="token comment"># 可选，拉取镜像使用的secret，可以配置多个</span>
  <span class="token operator">-</span> name<span class="token punctuation">:</span> default<span class="token operator">-</span>dockercfg<span class="token operator">-</span><span class="token number">86258</span>
  hostNetwork<span class="token punctuation">:</span> false    <span class="token comment"># 可选，是否为主机模式，如是，会占用主机端口</span>
  volumes<span class="token punctuation">:</span>      <span class="token comment"># 共享存储卷列表</span>
  <span class="token operator">-</span> name<span class="token punctuation">:</span> webroot <span class="token comment"># 名称，与上述对应</span>
    emptyDir<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token comment"># 挂载目录</span>
        <span class="token comment">#hostPath:              # 挂载本机目录</span>
        <span class="token comment">#  path: /etc/hosts</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br></div></div><h5 id="创建资源"><a href="#创建资源" class="header-anchor">#</a> 创建资源</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl create -f pod.yaml</span>
pod<span class="token operator">/</span>nginx created
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="查看是否创建成功"><a href="#查看是否创建成功" class="header-anchor">#</a> 查看是否创建成功</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl get po -owide</span>
NAME    READY   STATUS    RESTARTS   AGE   IP               NODE        NOMINATED NODE   READINESS GATES
nginx   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          6s    <span class="token number">172.175</span><span class="token number">.156</span><span class="token number">.74</span>   k8s<span class="token operator">-</span>node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="pod三种探针"><a href="#pod三种探针" class="header-anchor">#</a> POD三种探针</h3> <p>1、StartupProbe:k8s1.16版本后新加的探测方式,用于判断容器内应用程序是否已经启动,如果配置了startupProbe就会先禁止其他的探测,直到它成功为止,成功后将不在进行探测</p> <p>2、LivenessProbe:用于探测容器是否运行,如果探测失败,kubelet会根据配置的重启策略进行相应的处理,若没有配置该探针,默认就是sucess</p> <p>3、ReadinessProbe:一般用于探测容器内的程序是否健康,它的返回值如果为success，那么就代表这个容器已经完全启动,并且程序已经是可以接受流量的状态</p> <h4 id="探针的检测方式"><a href="#探针的检测方式" class="header-anchor">#</a> 探针的检测方式</h4> <p>1、ExecAction:在容器内执行一个命令,如果返回值为0，则认为容器健康</p> <p>2、TCPSocketAction:通过TCP连接检查容器内的端口是否是通的,如果是通的就认为容器健康</p> <p>3、HTTPGetAction:通过应用程序暴露的API地址来检查程序是否是正常的,如果状态码为200~400之间,则认为容器健康</p> <h4 id="startupprobe"><a href="#startupprobe" class="header-anchor">#</a> StartupProbe</h4> <p>判断容器内的应用程序是否已启动。如果提供了启动探测，则禁用所有其他探测，直到它成功为止。如果启动探测失败，kubelet将杀死容器，容器将服从其重启策略。如果容器没有提供启动探测，则默认状态为成功</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 健康状态检测端口</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># cat pod.yaml</span>
    startupProbe<span class="token punctuation">:</span> <span class="token comment"># 可选，检测容器内进程是否完成启动。注意三种检查方式同时只能使用一种。</span>
      <span class="token comment">#httpGet:      # httpGet检测方式，生产环境建议使用httpGet实现接口级健康检查，健康检查由应用程序提供。</span>
      <span class="token comment">#      path: /api/successStart # 检查路径</span>
      <span class="token comment">#      port: 80</span>
         tcpSocket<span class="token punctuation">:</span>
           port<span class="token punctuation">:</span> <span class="token number">80</span>
<span class="token comment"># 创建容器</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl  get po -owide</span>
NAME    READY   STATUS    RESTARTS   AGE     IP               NODE        NOMINATED NODE   READINESS GATES
nginx   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          3m39s   <span class="token number">172.175</span><span class="token number">.156</span><span class="token number">.76</span>   k8s<span class="token operator">-</span>node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># curl 172.175.156.76</span>
<span class="token operator">&lt;</span>!DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx!<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
    body <span class="token punctuation">{</span>
        width<span class="token punctuation">:</span> 35em<span class="token punctuation">;</span>
        margin<span class="token punctuation">:</span> <span class="token number">0</span> auto<span class="token punctuation">;</span>
        font<span class="token operator">-</span>family<span class="token punctuation">:</span> Tahoma<span class="token punctuation">,</span> Verdana<span class="token punctuation">,</span> Arial<span class="token punctuation">,</span> sans<span class="token operator">-</span>serif<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="pod退出流程"><a href="#pod退出流程" class="header-anchor">#</a> pod退出流程</h4> <p>用户操作删除操作---&gt;pod变成Terminating--&gt;执行PreStop的指令--&gt;Endpoint删除该Pod的IP地址</p> <p>Prestop：先去请求eureka接口，把自己的IP地址和端口号，进行下线，eureka从注册表中删除该应用的IP地址。然后容器进行sleep 90；kill pgrep java</p> <p>如果sleep时间过长，需要修改terminationGracePeriodSeconds</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>terminationGracePeriodSeconds<span class="token punctuation">:</span> <span class="token number">40</span>  <span class="token comment">#*</span>
  containers<span class="token punctuation">:</span>   <span class="token comment"># 必选，容器列表</span>
  <span class="token operator">-</span> name<span class="token punctuation">:</span> nginx <span class="token comment"># 必选，符合RFC 1035规范的容器名称</span>
    image<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest    <span class="token comment"># 必选，容器所用的镜像的地址</span>
    imagePullPolicy<span class="token punctuation">:</span> Always     <span class="token comment"># 可选，镜像拉取策略</span>
    command<span class="token punctuation">:</span> <span class="token comment"># 可选，容器启动执行的命令</span>
    <span class="token operator">-</span> nginx
    <span class="token operator">-</span> <span class="token operator">-</span>g
    <span class="token operator">-</span> <span class="token string">&quot;daemon off;&quot;</span>
    lifecycle<span class="token punctuation">:</span>
   <span class="token comment">#   postStart: # 容器创建完成后执行的指令, 可以是exec httpGet TCPSocket</span>
   <span class="token comment">#     exec:</span>
   <span class="token comment">#       command:</span>
   <span class="token comment">#       - sh</span>
   <span class="token comment">#       - -c</span>
   <span class="token comment">#       - 'mkdir /data/ '</span>
     preStop<span class="token punctuation">:</span>
   <span class="token comment">#     httpGet:</span>
   <span class="token comment">#           path: /</span>
   <span class="token comment">#           port: 80</span>
        <span class="token keyword">exec</span><span class="token punctuation">:</span>
          command<span class="token punctuation">:</span>
          <span class="token operator">-</span> sh
          <span class="token operator">-</span> <span class="token operator">-</span>c
          <span class="token operator">-</span> sleep <span class="token number">90</span>  <span class="token comment">#不会真的等待90s</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="资源调度"><a href="#资源调度" class="header-anchor">#</a> 资源调度</h3> <h4 id="无状态服务deployment"><a href="#无状态服务deployment" class="header-anchor">#</a> 无状态服务Deployment</h4> <p>用于部署无状态的服务,这个是最常用的控制器,一般用于管理维护企业内部无状态的微服务,比如configserver、zuul、springboot，他可以管理多个副本的Pod实现无缝迁移、自动扩容缩容、自动灾难恢复、一键回滚等功能</p> <h5 id="创建一个deployment"><a href="#创建一个deployment" class="header-anchor">#</a> 创建一个Deployment</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl create deployment nginx --image=nginx:1.15.2</span>
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>nginx created
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="查看是否创建成功-2"><a href="#查看是否创建成功-2" class="header-anchor">#</a> 查看是否创建成功</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl get deployment</span>
NAME    READY   UP<span class="token operator">-</span>TO<span class="token operator">-</span>DATE   AVAILABLE   AGE
nginx   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     <span class="token number">1</span>            <span class="token number">1</span>           77s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="导出一个yaml文件"><a href="#导出一个yaml文件" class="header-anchor">#</a> 导出一个yaml文件</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl  get deployment nginx -o yaml &gt; nginx-deployment.yaml</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># cat nginx-deployment.yaml</span>
apiVersion<span class="token punctuation">:</span> apps<span class="token operator">/</span>v1
kind<span class="token punctuation">:</span> Deployment
metadata<span class="token punctuation">:</span>
  annotations<span class="token punctuation">:</span>
    deployment<span class="token punctuation">.</span>kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>revision<span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span>
  creationTimestamp<span class="token punctuation">:</span> <span class="token string">&quot;2022-01-17T03:32:11Z&quot;</span>
  generation<span class="token punctuation">:</span> <span class="token number">1</span>   
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> nginx
  name<span class="token punctuation">:</span> nginx
  namespace<span class="token punctuation">:</span> default
spec<span class="token punctuation">:</span>
  progressDeadlineSeconds<span class="token punctuation">:</span> <span class="token number">600</span>
  replicas<span class="token punctuation">:</span> <span class="token number">2</span>  <span class="token comment">#副本数</span>
  revisionHistoryLimit<span class="token punctuation">:</span> <span class="token number">10</span>  <span class="token comment">#历史记录保留个数</span>
  selector<span class="token punctuation">:</span>
    matchLabels<span class="token punctuation">:</span>
      app<span class="token punctuation">:</span> nginx
  strategy<span class="token punctuation">:</span>
    rollingUpdate<span class="token punctuation">:</span>
      maxSurge<span class="token punctuation">:</span> <span class="token number">25</span><span class="token operator">%</span>
      maxUnavailable<span class="token punctuation">:</span> <span class="token number">25</span><span class="token operator">%</span>
    <span class="token builtin">type</span><span class="token punctuation">:</span> RollingUpdate
  template<span class="token punctuation">:</span>
    metadata<span class="token punctuation">:</span>
      creationTimestamp<span class="token punctuation">:</span> null
      labels<span class="token punctuation">:</span>
        app<span class="token punctuation">:</span> nginx
    spec<span class="token punctuation">:</span>
      containers<span class="token punctuation">:</span>
      <span class="token operator">-</span> image<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.2</span>
        imagePullPolicy<span class="token punctuation">:</span> IfNotPresent
        name<span class="token punctuation">:</span> nginx
        resources<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        terminationMessagePath<span class="token punctuation">:</span> <span class="token operator">/</span>dev<span class="token operator">/</span>termination<span class="token operator">-</span>log
        terminationMessagePolicy<span class="token punctuation">:</span> File
      dnsPolicy<span class="token punctuation">:</span> ClusterFirst
      restartPolicy<span class="token punctuation">:</span> Always
      schedulerName<span class="token punctuation">:</span> default<span class="token operator">-</span>scheduler
      securityContext<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      terminationGracePeriodSeconds<span class="token punctuation">:</span> <span class="token number">30</span>
<span class="token comment"># 从文件创建deployment</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl replace -f nginx-deployment.yaml</span>
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>nginx replaced
<span class="token comment"># 查看副本数 </span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl  get po</span>
NAME                     READY   STATUS    RESTARTS   AGE
nginx<span class="token operator">-</span>66bbc9fdc5<span class="token operator">-</span>bbl95   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          35s
nginx<span class="token operator">-</span>66bbc9fdc5<span class="token operator">-</span>m8jzn   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          10m
<span class="token comment"># 可以使用edit来管理修改副本数</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl edit deploy nginx</span>
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>nginx edited
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl  get po</span>
NAME                     READY   STATUS    RESTARTS   AGE
nginx<span class="token operator">-</span>66bbc9fdc5<span class="token operator">-</span>m8jzn   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          12m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h5 id="状态解析"><a href="#状态解析" class="header-anchor">#</a> 状态解析</h5> <p>![img](https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/image (3).png)</p> <p>1、NAME： Deployment名称</p> <p>2、READY： Pod的状态</p> <p>3、UP-TO-DATE：已经达到期望状态的被更新的副本数</p> <p>4、 AVAILABLE:已经可以用的副本数</p> <p>5、AGE:显示应用程序运行的时间</p> <p>6、 CONTAINERS:容器名称</p> <p>7、IMAGES:容器的镜像</p> <p>8、SELECTOR：管理的Pod的标签</p> <h5 id="deployment更新"><a href="#deployment更新" class="header-anchor">#</a> Deployment更新</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 更新nginx镜像</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl set image deploy nginx nginx=nginx:1.15.3 --record</span>
<span class="token comment"># 查看更新过程</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master work1<span class="token punctuation">]</span><span class="token comment"># kubectl rollout status deploy nginx</span>
Waiting <span class="token keyword">for</span> deployment <span class="token string">&quot;nginx&quot;</span> rollout to finish<span class="token punctuation">:</span> <span class="token number">1</span> out of <span class="token number">2</span> new replicas have been updated<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Waiting <span class="token keyword">for</span> deployment <span class="token string">&quot;nginx&quot;</span> rollout to finish<span class="token punctuation">:</span> <span class="token number">1</span> out of <span class="token number">2</span> new replicas have been updated<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Waiting <span class="token keyword">for</span> deployment <span class="token string">&quot;nginx&quot;</span> rollout to finish<span class="token punctuation">:</span> <span class="token number">1</span> out of <span class="token number">2</span> new replicas have been updated<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment"># 查看是否更新完成</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl get rs</span>
NAME               DESIRED   CURRENT   READY   AGE
nginx<span class="token operator">-</span>5dfc8689c6   <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       51s
nginx<span class="token operator">-</span>66bbc9fdc5   <span class="token number">0</span>         <span class="token number">0</span>         <span class="token number">0</span>       29m
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl  get po</span>
NAME                     READY   STATUS    RESTARTS   AGE
nginx<span class="token operator">-</span>5dfc8689c6<span class="token operator">-</span>tv7ws   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          59s
<span class="token comment"># 查看镜像是否已经更新</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl get po nginx-5dfc8689c6-tv7ws -oyaml | grep image</span>
            f<span class="token punctuation">:</span>image<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            f<span class="token punctuation">:</span>imagePullPolicy<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token operator">-</span> image<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.3</span>
    imagePullPolicy<span class="token punctuation">:</span> IfNotPresent
    image<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.3</span>
    imageID<span class="token punctuation">:</span> docker<span class="token operator">-</span>pullable<span class="token punctuation">:</span><span class="token operator">//</span>nginx@sha256<span class="token punctuation">:</span>24a0c4b4a4c0eb97a1aabb8e29f18e917d05abf
<span class="token comment"># 查看更新后过程的详细信息</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment">#  kubectl describe deploy nginx</span>
Events<span class="token punctuation">:</span>
  Type    Reason             Age    From                   Message
  <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>    <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>             <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>   <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>                   <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
  Normal  ScalingReplicaSet  32m    deployment<span class="token operator">-</span>controller  Scaled up replica <span class="token builtin">set</span> nginx<span class="token operator">-</span>66bbc9fdc5 to <span class="token number">1</span>
  Normal  ScalingReplicaSet  23m    deployment<span class="token operator">-</span>controller  Scaled up replica <span class="token builtin">set</span> nginx<span class="token operator">-</span>66bbc9fdc5 to <span class="token number">2</span>
  Normal  ScalingReplicaSet  20m    deployment<span class="token operator">-</span>controller  Scaled down replica <span class="token builtin">set</span> nginx<span class="token operator">-</span>66bbc9fdc5 to <span class="token number">1</span>
  Normal  ScalingReplicaSet  4m28s  deployment<span class="token operator">-</span>controller  Scaled up replica <span class="token builtin">set</span> nginx<span class="token operator">-</span>5dfc8689c6 to <span class="token number">1</span>
  Normal  ScalingReplicaSet  4m6s   deployment<span class="token operator">-</span>controller  Scaled down replica <span class="token builtin">set</span> nginx<span class="token operator">-</span>66bbc9fdc5 to <span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h5 id="deployment回滚"><a href="#deployment回滚" class="header-anchor">#</a> Deployment回滚</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 查看历史版本</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl rollout history deploy nginx</span>
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>nginx
REVISION  CHANGE<span class="token operator">-</span>CAUSE
<span class="token number">2</span>         kubectl <span class="token builtin">set</span> image deploy nginx nginx<span class="token operator">=</span>nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.3</span> <span class="token operator">-</span><span class="token operator">-</span>record<span class="token operator">=</span>true
<span class="token number">3</span>         kubectl <span class="token builtin">set</span> image deploy nginx nginx<span class="token operator">=</span>nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.4</span> <span class="token operator">-</span><span class="token operator">-</span>record<span class="token operator">=</span>true
<span class="token comment"># 查看之前的镜像版本</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl get po nginx-6cdd5dd489-gr489 -oyaml | grep image</span>
            f<span class="token punctuation">:</span>image<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            f<span class="token punctuation">:</span>imagePullPolicy<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token operator">-</span> image<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.4</span>
    imagePullPolicy<span class="token punctuation">:</span> IfNotPresent
    image<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.4</span>
    imageID<span class="token punctuation">:</span> docker<span class="token operator">-</span>pullable<span class="token punctuation">:</span><span class="token operator">//</span>nginx@sha256<span class="token punctuation">:</span>e8ab8d42e0c34c104ac60b43ba60b19af08e19a
<span class="token comment"># 回滚到上一个版本</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl rollout undo deploy nginx</span>
<span class="token comment"># 回滚之后的</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl rollout undo deploy nginx</span>
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>nginx rolled back
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl get deploy nginx -oyaml | grep nginx</span>
    kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>change<span class="token operator">-</span>cause<span class="token punctuation">:</span> kubectl <span class="token builtin">set</span> image deploy nginx nginx<span class="token operator">=</span>nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.3</span>
    app<span class="token punctuation">:</span> nginx
              k<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;nginx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">:</span>
              k<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;nginx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> nginx
      app<span class="token punctuation">:</span> nginx
        app<span class="token punctuation">:</span> nginx
      <span class="token operator">-</span> image<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.3</span>
        name<span class="token punctuation">:</span> nginx
<span class="token comment"># 查看指定版本的详细信息</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl  rollout history deploy nginx --revision=3</span>
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>nginx <span class="token keyword">with</span> revision <span class="token comment">#3</span>
Pod Template<span class="token punctuation">:</span>
  Labels<span class="token punctuation">:</span>       app<span class="token operator">=</span>nginx
        pod<span class="token operator">-</span>template<span class="token operator">-</span><span class="token builtin">hash</span><span class="token operator">=</span>6cdd5dd489
  Annotations<span class="token punctuation">:</span>  kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>change<span class="token operator">-</span>cause<span class="token punctuation">:</span> kubectl <span class="token builtin">set</span> image deploy nginx nginx<span class="token operator">=</span>nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.4</span> <span class="token operator">-</span><span class="token operator">-</span>record<span class="token operator">=</span>true
  Containers<span class="token punctuation">:</span>
   nginx<span class="token punctuation">:</span>
    Image<span class="token punctuation">:</span>      nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.4</span>
    Port<span class="token punctuation">:</span>       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
    Host Port<span class="token punctuation">:</span>  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
    Environment<span class="token punctuation">:</span>        <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
    Mounts<span class="token punctuation">:</span>     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
  Volumes<span class="token punctuation">:</span>      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="token comment"># 回滚到指定的版本</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl rollout undo deploy nginx --to-revision=3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h5 id="deployment扩容"><a href="#deployment扩容" class="header-anchor">#</a> deployment扩容</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 扩容</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl scale --replicas=3 deploy nginx</span>
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>nginx scaled
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl  get po</span>
NAME                     READY   STATUS    RESTARTS   AGE
nginx<span class="token operator">-</span>6cdd5dd489<span class="token operator">-</span>hrd7g   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          7m58s
nginx<span class="token operator">-</span>6cdd5dd489<span class="token operator">-</span>nc697   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          26s
nginx<span class="token operator">-</span>6cdd5dd489<span class="token operator">-</span>txcbk   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          26s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="deployment缩容"><a href="#deployment缩容" class="header-anchor">#</a> deployment缩容</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl scale --replicas=2 deploy nginx</span>
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>nginx scaled
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl  get po</span>
NAME                     READY   STATUS        RESTARTS   AGE
nginx<span class="token operator">-</span>6cdd5dd489<span class="token operator">-</span>hrd7g   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          10m
nginx<span class="token operator">-</span>6cdd5dd489<span class="token operator">-</span>nc697   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          3m15s
nginx<span class="token operator">-</span>6cdd5dd489<span class="token operator">-</span>txcbk   <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>     Terminating   <span class="token number">0</span>          3m15s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="暂停更新"><a href="#暂停更新" class="header-anchor">#</a> 暂停更新</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl rollout pause deployment nginx</span>
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>nginx paused
<span class="token comment"># 第一次更新操作</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl set image deploy nginx nginx=nginx:1.15.5 --record</span>
<span class="token comment"># 添加内存和cpu配置</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl set resources deploy nginx -c nginx --limits=cpu=200m,memory=128Mi --requests=cpu=10m,memory=16Mi</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="恢复更新"><a href="#恢复更新" class="header-anchor">#</a> 恢复更新</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl  get po</span>
NAME                     READY   STATUS    RESTARTS   AGE
nginx<span class="token operator">-</span>6cdd5dd489<span class="token operator">-</span>hrd7g   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          19m
nginx<span class="token operator">-</span>6cdd5dd489<span class="token operator">-</span>nc697   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          12m
<span class="token comment"># 恢复更新</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl rollout resume deploy nginx</span>
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>nginx resumed
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl get rs</span>
NAME               DESIRED   CURRENT   READY   AGE
nginx<span class="token operator">-</span>5dfc8689c6   <span class="token number">0</span>         <span class="token number">0</span>         <span class="token number">0</span>       145m
nginx<span class="token operator">-</span>66bbc9fdc5   <span class="token number">0</span>         <span class="token number">0</span>         <span class="token number">0</span>       174m
nginx<span class="token operator">-</span>69944fdbc8   <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">0</span>       8s
nginx<span class="token operator">-</span>6cdd5dd489   <span class="token number">2</span>         <span class="token number">2</span>         <span class="token number">2</span>       31m
<span class="token comment"># 查看是否更新完成</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl  get po</span>
NAME                     READY   STATUS    RESTARTS   AGE
nginx<span class="token operator">-</span>69944fdbc8<span class="token operator">-</span>7mhfs   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          17s
nginx<span class="token operator">-</span>69944fdbc8<span class="token operator">-</span>9xbq2   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          38s
<span class="token comment"># 查看更新后的nginx镜像版本</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment">#  kubectl get deploy nginx -oyaml | grep nginx</span>
    kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>change<span class="token operator">-</span>cause<span class="token punctuation">:</span> kubectl <span class="token builtin">set</span> image deploy nginx nginx<span class="token operator">=</span>nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.5</span>
    app<span class="token punctuation">:</span> nginx
              k<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;nginx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">:</span>
              k<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;nginx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> nginx
      app<span class="token punctuation">:</span> nginx
        app<span class="token punctuation">:</span> nginx
      <span class="token operator">-</span> image<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.5</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h5 id="deploy更新注意事项"><a href="#deploy更新注意事项" class="header-anchor">#</a> Deploy更新注意事项</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl get deploy nginx -oyaml</span>
apiVersion<span class="token punctuation">:</span> apps<span class="token operator">/</span>v1
kind<span class="token punctuation">:</span> Deployment
metadata<span class="token punctuation">:</span>
  annotations<span class="token punctuation">:</span>
    deployment<span class="token punctuation">.</span>kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>revision<span class="token punctuation">:</span> <span class="token string">&quot;7&quot;</span>
    kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>change<span class="token operator">-</span>cause<span class="token punctuation">:</span> kubectl <span class="token builtin">set</span> image deploy nginx nginx<span class="token operator">=</span>nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.5</span>
      <span class="token operator">-</span><span class="token operator">-</span>record<span class="token operator">=</span>true
  creationTimestamp<span class="token punctuation">:</span> <span class="token string">&quot;2022-01-17T03:32:11Z&quot;</span>
  generation<span class="token punctuation">:</span> <span class="token number">14</span>
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> nginx
spec<span class="token punctuation">:</span>
  progressDeadlineSeconds<span class="token punctuation">:</span> <span class="token number">600</span>
  replicas<span class="token punctuation">:</span> <span class="token number">2</span>
  revisionHistoryLimit<span class="token punctuation">:</span> <span class="token number">10</span>   <span class="token comment"># 设置保留rs旧的revision的个数,设置为0的话,不保留历史数据</span>
  selector<span class="token punctuation">:</span>
    matchLabels<span class="token punctuation">:</span>
      app<span class="token punctuation">:</span> nginx
  strategy<span class="token punctuation">:</span>
    rollingUpdate<span class="token punctuation">:</span>
      maxSurge<span class="token punctuation">:</span> <span class="token number">25</span><span class="token operator">%</span>  <span class="token comment"># 可以超过期望值的最大Pod数，可选字段，默认为25%，可以设置成数字或百分比，如果该值为0，那么maxUnavailable不能为0</span>
      maxUnavailable<span class="token punctuation">:</span> <span class="token number">25</span><span class="token operator">%</span>  <span class="token comment"># 指定在回滚或更新时最大不可用的Pod的数量，可选字段，默认25%，可以设置成数字或百分比，如果该值为0，那么maxSurge就不能0</span>
    <span class="token builtin">type</span><span class="token punctuation">:</span> RollingUpdate  <span class="token comment"># 指定在回滚或更新时最大不可用的Pod的数量，可选字段，默认25%，可以设置成数字或百分比，如果该值为0，那么maxSurge就不能0</span>
  template<span class="token punctuation">:</span>
    metadata<span class="token punctuation">:</span>
      creationTimestamp<span class="token punctuation">:</span> null
      labels<span class="token punctuation">:</span>
        app<span class="token punctuation">:</span> nginx
    spec<span class="token punctuation">:</span>
      containers<span class="token punctuation">:</span>
      <span class="token operator">-</span> image<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.5</span>
        imagePullPolicy<span class="token punctuation">:</span> IfNotPresent 
        name<span class="token punctuation">:</span> nginx
        resources<span class="token punctuation">:</span>
          limits<span class="token punctuation">:</span>
            cpu<span class="token punctuation">:</span> 200m
            memory<span class="token punctuation">:</span> 128Mi
          requests<span class="token punctuation">:</span>
            cpu<span class="token punctuation">:</span> 10m
            memory<span class="token punctuation">:</span> 16Mi
        terminationMessagePath<span class="token punctuation">:</span> <span class="token operator">/</span>dev<span class="token operator">/</span>termination<span class="token operator">-</span>log
        terminationMessagePolicy<span class="token punctuation">:</span> File
      dnsPolicy<span class="token punctuation">:</span> ClusterFirst
      restartPolicy<span class="token punctuation">:</span> Always
      schedulerName<span class="token punctuation">:</span> default<span class="token operator">-</span>scheduler
      securityContext<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      terminationGracePeriodSeconds<span class="token punctuation">:</span> <span class="token number">30</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>1、spc.minReadySeconds:可选参数,指定新创建的Pod在没有任何容器崩溃的情况下视为Ready最小的秒数,默认为0,一旦被创建就视为可用</p> <p>2、Recreate：重建，先删除旧的Pod，在创建新的Pod</p> <h4 id="有状态应用管理"><a href="#有状态应用管理" class="header-anchor">#</a> 有状态应用管理</h4> <h5 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h5> <p>StatefulSet（有状态集，缩写为sts）常用于部署有状态的且需要有序启动的应用程序，比如在进行SpringCloud项目容器化时，Eureka的部署是比较适合用StatefulSet部署方式的，可以给每个Eureka实例创建一个唯一且固定的标识符，并且每个Eureka实例无需配置多余的Service，其余Spring Boot应用可以直接通过Eureka的Headless Service即可进行注册。</p> <p>Service：无头 service，没有ClusterIP eureka-svc</p> <h5 id="基本概念"><a href="#基本概念" class="header-anchor">#</a> 基本概念</h5> <p>StatefulSet主要用于管理有状态应用程序的工作负载API对象。比如在生产环境中，可以部署ElasticSearch集群、MongoDB集群或者需要持久化的RabbitMQ集群、Redis集群、Kafka集群和ZooKeeper集群等。</p> <p>和Deployment类似，一个StatefulSet也同样管理着基于相同容器规范的Pod。不同的是，StatefulSet为每个Pod维护了一个粘性标识。这些Pod是根据相同的规范创建的，但是不可互换，每个Pod都有一个持久的标识符，在重新调度时也会保留，一般格式为StatefulSetName-Number。比如定义一个名字是Redis-Sentinel的StatefulSet，指定创建三个Pod，那么创建出来的Pod名字就为Redis-Sentinel-0、Redis-Sentinel-1、Redis-Sentinel-2。而StatefulSet创建的Pod一般使用Headless Service（无头服务）进行通信，和普通的Service的区别在于Headless Service没有ClusterIP，它使用的是Endpoint进行互相通信，Headless一般的格式为：</p> <p>statefulSetName-{0..N-1}.serviceName.namespace.svc.cluster.local。</p> <p>说明：</p> <p>1、serviceName为Headless Service的名字，创建StatefulSet时，必须指定Headless Service名称；</p> <p>2、0..N-1为Pod所在的序号，从0开始到N-1；</p> <p>3、statefulSetName为StatefulSet的名字；</p> <p>4、 namespace为服务所在的命名空间；</p> <p>5、cluster.local为Cluster Domain（集群域）。</p> <p>假如公司某个项目需要在Kubernetes中部署一个主从模式的Redis，此时使用StatefulSet部署就极为合适，因为StatefulSet启动时，只有当前一个容器完全启动时，后一个容器才会被调度，并且每个容器的标识符是固定的，那么就可以通过标识符来断定当前Pod的角色。</p> <p>比如用一个名为redis-ms的StatefulSet部署主从架构的Redis，第一个容器启动时，它的标识符为redis-ms-0，并且Pod内主机名也为redis-ms-0，此时就可以根据主机名来判断，当主机名为redis-ms-0的容器作为Redis的主节点，其余从节点，那么Slave连接Master主机配置就可以使用不会更改的Master的Headless Service，此时Redis从节点（Slave）配置文件如下：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>port <span class="token number">6379</span>
slaveof redis<span class="token operator">-</span>ms<span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">.</span>redis<span class="token operator">-</span>ms<span class="token punctuation">.</span>public<span class="token operator">-</span>service<span class="token punctuation">.</span>svc<span class="token punctuation">.</span>cluster<span class="token punctuation">.</span>local <span class="token number">6379</span>
tcp<span class="token operator">-</span>backlog <span class="token number">511</span>
timeout <span class="token number">0</span>
tcp<span class="token operator">-</span>keepalive <span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>其中redis-ms-0.redis-ms.public-service.svc.cluster.local是Redis Master的Headless Service，**在同一命名空间下只需要写**<strong>redis-ms-0.redis-ms即可，后面的public-service.svc.cluster.local可以省略</strong>。</p> <h5 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h5> <p>一般StatefulSet用于有以下一个或者多个需求的应用程序：</p> <p>​	1、需要稳定的独一无二的网络标识符。</p> <p>​	2、 需要持久化数据。</p> <p>​	3、需要有序的、优雅的部署和扩展。</p> <p>4、 需要有序的自动滚动更新。</p> <p>如果应用程序不需要任何稳定的标识符或者有序的部署、删除或者扩展，应该使用无状态的控制器部署应用程序，比如Deployment或者ReplicaSet。</p> <p>StatefulSet是Kubernetes 1.9版本之前的beta资源，在1.5版本之前的任何Kubernetes版本都没有</p> <p>Pod所用的存储必须由PersistentVolume Provisioner（持久化卷配置器）根据请求配置StorageClass，或者由管理员预先配置，当然也可以不配置存储</p> <p>为了确保数据安全，删除和缩放StatefulSet不会删除与StatefulSet关联的卷，可以手动选择性地删除PVC和PV</p> <p>StatefulSet目前使用Headless Service（无头服务）负责Pod的网络身份和通信，需要提前创建此服务</p> <p>删除一个StatefulSet时，不保证对Pod的终止，要在StatefulSet中实现Pod的有序和正常终止，可以在删除之前将StatefulSet的副本缩减为0。</p> <h5 id="创建一个statefulset"><a href="#创建一个statefulset" class="header-anchor">#</a> 创建一个StatefulSet</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># cat nginx-sts.yaml</span>
apiVersion<span class="token punctuation">:</span> v1
kind<span class="token punctuation">:</span> Service
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> nginx
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> nginx
spec<span class="token punctuation">:</span>
  ports<span class="token punctuation">:</span>
  <span class="token operator">-</span> port<span class="token punctuation">:</span> <span class="token number">80</span>
    name<span class="token punctuation">:</span> web
  clusterIP<span class="token punctuation">:</span> <span class="token boolean">None</span>
  selector<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> nginx
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
apiVersion<span class="token punctuation">:</span> apps<span class="token operator">/</span>v1
kind<span class="token punctuation">:</span> StatefulSet
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> web
spec<span class="token punctuation">:</span>
  serviceName<span class="token punctuation">:</span> <span class="token string">&quot;nginx&quot;</span>
  replicas<span class="token punctuation">:</span> <span class="token number">2</span>
  selector<span class="token punctuation">:</span>
    matchLabels<span class="token punctuation">:</span>
      app<span class="token punctuation">:</span> nginx
  template<span class="token punctuation">:</span>
    metadata<span class="token punctuation">:</span>
      labels<span class="token punctuation">:</span>
        app<span class="token punctuation">:</span> nginx
    spec<span class="token punctuation">:</span>
      containers<span class="token punctuation">:</span>
      <span class="token operator">-</span> name<span class="token punctuation">:</span> nginx
        image<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.5</span>
        ports<span class="token punctuation">:</span>
        <span class="token operator">-</span> containerPort<span class="token punctuation">:</span> <span class="token number">80</span>
          name<span class="token punctuation">:</span> web
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl get po</span>
NAME    READY   STATUS    RESTARTS   AGE
web<span class="token operator">-</span><span class="token number">0</span>   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          56s
web<span class="token operator">-</span><span class="token number">1</span>   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          55s
<span class="token comment"># 查看server，没有cluster-ip的就是无头服务</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl get svc</span>
NAME         TYPE        CLUSTER<span class="token operator">-</span>IP   EXTERNAL<span class="token operator">-</span>IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>   AGE
kubernetes   ClusterIP   <span class="token number">10.96</span><span class="token number">.0</span><span class="token number">.1</span>    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span><span class="token operator">/</span>TCP   5d16h
nginx        ClusterIP   <span class="token boolean">None</span>         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span><span class="token operator">/</span>TCP    66s
<span class="token comment"># 扩容sts</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl  scale --replicas=3 sts web</span>
statefulset<span class="token punctuation">.</span>apps<span class="token operator">/</span>web scaled
<span class="token comment"># 标识符是固定住而且唯一的</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl  get po</span>
NAME    READY   STATUS    RESTARTS   AGE
web<span class="token operator">-</span><span class="token number">0</span>   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          3m57s
web<span class="token operator">-</span><span class="token number">1</span>   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          3m56s
web<span class="token operator">-</span><span class="token number">2</span>   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          12s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h5 id="验证服务之间是否通的"><a href="#验证服务之间是否通的" class="header-anchor">#</a> 验证服务之间是否通的</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># cat&lt;&lt;EOF | kubectl apply -f -</span>
apiVersion<span class="token punctuation">:</span> v1
kind<span class="token punctuation">:</span> Pod
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> busybox1
  namespace<span class="token punctuation">:</span> default
spec<span class="token punctuation">:</span>
  containers<span class="token punctuation">:</span>
  <span class="token operator">-</span> name<span class="token punctuation">:</span> busybox
    image<span class="token punctuation">:</span> busybox<span class="token punctuation">:</span><span class="token number">1.28</span>
    command<span class="token punctuation">:</span>
      <span class="token operator">-</span> sleep
      <span class="token operator">-</span> <span class="token string">&quot;3600&quot;</span>
    imagePullPolicy<span class="token punctuation">:</span> IfNotPresent
  restartPolicy<span class="token punctuation">:</span> Always
EOF
<span class="token comment"># 获取pod的id</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl  get po -owide</span>
NAME       READY   STATUS             RESTARTS   AGE     IP               NODE        NOMINATED NODE   READINESS GATES
busybox1   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running            <span class="token number">0</span>          72s     <span class="token number">172.175</span><span class="token number">.156</span><span class="token number">.93</span>   k8s<span class="token operator">-</span>node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
web<span class="token operator">-</span><span class="token number">0</span>      <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running            <span class="token number">0</span>          22m     <span class="token number">172.175</span><span class="token number">.156</span><span class="token number">.91</span>   k8s<span class="token operator">-</span>node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
web<span class="token operator">-</span><span class="token number">1</span>      <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running            <span class="token number">0</span>          22m     <span class="token number">172.173</span><span class="token number">.131</span><span class="token number">.17</span>   k8s<span class="token operator">-</span>node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
web<span class="token operator">-</span><span class="token number">2</span>      <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running            <span class="token number">0</span>          18m     <span class="token number">172.175</span><span class="token number">.156</span><span class="token number">.92</span>   k8s<span class="token operator">-</span>node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="token comment"># 测试互通</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl exec -ti busybox1 -- sh</span>
<span class="token operator">/</span> <span class="token comment"># ping web-0.nginx</span>
PING web<span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">.</span>nginx <span class="token punctuation">(</span><span class="token number">172.175</span><span class="token number">.156</span><span class="token number">.91</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token number">56</span> data <span class="token builtin">bytes</span>
<span class="token number">64</span> <span class="token builtin">bytes</span> <span class="token keyword">from</span> <span class="token number">172.175</span><span class="token number">.156</span><span class="token number">.91</span><span class="token punctuation">:</span> seq<span class="token operator">=</span><span class="token number">0</span> ttl<span class="token operator">=</span><span class="token number">63</span> time<span class="token operator">=</span><span class="token number">0.064</span> ms
<span class="token number">64</span> <span class="token builtin">bytes</span> <span class="token keyword">from</span> <span class="token number">172.175</span><span class="token number">.156</span><span class="token number">.91</span><span class="token punctuation">:</span> seq<span class="token operator">=</span><span class="token number">1</span> ttl<span class="token operator">=</span><span class="token number">63</span> time<span class="token operator">=</span><span class="token number">0.067</span> ms
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h5 id="sts扩容"><a href="#sts扩容" class="header-anchor">#</a> sts扩容</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl  scale --replicas=5 sts web</span>
statefulset<span class="token punctuation">.</span>apps<span class="token operator">/</span>web scaled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="statefulset更新策略"><a href="#statefulset更新策略" class="header-anchor">#</a> StatefulSet更新策略</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl  get sts -oyaml</span>
apiVersion<span class="token punctuation">:</span> v1
items<span class="token punctuation">:</span>
<span class="token operator">-</span> apiVersion<span class="token punctuation">:</span> apps<span class="token operator">/</span>v1
  kind<span class="token punctuation">:</span> StatefulSet
  metadata<span class="token punctuation">:</span>
    creationTimestamp<span class="token punctuation">:</span> <span class="token string">&quot;2022-01-17T06:58:23Z&quot;</span>
    generation<span class="token punctuation">:</span> <span class="token number">3</span>
    name<span class="token punctuation">:</span> web
    namespace<span class="token punctuation">:</span> default
  spec<span class="token punctuation">:</span>
    podManagementPolicy<span class="token punctuation">:</span> OrderedReady
    replicas<span class="token punctuation">:</span> <span class="token number">5</span>
    revisionHistoryLimit<span class="token punctuation">:</span> <span class="token number">10</span>
    selector<span class="token punctuation">:</span>
      matchLabels<span class="token punctuation">:</span>
        app<span class="token punctuation">:</span> nginx
    serviceName<span class="token punctuation">:</span> nginx
    template<span class="token punctuation">:</span>
      metadata<span class="token punctuation">:</span>
        creationTimestamp<span class="token punctuation">:</span> null
        labels<span class="token punctuation">:</span>
          app<span class="token punctuation">:</span> nginx
      spec<span class="token punctuation">:</span>
        containers<span class="token punctuation">:</span>
        <span class="token operator">-</span> image<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.5</span>
          imagePullPolicy<span class="token punctuation">:</span> IfNotPresent
          name<span class="token punctuation">:</span> nginx
          ports<span class="token punctuation">:</span>
          <span class="token operator">-</span> containerPort<span class="token punctuation">:</span> <span class="token number">80</span>
            name<span class="token punctuation">:</span> web
            protocol<span class="token punctuation">:</span> TCP
          resources<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
          terminationMessagePath<span class="token punctuation">:</span> <span class="token operator">/</span>dev<span class="token operator">/</span>termination<span class="token operator">-</span>log
          terminationMessagePolicy<span class="token punctuation">:</span> File
        dnsPolicy<span class="token punctuation">:</span> ClusterFirst
        restartPolicy<span class="token punctuation">:</span> Always
        schedulerName<span class="token punctuation">:</span> default<span class="token operator">-</span>scheduler
        securityContext<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        terminationGracePeriodSeconds<span class="token punctuation">:</span> <span class="token number">30</span>
    updateStrategy<span class="token punctuation">:</span>
      rollingUpdate<span class="token punctuation">:</span>
        partition<span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token builtin">type</span><span class="token punctuation">:</span> RollingUpdate
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>OnDelete:手动更新(需要手动删除一个pod才会触发更新策略)</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl edit sts web</span>
 spec<span class="token punctuation">:</span>
      containers<span class="token punctuation">:</span>
      <span class="token operator">-</span> image<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.3</span>
        imagePullPolicy<span class="token punctuation">:</span> IfNotPresent
        name<span class="token punctuation">:</span> nginx
        ports<span class="token punctuation">:</span>
        <span class="token operator">-</span> containerPort<span class="token punctuation">:</span> <span class="token number">80</span>
          name<span class="token punctuation">:</span> web
          protocol<span class="token punctuation">:</span> TCP
  updateStrategy<span class="token punctuation">:</span>
     <span class="token builtin">type</span><span class="token punctuation">:</span> OnDelete
<span class="token comment"># 删除掉一个pod更新后与其他pod做对比</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl delete po  web-0</span>
pod <span class="token string">&quot;web-0&quot;</span> deleted
<span class="token comment"># 更新 后做对比</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/image6.png" alt="img"></p> <p>RollingUpdate:默认更新策略,滚动更新</p> <h5 id="灰度发布"><a href="#灰度发布" class="header-anchor">#</a> 灰度发布</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code>  <span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl edit sts web</span>
  updateStrategy<span class="token punctuation">:</span>
    rollingUpdate<span class="token punctuation">:</span>
      partition<span class="token punctuation">:</span> <span class="token number">3</span>     <span class="token comment">#pod标识符小于3 的不更新</span>
    <span class="token builtin">type</span><span class="token punctuation">:</span> RollingUpdate
<span class="token comment"># 开始更新</span>
  <span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl edit sts web</span>
    spec<span class="token punctuation">:</span>
      containers<span class="token punctuation">:</span>
      <span class="token operator">-</span> image<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.5</span>
        imagePullPolicy<span class="token punctuation">:</span> IfNotPresent
        name<span class="token punctuation">:</span> nginx
        ports<span class="token punctuation">:</span>
        <span class="token operator">-</span> containerPort<span class="token punctuation">:</span> <span class="token number">80</span>
          name<span class="token punctuation">:</span> web
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h5 id="级联删除和非级联删除"><a href="#级联删除和非级联删除" class="header-anchor">#</a> 级联删除和非级联删除</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 级联删除</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl delete sts web</span>
statefulset<span class="token punctuation">.</span>apps <span class="token string">&quot;web&quot;</span> deleted
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl  get po</span>
NAME       READY   STATUS        RESTARTS   AGE
busybox1   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">29</span>         29h
web<span class="token operator">-</span><span class="token number">0</span>      <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>     Terminating   <span class="token number">0</span>          23m
web<span class="token operator">-</span><span class="token number">1</span>      <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>     Terminating   <span class="token number">0</span>          7h54m
web<span class="token operator">-</span><span class="token number">2</span>      <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>     Terminating   <span class="token number">0</span>          10m
web<span class="token operator">-</span><span class="token number">3</span>      <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>     Terminating   <span class="token number">0</span>          6m15s
web<span class="token operator">-</span><span class="token number">4</span>      <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>     Terminating   <span class="token number">0</span>          6m23s
<span class="token comment"># 非级联删除</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl delete sts web --cascade=orphan</span>
statefulset<span class="token punctuation">.</span>apps <span class="token string">&quot;web&quot;</span> deleted
<span class="token comment"># 删除sts后,Pod变成了孤儿pod,此时删除Pod不会被重建</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl  get po</span>
NAME       READY   STATUS    RESTARTS   AGE
busybox1   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">29</span>         29h
web<span class="token operator">-</span><span class="token number">0</span>      <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          3m46s
web<span class="token operator">-</span><span class="token number">1</span>      <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          3m45s
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl delete po web-0 web-1 </span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get po</span>
No resources found <span class="token keyword">in</span> default namespace<span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="守护进程服务daemonset"><a href="#守护进程服务daemonset" class="header-anchor">#</a> 守护进程服务DaemonSet</h4> <h5 id="简介-2"><a href="#简介-2" class="header-anchor">#</a> 简介</h5> <p>DaemonSet:守护进程缩写为ds,在所有节点或者匹配的节点上都部署一个Pod</p> <p>使用DaemonSet的场景</p> <p>1、运行集群存储的daemon，比如ceph或者glusterd</p> <p>2、节点的CNI网络插件，calico</p> <p>3、节点日志的收集：fluentd或者是filebeat</p> <p>4、节点的监控：node exporter</p> <p>5、服务暴露：部署一个ingress nginx</p> <h5 id="创建daemonset"><a href="#创建daemonset" class="header-anchor">#</a> 创建DaemonSet</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># cat nginx-ds.yaml</span>
apiVersion<span class="token punctuation">:</span> apps<span class="token operator">/</span>v1
kind<span class="token punctuation">:</span> DaemonSet
metadata<span class="token punctuation">:</span>
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> nginx
  name<span class="token punctuation">:</span> nginx
spec<span class="token punctuation">:</span>
  revisionHistoryLimit<span class="token punctuation">:</span> <span class="token number">10</span>
  selector<span class="token punctuation">:</span>
    matchLabels<span class="token punctuation">:</span>
      app<span class="token punctuation">:</span> nginx
  template<span class="token punctuation">:</span>
    metadata<span class="token punctuation">:</span>
      creationTimestamp<span class="token punctuation">:</span> null
      labels<span class="token punctuation">:</span>
        app<span class="token punctuation">:</span> nginx   
    spec<span class="token punctuation">:</span>
      containers<span class="token punctuation">:</span>
      <span class="token operator">-</span> image<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.2</span>
        imagePullPolicy<span class="token punctuation">:</span> IfNotPresent
        name<span class="token punctuation">:</span> nginx
        resources<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        terminationMessagePath<span class="token punctuation">:</span> <span class="token operator">/</span>dev<span class="token operator">/</span>termination<span class="token operator">-</span>log
        terminationMessagePolicy<span class="token punctuation">:</span> File
      dnsPolicy<span class="token punctuation">:</span> ClusterFirst
      restartPolicy<span class="token punctuation">:</span> Always
      schedulerName<span class="token punctuation">:</span> default<span class="token operator">-</span>scheduler
      securityContext<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      terminationGracePeriodSeconds<span class="token punctuation">:</span> <span class="token number">30</span>
<span class="token comment"># 创建一个ds</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl create -f nginx-ds.yaml</span>
<span class="token comment"># 查看是否创建成功</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 work1<span class="token punctuation">]</span><span class="token comment"># kubectl get po -owide</span>
NAME          READY   STATUS    RESTARTS   AGE     IP               NODE           NOMINATED NODE   READINESS GATES
nginx<span class="token operator">-</span>56sds   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          2m59s   <span class="token number">172.25</span><span class="token number">.92</span><span class="token number">.66</span>     k8s<span class="token operator">-</span>master2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nginx<span class="token operator">-</span>dh7x9   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          2m59s   <span class="token number">172.17</span><span class="token number">.148</span><span class="token number">.212</span>   k8s<span class="token operator">-</span>node2     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nginx<span class="token operator">-</span>f8t9l   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          2m59s   <span class="token number">172.28</span><span class="token number">.82</span><span class="token number">.198</span>    k8s<span class="token operator">-</span>master1     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nginx<span class="token operator">-</span>kp2td   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          2m59s   <span class="token number">172.22</span><span class="token number">.246</span><span class="token number">.144</span>   k8s<span class="token operator">-</span>node1     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nginx<span class="token operator">-</span>sph5l   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          2m59s   <span class="token number">172.25</span><span class="token number">.244</span><span class="token number">.197</span>   k8s<span class="token operator">-</span>master3   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="token comment"># 打标签</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl label node  k8s-node2  ds=true</span>
<span class="token comment"># 查看标签是否打成功</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl  get node --show-labels</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/image7.png" alt="img"></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 更新yaml文件</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># cat nginx-ds.yaml</span>
apiVersion<span class="token punctuation">:</span> apps<span class="token operator">/</span>v1
kind<span class="token punctuation">:</span> DaemonSet
metadata<span class="token punctuation">:</span>
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> nginx
  name<span class="token punctuation">:</span> nginx
spec<span class="token punctuation">:</span>
  revisionHistoryLimit<span class="token punctuation">:</span> <span class="token number">10</span>
  selector<span class="token punctuation">:</span>
    matchLabels<span class="token punctuation">:</span>
      app<span class="token punctuation">:</span> nginx
  template<span class="token punctuation">:</span>
    metadata<span class="token punctuation">:</span>
      creationTimestamp<span class="token punctuation">:</span> null
      labels<span class="token punctuation">:</span>
        app<span class="token punctuation">:</span> nginx
    spec<span class="token punctuation">:</span>
      nodeSelector<span class="token punctuation">:</span>
        ds<span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>   <span class="token comment">#标签</span>
      containers<span class="token punctuation">:</span>
      <span class="token operator">-</span> image<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.2</span>
        imagePullPolicy<span class="token punctuation">:</span> IfNotPresent
        name<span class="token punctuation">:</span> nginx
        resources<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        terminationMessagePath<span class="token punctuation">:</span> <span class="token operator">/</span>dev<span class="token operator">/</span>termination<span class="token operator">-</span>log
        terminationMessagePolicy<span class="token punctuation">:</span> File
      dnsPolicy<span class="token punctuation">:</span> ClusterFirst
      restartPolicy<span class="token punctuation">:</span> Always
      schedulerName<span class="token punctuation">:</span> default<span class="token operator">-</span>scheduler
      securityContext<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      terminationGracePeriodSeconds<span class="token punctuation">:</span> <span class="token number">30</span>
<span class="token comment"># 重新加载一下</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl replace -f nginx-ds.yaml</span>
<span class="token comment"># 查看创建情况   </span>
<span class="token comment"># 不符合标签要求的机器就不会创建pod了</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl  get po -owide</span>
NAME          READY   STATUS    RESTARTS   AGE   IP               NODE        NOMINATED NODE   READINESS GATES
nginx<span class="token operator">-</span>b7tjg   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          13s   <span class="token number">172.173</span><span class="token number">.131</span><span class="token number">.33</span>   k8s<span class="token operator">-</span>node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h5 id="daemonset更新和回滚"><a href="#daemonset更新和回滚" class="header-anchor">#</a> DaemonSet更新和回滚</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code> <span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl edit ds</span>
 updateStrategy<span class="token punctuation">:</span>
    <span class="token builtin">type</span><span class="token punctuation">:</span> OnDelete  <span class="token comment">#更新方式OnDelete,更新单个pod容器的镜像，如果镜像有问题就影响到更新的那个，不会影响到其他节点</span>
<span class="token comment"># 更新</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl set image ds nginx nginx=nginx:1.15.4 --record</span>
<span class="token comment"># 查看更新记录</span>
<span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl rollout history ds nginx</span>
daemonset<span class="token punctuation">.</span>apps<span class="token operator">/</span>nginx
REVISION  CHANGE<span class="token operator">-</span>CAUSE
<span class="token number">1</span>         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="token number">2</span>         kubectl <span class="token builtin">set</span> image ds nginx nginx<span class="token operator">=</span>nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.4</span> <span class="token operator">-</span><span class="token operator">-</span>record<span class="token operator">=</span>true
<span class="token number">3</span>         kubectl <span class="token builtin">set</span> image ds nginx nginx<span class="token operator">=</span>nginx<span class="token punctuation">:</span><span class="token number">1.15</span><span class="token number">.3</span> <span class="token operator">-</span><span class="token operator">-</span>record<span class="token operator">=</span>true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="label-selector"><a href="#label-selector" class="header-anchor">#</a> Label&amp;Selector</h4> <h5 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h5> <p>Label：对k8s中各种资源进行分类、分组，添加一个具有特别属性的一个标签。</p> <p>Selector：通过一个过滤的语法进行查找到对应标签的资源</p> <h5 id="实践"><a href="#实践" class="header-anchor">#</a> 实践</h5> <p>打标签</p> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 ~]# kubectl label  node k8s-node2 region=subent7
node/k8s-node2 labeled
# 过滤出来打标签的机器
[root@k8s-master1 ~]# kubectl get node -l region=subent7
NAME        STATUS   ROLES    AGE   VERSION
k8s-node2   Ready    &lt;none&gt;   29d   v1.20.14
[root@k8s-master1 test]# kubectl get po --show-labels
NAME       READY   STATUS    RESTARTS   AGE     LABELS
busybox1   1/1     Running   0          7m44s   &lt;none&gt;
# 打标签
[root@k8s-master1 test]# kubectl label po busybox1 app=busybox1
pod/busybox1 labeled
# 查看标签是否打成功
[root@k8s-master1 test]# kubectl get po -A -l app=busybox1
NAMESPACE   NAME       READY   STATUS    RESTARTS   AGE
default     busybox1   1/1     Running   0          9m2s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h5 id="删除标签"><a href="#删除标签" class="header-anchor">#</a> 删除标签</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 test]# kubectl label po busybox1 app-
pod/busybox1 labeled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="修改标签"><a href="#修改标签" class="header-anchor">#</a> 修改标签</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 test]# kubectl  get po --show-labels
NAME       READY   STATUS    RESTARTS   AGE   LABELS
busybox1   1/1     Running   0          14m   app=busybox1
# 开始修改标签
[root@k8s-master1 test]# kubectl label po busybox1 app=busybox2 --overwrite
pod/busybox1 labeled
# 查看是否修改成功
[root@k8s-master1 test]# kubectl  get po --show-labels
NAME       READY   STATUS    RESTARTS   AGE   LABELS
busybox1   1/1     Running   0          17m   app=busybox2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="什么是hpa"><a href="#什么是hpa" class="header-anchor">#</a> 什么是HPA</h4> <h5 id="简介-3"><a href="#简介-3" class="header-anchor">#</a> 简介</h5> <p>HPA（Horizontal Pod Autoscaler，水平Pod自动伸缩器）可根据观察到的CPU、内存使用率或自定义度量标准来自动扩展或缩容Pod的数量。HPA不适用于无法缩放的对象，比如DaemonSet。</p> <p>HPA控制器会定期调整RC或Deployment的副本数，以使观察到的平均CPU利用率与用户指定的目标相匹配</p> <h5 id="hpa实践"><a href="#hpa实践" class="header-anchor">#</a> HPA实践</h5> <p>在生产环境中，总会有一些意想不到的事情发生，比如公司网站流量突然升高，此时之前创建的Pod已不足以撑住所有的访问，而运维人员也不可能24小时守着业务服务，这时就可以通过配置HPA，实现负载过高的情况下自动扩容Pod副本数以分摊高并发的流量，当流量恢复正常后，HPA会自动缩减Pod的数量</p> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code># 创建HPA并导出来yaml文件
[root@k8s-master1 test]# kubectl create  deployment hpa-nginx --image=nginx --dry-run=client -oyaml &gt; hpa-nginx.yaml
# 修改配置文件
[root@k8s-master1 test]# cat hpa-nginx.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  labels:
    app: hpa-nginx
  name: hpa-nginx
spec:
  replicas: 1
  selector:
    matchLabels:
      app: hpa-nginx
  strategy: {}
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: hpa-nginx
    spec:
      containers:
      - image: nginx
        name: nginx
        resources:
          requests:
            cpu: 10m
# 查看是否创建成功
[root@k8s-master1 test]# kubectl  get po
NAME                         READY   STATUS    RESTARTS   AGE
busybox1                     1/1     Running   0          57m
hpa-nginx-5fbf7b76c5-hczhd   1/1     Running   0          67s
# 查看deployment
[root@k8s-master1 test]# kubectl get deployment
NAME        READY   UP-TO-DATE   AVAILABLE   AGE
hpa-nginx   1/1     1            1           5m14s
# 临时开启nginx-server的端口，实际使用时需要定义service
[root@k8s-master1 test]# kubectl  expose deployment hpa-nginx --port=80
service/hpa-nginx exposed
# 看看cpu指标
[root@k8s-master1 test]# kubectl  top po
NAME                         CPU(cores)   MEMORY(bytes)
busybox1                     0m           1Mi
hpa-nginx-5fbf7b76c5-hczhd   0m           5Mi
# 设定hpa的cpu和内存指标 
[root@k8s-master1 test]# kubectl autoscale deployment hpa-nginx --cpu-percent=10 --min=1 --max=10
此HPA将根据CPU的使用率自动增加和减少副本数量，上述设置的是CPU使用率超过10%（--cpu-percent参数指定）即会增加Pod的数量，以保持所有Pod的平均CPU利用率为10%，允许最大的Pod数量为10（--max），最少的Pod数为1（--min）。

# 查看当前HPA状态，因为未对其发送任何请求，所以当前CPU使用率为0%：
[root@k8s-master1 test]# kubectl  get hpa
NAME        REFERENCE              TARGETS   MINPODS   MAXPODS   REPLICAS   AGE
hpa-nginx   Deployment/hpa-nginx   0%/10%    1         10        1          5m16s
# 查看svc地址
[root@k8s-master1 test]# kubectl  get svc
NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE
hpa-nginx    ClusterIP   10.101.102.29   &lt;none&gt;        80/TCP    23m
# 模拟压测
[root@k8s-master1 ~]# while true; do wget -q -O- http://10.101.102.29 &gt; /dev/null; done
# 查看结果
[root@k8s-master1 test]# kubectl  get hpa
NAME        REFERENCE              TARGETS   MINPODS   MAXPODS   REPLICAS   AGE
hpa-nginx   Deployment/hpa-nginx   78%/10%   1         10        10         15m
# 查看cpu情况
# 压测的过程中慢慢会扩容,后面会自动删除剩下来一个
[root@k8s-master1 test]# kubectl  top po
NAME                         CPU(cores)   MEMORY(bytes)
busybox1                     0m           1Mi
hpa-nginx-5fbf7b76c5-752sd   0m           5Mi
hpa-nginx-5fbf7b76c5-9qch2   0m           5Mi
hpa-nginx-5fbf7b76c5-cbfvc   0m           5Mi
hpa-nginx-5fbf7b76c5-cfr59   0m           5Mi
hpa-nginx-5fbf7b76c5-hczhd   0m           6Mi
hpa-nginx-5fbf7b76c5-jctnl   0m           6Mi
hpa-nginx-5fbf7b76c5-qxxgd   0m           5Mi
hpa-nginx-5fbf7b76c5-rb88r   0m           5Mi
hpa-nginx-5fbf7b76c5-rtcl4   0m           5Mi
hpa-nginx-5fbf7b76c5-sg8jw   0m           5Mi
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br></div></div><h4 id="什么是service"><a href="#什么是service" class="header-anchor">#</a> 什么是service</h4> <p>Service可以简单的理解为逻辑上的一组Pod,一种可以访问Pod的策略,而且其他pod可以通过这个Service访问到这个Service代理的Pod,相对于Pod而言，它会有一个固定的名称,一旦创建就固定不变</p> <h5 id="自定义一个service"><a href="#自定义一个service" class="header-anchor">#</a> 自定义一个service</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code># 查看容器的标签
[root@k8s-master1 test]# kubectl  get po --show-labels
NAME                     READY   STATUS    RESTARTS   AGE     LABELS
busybox1                 1/1     Running   3          3h19m   app=busybox2
nginx-66bbc9fdc5-6f6x9   1/1     Running   0          49s     app=nginx,pod-template-hash=66bbc9fdc5
nginx-66bbc9fdc5-7fz4v   1/1     Running   0          49s     app=nginx,pod-template-hash=66bbc9fdc5
[root@k8s-master1 test]# cat nginx-svc.yaml
apiVersion: v1
kind: Service
metadata:
  labels:
    app: nginx-svc
  name: nginx-svc
spec:
  ports:
  - name: http    #Service端口的名称
    port: 80     #Service自已的端口
    protocol: TCP  # UDP TCP SCTP  default:TCP
    targetPort: 80  # 后端应用的端口
  - name: https
    port: 443
    protocol: TCP
    targetPort: 443
  selector:
    app: nginx       # 容器的标签
  sessionAffinity: None
  type: ClusterIP
# 创建service 
[root@k8s-master1 test]# kubectl  create -f nginx-svc.yaml
service/nginx-svc created
# 查看service创建情况
[root@k8s-master1 test]# kubectl get svc
NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
hpa-nginx    ClusterIP   10.101.102.29   &lt;none&gt;        80/TCP           120m
kubernetes   ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP          29d
nginx-svc    ClusterIP   10.97.98.26    &lt;none&gt;        80/TCP,443/TCP   62s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h5 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 test]# curl 10.97.98.26
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
&lt;p&gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&lt;/p&gt;

&lt;p&gt;For online documentation and support please refer to
&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
Commercial support is available at
&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h5 id="使用service代理k8s外部服务"><a href="#使用service代理k8s外部服务" class="header-anchor">#</a> 使用Service代理k8s外部服务</h5> <p>1、希望在生产环境中使用某个固定的名称而非IP地址进行访问外部的中间件服务</p> <p>2、希望Service指向另一个Namespace中或其他集群中的服务</p> <p>3、某个项目正在迁移至k8s集群，但是一部分服务仍然在集群外部，此时可以使用service代理至k8s集群外部的服务</p> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 test]# cat nginx-svc.yaml
apiVersion: v1
kind: Service
metadata:
  labels:
    app: nginx-svc-esxternal
  name: nginx-svc-esxternal
spec:
  ports:
  - name: http    #Service端口的名称
    port: 80     #Service自已的端口
    protocol: TCP  # UDP TCP SCTP  default:TCP
    targetPort: 80  # 后端应用的端口
  sessionAffinity: None
  type: ClusterIP
#  创建svc 
[root@k8s-master1 test]# kubectl  create -f nginx-svc.yaml
service/nginx-svc-esxternal created
# 创建是否创建成功
[root@k8s-master1 test]# kubectl get svc
NAME                  TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE
nginx-svc-esxternal   ClusterIP   10.108.120.251   &lt;none&gt;        80/TCP    66s
# 创建ep 
# k8s访问集群外独立的服务最好的方式是采用Endpoint方式
[root@k8s-master1 test]# cat nginx-ep-external.yaml
apiVersion: v1
kind: Endpoints
metadata:
  labels:
    app: nginx-svc-esxternal     #ep要和service的名称一致 
  name:  nginx-svc-esxternal 
  namespace: default
subsets:
- addresses:
  - ip: 140.205.94.189  #代理外部web服务的ip
  ports:
  - name: http
    port: 80
    protocol: TCP
# 开始创建 
[root@k8s-master1 test]# kubectl  create -f nginx-ep-external.yaml
# 查看是否创建成功
[root@k8s-master1 test]# kubectl  get ep
NAME                 ENDPOINTS                         AGE
nginx-svc-external   140.205.94.189:80                  112s
# 查看svc地址
[root@k8s-master1 test]# kubectl  get svc
NAME                  TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE
nginx-svc-esxternal   ClusterIP   10.108.120.251   &lt;none&gt;        80/TCP    13m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><h5 id="反代外部域名"><a href="#反代外部域名" class="header-anchor">#</a> 反代外部域名</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 test]# cat nginx-externalName.yaml
apiVersion: v1
kind: Service
metadata:
  labels:
    app: nginx-externalname
  name: nginx-externalname
spec:
  type: ExternalName
  externalName: www.baidu.com
# 创建 
[root@k8s-master1 test]# kubectl  create -f nginx-externalName.yaml
service/nginx-externalname created
# 查看是否创建成功
[root@k8s-master1 test]# kubectl  get svc
NAME                 TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)   AGE
nginx-externalname   ExternalName   &lt;none&gt;          www.baidu.com   &lt;none&gt;    104s
# 测试
[root@k8s-master1 test]# kubectl  exec -ti busybox1 -- sh
/ # nslookup nginx-externalname
Server:    10.96.0.10
Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local

Name:      nginx-externalname
Address 1: 103.235.46.39
/ # wget 103.235.46.39
Connecting to 103.235.46.39 (103.235.46.39:80)
index.html           100% |**********************************************************************************************************************************************|  2381   0:00:00 ETA
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h5 id="service常用类型"><a href="#service常用类型" class="header-anchor">#</a> service常用类型</h5> <p>1、ClusterIP:在集群内部使用,也是默认值</p> <p>2、ExternalName:通过返回定义的CNAME别名</p> <p>3、NodePort:在所有安装了kube-proxy的节点上打开了一个端口,此端口可以代理至后端Pod,然后集群外部 可以使用节点的IP地址和NodePort的端口号访问到集群Pod的服务，NodePort端口范围默认是30000-32767</p> <p>4、LoadBalancer:使用云提供商的负载均衡器公开服务</p> <h4 id="什么是ingress"><a href="#什么是ingress" class="header-anchor">#</a> 什么是ingress</h4> <p>通俗来讲，ingress和之前提到的Service、Deployment，也是一个k8s的资源类型，ingress用于实现用域名的方式访问k8s内部应用</p> <h5 id="安装ingress"><a href="#安装ingress" class="header-anchor">#</a> 安装ingress</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code># 官网地址:https://helm.sh/docs/intro/install/
[root@k8s-master1 ~]# tar xf helm-v3.8.0-linux-amd64.tar.gz
[root@k8s-master1 ~]# tar xf helm-v3.8.0-linux-amd64.tar.gz
[root@k8s-master1 ~]# mv  linux-amd64/helm  /usr/local/bin/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="查看是否安装完成"><a href="#查看是否安装完成" class="header-anchor">#</a> 查看是否安装完成</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 ~]# helm version
version.BuildInfo{Version:&quot;v3.8.0&quot;, GitCommit:&quot;d14138609b01886f544b2025f5000351c9eb092e&quot;, GitTreeState:&quot;clean&quot;, GoVersion:&quot;go1.17.5&quot;}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="添加helm仓库"><a href="#添加helm仓库" class="header-anchor">#</a> 添加helm仓库</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 ~]# helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
# 执行结果
&quot;ingress-nginx&quot; has been added to your repositories
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="查看是否添加成功"><a href="#查看是否添加成功" class="header-anchor">#</a> 查看是否添加成功</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 ~]# helm repo list
NAME            URL
ingress-nginx   https://kubernetes.github.io/ingress-nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="搜索软件版本"><a href="#搜索软件版本" class="header-anchor">#</a> 搜索软件版本</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 ~]# helm search repo ingress-nginx
NAME                            CHART VERSION   APP VERSION     DESCRIPTION
ingress-nginx/ingress-nginx     4.0.17          1.1.1           Ingress controller for Kubernetes using NGINX a...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="下载源码包"><a href="#下载源码包" class="header-anchor">#</a> 下载源码包</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 ~]# helm pull ingress-nginx/ingress-nginx --version 3.6.0
[root@k8s-master1 ~]# mv ingress-nginx-3.6.0.tgz  test/
[root@k8s-master1 ~]# cd test/
[root@k8s-master1 test]# tar xf ingress-nginx-3.6.0.tgz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="修改配置文件"><a href="#修改配置文件" class="header-anchor">#</a> 修改配置文件</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 test]# cd ingress-nginx
[root@k8s-master1 ingress-nginx]# cp values.yaml{,.bak}
[root@k8s-master1 ingress-nginx]# vim values.yaml
# 修改controller镜像地址
registry: registry.cn-beijing.aliyuncs.com/dotbalo/controller
# 禁掉哈希值
 #digest: sha256:e9fb216ace49dfa4a5983b183067e97496e7a8b307d2093f4278cd550c303899
# 使用hostNetwork,即使用宿主机上的端口80 443
 hostNetwork: true
 dnsPolicy: ClusterFirstWithHostNet
# 使用DaemonSet,将ingress部署在指定节点上
  kind: DaemonSet
# 节点选择，将需要部署的节点打上ingress=true的label
 nodeSelector:
    kubernetes.io/os: linux
    ingress: &quot;true&quot;
# 修改type,改为ClusterIP。如果在云环境，有loadbanace可以使用loadbanace
   targetPorts:
      http: http
      https: https
    type: ClusterIP
# 修改kube-webhook-certgen镜像地址    
 patch:
      enabled: true
      image:
        registry: registry.cn-beijing.aliyuncs.com/dotbalo/kube-webhook-certgen
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h5 id="开始执行安装"><a href="#开始执行安装" class="header-anchor">#</a> 开始执行安装</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>#选择节点打标签
[root@k8s-master1 ingress-nginx]# kubectl label node k8s-master2 ingress=true
node/k8s-master2 labeled
# 创建一个ingress的namespace
[root@k8s-master1 ingress-nginx]# kubectl create ns ingress-nginx
namespace/ingress-nginx created
# 查看是否创建成功
[root@k8s-master1 ingress-nginx]# kubectl  get ns
NAME                   STATUS   AGE
ingress-nginx          Active   27s
# 开始安装
[root@k8s-master1 ingress-nginx]# helm install ingress-nginx -n ingress-nginx .
# 安装过程
NAME: ingress-nginx
LAST DEPLOYED: Fri Feb 11 09:58:40 2022
NAMESPACE: ingress-nginx
STATUS: deployed
REVISION: 1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h5 id="查看是否安装完成-2"><a href="#查看是否安装完成-2" class="header-anchor">#</a> 查看是否安装完成</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 ingress-nginx]# kubectl  get po -n ingress-nginx
NAME                             READY   STATUS    RESTARTS   AGE
ingress-nginx-controller-4n6nh   1/1     Running   0          41s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="扩充节点"><a href="#扩充节点" class="header-anchor">#</a> 扩充节点</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code># 打标签
[root@k8s-master1 ingress-nginx]# kubectl label node k8s-node1 ingress=true
node/k8s-node1 labeled
# 查看是否扩充成功
[root@k8s-master1 ingress-nginx]# kubectl get po -n ingress-nginx -owide
NAME                             READY   STATUS    RESTARTS   AGE   IP           NODE        NOMINATED NODE   READINESS GATES
ingress-nginx-controller-4n6nh   1/1     Running   0          33m   10.2.32.13   k8s-node2   &lt;none&gt;           &lt;none&gt;
ingress-nginx-controller-qdklt   1/1     Running   0          86s   10.2.32.12   k8s-node1   &lt;none&gt;           &lt;none&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="缩容"><a href="#缩容" class="header-anchor">#</a> 缩容</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 ingress-nginx]# kubectl  label node k8s-node1 ingress-
node/k8s-node1 labeled
[root@k8s-master1 ingress-nginx]# kubectl  get po -n ingress-nginx -owide
NAME                             READY   STATUS    RESTARTS   AGE   IP           NODE        NOMINATED NODE   READINESS GATES
ingress-nginx-controller-4n6nh   1/1     Running   0          37m   10.2.32.13   k8s-node2   &lt;none&gt;           &lt;none&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="ingress简单使用"><a href="#ingress简单使用" class="header-anchor">#</a> ingress简单使用</h4> <h5 id="创建一个ingress"><a href="#创建一个ingress" class="header-anchor">#</a> 创建一个ingress</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 test]# cat ingress.yaml
apiVersion: networking.k8s.io/v1beta1 # networking.k8s.io/v1 / extensions/v1beta1
kind: Ingress
metadata:
  annotations:
    kubernetes.io/ingress.class: &quot;nginx&quot;  #跟helm配置文件里面的配置一致ingressClass: nginx
  name: example
spec:
  rules: # 一个Ingress可以配置多个rules
  - host: foo.bar.com # 域名配置，可以不写，匹配*， *.bar.com
    http:
      paths: # 相当于nginx的location配合，同一个host可以配置多个path / /abc
      - backend:
          serviceName: nginx-svc   #代理到哪个service上
          servicePort: 80  #service的端口号
        path: /
[root@k8s-master1 test]# kubectl  create -f ingress.yaml
# 查看是否创建成功
[root@k8s-master1 test]# kubectl  get ingress
NAME      CLASS    HOSTS         ADDRESS        PORTS   AGE
example   &lt;none&gt;   foo.bar.com   10.99.35.109   80      51s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h5 id="测试-2"><a href="#测试-2" class="header-anchor">#</a> 测试</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code># 配置本地hosts文件域名解析,ip是ingress安装的节点ip
10.2.32.11  foo.bar.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://lixuanfengs.github.io/blog-images/cactus-vuepress-img/image8.png" alt="img"></p> <h4 id="configmap介绍"><a href="#configmap介绍" class="header-anchor">#</a> ConfigMap介绍</h4> <p>ConfigMap是一种API对象，用来将非加密数据保存到键值对中。可以用作环境变量、命令行参数或者存储卷中的配置文件。</p> <p>ConfigMap可以将环境变量配置信息和容器镜像解耦，便于应用配置的修改。如果需要存储加密信息时可以使用Secret对象</p> <h5 id="基于目录创建configmap"><a href="#基于目录创建configmap" class="header-anchor">#</a> 基于目录创建ConfigMap</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code># 准备测试文件
[root@k8s-master1 ~]# mkdir configmap
[root@k8s-master1 ~]# cd configmap/
[root@k8s-master1 configmap]# mkdir conf
[root@k8s-master1 configmap]# cd conf/
[root@k8s-master1 conf]# cat game.conf
lives=3
secret.code=true
[root@k8s-master1 conf]# cat game2.conf
color.good=purple
user=tomcat
# 开始创建ConfigMap 
[root@k8s-master1 configmap]# kubectl create cm cmfromdir --from-file=conf/
configmap/cmfromdir created
#  查看是否创建成功
[root@k8s-master1 configmap]# kubectl  get cm
NAME               DATA   AGE
cmfromdir          2      68s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h5 id="基于文件创建configmap"><a href="#基于文件创建configmap" class="header-anchor">#</a> 基于文件创建ConfigMap</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 conf]# cat redis.conf
password redis123
[root@k8s-master1 configmap]#  kubectl create cm cmfromfile --from-file=conf/redis.conf
configmap/cmfromfile created
# 查看创建好的详细信息
[root@k8s-master1 configmap]# kubectl  get cm cmfromfile -oyaml
apiVersion: v1
data:
  redis.conf: |
    password redis123
# 查看是否创建成功
[root@k8s-master1 configmap]# kubectl  get cm
NAME               DATA   AGE
cmfromdir          2      3h5m
cmfromfile         1      3m58s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h5 id="自定义configmap的key名称"><a href="#自定义configmap的key名称" class="header-anchor">#</a> 自定义ConfigMap的key名称</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 conf]# kubectl  create cm cmspecialname --from-file=game-conf=game.conf
# 多个文件自定义ConfigMap名称
[root@k8s-master1 conf]# kubectl create cm cmspecialname2 --from-file=game-conf=game.conf --from-file=redis-conf=redis.conf
# 查看创建情况
[root@k8s-master1 conf]# kubectl  get cm cmspecialname2 -oyaml
apiVersion: v1
data:
  game-conf: |
    lives=3
    secret.code=true
  redis-conf: |
    password redis123
# 创建到不同的命名空间下只需要在后面加-n  命名空间名称即可     
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h5 id="基于env创建configmap"><a href="#基于env创建configmap" class="header-anchor">#</a> 基于env创建CoNfigMap</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 conf]# cat game2.conf
lives=3
color.good=purple
user=tomcat
test_env=dukuan
[root@k8s-master1 conf]# kubectl create cm gameenvcm --from-env-file=game2.conf
configmap/gameenvcm created
# 查看创建情况
[root@k8s-master1 conf]# kubectl  get cm gameenvcm -oyaml
apiVersion: v1
data:
  color.good: purple
  test_env: dukuan
  user: tomcat
kind: ConfigMap
# 直接创建ConfigMap
[root@k8s-master1 conf]# kubectl create cm envfromliteral --from-literal=level=INFO
--from-literal=PASSWORD=redis1234
[root@k8s-master1 conf]# kubectl get cm envfromliteral -oyaml
apiVersion: v1
data:
  level: INFO--from-literal=PASSWORD=redis1234
kind: ConfigMap
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h5 id="创建多个configmap"><a href="#创建多个configmap" class="header-anchor">#</a> 创建多个ConfigMap</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 conf]# cat configmaps.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: special-config
  namespace: default
data:
  special.how: very
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: env-config
  namespace: default
data:
  log_level: INFO
# 执行创建
[root@k8s-master1 conf]# kubectl create -f configmaps.yaml
configmap/special-config created
configmap/env-config created
# 查看是否创建成功
[root@k8s-master1 conf]# kubectl get cm
NAME               DATA   AGE
env-config         1      30s
envfromliteral     1      14m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h5 id="使用valuefrom定义环境变量"><a href="#使用valuefrom定义环境变量" class="header-anchor">#</a> 使用valueFrom定义环境变量</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 conf]#  kubectl  get cm gameenvcmmm  -oyaml
apiVersion: v1
data:
  color.good: purple
  lives: &quot;3&quot;
  test_env: dukuan
  user: tomcat
kind: ConfigMap
# 导出yaml文件
[root@k8s-master1 conf]# kubectl  create deploy dp-cm --image=nginx --dry-run=client -oyaml &gt; dp-cm.yaml
[root@k8s-master1 conf]# cat dp-cm.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: dp-cm
  name: dp-cm
spec:
  replicas: 1
  selector:
    matchLabels:
      app: dp-cm
  strategy: {}
  template:
    metadata:
      labels:
        app: dp-cm
    spec:
      containers:
      - image: nginx
        name: nginx
        env:
        - name: TEST_ENV    #也可以自定义多个env,指定多个name名称即可
          value: testenv
        - name: LIVES
          valueFrom:
            configMapKeyRef:
              name: cmspecialname   #已有的ConfigMap名称 
              key : lives
# 执行创建
[root@k8s-master1 conf]# kubectl  create -f dp-cm.yaml
deployment.apps/dp-cm created
# 查看pod状态
[root@k8s-master1 conf]# kubectl  get deploy
NAME    READY   UP-TO-DATE   AVAILABLE   AGE
dp-cm   1/1     1            1           19s
[root@k8s-master1 conf]# kubectl  get po
NAME                     READY   STATUS    RESTARTS   AGE
dp-cm-f5f56988f-bltfs    1/1     Running   0          85s
# 查看环境变量是否创建
[root@k8s-master1 conf]# kubectl  exec dp-cm-f5f56988f-bltfs env
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
HOSTNAME=dp-cm-f5f56988f-bltfs
TEST_ENV=testenv
LIVES=3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h5 id="使用envfrom定义环境变量"><a href="#使用envfrom定义环境变量" class="header-anchor">#</a> 使用envFrom定义环境变量</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 conf]# cat dp-cm.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: dp-cm
  name: dp-cm
spec:
  replicas: 1
  selector:
    matchLabels:
      app: dp-cm
  strategy: {}
  template:
    metadata:
      labels:
        app: dp-cm
    spec:
      containers:
      - image: nginx
        name: nginx
        envFrom:
        - configMapRef:
            name: gameenvcmmm
          prefix: fromCm_   #给环境变量加个前缀的名字好区分
        env:
        - name: TEST_ENV
          value: testenv
        - name: LIVES
          valueFrom:
            configMapKeyRef:
              name: gameenvcmmm
              key : lives
# 更新配置文件
[root@k8s-master1 conf]# kubectl  create -f dp-cm.yaml
deployment.apps/dp-cm created
# 查看是否创建成功
[root@k8s-master1 conf]# kubectl  get po
NAME                     READY   STATUS    RESTARTS   AGE
busybox1                 1/1     Running   28         28h
dp-cm-68fc4d49d4-sgxff   1/1     Running   0          47s
# 查看环境变量是否生成
[root@k8s-master1 conf]# kubectl  exec  dp-cm-68fc4d49d4-sgxff env
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
HOSTNAME=dp-cm-68fc4d49d4-sgxff
fromCm_color.good=purple
fromCm_lives=3
fromCm_test_env=dukuan
fromCm_user=tomcat
TEST_ENV=testenv
LIVES=3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><h5 id="以文件的形式挂载configmap"><a href="#以文件的形式挂载configmap" class="header-anchor">#</a> 以文件的形式挂载ConfigMap</h5> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># 创建ConfigMap </span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 configmap<span class="token punctuation">]</span><span class="token comment"># kubectl create cm redis-conf --from-file=conf/redis.conf</span>
configmap/redis<span class="token punctuation">-</span>conf created
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 conf<span class="token punctuation">]</span><span class="token comment"># cat dp-cm.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> dp<span class="token punctuation">-</span>cmm
  <span class="token key atrule">name</span><span class="token punctuation">:</span> dp<span class="token punctuation">-</span>cmm
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> dp<span class="token punctuation">-</span>cmm
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> dp<span class="token punctuation">-</span>cmm
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
          <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redisconf
              <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/config    <span class="token comment">#挂载路径 多个ConfigMap的话就要写多个挂载路径以免被覆盖</span>
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redisconf
          <span class="token key atrule">configMap</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>conf    <span class="token comment">#ConfigMap的名称</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 conf<span class="token punctuation">]</span><span class="token comment"># kubectl  create -f dp-cm.yaml</span>
deployment.apps/dp<span class="token punctuation">-</span>cmm created
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 conf<span class="token punctuation">]</span><span class="token comment"># kubectl  get po</span>
NAME                      READY   STATUS    RESTARTS   AGE
dp<span class="token punctuation">-</span>cmm<span class="token punctuation">-</span>598569bd6d<span class="token punctuation">-</span>dm47r   1/1     Running   0          39s
<span class="token comment"># 进到容器里面验证是否挂载成功</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 conf<span class="token punctuation">]</span><span class="token comment"># kubectl exec -ti dp-cmm-598569bd6d-dm47r -- bash</span>
root@dp<span class="token punctuation">-</span>cmm<span class="token punctuation">-</span>598569bd6d<span class="token punctuation">-</span>dm47r<span class="token punctuation">:</span>/<span class="token comment"># cd /etc/config/</span>
root@dp<span class="token punctuation">-</span>cmm<span class="token punctuation">-</span>598569bd6d<span class="token punctuation">-</span>dm47r<span class="token punctuation">:</span>/etc/config<span class="token comment"># ls</span>
redis.conf
<span class="token comment"># 修改redis.config看看是否会同步到容器中</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 configmap<span class="token punctuation">]</span><span class="token comment"># kubectl edit cm redis-conf</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis.conf</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    password redis12111113</span>
<span class="token comment"># 查看是否同步    </span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 conf<span class="token punctuation">]</span><span class="token comment"># kubectl exec -ti dp-cmm-598569bd6d-dm47r -- bash</span>
root@dp<span class="token punctuation">-</span>cmm<span class="token punctuation">-</span>598569bd6d<span class="token punctuation">-</span>dm47r<span class="token punctuation">:</span>/<span class="token comment"># cd /etc/config/</span>
root@dp<span class="token punctuation">-</span>cmm<span class="token punctuation">-</span>598569bd6d<span class="token punctuation">-</span>dm47r<span class="token punctuation">:</span>/etc/config<span class="token comment"># cat redis.conf</span>
password redis12111113
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><h5 id="自定义挂载权限及名称"><a href="#自定义挂载权限及名称" class="header-anchor">#</a> 自定义挂载权限及名称</h5> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 configmap<span class="token punctuation">]</span><span class="token comment"># kubectl  get cm cmfromfile -oyaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis.conf</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    password redis123</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token comment"># yaml文件</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 conf<span class="token punctuation">]</span><span class="token comment"># cat dp-cm.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> dp<span class="token punctuation">-</span>cmm
  <span class="token key atrule">name</span><span class="token punctuation">:</span> dp<span class="token punctuation">-</span>cmm
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> dp<span class="token punctuation">-</span>cmm
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> dp<span class="token punctuation">-</span>cmm
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
          <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redisconf
              <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/config
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> cmfromfile
              <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/config2
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redisconf
          <span class="token key atrule">configMap</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>conf
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> cmfromfile
          <span class="token key atrule">configMap</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> cmfromfile
            <span class="token key atrule">items</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> redis.conf   <span class="token comment">#ConfigMap key的名称</span>
                <span class="token key atrule">path</span><span class="token punctuation">:</span> redis.conf.bak
              <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> redis.conf
                <span class="token key atrule">path</span><span class="token punctuation">:</span> redis.conf.bak2
                <span class="token key atrule">mode</span><span class="token punctuation">:</span> <span class="token number">0644</span> <span class="token comment">#指定单个文件的权限,优先级高</span>
            <span class="token key atrule">defaultMode</span><span class="token punctuation">:</span> <span class="token number">0666</span>   <span class="token comment">#自定义挂载文件权限</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 conf<span class="token punctuation">]</span><span class="token comment"># kubectl  create -f dp-cm.yaml</span>
deployment.apps/dp<span class="token punctuation">-</span>cmm created
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 conf<span class="token punctuation">]</span><span class="token comment"># kubectl  get po</span>
NAME                      READY   STATUS    RESTARTS   AGE
busybox1                  1/1     Running   32         32h
dp<span class="token punctuation">-</span>cmm<span class="token punctuation">-</span>7f9845d965<span class="token punctuation">-</span>m7hqc   1/1     Running   0          50s
<span class="token comment"># 进入到容器验证</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 conf<span class="token punctuation">]</span><span class="token comment"># kubectl  exec -ti dp-cmm-7f9845d965-m7hqc -- bash</span>
root@dp<span class="token punctuation">-</span>cmm<span class="token punctuation">-</span>7f9845d965<span class="token punctuation">-</span>m7hqc<span class="token punctuation">:</span>/<span class="token comment"># ls  /etc/config/ -l</span>
total 0
lrwxrwxrwx 1 root root 17 Feb 11 14<span class="token punctuation">:</span>35 redis.conf <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> ..data/redis.conf
root@dp<span class="token punctuation">-</span>cmm<span class="token punctuation">-</span>7f9845d965<span class="token punctuation">-</span>m7hqc<span class="token punctuation">:</span>/<span class="token comment"># cd /etc/config2/</span>
root@dp<span class="token punctuation">-</span>cmm<span class="token punctuation">-</span>7f9845d965<span class="token punctuation">-</span>m7hqc<span class="token punctuation">:</span>/etc/config2<span class="token comment"># cd  ..data</span>
root@dp<span class="token punctuation">-</span>cmm<span class="token punctuation">-</span>7f9845d965<span class="token punctuation">-</span>m7hqc<span class="token punctuation">:</span>/etc/config2/..data<span class="token comment"># ls -l</span>
total 8
<span class="token punctuation">-</span>rw<span class="token punctuation">-</span>rw<span class="token punctuation">-</span>rw<span class="token punctuation">-</span> 1 root root 18 Feb 11 14<span class="token punctuation">:</span>35 redis.conf.bak
<span class="token punctuation">-</span>rw<span class="token punctuation">-</span>r<span class="token punctuation">-</span><span class="token punctuation">-</span>r<span class="token punctuation">-</span><span class="token punctuation">-</span> 1 root root 18 Feb 11 14<span class="token punctuation">:</span>35 redis.conf.bak2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><h4 id="secret的介绍"><a href="#secret的介绍" class="header-anchor">#</a> Secret的介绍</h4> <p>Secret 是一种包含少量敏感信息例如密码、令牌或密钥的对象。 这样的信息可能会被放在 Pod 规约中或者镜像中。 用户可以创建 Secret，同时系统也创建了一些 Secret。</p> <h5 id="创建secret"><a href="#创建secret" class="header-anchor">#</a> 创建Secret</h5> <p>一个 Secret 可以包含 Pod 访问数据库所需的用户凭证。 例如，由用户名和密码组成的数据库连接字符串。 你可以在本地计算机上，将用户名存储在文件 ./username.txt 中，将密码存储在文件 ./password.txt 中</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 ~<span class="token punctuation">]</span><span class="token comment"># mkdir secret</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 ~<span class="token punctuation">]</span><span class="token comment"># cd secret/</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># echo -n 'admin' &gt; ./username.txt</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># echo -n '1f2d1e2e67df' &gt; ./password.txt</span>
<span class="token comment"># generic:类型    db-user-pass:名称</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment">#  kubectl create secret generic db-user-pass \</span>
   <span class="token punctuation">-</span><span class="token punctuation">-</span>from<span class="token punctuation">-</span>file=./username.txt \
   <span class="token punctuation">-</span><span class="token punctuation">-</span>from<span class="token punctuation">-</span>file=./password.txt
<span class="token comment"># 查看是否创建成功</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># kubectl  get secret</span>
NAME                  TYPE                                  DATA   AGE
db<span class="token punctuation">-</span>user<span class="token punctuation">-</span>pass          Opaque                                2      3m12s
<span class="token comment"># 查看Secret的详细信息</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># kubectl  get secret db-user-pass -oyaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">password.txt</span><span class="token punctuation">:</span> MWYyZDFlMmU2N2Rm
  <span class="token key atrule">username.txt</span><span class="token punctuation">:</span> YWRtaW4=
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>你还可以使用 <code>--from-literal=&lt;key&gt;=&lt;value&gt;</code> 标签提供 Secret 数据。 可以多次使用此标签，提供多个键值对。 请注意，特殊字符（例如：<code>$</code>，<code>\</code>，<code>*</code>，<code>=</code> 和 <code>!</code>）由你的 <a href="https://en.wikipedia.org/wiki/Shell_(computing)" target="_blank" rel="noopener noreferrer">shell<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 解释执行，而且需要转义。</p> <p>在大多数 shell 中，转义密码最简便的方法是用单引号括起来。 比如，如果你的密码是 <code>S!B\*d$zDsb=</code>， 可以像下面一样执行命令</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># 创建Secret</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># kubectl create secret generic db-user-pas   --from-literal=username=devuser   --from-literal=password='S!B\*d$zDsb='</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># kubectl  get secrets</span>
NAME                  TYPE                                  DATA   AGE
db<span class="token punctuation">-</span>user<span class="token punctuation">-</span>pas           Opaque                                2      92s
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># kubectl  get secret db-user-pas  -oyaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">password</span><span class="token punctuation">:</span> UyFCXCpkJHpEc2I9
  <span class="token key atrule">username</span><span class="token punctuation">:</span> ZGV2dXNlcg==
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token comment"># 解析对比</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># echo 'UyFCXCpkJHpEc2I9' | base64 --decode</span>
S<span class="token tag">!B</span>\<span class="token important">*d$zDsb=</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h5 id="使用配置文件创建secret"><a href="#使用配置文件创建secret" class="header-anchor">#</a> 使用配置文件创建Secret</h5> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># cat secret.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> mysecret
<span class="token key atrule">type</span><span class="token punctuation">:</span> Opaque
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">username</span><span class="token punctuation">:</span> YWRtaW4=
  <span class="token key atrule">password</span><span class="token punctuation">:</span> MWYyZDFlMmU2N2Rm
<span class="token comment"># 开始创建</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># kubectl  create -f secret.yaml</span>
secret/mysecret created
<span class="token comment"># 查看创建情况</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># kubectl  get secret</span>
NAME                  TYPE                                  DATA   AGE
mysecret              Opaque                                2      63s
<span class="token comment"># 删除secret </span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># kubectl  delete secret mysecret</span>
secret &quot;mysecret&quot; deleted
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>使用 stringData 字段。 这字段可以将一个非 base64 编码的字符串直接放入 Secret 中， 当创建或更新该 Secret 时，此字段将被编码</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># cat secret.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> mysecret
<span class="token key atrule">type</span><span class="token punctuation">:</span> Opaque
<span class="token key atrule">stringData</span><span class="token punctuation">:</span>
  <span class="token key atrule">username</span><span class="token punctuation">:</span> admin     <span class="token comment">#明文账号密码</span>
  <span class="token key atrule">password</span><span class="token punctuation">:</span> password123
<span class="token comment"># 执行创建</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># kubectl  create -f secret.yaml</span>
secret/mysecret created
<span class="token comment"># 查看创建情况</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># kubectl  get secret mysecret</span>
NAME       TYPE     DATA   AGE
mysecret   Opaque   2      68s
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># kubectl  get secret mysecret -oyaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">password</span><span class="token punctuation">:</span> cGFzc3dvcmQxMjM=    <span class="token comment">#已经显示被bash64加密过的</span>
  <span class="token key atrule">username</span><span class="token punctuation">:</span> YWRtaW4=
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h5 id="使用secret拉取私有仓库镜像"><a href="#使用secret拉取私有仓库镜像" class="header-anchor">#</a> 使用Secret拉取私有仓库镜像</h5> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># kubectl create secret docker-registry myregistry   --docker-username=亲19962  --docker-password=asdfghjkl1234   --docker-email=3555934218@qq.com  --docker-server=registry.cn-hangzhou.aliyuncs.com</span>
<span class="token comment"># 执行结果</span>
secret/myregistry created
<span class="token comment"># docker-registry  指定Secret的类型</span>
<span class="token comment"># myregistry(secret名称)</span>
<span class="token comment"># DOCKER_REGISTRY_SERVER：镜像仓库地址</span>
<span class="token comment"># DOCKER_USER：镜像仓库用户名，需要有拉取镜像的权限</span>
<span class="token comment"># DOCKER_PASSWORD：镜像仓库密码</span>
<span class="token comment"># DOCKER_EMAIL：邮箱信息，可以为空</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># kubectl  get secret</span>
NAME                  TYPE                                  DATA   AGE
myregistry            kubernetes.io/dockerconfigjson        1      4m16s
<span class="token comment"># 挂载容器</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># cat dp-cm.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> dp<span class="token punctuation">-</span>cmm
  <span class="token key atrule">name</span><span class="token punctuation">:</span> dp<span class="token punctuation">-</span>cmm
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> dp<span class="token punctuation">-</span>cmm
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> dp<span class="token punctuation">-</span>cmm
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> registry.cn<span class="token punctuation">-</span>hangzhou.aliyuncs.com/xiaomao_q/nginx<span class="token punctuation">:</span>v1   <span class="token comment">#私有仓库</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redisconf
              <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/config
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> cmfromfile
              <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/config2
      <span class="token key atrule">imagePullSecrets</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myregistry <span class="token comment"># 挂载带有私有仓库认证的账号密码的secret</span>
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redisconf
          <span class="token key atrule">configMap</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>conf
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> cmfromfile
          <span class="token key atrule">configMap</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> cmfromfile
            <span class="token key atrule">items</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> redis.conf
                <span class="token key atrule">path</span><span class="token punctuation">:</span> redis.conf.bak
              <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> redis.conf
                <span class="token key atrule">path</span><span class="token punctuation">:</span> redis.conf.bak2
                <span class="token key atrule">mode</span><span class="token punctuation">:</span> <span class="token number">0644</span> <span class="token comment">#指定单个文件的权限,优先级高</span>
            <span class="token key atrule">defaultMode</span><span class="token punctuation">:</span> <span class="token number">0666</span>   <span class="token comment">#自定义挂载文件权限</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># kubectl  create -f dp-cm.yaml</span>
deployment.apps/dp<span class="token punctuation">-</span>cmm created
<span class="token comment"># 查看是否创建成功</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># kubectl  get po</span>
NAME                      READY   STATUS    RESTARTS   AGE
dp<span class="token punctuation">-</span>cmm<span class="token punctuation">-</span>5cb7b5d669<span class="token punctuation">-</span>74htd   1/1     Running   0          55s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><h5 id="使用subpath解决挂载覆盖"><a href="#使用subpath解决挂载覆盖" class="header-anchor">#</a> 使用SubPath解决挂载覆盖</h5> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># 导出yaml文件</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl  exec dp-cmm-5cb7b5d669-74htd -- cat /etc/nginx/nginx.conf &gt; nginx.conf</span>
<span class="token comment"># 创建一个configMap</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl  create cm nginx-conf --from-file=nginx.conf</span>
configmap/nginx<span class="token punctuation">-</span>conf created
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl  get cm</span>
nginx<span class="token punctuation">-</span>conf         1      14s
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># cat dp-cm.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> dp<span class="token punctuation">-</span>cmm
  <span class="token key atrule">name</span><span class="token punctuation">:</span> dp<span class="token punctuation">-</span>cmm
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> dp<span class="token punctuation">-</span>cmm
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> dp<span class="token punctuation">-</span>cmm
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> registry.cn<span class="token punctuation">-</span>hangzhou.aliyuncs.com/xiaomao_q/nginx<span class="token punctuation">:</span>v1   <span class="token comment">#私有仓库</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>conf
              <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/nginx/nginx.conf   <span class="token comment">#挂载路径,只挂载单文件不会覆盖掉整个目录</span>
              <span class="token key atrule">subPath</span><span class="token punctuation">:</span> nginx.conf  <span class="token comment">#挂载文件,能解决掉覆盖问题</span>
      <span class="token key atrule">imagePullSecrets</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myregistry <span class="token comment"># 挂载带有私有仓库认证的账号密码的secret</span>
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>conf
          <span class="token key atrule">configMap</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>conf
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># kubectl create -f dp-cm.yaml</span>
deployment.apps/dp<span class="token punctuation">-</span>cmm created
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># kubectl  get po</span>
NAME                      READY   STATUS    RESTARTS   AGE
dp<span class="token punctuation">-</span>cmm<span class="token punctuation">-</span>74dd8bc59b<span class="token punctuation">-</span>6clcr   1/1     Running   0          7s
<span class="token comment"># 查看是否挂载成功</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 secret<span class="token punctuation">]</span><span class="token comment"># kubectl  exec -ti dp-cmm-74dd8bc59b-6clcr -- bash</span>
root@dp<span class="token punctuation">-</span>cmm<span class="token punctuation">-</span>74dd8bc59b<span class="token punctuation">-</span>6clcr<span class="token punctuation">:</span>/<span class="token comment"># cat /etc/nginx/nginx.conf</span>

user  nginx;
worker_processes  1;

error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;


events <span class="token punctuation">{</span>
    worker_connections  512;   <span class="token comment">#这个刚才是我故意修改的，为了验证挂载是否成功</span>
<span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><h5 id="configmap热更新"><a href="#configmap热更新" class="header-anchor">#</a> ConfigMap热更新</h5> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># 修改原始文件信息</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># cat nginx.conf</span>

user  nginx;
worker_processes  1;

error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;


events <span class="token punctuation">{</span>
    worker_connections  256;
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># ls</span>
nginx.conf  tls.crt  tls.key
<span class="token comment"># 执行更新</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl  create cm nginx-conf  --from-file=nginx.conf --dry-run=client -oyaml | kubectl replace -f -</span>
<span class="token comment"># 查看是否更新成功</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master1 test<span class="token punctuation">]</span><span class="token comment"># kubectl  get cm  nginx-conf -oyaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">nginx.conf</span><span class="token punctuation">:</span> <span class="token punctuation">|</span>2

    user  nginx;
    worker_processes  1;

    error_log  /var/log/nginx/error.log warn;
    pid        /var/run/nginx.pid;


    events <span class="token punctuation">{</span>
        worker_connections  256;   <span class="token comment">#更新成功</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h5 id="使用限制"><a href="#使用限制" class="header-anchor">#</a> 使用限制</h5> <p>1、提前创建ConfigMap和Secret</p> <p>2、引用key必须存在</p> <p>3、envFrom、valueFrom无法热更新环境变量</p> <p>4、envFrom配置环境变量,如果key是无效的,它会忽略掉无效的key</p> <p>5、ConfigMap和Secret必须要和Pod或者是引用它资源在同一个命名空间</p> <p>6、subPath也是无法热更新</p> <p>7、ConfigMap和Secret最好不要太大</p> <h4 id="volumes介绍"><a href="#volumes介绍" class="header-anchor">#</a> Volumes介绍</h4> <p>Container（容器）中的磁盘文件是短暂的，当容器崩溃时，kubelet会重新启动容器，但最初的文件将丢失，Container会以最干净的状态启动。另外，当一个Pod运行多个Container时，各个容器可能需要共享一些文件。Kubernetes Volume可以解决这两个问题。</p> <p>一些需要持久化数据的程序才会用到Volumes，或者一些需要共享数据的容器需要volumes。</p> <p>Redis-Cluster：nodes.conf</p> <p>日志收集的需求：需要在应用程序的容器里面加一个sidecar，这个容器是一个收集日志的容器，比如filebeat，它通过volumes共享应用程序的日志文件目录。</p> <p>Volumes：官方文档https://kubernetes.io/docs/concepts/storage/volumes/</p> <h5 id="emptydir"><a href="#emptydir" class="header-anchor">#</a> emptyDir</h5> <p>当 Pod 指定到某个节点上时，首先创建的是一个 emptyDir 卷，并且只要 Pod 在该节点上运行，卷就一直存在。就像它的名称表示的那样，卷最初是空的。</p> <p>尽管 Pod 中每个容器挂载 emptyDir 卷的路径可能相同也可能不同，但是这些容器都可以读写 emptyDir 卷中相同的文件</p> <p>如果Pod中有多个容器，其中某个容器重启，不会影响emptyDir 卷中的数据。当 Pod 因为某些原因被删除时，emptyDir 卷中的数据也会永久删除</p> <p>注意：容器崩溃并不会导致 Pod 被从节点上移除，因此容器崩溃时 emptyDir 卷中的数据是安全的。</p> <p>用途</p> <p>1、缓存空间,例如基于磁盘的归并排序</p> <p>2、为耗时较长的计算任务提供检查点,以便任务能方便地从崩溃前状态恢复</p> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 test]# cat nginx-deploy.yaml
apiVersion: v1
kind: Pod
metadata:
  name: pod-emptydir
  namespace: default
spec:
  containers:
  - name: myapp-pod
    image: registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1
    imagePullPolicy: IfNotPresent
    volumeMounts:
    - mountPath: /cache    #挂载目录
      name: cache-volume
  - name: busybox-pod
    image: registry.cn-beijing.aliyuncs.com/google_registry/busybox:1.24
    imagePullPolicy: IfNotPresent
    command: [&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;sleep 3600&quot;]
    volumeMounts:
    - mountPath: /test/cache   #挂载目录
      name: cache-volume
  volumes:
  - name: cache-volume
    emptyDir: {}
[root@k8s-master1 test]# kubectl  apply -f nginx-deploy.yaml
# 查看pod状态
[root@k8s-master1 test]# kubectl  get po
NAME                     READY   STATUS    RESTARTS   AGE
pod-emptydir             2/2     Running   1          67m
# 验证测试
[root@k8s-master1 ~]# kubectl exec -it pod-emptydir -c myapp-pod -- sh
/ # cd /cache/
/cache # pwd
/cache
/cache # date &gt;&gt; data.info
/cache # ls -l
total 4
-rw-r--r--    1 root     root            29 Feb 17 03:34 data.info
/cache # cat data.info
Thu Feb 17 03:34:47 UTC 2022
/cache # You have new mail in /var/spool/mail/root
[root@k8s-master1 ~]#
[root@k8s-master1 ~]# kubectl exec -it pod-emptydir -c myapp-pod -- sh
/ # cd cache/
/cache # ls
data.info
/cache # cat data.info
Thu Feb 17 03:34:47 UTC 2022
=====
# 启动另一个容器查看是否同步数据
[root@k8s-master1 ~]# kubectl  exec -it pod-emptydir -c busybox-pod -- sh
/ # cd /test/cache/
/test/cache # ls
data.info
/test/cache # cat data.info
Thu Feb 17 03:34:47 UTC 2022
/test/cache # echo &quot;=====&quot; &gt;&gt; data.info
/test/cache # cat data.info
Thu Feb 17 03:34:47 UTC 2022
=====
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><h5 id="hostpath"><a href="#hostpath" class="header-anchor">#</a> hostPath</h5> <p>hostPath卷可将节点上的文件或目录挂载到Pod上，用于Pod自定义日志输出或访问Docker内部的容器等。</p> <p>使用hostPath卷的示例。</p> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 test]# cat nginx-deploy.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: &quot;1&quot;
  creationTimestamp: &quot;2020-09-19T02:41:11Z&quot;
  generation: 1
  labels:
    app: nginx
  name: nginx
  namespace: default
spec:
  progressDeadlineSeconds: 600
  replicas: 2
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: nginx
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: nginx
    spec:
      containers:
      - image: nginx:1.15.2
        imagePullPolicy: IfNotPresent
        name: nginx
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /opt
          name: share-volume
        - mountPath: /etc/timezone
          name: timezone
      - image: nginx:1.15.2
        imagePullPolicy: IfNotPresent
        name: nginx2
        command:
        - sh
        - -c
        - sleep 3600
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /mnt
          name: share-volume
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      terminationGracePeriodSeconds: 30
      volumes:
      - name: share-volume
        emptyDir: {}
          #medium: Memory

      - name: timezone
        hostPath:
          path: /etc/timezone   #宿主机文件挂载到pod上
          type: File
# 执行创建
[root@k8s-master1 test]# kubectl  create -f nginx-deploy.yaml
deployment.apps/nginx created
# 验证
[root@k8s-master1 test]# kubectl exec nginx-866594ffc6-6h2dm -c nginx -- cat /etc/timezone
Asia/Shanghai
[root@k8s-master1 test]# kubectl exec nginx-866594ffc6-xj89w  -c nginx2 -- cat /etc/timezone
Etc/UTC
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><p>hostPath卷常用的type（类型）如下：</p> <p>1、 type为空字符串：默认选项，意味着挂载hostPath卷之前不会执行任何检查。</p> <p>2、DirectoryOrCreate：如果给定的path不存在任何东西，那么将根据需要创建一个权限为0755的空目录，和Kubelet具有相同的组和权限。</p> <p>3、 Directory：目录必须存在于给定的路径下。</p> <p>4、FileOrCreate：如果给定的路径不存储任何内容，则会根据需要创建一个空文件，权限设置为0644，和Kubelet具有相同的组和所有权。</p> <p>5、File：文件，必须存在于给定路径中。</p> <p>6、Socket：UNIX套接字，必须存在于给定路径中。</p> <p>7、CharDevice：字符设备，必须存在于给定路径中。</p> <p>8、BlockDevice：块设备，必须存在于给定路径中。</p> <h4 id="nfs"><a href="#nfs" class="header-anchor">#</a> NFS</h4> <h5 id="挂载到容器"><a href="#挂载到容器" class="header-anchor">#</a> 挂载到容器</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code># 服务端安装
[root@k8s-master1 test]# yum -y install nfs-utils
# 启动NFS
[root@k8s-master1 test]# systemctl start nfs-server
# 创建共享目录
[root@k8s-master1 test]# mkdir -p /data/k8s
[root@k8s-master1 test]# cat  /etc/exports
/data/k8s  10.2.32.11/19(rw,sync,no_subtree_check,no_root_squash)
# 重启NFS
[root@k8s-master1 test]# systemctl restart nfs-server
[root@k8s-master1 test]# cat nginx-deploy.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: &quot;1&quot;
  creationTimestamp: &quot;2020-09-19T02:41:11Z&quot;
  generation: 1
  labels:
    app: nginx
  name: nginx
  namespace: default
spec:
  progressDeadlineSeconds: 600
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: nginx
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: nginx
    spec:
      containers:
      - image: nginx:1.15.2
        imagePullPolicy: IfNotPresent
        name: nginx
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /opt   #容器内部挂载路径
          name: nfs-volume
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      terminationGracePeriodSeconds: 30
      volumes:
      - name: nfs-volume     #NFS卷的名称
        nfs:
          server: 10.2.32.11   #NFS服务器地址
          path: /data/k8s/   #NFS共享目录 
#  创建pod 
[root@k8s-master1 test]# kubectl  create -f nginx-deploy.yaml
deployment.apps/nginx created
# 查看pod是否创建成功
[root@k8s-master1 test]# kubectl  get po
NAME                     READY   STATUS    RESTARTS   AGE
nginx-6856d6d5c6-ptxn8   1/1     Running   0          55s
# 查看是否挂载成功
[root@k8s-master1 test]# kubectl exec -ti nginx-6856d6d5c6-ptxn8 -- bash
root@nginx-6856d6d5c6-ptxn8:/# df -h
Filesystem               Size  Used Avail Use% Mounted on
overlay                   47G  6.2G   41G  14% /
tmpfs                     64M     0   64M   0% /dev
tmpfs                    2.0G     0  2.0G   0% /sys/fs/cgroup
10.2.32.11:/data/k8s      47G  6.2G   41G  14% /opt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div><h4 id="pv和pvc"><a href="#pv和pvc" class="header-anchor">#</a> PV和PVC</h4> <p>Volume无法解决的问题:</p> <p>​    1、当某个数据卷不再被挂载使用时,里面的数据如何处理？</p> <p>​    2、如果想要实现只读挂载如何处理？</p> <p>​    3、如果想要只能一个Pod挂载如何处理？</p> <p>​    4、如何只允许某个Pod使用10G的空间？</p> <h5 id="pv和pvc的介绍"><a href="#pv和pvc的介绍" class="header-anchor">#</a> PV和PVC的介绍</h5> <p>PersistentVolume：简称PV，是由Kubernetes管理员设置的存储，可以配置Ceph、NFS、GlusterFS等常用存储配置，相对于Volume配置，提供了更多的功能，比如生命周期的管理、大小的限制。PV分为静态和动态。PersistentVolumeClaim：简称PVC，是对存储PV的请求，表示需要什么类型的PV，需要存储的技术人员只需要配置PVC即可使用存储，或者Volume配置PVC的名称即可。</p> <h5 id="pv的回收策略"><a href="#pv的回收策略" class="header-anchor">#</a> PV的回收策略</h5> <p>1、Retain:保留，该策略允许手动回收资源，当删除PVC时，PV仍然存在，PV被视为已释放，管理员可以手动回收卷</p> <p>2、Recycle：回收，如果Volume插件支持，Recycle策略会对卷执行rm -rf清理该PV，并使其可用于下一个新的PVC，但是本策略将来会被弃用，目前只有NFS和HostPath支持该策略。</p> <p>3、Delete：删除，如果Volume插件支持，删除PVC时会同时删除PV，动态卷默认为Delete，目前支持Delete的存储后端包括AWS EBS, GCE PD, Azure Disk, or OpenStack Cinder等</p> <p>4、可以通过persistentVolumeReclaimPolicy: Recycle字段配置</p> <h5 id="pv访问策略"><a href="#pv访问策略" class="header-anchor">#</a> PV访问策略</h5> <p>1、ReadWriteOnce：可以被单节点以读写模式挂载，命令行中可以被缩写为RWO。</p> <p>2、ReadOnlyMany：可以被多个节点以只读模式挂载，命令行中可以被缩写为ROX。</p> <p>3、ReadWriteMany：可以被多个节点以读写模式挂载，命令行中可以被缩写为RWX。</p> <h5 id="文件存储、块存储、对象存储区别"><a href="#文件存储、块存储、对象存储区别" class="header-anchor">#</a> 文件存储、块存储、对象存储区别</h5> <p>1、文件存储:一些数据可能需要被多个节点使用,比如用户的头像、用户上传的文件等，实现方式：NFS、NAS、FTP等</p> <p>2、块存储:一些数据只能被一个节点使用,或者是需要将一块裸盘整个挂载使用,比如数据库、Redis等,实现方式：Ceph、GlusterFS、公有云</p> <p>3、对象存储:由程序代码直接实现一种存储方式,云原生应用无状态化常用的实现方式,实现方式:一般是符合S3协议的云存储,比如AWS的S3存储、Minio等</p> <h5 id="创建pv连接nfs"><a href="#创建pv连接nfs" class="header-anchor">#</a> 创建pv连接nfs</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 test]# cat pv.yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv-nfs
spec:
  capacity:   #容量配置
    storage: 5Gi  #这个pv用的空间大小
  volumeMode: Filesystem
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Recycle
  storageClassName: nfs-slow
  nfs:
    path: /data/k8s
    server: 10.2.32.11
# 配置解释
1、capacity: 容量配置
2、volumeMode:  卷的模式,目前支持Filesystem(文件系统)和Block(块),其中Block类型需要后端存储支持,默认为文件系统
3、accessModes: 该PV的访问模式
4、storageClassName: PV的类，一个特定类型的PV只能绑定到特定类别的PVC
5、persistentVolumeReclaimPolicy:回收策略
6、nfs：NFS服务配置，包括以下两个选项
	1、path：NFS上的共享目录
	2、server：NFS的IP地址
# 创建PV 
[root@k8s-master1 test]# kubectl  create -f pv.yaml
persistentvolume/pv-nfs created
# 查看PV是否创建成功
[root@k8s-master1 test]# kubectl  get -f pv.yaml
NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE
pv-nfs   5Gi        RWO            Recycle          Available           nfs-slow                86s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h5 id="pv的状态"><a href="#pv的状态" class="header-anchor">#</a> PV的状态</h5> <p>1、Available：可用，没有被PVC绑定的空闲资源。</p> <p>2、Bound：已绑定，已经被PVC绑定。</p> <p>3、Released：已释放，PVC被删除，但是资源还未被重新使用。</p> <p>4、Failed：失败，自动回收失败。</p> <h5 id="创建hostpath类型的pv"><a href="#创建hostpath类型的pv" class="header-anchor">#</a> 创建HostPath类型的PV</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 test]# cat pv-hostPath.yaml
kind: PersistentVolume
apiVersion: v1
metadata:
  name: task-pv-volume
  labels:
    type: local
spec:
  storageClassName: hostpath
  capacity:
    storage: 10Gi
  accessModes:
    - ReadWriteOnce
  hostPath:    # 服务配置
    path: &quot;/mnt/data&quot;   #宿主机路径
# 创建PV 
[root@k8s-master1 test]# kubectl  create -f pv-hostPath.yaml
persistentvolume/task-pv-volume created
# 查看PV是否创建成功
[root@k8s-master1 test]# kubectl  get -f pv-hostPath.yaml
NAME             CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE
task-pv-volume   10Gi       RWO            Retain           Available           hostpath                4m3s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h5 id="pvc绑定pv"><a href="#pvc绑定pv" class="header-anchor">#</a> PVC绑定PV</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 test]# cat nfs-pvc.yaml
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: nfs-pvc-claim
spec:
  storageClassName: nfs-slow
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 3Gi   # 小于等于pv
# 创建PVC 
[root@k8s-master1 test]# kubectl  create -f nfs-pvc.yaml
persistentvolumeclaim/nfs-pvc-claim created
# 查看pvc是否创建成功
[root@k8s-master1 test]# kubectl  get -f  nfs-pvc.yaml
NAME            STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE
nfs-pvc-claim   Bound    pv-nfs   5Gi        RWO            nfs-slow       43s
# 查看pvc是否跟pv绑定成功
[root@k8s-master1 test]# kubectl  get pv pv-nfs
NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                   STORAGECLASS   REASON   AGE
pv-nfs   5Gi        RWO            Recycle          Bound    default/nfs-pvc-claim   nfs-slow                95m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h5 id="pod容器使用pvc"><a href="#pod容器使用pvc" class="header-anchor">#</a> pod容器使用PVC</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>[root@k8s-master1 test]# cat nginx-pvc.yaml
kind: Pod
apiVersion: v1
metadata:
  name: task-pv-pod
spec:
  volumes:
    - name: task-pv-volume  #Volumes名称
      persistentVolumeClaim:
       claimName: nfs-pvc-claim  # pvc名称
  containers:
    - name: task-pv-container
      image: nginx
      ports:
        - containerPort: 80
          name: &quot;http-server&quot;
      volumeMounts:
        - mountPath: &quot;/usr/share/nginx/html&quot;   #容器挂载的路径
          name: task-pv-volume
# 创建POD 
[root@k8s-master1 test]# kubectl  create -f nginx-pvc.yaml
pod/task-pv-pod created
# 查看状态
[root@k8s-master1 test]# kubectl  get -f nginx-pvc.yaml
NAME          READY   STATUS    RESTARTS   AGE
task-pv-pod   1/1     Running   0          62s
# 服务端文件写入测试
[root@k8s-master1 test]# kubectl exec -ti task-pv-pod -- bash
root@task-pv-pod:/# df -Th
Filesystem              Type     Size  Used Avail Use% Mounted on
overlay                 overlay   46G   17G   30G  36% /
10.2.32.11:/data/k8s    nfs4      47G  6.2G   41G  14% /usr/share/nginx/html
[root@k8s-master1 ~]# cd /data/k8s/
[root@k8s-master1 k8s]# echo &quot;123456&quot; &gt; index.html
# 查看文件是否同步
[root@k8s-master1 test]# kubectl exec -ti task-pv-pod -- bash
root@task-pv-pod:/usr/share/nginx/html# cat index.html
123456
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h5 id="pvc创建和挂载失败的原因"><a href="#pvc创建和挂载失败的原因" class="header-anchor">#</a> PVC创建和挂载失败的原因</h5> <p>PVC一直Pending的原因:</p> <p>​      1、PVC的空间申请大小大于PV的大小</p> <p>​      2、PVC的StorageClassName没有和PV的一致</p> <p>​      3、PVC的accessModes和PV的不一致</p> <p>挂载PVC的Pod一直处于Pending：</p> <p>·    1、PVC没有创建成功/PVC不存在</p> <p>​     2、PVC和Pod不在同一个Namespace</p> <h4 id="什么是job"><a href="#什么是job" class="header-anchor">#</a> 什么是JOB</h4> <p>Job负责批量处理任务,即仅执行一次的任务,它保证批处理任务的一个或多个Pod成功结束</p> <p><img src="images%5Cimage9.png" alt=""></p> <h5 id="配置参数详解"><a href="#配置参数详解" class="header-anchor">#</a> 配置参数详解</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>1、backoffLimit: 如果任务执行失败，失败多少次后不再执行
2、completions：有多少个Pod执行成功，认为任务是成功的(执行多少次成功)
	1、为空默认和parallelism数值一样
3、parallelism：并行执行任务的数量
    1、如果parallelism数值大于未完成任务数，只会创建未完成的数量；
    2、 比如completions是4，并发是3，第一次会创建3个Pod执行任务，
        第二次只会创建一个Pod执行任务
4、ttlSecondsAfterFinished：Job在执行结束之后（状态为completed或Failed）自动清理。设置为0表示执行结束立即删除，不设置则不会清除，需要开启TTLAfterFinished特性
[root@k8s-master1 test]# cat job.yaml
apiVersion: batch/v1
kind: Job
metadata:
  labels:
    job-name: echo
  name: echo
  namespace: default
spec:
  #suspend: true # 1.21+
  #ttlSecondsAfterFinished: 100
  backoffLimit: 4
  completions: 1
  parallelism: 1
  template:
    spec:
      containers:
      - command:
        - echo
        - Hello, Job
        image: nginx
        imagePullPolicy: IfNotPresent
        name: echo
        resources: {}
      restartPolicy: Never
# 执行创建job 
[root@k8s-master1 test]# kubectl  create -f job.yaml
job.batch/echo created
# 查看是否创建成功
[root@k8s-master1 test]# kubectl  get job
NAME   COMPLETIONS   DURATION   AGE
echo   1/1           24s        2m6s
[root@k8s-master1 test]# kubectl  get po
NAME                     READY   STATUS      RESTARTS   AGE
echo-zl2dr               0/1     Completed   0          3m39s
# 查看pod日志
[root@k8s-master1 test]# kubectl  logs -f  echo-zl2dr
Hello, Job
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h4 id="cronjob"><a href="#cronjob" class="header-anchor">#</a> CronJob</h4> <h5 id="cronjobe参数详解"><a href="#cronjobe参数详解" class="header-anchor">#</a> CronJobe参数详解</h5> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>1、apiVersion: batch/v1beta1 #1.21+ batch/v1
2、schedule:调度周期,和Linux一致,分别是分时日月周
3、restartPolicy:重启策略,和Pod一致
4、concurrencyPolicy:并发调度策略,可选参数如下:
      Allow:允许同时运行多个任务
      Forbid:不允许并发运行,如果之前的任务尚未完成,新的任务不会被创建
      Replace:如果之前的任务尚未完成,新的任务会替换之前的任务
5、suspend:如果设置为true,则暂停后续的任务,默认为false
6、successfulJobsHistoryLimit: 保留多少已完成的任务,按需配置
7、failedJobsHistoryLimit：保留多少失败的任务     
[root@k8s-master1 test]# cat cronjob.yaml
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  labels:
    run: hello
  name: hello
  namespace: default
spec:
  concurrencyPolicy: Allow
  failedJobsHistoryLimit: 1
  jobTemplate:
    metadata:
    spec:
      template:
        metadata:
          labels:
            run: hello
        spec:
          containers:
          - args:
            - /bin/sh
            - -c
            - date; echo Hello from the Kubernetes cluster
            image: registry.cn-beijing.aliyuncs.com/dotbalo/busybox
            imagePullPolicy: Always
            name: hello
            resources: {}
          restartPolicy: OnFailure
          securityContext: {}
  schedule: '*/1 * * * *'
  successfulJobsHistoryLimit: 3
  suspend: false
[root@k8s-master1 test]# kubectl  create -f cronjob.yaml
cronjob.batch/hello created
# 查看创建情况
[root@k8s-master1 test]# kubectl  get cj
NAME    SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE
hello   */1 * * * *   False     1        3s              64s
[root@k8s-master1 test]# kubectl  get job
NAME               COMPLETIONS   DURATION   AGE
hello-1645362000   1/1           2s         7s
[root@k8s-master1 test]# kubectl  get job
NAME               COMPLETIONS   DURATION   AGE
hello-1645363620   1/1           2s         82s
hello-1645363680   1/1           3s         22s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><h4 id="initcontainer"><a href="#initcontainer" class="header-anchor">#</a> InitContainer</h4> <h5 id="用途"><a href="#用途" class="header-anchor">#</a> 用途</h5> <p>1、Init容器可以包含一些安装过程中应用容器中不存在的实用工具或个性化代码</p> <p>2、Init容器可以安全地运行这些工具,避免这些工具导致应用镜像的安全性降低</p> <p>3、Init容器可以以root身份运行,执行一些高权限的命令</p> <p>4、Init容器相关操作执行完成以后即退出,不会给业务容器带来安全隐患</p> <p>在主应用启动之前，做一些初始化的操作，比如创建文件、修改内核参数、等待依赖程序启动或其他需要在主程序启动之前需要做的工作</p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/lixuanfengs/cactus-vuepress-sc/edit/master/docs/03.手册/01.开发环境配置/09.K8S基础入门.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/06/22, 19:16:34</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/32abc1/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">MySQL8.0主从配置</div></a> <a href="/pages/10a196/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">k8s基础命令</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/32abc1/" class="prev">MySQL8.0主从配置</a></span> <span class="next"><a href="/pages/10a196/">k8s基础命令</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/118ac7/"><div>
            深圳仪器平台-开发手册记录
            <!----></div></a> <span class="date">01-25</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/6254d2/"><div>
            👋 该怎样设计一套“百万级API网关?”
            <!----></div></a> <span class="date">10-12</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/d9cb43/"><div>
            功能完善(算力关联、接口上报、调用反馈)
            <!----></div></a> <span class="date">10-09</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1183895890@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/lixuanfengs" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://cactusli.net" title="网站首页" target="_blank" class="iconfont icon-rss"></a><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=1183895890&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" class="iconfont icon-QQ"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2018-2024
    <span>Cactusli | <a href="https://github.com/lixuanfengs/cactus-vuepress/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div><div></div><div></div><div class="artalk"></div><canvas id="vuepress-canvas-cursor"></canvas><div></div><!----></div></div>
    <script src="/assets/js/app.d73578e6.js" defer></script><script src="/assets/js/2.f6444e8b.js" defer></script><script src="/assets/js/65.c5eca227.js" defer></script><script src="/assets/js/13.9ca28764.js" defer></script><script src="/assets/js/6.0f00df03.js" defer></script><script src="/assets/js/5.1368437e.js" defer></script><script src="/assets/js/4.7c9e6596.js" defer></script>
  </body>
</html>
