<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>负载均衡和web服务 | Cactusli blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3077305_pt8umhrn4k9.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3129839_xft6cqs5gc.css">
    <noscript><meta http-equiv="refresh" content="0; url=https://www.youngkbt.cn/noscript/"><style>.theme-vdoing-content { display:none }</noscript>
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/artalk/2.5.5/Artalk.css">
    <script src="https://cdn.bootcdn.net/ajax/libs/artalk/2.5.5/Artalk.js"></script>
    <script>var _hmt = _hmt || [];
          (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?efc65c9365211267213266ca9b95b304"; 
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
          })();
          </script>
    <meta name="description" content="后端技术博客,专注前后端学习与总结。Java,JavaScript,js,ES6,TypeScript,vue,React,python,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="后端端博客,个人技术博客,后端,后端开发,前端框架,Java后端,后端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="codeva-nBtnwPHxXt">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/assets/css/0.styles.b8eeafc3.css" as="style"><link rel="preload" href="/assets/js/app.d73578e6.js" as="script"><link rel="preload" href="/assets/js/2.f6444e8b.js" as="script"><link rel="preload" href="/assets/js/57.201a710e.js" as="script"><link rel="preload" href="/assets/js/13.9ca28764.js" as="script"><link rel="preload" href="/assets/js/6.0f00df03.js" as="script"><link rel="preload" href="/assets/js/5.1368437e.js" as="script"><link rel="preload" href="/assets/js/4.7c9e6596.js" as="script"><link rel="prefetch" href="/assets/js/10.af60255b.js"><link rel="prefetch" href="/assets/js/100.3ef796c4.js"><link rel="prefetch" href="/assets/js/101.aae7784e.js"><link rel="prefetch" href="/assets/js/102.8da091f1.js"><link rel="prefetch" href="/assets/js/103.ad0dd5b7.js"><link rel="prefetch" href="/assets/js/104.642836fc.js"><link rel="prefetch" href="/assets/js/105.f3c5bcec.js"><link rel="prefetch" href="/assets/js/106.85dad7d8.js"><link rel="prefetch" href="/assets/js/107.42b1c013.js"><link rel="prefetch" href="/assets/js/108.2a978b6c.js"><link rel="prefetch" href="/assets/js/109.46c8b7c6.js"><link rel="prefetch" href="/assets/js/11.372f8efb.js"><link rel="prefetch" href="/assets/js/110.2cb8a5dc.js"><link rel="prefetch" href="/assets/js/111.c68e8975.js"><link rel="prefetch" href="/assets/js/112.d89adde5.js"><link rel="prefetch" href="/assets/js/113.e52ab124.js"><link rel="prefetch" href="/assets/js/114.94f7a70b.js"><link rel="prefetch" href="/assets/js/115.68c55722.js"><link rel="prefetch" href="/assets/js/116.9cdf5c61.js"><link rel="prefetch" href="/assets/js/117.34a7707c.js"><link rel="prefetch" href="/assets/js/118.e9922234.js"><link rel="prefetch" href="/assets/js/119.61fe4a4e.js"><link rel="prefetch" href="/assets/js/12.1061ddb5.js"><link rel="prefetch" href="/assets/js/120.fe5311f5.js"><link rel="prefetch" href="/assets/js/121.905e8e51.js"><link rel="prefetch" href="/assets/js/122.8cd7cd0c.js"><link rel="prefetch" href="/assets/js/123.f4f98520.js"><link rel="prefetch" href="/assets/js/124.4e233943.js"><link rel="prefetch" href="/assets/js/125.092aa1bf.js"><link rel="prefetch" href="/assets/js/126.b9c11778.js"><link rel="prefetch" href="/assets/js/127.e55d2fa9.js"><link rel="prefetch" href="/assets/js/128.3197df92.js"><link rel="prefetch" href="/assets/js/129.0244ee9b.js"><link rel="prefetch" href="/assets/js/130.e0648777.js"><link rel="prefetch" href="/assets/js/131.94e0b948.js"><link rel="prefetch" href="/assets/js/132.8520ded5.js"><link rel="prefetch" href="/assets/js/133.034f0365.js"><link rel="prefetch" href="/assets/js/134.1ca4a150.js"><link rel="prefetch" href="/assets/js/135.bdfc5c00.js"><link rel="prefetch" href="/assets/js/136.4918fec8.js"><link rel="prefetch" href="/assets/js/137.2db62de4.js"><link rel="prefetch" href="/assets/js/138.87fd076f.js"><link rel="prefetch" href="/assets/js/139.eecbbecd.js"><link rel="prefetch" href="/assets/js/14.2c349983.js"><link rel="prefetch" href="/assets/js/140.40d4aa29.js"><link rel="prefetch" href="/assets/js/141.dc280dee.js"><link rel="prefetch" href="/assets/js/142.4fa6a57c.js"><link rel="prefetch" href="/assets/js/143.33b90797.js"><link rel="prefetch" href="/assets/js/144.180e147f.js"><link rel="prefetch" href="/assets/js/145.832bf539.js"><link rel="prefetch" href="/assets/js/146.71cc0cd4.js"><link rel="prefetch" href="/assets/js/147.4d966ac1.js"><link rel="prefetch" href="/assets/js/148.98ccdf6a.js"><link rel="prefetch" href="/assets/js/149.c6e90dd0.js"><link rel="prefetch" href="/assets/js/15.5bb38388.js"><link rel="prefetch" href="/assets/js/150.cb70fd12.js"><link rel="prefetch" href="/assets/js/151.2da07e43.js"><link rel="prefetch" href="/assets/js/152.65bb34e9.js"><link rel="prefetch" href="/assets/js/153.10ef087b.js"><link rel="prefetch" href="/assets/js/154.2b0c9bc8.js"><link rel="prefetch" href="/assets/js/155.e38977ec.js"><link rel="prefetch" href="/assets/js/156.02b0bba1.js"><link rel="prefetch" href="/assets/js/157.3ed0f21f.js"><link rel="prefetch" href="/assets/js/158.beda5a17.js"><link rel="prefetch" href="/assets/js/159.5bfbc4d9.js"><link rel="prefetch" href="/assets/js/16.a58fed94.js"><link rel="prefetch" href="/assets/js/160.408dbb35.js"><link rel="prefetch" href="/assets/js/161.c4344be4.js"><link rel="prefetch" href="/assets/js/162.f80a95f8.js"><link rel="prefetch" href="/assets/js/163.dc12b090.js"><link rel="prefetch" href="/assets/js/164.682e2b57.js"><link rel="prefetch" href="/assets/js/165.0af68775.js"><link rel="prefetch" href="/assets/js/166.6254b754.js"><link rel="prefetch" href="/assets/js/167.727b0d47.js"><link rel="prefetch" href="/assets/js/168.e3458b70.js"><link rel="prefetch" href="/assets/js/169.d6492dcd.js"><link rel="prefetch" href="/assets/js/17.2429b1e6.js"><link rel="prefetch" href="/assets/js/170.3677af86.js"><link rel="prefetch" href="/assets/js/171.fe866179.js"><link rel="prefetch" href="/assets/js/172.c7d611be.js"><link rel="prefetch" href="/assets/js/173.e535d27d.js"><link rel="prefetch" href="/assets/js/174.07646070.js"><link rel="prefetch" href="/assets/js/175.227bcdd6.js"><link rel="prefetch" href="/assets/js/176.d03f1195.js"><link rel="prefetch" href="/assets/js/177.7206380a.js"><link rel="prefetch" href="/assets/js/178.7bfc35c4.js"><link rel="prefetch" href="/assets/js/179.d990d8ea.js"><link rel="prefetch" href="/assets/js/18.a5d750b4.js"><link rel="prefetch" href="/assets/js/180.2e4eba32.js"><link rel="prefetch" href="/assets/js/181.cbd8f5ca.js"><link rel="prefetch" href="/assets/js/182.afd4c94b.js"><link rel="prefetch" href="/assets/js/183.e7ab48ce.js"><link rel="prefetch" href="/assets/js/184.5f21d13c.js"><link rel="prefetch" href="/assets/js/185.4a4fd3b0.js"><link rel="prefetch" href="/assets/js/186.2ff2b9cd.js"><link rel="prefetch" href="/assets/js/187.b325350e.js"><link rel="prefetch" href="/assets/js/188.2a18fad9.js"><link rel="prefetch" href="/assets/js/189.425c0eb4.js"><link rel="prefetch" href="/assets/js/19.6925fadc.js"><link rel="prefetch" href="/assets/js/190.372a786b.js"><link rel="prefetch" href="/assets/js/191.a6b816f2.js"><link rel="prefetch" href="/assets/js/192.2d46ba6c.js"><link rel="prefetch" href="/assets/js/193.9d886ea4.js"><link rel="prefetch" href="/assets/js/194.ec75fc6b.js"><link rel="prefetch" href="/assets/js/195.5688915a.js"><link rel="prefetch" href="/assets/js/196.fa745ec4.js"><link rel="prefetch" href="/assets/js/197.b389a9e8.js"><link rel="prefetch" href="/assets/js/198.66ebbff6.js"><link rel="prefetch" href="/assets/js/199.32103f1f.js"><link rel="prefetch" href="/assets/js/20.d4b6b23a.js"><link rel="prefetch" href="/assets/js/200.1b917b48.js"><link rel="prefetch" href="/assets/js/201.626e8295.js"><link rel="prefetch" href="/assets/js/202.3df66e9e.js"><link rel="prefetch" href="/assets/js/203.aff1d912.js"><link rel="prefetch" href="/assets/js/204.6306a828.js"><link rel="prefetch" href="/assets/js/205.320db987.js"><link rel="prefetch" href="/assets/js/206.b4488e77.js"><link rel="prefetch" href="/assets/js/207.d5f17556.js"><link rel="prefetch" href="/assets/js/208.37210f86.js"><link rel="prefetch" href="/assets/js/209.786c7af4.js"><link rel="prefetch" href="/assets/js/21.95dcd0d6.js"><link rel="prefetch" href="/assets/js/210.38e58d19.js"><link rel="prefetch" href="/assets/js/211.09b699bb.js"><link rel="prefetch" href="/assets/js/212.ffd8d260.js"><link rel="prefetch" href="/assets/js/213.2891f4a0.js"><link rel="prefetch" href="/assets/js/214.8c1a47e0.js"><link rel="prefetch" href="/assets/js/215.c0dec61f.js"><link rel="prefetch" href="/assets/js/216.c71c59ab.js"><link rel="prefetch" href="/assets/js/217.8891c004.js"><link rel="prefetch" href="/assets/js/218.a2075ffe.js"><link rel="prefetch" href="/assets/js/219.1e70631e.js"><link rel="prefetch" href="/assets/js/22.473284b6.js"><link rel="prefetch" href="/assets/js/220.1d012692.js"><link rel="prefetch" href="/assets/js/221.aa4a0d37.js"><link rel="prefetch" href="/assets/js/222.b512a429.js"><link rel="prefetch" href="/assets/js/223.9e6d42f2.js"><link rel="prefetch" href="/assets/js/224.e46f8d1d.js"><link rel="prefetch" href="/assets/js/225.d8083ae3.js"><link rel="prefetch" href="/assets/js/226.7730bb6a.js"><link rel="prefetch" href="/assets/js/227.3ec46626.js"><link rel="prefetch" href="/assets/js/228.0be929cb.js"><link rel="prefetch" href="/assets/js/229.d8da48e4.js"><link rel="prefetch" href="/assets/js/23.1a1a291a.js"><link rel="prefetch" href="/assets/js/230.f6b2bd82.js"><link rel="prefetch" href="/assets/js/231.c43852a4.js"><link rel="prefetch" href="/assets/js/232.0aa9bd8a.js"><link rel="prefetch" href="/assets/js/233.28899baa.js"><link rel="prefetch" href="/assets/js/234.37a56cac.js"><link rel="prefetch" href="/assets/js/235.57d1f2f2.js"><link rel="prefetch" href="/assets/js/236.10c15500.js"><link rel="prefetch" href="/assets/js/237.8ccfba13.js"><link rel="prefetch" href="/assets/js/238.072cdb99.js"><link rel="prefetch" href="/assets/js/239.a4042ce8.js"><link rel="prefetch" href="/assets/js/24.6f32ee5c.js"><link rel="prefetch" href="/assets/js/240.a4e8f29e.js"><link rel="prefetch" href="/assets/js/241.aec0fdc6.js"><link rel="prefetch" href="/assets/js/242.4e5a95cc.js"><link rel="prefetch" href="/assets/js/243.0ab57bd0.js"><link rel="prefetch" href="/assets/js/244.d5257ed9.js"><link rel="prefetch" href="/assets/js/245.747b1f48.js"><link rel="prefetch" href="/assets/js/246.f89916b2.js"><link rel="prefetch" href="/assets/js/247.9baf4f72.js"><link rel="prefetch" href="/assets/js/248.5878bead.js"><link rel="prefetch" href="/assets/js/249.0153ed9a.js"><link rel="prefetch" href="/assets/js/25.825806eb.js"><link rel="prefetch" href="/assets/js/250.4f47bd06.js"><link rel="prefetch" href="/assets/js/251.2c55f0ac.js"><link rel="prefetch" href="/assets/js/252.3171358b.js"><link rel="prefetch" href="/assets/js/253.3d927b62.js"><link rel="prefetch" href="/assets/js/254.56caa785.js"><link rel="prefetch" href="/assets/js/255.b75a0344.js"><link rel="prefetch" href="/assets/js/256.e449fa3a.js"><link rel="prefetch" href="/assets/js/257.a280fd63.js"><link rel="prefetch" href="/assets/js/258.85cacce2.js"><link rel="prefetch" href="/assets/js/259.220782f3.js"><link rel="prefetch" href="/assets/js/26.c2a73fa1.js"><link rel="prefetch" href="/assets/js/260.4cad83bd.js"><link rel="prefetch" href="/assets/js/261.cc01772f.js"><link rel="prefetch" href="/assets/js/262.31fb9ce0.js"><link rel="prefetch" href="/assets/js/263.95d45d4a.js"><link rel="prefetch" href="/assets/js/264.a23581c9.js"><link rel="prefetch" href="/assets/js/265.f4d45025.js"><link rel="prefetch" href="/assets/js/266.08c29ff3.js"><link rel="prefetch" href="/assets/js/267.f25d5c52.js"><link rel="prefetch" href="/assets/js/268.e4b83b3f.js"><link rel="prefetch" href="/assets/js/269.54e6f5d2.js"><link rel="prefetch" href="/assets/js/27.94b60768.js"><link rel="prefetch" href="/assets/js/270.477bbf01.js"><link rel="prefetch" href="/assets/js/271.eadefaf2.js"><link rel="prefetch" href="/assets/js/272.c77f20a4.js"><link rel="prefetch" href="/assets/js/273.86e57213.js"><link rel="prefetch" href="/assets/js/274.caf08186.js"><link rel="prefetch" href="/assets/js/275.843af577.js"><link rel="prefetch" href="/assets/js/276.bc7dfde0.js"><link rel="prefetch" href="/assets/js/277.a18aa211.js"><link rel="prefetch" href="/assets/js/278.25260976.js"><link rel="prefetch" href="/assets/js/279.0bc329e7.js"><link rel="prefetch" href="/assets/js/28.166f967e.js"><link rel="prefetch" href="/assets/js/280.c7eb5b22.js"><link rel="prefetch" href="/assets/js/281.78d4ed73.js"><link rel="prefetch" href="/assets/js/282.08dbc1ff.js"><link rel="prefetch" href="/assets/js/283.1a8ed58d.js"><link rel="prefetch" href="/assets/js/284.c67e1e75.js"><link rel="prefetch" href="/assets/js/285.6252305a.js"><link rel="prefetch" href="/assets/js/286.5c98afe5.js"><link rel="prefetch" href="/assets/js/287.bd42634c.js"><link rel="prefetch" href="/assets/js/288.1a692f6d.js"><link rel="prefetch" href="/assets/js/289.137dd607.js"><link rel="prefetch" href="/assets/js/29.69647249.js"><link rel="prefetch" href="/assets/js/290.6cb00ec4.js"><link rel="prefetch" href="/assets/js/291.4a6210f6.js"><link rel="prefetch" href="/assets/js/292.dedb1bb4.js"><link rel="prefetch" href="/assets/js/293.6e25fb34.js"><link rel="prefetch" href="/assets/js/294.c7f2e4eb.js"><link rel="prefetch" href="/assets/js/295.76fdbc3b.js"><link rel="prefetch" href="/assets/js/296.48999983.js"><link rel="prefetch" href="/assets/js/297.8d1c640d.js"><link rel="prefetch" href="/assets/js/298.9f5441b7.js"><link rel="prefetch" href="/assets/js/299.150b9208.js"><link rel="prefetch" href="/assets/js/3.461c0085.js"><link rel="prefetch" href="/assets/js/30.defdcb36.js"><link rel="prefetch" href="/assets/js/300.6b9057e3.js"><link rel="prefetch" href="/assets/js/301.74c659b3.js"><link rel="prefetch" href="/assets/js/302.6d8ebf64.js"><link rel="prefetch" href="/assets/js/303.21fe2025.js"><link rel="prefetch" href="/assets/js/304.3c05c7a6.js"><link rel="prefetch" href="/assets/js/305.7c3fb5eb.js"><link rel="prefetch" href="/assets/js/306.c1fa105b.js"><link rel="prefetch" href="/assets/js/307.48a1d678.js"><link rel="prefetch" href="/assets/js/308.4e58779a.js"><link rel="prefetch" href="/assets/js/309.9fac2cdc.js"><link rel="prefetch" href="/assets/js/31.77a45ce0.js"><link rel="prefetch" href="/assets/js/310.3a159c1e.js"><link rel="prefetch" href="/assets/js/311.603f45af.js"><link rel="prefetch" href="/assets/js/312.603c7885.js"><link rel="prefetch" href="/assets/js/313.69be703f.js"><link rel="prefetch" href="/assets/js/314.9054c9ab.js"><link rel="prefetch" href="/assets/js/315.e331ef4b.js"><link rel="prefetch" href="/assets/js/316.1d0a506f.js"><link rel="prefetch" href="/assets/js/317.1b787b88.js"><link rel="prefetch" href="/assets/js/318.86f787b0.js"><link rel="prefetch" href="/assets/js/319.a6921190.js"><link rel="prefetch" href="/assets/js/32.93f3bdf1.js"><link rel="prefetch" href="/assets/js/320.f0c26c43.js"><link rel="prefetch" href="/assets/js/321.a19c9ff4.js"><link rel="prefetch" href="/assets/js/322.01ba6221.js"><link rel="prefetch" href="/assets/js/323.978cd49f.js"><link rel="prefetch" href="/assets/js/324.fe310b5d.js"><link rel="prefetch" href="/assets/js/325.3244bcda.js"><link rel="prefetch" href="/assets/js/326.5c4f01a3.js"><link rel="prefetch" href="/assets/js/327.5db6522f.js"><link rel="prefetch" href="/assets/js/328.e220334a.js"><link rel="prefetch" href="/assets/js/329.df7c545b.js"><link rel="prefetch" href="/assets/js/33.f4982416.js"><link rel="prefetch" href="/assets/js/330.3f9cc52f.js"><link rel="prefetch" href="/assets/js/331.1661ec63.js"><link rel="prefetch" href="/assets/js/332.bdec065c.js"><link rel="prefetch" href="/assets/js/333.b663aa77.js"><link rel="prefetch" href="/assets/js/334.b1f6193f.js"><link rel="prefetch" href="/assets/js/335.cc7fedb2.js"><link rel="prefetch" href="/assets/js/336.35aa2903.js"><link rel="prefetch" href="/assets/js/337.a91aa873.js"><link rel="prefetch" href="/assets/js/338.ae795233.js"><link rel="prefetch" href="/assets/js/339.4582441a.js"><link rel="prefetch" href="/assets/js/34.deb0c8cd.js"><link rel="prefetch" href="/assets/js/340.c9e30c24.js"><link rel="prefetch" href="/assets/js/341.ab8bbf2f.js"><link rel="prefetch" href="/assets/js/342.4dcd40fe.js"><link rel="prefetch" href="/assets/js/343.04aa7b0e.js"><link rel="prefetch" href="/assets/js/344.cf12e221.js"><link rel="prefetch" href="/assets/js/345.851fea37.js"><link rel="prefetch" href="/assets/js/346.cd04ce92.js"><link rel="prefetch" href="/assets/js/347.cc13c5f8.js"><link rel="prefetch" href="/assets/js/348.e8149a34.js"><link rel="prefetch" href="/assets/js/349.8c615125.js"><link rel="prefetch" href="/assets/js/35.946b2b10.js"><link rel="prefetch" href="/assets/js/350.297c9452.js"><link rel="prefetch" href="/assets/js/351.c625eafe.js"><link rel="prefetch" href="/assets/js/352.21fc6d9a.js"><link rel="prefetch" href="/assets/js/353.0918e6c0.js"><link rel="prefetch" href="/assets/js/354.760beca2.js"><link rel="prefetch" href="/assets/js/355.ec756b28.js"><link rel="prefetch" href="/assets/js/356.c41182ab.js"><link rel="prefetch" href="/assets/js/357.3a762703.js"><link rel="prefetch" href="/assets/js/358.2c575e4a.js"><link rel="prefetch" href="/assets/js/359.7ce42976.js"><link rel="prefetch" href="/assets/js/36.22805e5a.js"><link rel="prefetch" href="/assets/js/360.ef9a8667.js"><link rel="prefetch" href="/assets/js/361.1511e3f4.js"><link rel="prefetch" href="/assets/js/362.d5fbab7c.js"><link rel="prefetch" href="/assets/js/363.976be7aa.js"><link rel="prefetch" href="/assets/js/364.1843f42a.js"><link rel="prefetch" href="/assets/js/365.dfde987d.js"><link rel="prefetch" href="/assets/js/366.b87a9cb5.js"><link rel="prefetch" href="/assets/js/367.8ba1f57c.js"><link rel="prefetch" href="/assets/js/368.8b96559b.js"><link rel="prefetch" href="/assets/js/369.2546100c.js"><link rel="prefetch" href="/assets/js/37.3525192b.js"><link rel="prefetch" href="/assets/js/370.4db8b482.js"><link rel="prefetch" href="/assets/js/371.0542b71b.js"><link rel="prefetch" href="/assets/js/372.4c9bde18.js"><link rel="prefetch" href="/assets/js/373.32bcd884.js"><link rel="prefetch" href="/assets/js/374.3793da0b.js"><link rel="prefetch" href="/assets/js/375.8297ec5b.js"><link rel="prefetch" href="/assets/js/376.e346176b.js"><link rel="prefetch" href="/assets/js/377.ac5d8c7f.js"><link rel="prefetch" href="/assets/js/378.e0b84ffc.js"><link rel="prefetch" href="/assets/js/379.663b7fb2.js"><link rel="prefetch" href="/assets/js/38.72fc1973.js"><link rel="prefetch" href="/assets/js/380.01abbbeb.js"><link rel="prefetch" href="/assets/js/381.445e4202.js"><link rel="prefetch" href="/assets/js/382.ff24e162.js"><link rel="prefetch" href="/assets/js/383.c8303f29.js"><link rel="prefetch" href="/assets/js/384.67496581.js"><link rel="prefetch" href="/assets/js/385.e206fb4d.js"><link rel="prefetch" href="/assets/js/386.1e324581.js"><link rel="prefetch" href="/assets/js/387.4b3c734b.js"><link rel="prefetch" href="/assets/js/388.89e3ad82.js"><link rel="prefetch" href="/assets/js/389.814cbc20.js"><link rel="prefetch" href="/assets/js/39.85d65742.js"><link rel="prefetch" href="/assets/js/390.3d2bc4b1.js"><link rel="prefetch" href="/assets/js/391.ad15e5c9.js"><link rel="prefetch" href="/assets/js/392.22ea3d28.js"><link rel="prefetch" href="/assets/js/393.dc925e8e.js"><link rel="prefetch" href="/assets/js/394.f758a517.js"><link rel="prefetch" href="/assets/js/395.bb8c0d77.js"><link rel="prefetch" href="/assets/js/396.8cc3e6cb.js"><link rel="prefetch" href="/assets/js/397.44dba438.js"><link rel="prefetch" href="/assets/js/398.76ebedbb.js"><link rel="prefetch" href="/assets/js/399.a6acb507.js"><link rel="prefetch" href="/assets/js/40.2ef6e1f7.js"><link rel="prefetch" href="/assets/js/400.a6d9d98e.js"><link rel="prefetch" href="/assets/js/401.0715bf66.js"><link rel="prefetch" href="/assets/js/402.fff59a65.js"><link rel="prefetch" href="/assets/js/403.9f58e94a.js"><link rel="prefetch" href="/assets/js/404.4817775f.js"><link rel="prefetch" href="/assets/js/405.1744cc09.js"><link rel="prefetch" href="/assets/js/406.a978bd4c.js"><link rel="prefetch" href="/assets/js/407.4fb1ac88.js"><link rel="prefetch" href="/assets/js/408.f1bb0f31.js"><link rel="prefetch" href="/assets/js/409.942c7d40.js"><link rel="prefetch" href="/assets/js/41.a4f19bba.js"><link rel="prefetch" href="/assets/js/410.66f0918b.js"><link rel="prefetch" href="/assets/js/411.6a5436f5.js"><link rel="prefetch" href="/assets/js/412.ec974a04.js"><link rel="prefetch" href="/assets/js/413.ba4fd119.js"><link rel="prefetch" href="/assets/js/414.55e59bef.js"><link rel="prefetch" href="/assets/js/415.412201ca.js"><link rel="prefetch" href="/assets/js/416.4b4ba217.js"><link rel="prefetch" href="/assets/js/417.a65d2f1b.js"><link rel="prefetch" href="/assets/js/418.bf142c63.js"><link rel="prefetch" href="/assets/js/419.65b0f04d.js"><link rel="prefetch" href="/assets/js/42.7f2b0b0f.js"><link rel="prefetch" href="/assets/js/420.ab0f7606.js"><link rel="prefetch" href="/assets/js/421.d9d2dc13.js"><link rel="prefetch" href="/assets/js/422.093a8290.js"><link rel="prefetch" href="/assets/js/423.041fc7be.js"><link rel="prefetch" href="/assets/js/424.410b1a8f.js"><link rel="prefetch" href="/assets/js/425.661237bb.js"><link rel="prefetch" href="/assets/js/426.c01ca04f.js"><link rel="prefetch" href="/assets/js/427.af6802e0.js"><link rel="prefetch" href="/assets/js/428.e255a9c4.js"><link rel="prefetch" href="/assets/js/429.3f62c79c.js"><link rel="prefetch" href="/assets/js/43.96eb08e4.js"><link rel="prefetch" href="/assets/js/430.86f8cd5f.js"><link rel="prefetch" href="/assets/js/431.89f717cb.js"><link rel="prefetch" href="/assets/js/432.606f5381.js"><link rel="prefetch" href="/assets/js/433.e2a7c92d.js"><link rel="prefetch" href="/assets/js/434.375d2ee0.js"><link rel="prefetch" href="/assets/js/435.10ac30b9.js"><link rel="prefetch" href="/assets/js/436.dfadd161.js"><link rel="prefetch" href="/assets/js/437.f92a1705.js"><link rel="prefetch" href="/assets/js/438.a924c254.js"><link rel="prefetch" href="/assets/js/439.6a8f7f89.js"><link rel="prefetch" href="/assets/js/44.af0f503b.js"><link rel="prefetch" href="/assets/js/440.6f41f087.js"><link rel="prefetch" href="/assets/js/441.296b6711.js"><link rel="prefetch" href="/assets/js/442.e82e2313.js"><link rel="prefetch" href="/assets/js/443.c46b8b7c.js"><link rel="prefetch" href="/assets/js/444.850b3f10.js"><link rel="prefetch" href="/assets/js/445.70fafa08.js"><link rel="prefetch" href="/assets/js/446.c2fd23e4.js"><link rel="prefetch" href="/assets/js/447.fac66885.js"><link rel="prefetch" href="/assets/js/448.5c8074d5.js"><link rel="prefetch" href="/assets/js/449.25db27ca.js"><link rel="prefetch" href="/assets/js/45.19ecb85c.js"><link rel="prefetch" href="/assets/js/450.8bc58614.js"><link rel="prefetch" href="/assets/js/451.69e35a33.js"><link rel="prefetch" href="/assets/js/452.a129daf9.js"><link rel="prefetch" href="/assets/js/453.4f696672.js"><link rel="prefetch" href="/assets/js/454.e2a1b328.js"><link rel="prefetch" href="/assets/js/455.b7037708.js"><link rel="prefetch" href="/assets/js/456.eda2adc0.js"><link rel="prefetch" href="/assets/js/457.5f0d7722.js"><link rel="prefetch" href="/assets/js/458.effcb970.js"><link rel="prefetch" href="/assets/js/459.48baddfb.js"><link rel="prefetch" href="/assets/js/46.88cbca22.js"><link rel="prefetch" href="/assets/js/460.c50fe2c5.js"><link rel="prefetch" href="/assets/js/461.55293f7a.js"><link rel="prefetch" href="/assets/js/462.682315f0.js"><link rel="prefetch" href="/assets/js/463.f4278aae.js"><link rel="prefetch" href="/assets/js/464.f140b938.js"><link rel="prefetch" href="/assets/js/465.392a08f4.js"><link rel="prefetch" href="/assets/js/466.90a32c46.js"><link rel="prefetch" href="/assets/js/467.d795bc61.js"><link rel="prefetch" href="/assets/js/468.6e663011.js"><link rel="prefetch" href="/assets/js/469.b7bffde5.js"><link rel="prefetch" href="/assets/js/47.7e31de19.js"><link rel="prefetch" href="/assets/js/470.388beea3.js"><link rel="prefetch" href="/assets/js/471.6ca5dbe5.js"><link rel="prefetch" href="/assets/js/472.9bc4c0a6.js"><link rel="prefetch" href="/assets/js/473.fd427e29.js"><link rel="prefetch" href="/assets/js/474.862fc10a.js"><link rel="prefetch" href="/assets/js/475.6e3893de.js"><link rel="prefetch" href="/assets/js/476.0f32dc93.js"><link rel="prefetch" href="/assets/js/477.8cb145a5.js"><link rel="prefetch" href="/assets/js/478.65a09f13.js"><link rel="prefetch" href="/assets/js/479.bee3f754.js"><link rel="prefetch" href="/assets/js/48.ca956f8d.js"><link rel="prefetch" href="/assets/js/480.f59f88af.js"><link rel="prefetch" href="/assets/js/481.8c5e02e6.js"><link rel="prefetch" href="/assets/js/482.7988ca13.js"><link rel="prefetch" href="/assets/js/483.6d1e171c.js"><link rel="prefetch" href="/assets/js/484.b3f3a54b.js"><link rel="prefetch" href="/assets/js/485.e97a72d8.js"><link rel="prefetch" href="/assets/js/49.4cf4b45c.js"><link rel="prefetch" href="/assets/js/50.9fdb4f1e.js"><link rel="prefetch" href="/assets/js/51.88f75159.js"><link rel="prefetch" href="/assets/js/52.1c372af0.js"><link rel="prefetch" href="/assets/js/53.e0e13d9a.js"><link rel="prefetch" href="/assets/js/54.231f6505.js"><link rel="prefetch" href="/assets/js/55.52b04941.js"><link rel="prefetch" href="/assets/js/56.91345e86.js"><link rel="prefetch" href="/assets/js/58.6fb2ccb6.js"><link rel="prefetch" href="/assets/js/59.cb26cb6a.js"><link rel="prefetch" href="/assets/js/60.a5fc202b.js"><link rel="prefetch" href="/assets/js/61.0facb3f9.js"><link rel="prefetch" href="/assets/js/62.d00be571.js"><link rel="prefetch" href="/assets/js/63.d66d194b.js"><link rel="prefetch" href="/assets/js/64.4b34837d.js"><link rel="prefetch" href="/assets/js/65.c5eca227.js"><link rel="prefetch" href="/assets/js/66.f3bb4baa.js"><link rel="prefetch" href="/assets/js/67.4fbce724.js"><link rel="prefetch" href="/assets/js/68.39780014.js"><link rel="prefetch" href="/assets/js/69.523952df.js"><link rel="prefetch" href="/assets/js/7.d893eec0.js"><link rel="prefetch" href="/assets/js/70.33f89cfa.js"><link rel="prefetch" href="/assets/js/71.6b329e8e.js"><link rel="prefetch" href="/assets/js/72.90caac3a.js"><link rel="prefetch" href="/assets/js/73.2b7012a1.js"><link rel="prefetch" href="/assets/js/74.0076f1ec.js"><link rel="prefetch" href="/assets/js/75.1cbaf5cf.js"><link rel="prefetch" href="/assets/js/76.2461a9e9.js"><link rel="prefetch" href="/assets/js/77.be9e1732.js"><link rel="prefetch" href="/assets/js/78.a4825263.js"><link rel="prefetch" href="/assets/js/79.95c5e105.js"><link rel="prefetch" href="/assets/js/8.acf971e3.js"><link rel="prefetch" href="/assets/js/80.1a7c44e2.js"><link rel="prefetch" href="/assets/js/81.38ee2ba4.js"><link rel="prefetch" href="/assets/js/82.78220668.js"><link rel="prefetch" href="/assets/js/83.3dfead3b.js"><link rel="prefetch" href="/assets/js/84.7f1f743d.js"><link rel="prefetch" href="/assets/js/85.ab59a697.js"><link rel="prefetch" href="/assets/js/86.1888a97f.js"><link rel="prefetch" href="/assets/js/87.149a705f.js"><link rel="prefetch" href="/assets/js/88.8a53e92d.js"><link rel="prefetch" href="/assets/js/89.a68dd87b.js"><link rel="prefetch" href="/assets/js/9.c38b654d.js"><link rel="prefetch" href="/assets/js/90.c70af23c.js"><link rel="prefetch" href="/assets/js/91.58de9211.js"><link rel="prefetch" href="/assets/js/92.697a7ada.js"><link rel="prefetch" href="/assets/js/93.2a27830a.js"><link rel="prefetch" href="/assets/js/94.20be84f6.js"><link rel="prefetch" href="/assets/js/95.bc2120e0.js"><link rel="prefetch" href="/assets/js/96.5b3aa395.js"><link rel="prefetch" href="/assets/js/97.c4a15008.js"><link rel="prefetch" href="/assets/js/98.3e47fdce.js"><link rel="prefetch" href="/assets/js/99.4b101d54.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b8eeafc3.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Cactusli blog" class="logo"> <span class="site-name can-hide">Cactusli blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/Java/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java Study</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/Java/" class="nav-link">Java 基础</a></li><li class="dropdown-subitem"><a href="/note/design-pattern/" class="nav-link">Java 版设计模式</a></li></ul></li><li class="dropdown-item"><h4>阅读源码系列</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/32e50d/" class="nav-link">Spring Boot</a></li><li class="dropdown-subitem"><a href="/pages/d065c4/" class="nav-link">Netty</a></li><li class="dropdown-subitem"><a href="/pages/4d3c7f/" class="nav-link">Dubbo</a></li><li class="dropdown-subitem"><a href="/pages/920e2b/" class="nav-link">搭建rpc框架</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/SpringBoot/" class="nav-link">《SpringBoot教程》</a></li><li class="dropdown-subitem"><a href="/note/Docker/" class="nav-link">《Docker教程》</a></li><li class="dropdown-subitem"><a href="/note/Kubernetes/" class="nav-link">《Kubernetes教程》</a></li><li class="dropdown-subitem"><a href="/note/SpringCloud-febs/" class="nav-link">《SpringCloud微服务权限系统搭建》</a></li><li class="dropdown-subitem"><a href="/note/Netty/" class="nav-link">《Netty教程》</a></li><li class="dropdown-subitem"><a href="/note/Gateway/" class="nav-link">《API网关设计与实践》</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li><li class="dropdown-item"><h4>页面</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="手册" class="dropdown-title"><a href="/manual/" class="link-title">手册</a> <span class="title" style="display:none;">手册</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/d2639c/" aria-current="page" class="nav-link router-link-exact-active router-link-active">环境配置</a></li><li class="dropdown-item"><!----> <a href="/pages/39e2a1/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">手册记录</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://firework.cloudflaress.eu.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  看烟花
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/706328/" class="nav-link">英语学习</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/lixuanfengs/cactus-vuepress-sc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.statically.io/gh/lixuanfengs/blog-images/master/cactus-blogs/avatar3.gif"> <div class="blogger-info"><h3>Xuan Feng Li</h3> <span>学习老黄牛精神！</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/Java/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java Study</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/Java/" class="nav-link">Java 基础</a></li><li class="dropdown-subitem"><a href="/note/design-pattern/" class="nav-link">Java 版设计模式</a></li></ul></li><li class="dropdown-item"><h4>阅读源码系列</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/32e50d/" class="nav-link">Spring Boot</a></li><li class="dropdown-subitem"><a href="/pages/d065c4/" class="nav-link">Netty</a></li><li class="dropdown-subitem"><a href="/pages/4d3c7f/" class="nav-link">Dubbo</a></li><li class="dropdown-subitem"><a href="/pages/920e2b/" class="nav-link">搭建rpc框架</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/SpringBoot/" class="nav-link">《SpringBoot教程》</a></li><li class="dropdown-subitem"><a href="/note/Docker/" class="nav-link">《Docker教程》</a></li><li class="dropdown-subitem"><a href="/note/Kubernetes/" class="nav-link">《Kubernetes教程》</a></li><li class="dropdown-subitem"><a href="/note/SpringCloud-febs/" class="nav-link">《SpringCloud微服务权限系统搭建》</a></li><li class="dropdown-subitem"><a href="/note/Netty/" class="nav-link">《Netty教程》</a></li><li class="dropdown-subitem"><a href="/note/Gateway/" class="nav-link">《API网关设计与实践》</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li><li class="dropdown-item"><h4>页面</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="手册" class="dropdown-title"><a href="/manual/" class="link-title">手册</a> <span class="title" style="display:none;">手册</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/d2639c/" aria-current="page" class="nav-link router-link-exact-active router-link-active">环境配置</a></li><li class="dropdown-item"><!----> <a href="/pages/39e2a1/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">手册记录</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://firework.cloudflaress.eu.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  看烟花
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/706328/" class="nav-link">英语学习</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/lixuanfengs/cactus-vuepress-sc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>开发环境配置</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/d2639c/" aria-current="page" class="active sidebar-link">负载均衡和web服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/d2639c/#tomcat安装与使用" class="sidebar-link">tomcat安装与使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d2639c/#安装jdk" class="sidebar-link">安装jdk</a></li><li class="sidebar-sub-header level3"><a href="/pages/d2639c/#安装tomcat" class="sidebar-link">安装tomcat</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#解压源码包" class="sidebar-link">解压源码包</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#设置用户和组" class="sidebar-link">设置用户和组</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#编辑启动脚本" class="sidebar-link">编辑启动脚本</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#启动tomcat" class="sidebar-link">启动tomcat</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#查看tomcat-状态" class="sidebar-link">查看tomcat 状态</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#查看tomcat监听端口" class="sidebar-link">查看tomcat监听端口</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#目录结构" class="sidebar-link">目录结构</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#配置文件" class="sidebar-link">配置文件</a></li><li class="sidebar-sub-header level3"><a href="/pages/d2639c/#应用部署" class="sidebar-link">应用部署</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#根目录" class="sidebar-link">根目录</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#jsp-webapp目录结构" class="sidebar-link">JSP WebApp目录结构</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#webapp归档格式" class="sidebar-link">webapp归档格式</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#部署deploy" class="sidebar-link">部署Deploy</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#配置详解" class="sidebar-link">配置详解</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#用户认证" class="sidebar-link">用户认证</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#虚拟主机配置" class="sidebar-link">虚拟主机配置</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#context配置" class="sidebar-link">Context配置</a></li><li class="sidebar-sub-header level3"><a href="/pages/d2639c/#nginx-tomcat-实践" class="sidebar-link">Nginx+tomcat 实践</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#动静分离" class="sidebar-link">动静分离</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d2639c/#nginx基础" class="sidebar-link">Nginx基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d2639c/#nginx功能介绍" class="sidebar-link">Nginx功能介绍</a></li><li class="sidebar-sub-header level3"><a href="/pages/d2639c/#基础特性" class="sidebar-link">基础特性</a></li><li class="sidebar-sub-header level3"><a href="/pages/d2639c/#和web服务相关的功能" class="sidebar-link">和web服务相关的功能</a></li><li class="sidebar-sub-header level3"><a href="/pages/d2639c/#nginx组织结构" class="sidebar-link">Nginx组织结构</a></li><li class="sidebar-sub-header level3"><a href="/pages/d2639c/#nginx模块介绍" class="sidebar-link">Nginx模块介绍</a></li><li class="sidebar-sub-header level3"><a href="/pages/d2639c/#模块分类" class="sidebar-link">模块分类</a></li><li class="sidebar-sub-header level3"><a href="/pages/d2639c/#nginx安装" class="sidebar-link">Nginx安装</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#开始安装" class="sidebar-link">开始安装</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#编译安装" class="sidebar-link">编译安装</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#编辑nginx启动脚本" class="sidebar-link">编辑nginx启动脚本</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#默认配置文件" class="sidebar-link">默认配置文件</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#核心配置" class="sidebar-link">核心配置</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#http详细配置" class="sidebar-link">http详细配置</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#核心配置示例" class="sidebar-link">核心配置示例</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#新建一个pc-web站点" class="sidebar-link">新建一个PC web站点</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#新建一个mobile-web站点" class="sidebar-link">新建⼀个Mobile web站点</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#静态资源配置" class="sidebar-link">静态资源配置</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#访问测试" class="sidebar-link">访问测试</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#root与alias" class="sidebar-link">root与alias</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#location的使用" class="sidebar-link">location的使用</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#精确匹配" class="sidebar-link">精确匹配</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#匹配大小写" class="sidebar-link">匹配大小写</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#不区分大小写" class="sidebar-link">不区分大小写</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#匹配开头" class="sidebar-link">匹配开头</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#匹配文件后缀名" class="sidebar-link">匹配文件后缀名</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#生产使用案例" class="sidebar-link">生产使用案例</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#访问控制" class="sidebar-link">访问控制</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#自定义错误界面" class="sidebar-link">自定义错误界面</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#自定义访问日志" class="sidebar-link">自定义访问日志</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#检测文件是否存在" class="sidebar-link">检测文件是否存在</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#长连接配置" class="sidebar-link">长连接配置</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#下载服务器配置" class="sidebar-link">下载服务器配置</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#作为上传服务器" class="sidebar-link">作为上传服务器</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#隐藏nginx版本" class="sidebar-link">隐藏Nginx版本</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#nginx高级配置" class="sidebar-link">Nginx高级配置</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#nginx状态页" class="sidebar-link">Nginx状态页</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#状态页详细信息说明" class="sidebar-link">状态页详细信息说明</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#nginx第三方模块" class="sidebar-link">Nginx第三方模块</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#nginx变量使用" class="sidebar-link">Nginx变量使用</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#自定义变量" class="sidebar-link">自定义变量</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#nginx-自定义访问日志" class="sidebar-link">Nginx ⾃定义访问⽇志</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#nginx压缩功能" class="sidebar-link">Nginx压缩功能</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#关于favicon-ico" class="sidebar-link">关于favicon.ico</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#隐藏nginx版本号" class="sidebar-link">隐藏Nginx版本号</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#升级openssl版本" class="sidebar-link">升级OpenSSL版本</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#rewrite相关功能" class="sidebar-link">Rewrite相关功能</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#if指令" class="sidebar-link">if指令</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#rewrite-flflag使用介绍" class="sidebar-link">rewrite flflag使⽤介绍</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#域名永久与临时重定向" class="sidebar-link">域名永久与临时重定向</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#rewrite案例-brak" class="sidebar-link">rewrite案例--brak</a></li><li class="sidebar-sub-header level4"><a href="/pages/d2639c/#nginx反向代理" class="sidebar-link">Nginx反向代理</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#实现http反向代理" class="sidebar-link">实现http反向代理</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#反向代理缓存功能" class="sidebar-link">反向代理缓存功能</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#非缓存场景压测" class="sidebar-link">非缓存场景压测</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#准备缓存配置" class="sidebar-link">准备缓存配置</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#添加头部报文信息" class="sidebar-link">添加头部报文信息</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#http-upstream配置参数" class="sidebar-link">http upstream配置参数</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#负载均衡实例-mysql" class="sidebar-link">负载均衡实例：MySQL</a></li><li class="sidebar-sub-header level5"><a href="/pages/d2639c/#系统参数优化" class="sidebar-link">系统参数优化</a></li></ul></li></ul></li><li><a href="/pages/d9927e/" class="sidebar-link">keepalibved安装与使用</a></li><li><a href="/pages/4e44e7/" class="sidebar-link">redis安装部署</a></li><li><a href="/pages/deb0c4/" class="sidebar-link">zookeeper-centos7安装使用</a></li><li><a href="/pages/d2862a/" class="sidebar-link">RabbitMQ学习</a></li><li><a href="/pages/7d1629/" class="sidebar-link">KeepAlived搭建MySQL双主</a></li><li><a href="/pages/75b405/" class="sidebar-link">sql语句的学习</a></li><li><a href="/pages/32abc1/" class="sidebar-link">MySQL8.0主从配置</a></li><li><a href="/pages/95874c/" class="sidebar-link">K8S基础入门</a></li><li><a href="/pages/10a196/" class="sidebar-link">k8s基础命令</a></li><li><a href="/pages/680317/" class="sidebar-link">Kubeadm安装k8s集群</a></li><li><a href="/pages/e6e664/" class="sidebar-link">二进制高可用安装k8集群</a></li><li><a href="/pages/cf68cc/" class="sidebar-link">rancher搭建k8s 集群</a></li><li><a href="/pages/93c7a0/" class="sidebar-link">Oracle 12c安装</a></li><li><a href="/pages/6d00ed/" class="sidebar-link">Jenkins+gitlab持续集成学习</a></li><li><a href="/pages/528e32/" class="sidebar-link">CloudFlare Argo Tunnel免费内网穿透</a></li><li><a href="/pages/8ff689/" class="sidebar-link">Linux使用WireGuard来创建内网</a></li><li><a href="/pages/830e28/" class="sidebar-link">利用Cloudflare Zero Trust创建大内网</a></li><li><a href="/pages/a51cd8/" class="sidebar-link">Docker 相关的 Shell</a></li><li><a href="/pages/c7703f/" class="sidebar-link">VM虚拟机Ubuntu 20.04 LVM磁盘扩容</a></li><li><a href="/pages/118ac7/" class="sidebar-link">深圳仪器平台-开发手册记录</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GitHub技巧</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>博客搭建</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>手册记录</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/manual/#手册" data-v-06225672>手册</a></li><li data-v-06225672><a href="/manual/#开发环境配置" data-v-06225672>开发环境配置</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/lixuanfengs" target="_blank" title="作者" class="beLink" data-v-06225672>cactusli</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-07-19</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><!---->负载均衡和web服务<!----></h1>  <div class="theme-vdoing-content content__default"><h2 id="tomcat安装与使用"><a href="#tomcat安装与使用" class="header-anchor">#</a> tomcat安装与使用</h2> <h3 id="安装jdk"><a href="#安装jdk" class="header-anchor">#</a> 安装jdk</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:~<span class="token comment"># tar xf jdk-8u221-linux-x64.tar.gz -C /usr/local/</span>
root@ubuntu1:~<span class="token comment"># ll /usr/local/jdk1.8.0_221/</span>
<span class="token comment"># 编辑环境变量</span>
root@ubuntu1:~<span class="token comment"># vim /etc/profile.d/jdk.sh</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/local/jdk1.8.0_221/
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token environment constant">$PATH</span>
<span class="token comment"># 使环境变量生效</span>
root@ubuntu1:~<span class="token comment"># . /etc/profile.d/jdk.sh</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 验证jdk是否安装完成</span>
root@ubuntu1:~<span class="token comment"># java -version</span>
<span class="token function">java</span> version <span class="token string">&quot;1.8.0_221&quot;</span>
Java<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> SE Runtime Environment <span class="token punctuation">(</span>build <span class="token number">1.8</span>.0_221-b11<span class="token punctuation">)</span>
Java HotSpot<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> <span class="token number">64</span>-Bit Server VM <span class="token punctuation">(</span>build <span class="token number">25.221</span>-b11, mixed mode<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="安装tomcat"><a href="#安装tomcat" class="header-anchor">#</a> 安装tomcat</h3> <h4 id="解压源码包"><a href="#解压源码包" class="header-anchor">#</a> 解压源码包</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:~<span class="token comment"># tar xf apache-tomcat-8.5.42.tar.gz  -C /usr/local/</span>
root@ubuntu1:~<span class="token comment"># cd /usr/local/</span>
root@ubuntu1:/usr/local<span class="token comment"># ln -sv apache-tomcat-8.5.42/  tomcat</span>
<span class="token string">'tomcat'</span> -<span class="token operator">&gt;</span> <span class="token string">'apache-tomcat-8.5.42/'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="设置用户和组"><a href="#设置用户和组" class="header-anchor">#</a> 设置用户和组</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:/usr/local<span class="token comment"># sudo useradd -m -U -d /opt/tomcat -s /bin/false tomcat</span>
root@ubuntu1:/usr/local/tomcat<span class="token comment"># chown -R tomcat /usr/local/tomcat/*</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 赋予 bin 目录中的脚本可执行权限</span>
root@ubuntu1:/usr/local/tomcat<span class="token comment">#  sudo sh -c 'chmod +x  /usr/local/tomcat/bin/*.sh'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="编辑启动脚本"><a href="#编辑启动脚本" class="header-anchor">#</a> 编辑启动脚本</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:~<span class="token comment"># cat  /etc/systemd/system/tomcat.service</span>
<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>Tomcat <span class="token number">8.5</span> servlet container
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>forking

<span class="token assign-left variable">User</span><span class="token operator">=</span>tomcat
<span class="token assign-left variable">Group</span><span class="token operator">=</span>tomcat

<span class="token assign-left variable">Environment</span><span class="token operator">=</span><span class="token string">&quot;JAVA_HOME=/usr/local/jdk1.8.0_221/&quot;</span>

<span class="token assign-left variable">Environment</span><span class="token operator">=</span><span class="token string">&quot;CATALINA_BASE=/usr/local/tomcat&quot;</span>
<span class="token assign-left variable">Environment</span><span class="token operator">=</span><span class="token string">&quot;CATALINA_HOME=/usr/local/tomcat&quot;</span>
<span class="token assign-left variable">Environment</span><span class="token operator">=</span><span class="token string">&quot;CATALINA_PID=/usr/local/tomcat/temp/tomcat.pid&quot;</span>
<span class="token assign-left variable">Environment</span><span class="token operator">=</span><span class="token string">&quot;CATALINA_OPTS=-Xms512M -Xmx1024M -server -XX:+UseParallelGC&quot;</span>

<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/local/tomcat/bin/startup.sh
<span class="token assign-left variable">ExecStop</span><span class="token operator">=</span>/usr/local/tomcat/bin/shutdown.sh

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="启动tomcat"><a href="#启动tomcat" class="header-anchor">#</a> 启动tomcat</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:~<span class="token comment"># sudo systemctl daemon-reload</span>
root@ubuntu1:~<span class="token comment"># sudo systemctl start tomcat</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="查看tomcat-状态"><a href="#查看tomcat-状态" class="header-anchor">#</a> 查看tomcat 状态</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:~<span class="token comment"># systemctl status tomcat</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="查看tomcat监听端口"><a href="#查看tomcat监听端口" class="header-anchor">#</a> 查看tomcat监听端口</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:~<span class="token comment"># ss -ntl</span>
LISTEN                  <span class="token number">0</span>                        <span class="token number">100</span>                                                          *:8080                                                  *:*
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="目录结构"><a href="#目录结构" class="header-anchor">#</a> 目录结构</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">1</span>、bin:服务启动、停止等相关
<span class="token number">2</span>、conf:配置文件
<span class="token number">3</span>、lib:库目录
<span class="token number">4</span>、logs:日志目录
<span class="token number">5</span>、webapps:应用程序,应用部署目录
<span class="token number">6</span>、work:jsp编译后的结果文件
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">1</span>、server.xml:主配置文件
<span class="token number">2</span>、web.xml:每个webapp只有“部署”后才能被访问，它的部署方式通常由web.xml进行定义，其存放位置为WEB-INF/目录中；此文件为所有的webapps提供
默认部署相关的配置
<span class="token number">3</span>、context.xml:每个webapp都可以专用的配置文件，它通常由专用的配置文件context.xml来定义，其存放位置为WEB-INF/目录中；此文件为所有的
webapps提供默认配置
<span class="token number">4</span>、tomcat-users.xml:用户认证的账号和密码文件
<span class="token number">5</span>、catalina.policy:当使用-security选项启动tomcat时，用于为tomcat设置安全策略
<span class="token number">6</span>、catalina.properties:Java属性的定义文件，用于设定类加载器路径，以及一些与JVM调优相关参数
<span class="token number">7</span>、logging.properties:日志系统相关的配置
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="应用部署"><a href="#应用部署" class="header-anchor">#</a> 应用部署</h3> <h4 id="根目录"><a href="#根目录" class="header-anchor">#</a> 根目录</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">1</span>、Tomcat中默认网站根目录是CATALINA_BASE/webapps/
<span class="token number">2</span>、在Tomcat中部署主站应用程序和其他应用程序，和之前WEB服务程序不同
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>nginx 
假设在nginx中部署2个网站应用eshop、bbs，假设网站根目录是/var/www/html，那么部署可以是这样的。
eshop解压缩所有文件放到/var/www/html/目录下。
bbs的文件放在/var/www/html/bbs下。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>Tomcat
Tomcat中默认网站根目录是CATALINA_BASE/webapps/
在Tomcat的webapps目录中，有个非常特殊的目录ROOT，它就是网站默认根目录。
将eshop解压后的文件放到这个ROOT中
bbs解压后文件都放在CATALINA_BASE/webapps/bbs目录下
每一个虚拟主机的目录都可以使用appBase配置自己的站点目录，里面都可以使用ROOT目录作为主站目录。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="jsp-webapp目录结构"><a href="#jsp-webapp目录结构" class="header-anchor">#</a> JSP WebApp目录结构</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>主页配置：一般指定为index.jsp或index.html
WEB-INF/：当前WebApp的私有资源路径，通常存储当前应用使用的web.xml和context.xml配置文件
META-INF/：类似于WEB-INF
classes/：类文件，当前webapp需要的类
lib/：当前应用依赖的jar包
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="webapp归档格式"><a href="#webapp归档格式" class="header-anchor">#</a> <strong>webapp</strong>归档格式</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>.war：WebApp打包
.jar：EJB类打包文件
.rar：资源适配器类打包文件
.ear：企业级WebApp打包
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>传统应用开发测试后，通常打包为war格式，这种文件部署到了Tomcat的webapps下，还可以自动展开。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token operator">&lt;</span>Host <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;localhost&quot;</span> <span class="token assign-left variable">appBase</span><span class="token operator">=</span><span class="token string">&quot;webapps&quot;</span> <span class="token assign-left variable">unpackWARs</span><span class="token operator">=</span><span class="token string">&quot;true&quot;</span> <span class="token assign-left variable">autoDeploy</span><span class="token operator">=</span><span class="token string">&quot;true&quot;</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="部署deploy"><a href="#部署deploy" class="header-anchor">#</a> <strong>部署</strong>Deploy</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">1</span>、部署：将webapp的源文件放置到目标目录，通过web.xml和context.xml文件中配置的路径就可以访问该webapp，通过类加载器加载其特有的类和依赖的类到JVM上。
<span class="token number">2</span>、自动部署Auto Deploy：Tomcat发现多了这个应用就把它加载并启动起来
<span class="token number">3</span>、手动部署
	<span class="token number">1</span>、冷部署：将webapp放到指定目录，才去启动Tomcat
	<span class="token number">2</span>、热部署：Tomcat服务不停止，需要依赖manager、ant脚本、tcd（tomcat client 
deployer）等工具
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:/usr/local/tomcat/webapps/ROOT<span class="token comment"># cat test.jsp</span>
<span class="token operator">&lt;</span>%@ page <span class="token assign-left variable">language</span><span class="token operator">=</span><span class="token string">&quot;java&quot;</span> <span class="token assign-left variable">contentType</span><span class="token operator">=</span><span class="token string">&quot;text/html; charset=UTF-8&quot;</span>
 <span class="token assign-left variable">pageEncoding</span><span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span>%<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
                  <span class="token operator">&lt;</span>meta <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token operator">&gt;</span>
                   <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>jsp例子<span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
                 后面的内容是服务器端动态生成字符串，最后拼接在一起
                 <span class="token operator">&lt;</span>%
                 out.println<span class="token punctuation">(</span><span class="token string">&quot;hello jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 %<span class="token operator">&gt;</span>
                 %<span class="token operator">&lt;</span>br<span class="token operator">&gt;</span>
                 %<span class="token operator">&lt;</span>%<span class="token operator">=</span>request.getRequestURL<span class="token punctuation">(</span><span class="token punctuation">)</span>%<span class="token operator">&gt;</span>
                 %<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
         %<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 测试访问</span>
http://10.2.32.10:8080/test.jsp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 模拟部署一个应用</span>
root@ubuntu1:/usr/local/tomcat/webapps<span class="token comment"># mkdir myapp</span>
root@ubuntu1:/usr/local/tomcat/webapps<span class="token comment"># cp ROOT/test.jsp  myapp/index.jsp</span>
<span class="token comment"># 测试访问</span>
http://10.2.32.10:8080/myapp/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="配置详解"><a href="#配置详解" class="header-anchor">#</a> 配置详解</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 8005是Tomcat的管理端口，默认监听在127.0.0.1上。SHUTDOWN这个字符串接收到后就会关闭此Server。</span>
root@ubuntu1:/usr/local/tomcat/conf<span class="token comment"># vim server.xml</span>
<span class="token operator">&lt;</span>Server <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token string">&quot;8005&quot;</span> <span class="token assign-left variable">shutdown</span><span class="token operator">=</span><span class="token string">&quot;SHUTDOWN&quot;</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:/usr/local/tomcat/conf<span class="token comment"># vim server.xml</span>
<span class="token comment"># 这个管理功能建议禁用，改shutdown为一串猜不出的字符串    shutdown后面是md5值加密</span>
<span class="token operator">&lt;</span>Server <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token string">&quot;-1&quot;</span> <span class="token assign-left variable">shutdown</span><span class="token operator">=</span><span class="token string">&quot;fa7cda24e4e94031fb70956edfdfb33a&quot;</span><span class="token operator">&gt;</span>
<span class="token comment"># 这样改就不慌有人恶作剧了</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="用户认证"><a href="#用户认证" class="header-anchor">#</a> 用户认证</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 修改配置文件</span>
root@ubuntu1:/usr/local/tomcat/conf<span class="token comment"># vim tomcat-users.xml</span>
<span class="token operator">&lt;</span>tomcat-users <span class="token assign-left variable">xmlns</span><span class="token operator">=</span><span class="token string">&quot;http://tomcat.apache.org/xml&quot;</span>
              xmlns:xsi<span class="token operator">=</span><span class="token string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
              xsi:schemaLocation<span class="token operator">=</span><span class="token string">&quot;http://tomcat.apache.org/xml tomcat-users.xsd&quot;</span>
              <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>role <span class="token assign-left variable">rolename</span><span class="token operator">=</span><span class="token string">&quot;manager-gui&quot;</span>/<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>role <span class="token assign-left variable">rolename</span><span class="token operator">=</span><span class="token string">&quot;admin-gui&quot;</span>/<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>user <span class="token assign-left variable">username</span><span class="token operator">=</span><span class="token string">&quot;wayne&quot;</span> <span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">&quot;wayne&quot;</span> <span class="token assign-left variable">roles</span><span class="token operator">=</span><span class="token string">&quot;manager-gui,admin-gui&quot;</span>/<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/tomcat-users<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 配置白名单   本地用户访问</span>
root@ubuntu1:/usr/local/tomcat/webapps/manager/META-INF<span class="token comment"># vim context.xml</span>
<span class="token operator">&lt;</span>Valve <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">&quot;org.apache.catalina.valves.RemoteAddrValve&quot;</span>
         <span class="token assign-left variable">allow</span><span class="token operator">=</span><span class="token string">&quot;^.*$&quot;</span> /<span class="token operator">&gt;</span>
 root@ubuntu1:/usr/local/tomcat/webapps/host-manager/META-INF<span class="token comment"># vim context.xml </span>
 <span class="token comment"># 虚拟主机</span>
 <span class="token operator">&lt;</span>Valve <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">&quot;org.apache.catalina.valves.RemoteAddrValve&quot;</span>
         <span class="token assign-left variable">allow</span><span class="token operator">=</span><span class="token string">&quot;^.*$&quot;</span> /<span class="token operator">&gt;</span>         
 <span class="token comment"># 重启tomcat        </span>
 root@ubuntu1:/usr/local/tomcat/webapps/manager/META-INF<span class="token comment"># systemctl restart tomcat</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 测试访问    账号:wayne 密码:wayne</span>
http://10.2.32.10:8080/manager/html
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="虚拟主机配置"><a href="#虚拟主机配置" class="header-anchor">#</a> 虚拟主机配置</h4> <p>defaultHost指向内部定义某虚拟主机。缺省虚拟主机可以改动，默认localhost</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token operator">&lt;</span>Host <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;localhost&quot;</span> <span class="token assign-left variable">appBase</span><span class="token operator">=</span><span class="token string">&quot;webapps&quot;</span> <span class="token assign-left variable">unpackWARs</span><span class="token operator">=</span><span class="token string">&quot;true&quot;</span> <span class="token assign-left variable">autoDeploy</span><span class="token operator">=</span><span class="token string">&quot;true&quot;</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>虚拟主机配置：
<span class="token number">1</span>、name必须是主机名，用主机名来匹配。
<span class="token number">2</span>、appBase，当前主机的网页根目录，是相对于CATALINA_HOME，也可以使用绝对路径
<span class="token number">3</span>、unpackWARs是否自动解压war格式
<span class="token number">4</span>、autoDeploy 热部署，自动加载并运行应用
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 虚拟主机配置实验</span>
root@ubuntu1:~<span class="token comment"># mkdir -p /data/webapps</span>
root@ubuntu1:~<span class="token comment"># cp /usr/local/tomcat/webapps/myapp/   /data/webapps/ROOT -r</span>
<span class="token comment"># 编辑配置文件</span>
root@ubuntu1:/usr/local/tomcat/conf<span class="token comment"># vim server.xml</span>
 <span class="token operator">&lt;</span>Host <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;www.xiaomao.com&quot;</span>  <span class="token assign-left variable">appBase</span><span class="token operator">=</span><span class="token string">&quot;/data/webapps&quot;</span>
                            <span class="token assign-left variable">unpackWARs</span><span class="token operator">=</span><span class="token string">&quot;true&quot;</span> <span class="token assign-left variable">autoDeploy</span><span class="token operator">=</span><span class="token string">&quot;true&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/Host<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 重启测试  </span>
http://www.xiaomao.com:8080/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="context配置"><a href="#context配置" class="header-anchor">#</a> <strong>Context配置</strong></h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>Context作用：
<span class="token number">1</span>、路径映射
<span class="token number">2</span>、应用独立配置，例如单独配置应用日志、单独配置应用访问控制
<span class="token comment"># 测试  项目代码</span>
root@ubuntu1:~<span class="token comment"># cp /usr/local/tomcat/webapps/myapp/   /data/myappv1/  -r</span>
root@ubuntu1:/data<span class="token comment"># ln -sv myappv1/  test</span>
<span class="token string">'test'</span> -<span class="token operator">&gt;</span> <span class="token string">'myappv1/'</span>
root@ubuntu1:/data<span class="token comment"># ll</span>
total <span class="token number">20</span>
drwxr-xr-x  <span class="token number">5</span> root root <span class="token number">4096</span> Oct <span class="token number">27</span> <span class="token number">12</span>:58 ./
drwxr-xr-x <span class="token number">26</span> root root <span class="token number">4096</span> Oct <span class="token number">22</span> 06:00 <span class="token punctuation">..</span>/
drwxr-xr-x  <span class="token number">2</span> root root <span class="token number">4096</span> Oct <span class="token number">27</span> <span class="token number">12</span>:58 myappv1/
drwxr-xr-x <span class="token number">12</span> root root <span class="token number">4096</span> Oct <span class="token number">24</span> <span class="token number">14</span>:54 nginx/
lrwxrwxrwx  <span class="token number">1</span> root root    <span class="token number">8</span> Oct <span class="token number">27</span> <span class="token number">12</span>:58 <span class="token builtin class-name">test</span> -<span class="token operator">&gt;</span> myappv1/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token operator">&lt;</span>Context <span class="token assign-left variable">path</span><span class="token operator">=</span><span class="token string">&quot;/test&quot;</span> <span class="token assign-left variable">docBase</span><span class="token operator">=</span><span class="token string">&quot;/data/test&quot;</span> <span class="token assign-left variable">reloadable</span><span class="token operator">=</span><span class="token string">&quot;false&quot;</span> /<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>path指的是访问的路径
docBase，可以是绝对路径，也可以是相对路径（相对于Host的appBase）
reloadable，true表示如果WEB-INF/classes或META-INF/lib目录下.class文件有改动，就会将WEB应用
重新加载，性能消耗很大。生成环境中，会使用false来禁用。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 修改配置文件</span>
root@ubuntu1:/usr/local/tomcat/conf<span class="token comment"># vim server.xml</span>
 <span class="token operator">&lt;</span>Host <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;www.xiaomao.com&quot;</span>  <span class="token assign-left variable">appBase</span><span class="token operator">=</span><span class="token string">&quot;/data/webapps&quot;</span>
                            <span class="token assign-left variable">unpackWARs</span><span class="token operator">=</span><span class="token string">&quot;true&quot;</span> <span class="token assign-left variable">autoDeploy</span><span class="token operator">=</span><span class="token string">&quot;true&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Context <span class="token assign-left variable">path</span><span class="token operator">=</span><span class="token string">&quot;/test&quot;</span> <span class="token assign-left variable">docBase</span><span class="token operator">=</span><span class="token string">&quot;/data/test&quot;</span> <span class="token assign-left variable">reloadable</span><span class="token operator">=</span><span class="token string">&quot;false&quot;</span> /<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>/Host<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>注意</strong>：这里特别使用了软链接，原因就是以后版本升级，需要将软链接指向myappv2，重启Tomcat。如果新版上线后，出现问题，重新修改软链接到上一个版本的目录，并重启，就可以实现回滚。</p> <h3 id="nginx-tomcat-实践"><a href="#nginx-tomcat-实践" class="header-anchor">#</a> Nginx+tomcat 实践</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 单机反向代理</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># cat linux39.conf</span>
 location / <span class="token punctuation">{</span>
            index  index.html  index.htm<span class="token punctuation">;</span>
            proxy_pass http://10.2.32.10:8080/<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token comment"># 重启测试访问</span>
http://10.2.32.10/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="动静分离"><a href="#动静分离" class="header-anchor">#</a> 动静分离</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>location / <span class="token punctuation">{</span>
 root /data/webapps/ROOT<span class="token punctuation">;</span>
 index index.html<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment"># ~* 不区分大小写</span>
location ~* <span class="token punctuation">\</span>.jsp$ <span class="token punctuation">{</span>
 proxy_pass http://www.xiaomao.com:8080<span class="token punctuation">;</span> <span class="token comment"># /etc/hosts</span>
<span class="token punctuation">}</span>   <span class="token comment">#注释:在/data/webapps/ROOT目录下增加一个index.html。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h1 id="nginx安装与使用"><a href="#nginx安装与使用" class="header-anchor">#</a> nginx安装与使用</h1> <h2 id="nginx基础"><a href="#nginx基础" class="header-anchor">#</a> Nginx基础</h2> <h3 id="nginx功能介绍"><a href="#nginx功能介绍" class="header-anchor">#</a> Nginx功能介绍</h3> <p>1、静态的web资源服务器HTML,图片,js,css,txt等静态资源</p> <p>2、结合FastCGI/uWSGI/SCGI等协议反向代理动态资源请求</p> <p>3、http/https协议的反向代理</p> <p>4、imap4/pop3协议的方向代理</p> <p>5、tcp/udp协议的请求转发(反向代理)</p> <h3 id="基础特性"><a href="#基础特性" class="header-anchor">#</a> 基础特性</h3> <p>1、模块化设计，较好的扩展性</p> <p>2、高可靠性</p> <p>3、支持热部署:不停机更新配置文件,升级版本,更换日志文件</p> <p>4、低内存消耗:10000个keep-alive连接模式下的非活动连接，仅需2.5M内存</p> <h3 id="和web服务相关的功能"><a href="#和web服务相关的功能" class="header-anchor">#</a> 和web服务相关的功能</h3> <p>1、虚拟主机(server)</p> <p>2、支持keep-alive和管道连接(利用一个连接做多次请求)</p> <p>3、访问日志(支持基于日志缓冲提高其性能)</p> <p>4、url rewirte</p> <p>5、路径别名</p> <p>6、基于IP及用户的访问控制</p> <p>7、支持速率限制及并发数限制</p> <p>8、重新配置和在线升级无需中断客户的工作进程</p> <h3 id="nginx组织结构"><a href="#nginx组织结构" class="header-anchor">#</a> Nginx组织结构</h3> <p>web请求处理机制:</p> <p>1、多进程方式:服务器每接收到一个客户端就有服务器的主进程生成一个子进程响应客户端,直到用户关闭连接,这样的优势是处理速度快,各子进程之间相互独立,但是如果访问过大会导致服务器资源耗尽而无法提供请求</p> <p>2、多线程方式:与多进程方式类似,但是每收到一个客户端请求会有服务进程派生出一个线程来对客户方进行交互,一个线程的开销远远小于一个进程,因此多线程方式在很大程度减轻了web服务器对系统资源的要求,但是多线程也有自已的缺点,即当多个线程位于同一个进程内工作的时候，可以相互访问同样的内存地址空间,所以他们相互影响，另外一旦主进程挂掉则所有子线程都不能工作了，IIS服务器使用了多线程的方式,需要间隔一段时间就重启一次才能稳定</p> <h3 id="nginx模块介绍"><a href="#nginx模块介绍" class="header-anchor">#</a> Nginx模块介绍</h3> <p>1、核心模块:是Nginx服务器正常运行必不可少的模块,提供错误日志记录、配置文件解析、事件驱动机制、进程管理等核心功能</p> <p>2、标准HTTP模块:提供HTTP协议解析相关的功能:比如:端口配置、网页编码设置、HTTP响应头设置等等</p> <p>3、可选HTTP模块:主要用于扩展标准的HTTP功能,让Nginx能处理一些特殊的服务,比如:Flash多媒体传输、解析GeoIP请求、网络传输压缩、安全协议SSL支持等</p> <p>4、邮件服务模块:主要用于支持Nginx的邮件服务，包括对POP3协议、IMAP协议和SMTP协议的支持</p> <p>5、第三方模块:是为了扩展Nginx服务器应用,完成开发者自定义功能,比如:Json支持、Lua支持等</p> <p>6、Nginx高度模块化:但其模块早期不支持DSO机制；1.9.11版本支持动态装载和卸载</p> <h3 id="模块分类"><a href="#模块分类" class="header-anchor">#</a> 模块分类</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">1</span>、核心模块:core module
<span class="token number">2</span>、标准模块:HTTP模块:ngx_http_*、
          HTTP Core modules 默认功能
          HTTP Optional modules  需编译时指定
<span class="token number">3</span>、 Mail模块:ngx_mail_*
<span class="token number">4</span>、Stream模块:ngx_stream_*
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="nginx安装"><a href="#nginx安装" class="header-anchor">#</a> Nginx安装</h3> <p>Nginx的安装版本分为Mainline version(主要开发版本,其实就是还处于开发版本)、Stable version(当前最新稳定版本)和Legacy versions(旧的稳定版)</p> <h4 id="开始安装"><a href="#开始安装" class="header-anchor">#</a> 开始安装</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 安装依赖环境</span>
root@ubuntu1:~<span class="token comment"># sudo apt install curl gnupg2 ca-certificates lsb-release ubuntu-keyring</span>
<span class="token comment"># 导入密钥</span>
root@ubuntu1:~<span class="token comment"># curl https://nginx.org/keys/nginx_signing.key | gpg --dearmor \</span>
    <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /usr/share/keyrings/nginx-archive-keyring.gpg <span class="token operator">&gt;</span>/dev/null
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 验证密钥</span>
root@ubuntu1:~<span class="token comment"># gpg --dry-run --quiet --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg</span>
<span class="token comment"># 导入稳定版本的源</span>
root@ubuntu1:~<span class="token comment"># echo &quot;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \</span>
http://nginx.org/packages/ubuntu <span class="token variable"><span class="token variable">`</span>lsb_release <span class="token parameter variable">-cs</span><span class="token variable">`</span></span> nginx&quot; <span class="token punctuation">\</span>
    <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/nginx.list
<span class="token comment">#更新源</span>
root@ubuntu1:~<span class="token comment"># apt update</span>
<span class="token comment"># 搜索Nginx版本</span>
root@ubuntu1:~<span class="token comment"># apt-cache madison nginx</span>
     nginx <span class="token operator">|</span> <span class="token number">1.20</span>.1-1~bionic <span class="token operator">|</span> http://nginx.org/packages/ubuntu bionic/nginx amd64 Packages
     nginx <span class="token operator">|</span> <span class="token number">1.20</span>.0-1~bionic <span class="token operator">|</span> http://nginx.org/packages/ubuntu bionic/nginx amd64 Packages
     nginx <span class="token operator">|</span> <span class="token number">1.18</span>.0-2~bionic <span class="token operator">|</span> http://nginx.org/packages/ubuntu bionic/nginx amd64 Packages
<span class="token comment"># 开始安装Nginx </span>
root@ubuntu1:~<span class="token comment"># apt install nginx=1.16.1-1~bionic</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 显示版本和编译参数</span>
root@ubuntu1:~<span class="token comment"># nginx -V</span>
nginx version: nginx/1.16.1
built by gcc <span class="token number">7.4</span>.0 <span class="token punctuation">(</span>Ubuntu <span class="token number">7.4</span>.0-1ubuntu1~18.04.1<span class="token punctuation">)</span>
<span class="token comment"># 测试配置文件是否异常</span>
root@ubuntu1:~<span class="token comment"># nginx -t</span>
nginx: the configuration <span class="token function">file</span> /etc/nginx/nginx.conf syntax is ok
nginx: configuration <span class="token function">file</span> /etc/nginx/nginx.conf <span class="token builtin class-name">test</span> is successful
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="编译安装"><a href="#编译安装" class="header-anchor">#</a> 编译安装</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 下载源码包</span>
root@ubuntu1:/usr/local/src<span class="token comment"># wget http://nginx.org/download/nginx-1.16.1.tar.gz</span>
<span class="token comment"># 解压源码包</span>
root@ubuntu1:/usr/local/src<span class="token comment"># tar xf nginx-1.16.1.tar.gz</span>
<span class="token comment"># 安装依赖</span>
root@ubuntu1:/usr/local/src/nginx-1.16.1<span class="token comment"># apt install libgd-dev libgeoip-dev libpcre3 libpcre3-dev   libssl-dev</span>
<span class="token comment"># 开始编译安装</span>
root@ubuntu1:/usr/local/src/nginx-1.16.1<span class="token comment"># mkdir -p /apps/nginx</span>
  ./configure <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/apps/nginx  --with-http_ssl_module <span class="token punctuation">\</span>
            --with-http_v2_module  <span class="token punctuation">\</span>
            --with-http_realip_module <span class="token punctuation">\</span>
            --with-http_addition_module  <span class="token punctuation">\</span>
            --with-http_image_filter_module <span class="token punctuation">\</span>
            --with-http_geoip_module <span class="token punctuation">\</span>
            --with-http_gunzip_module <span class="token punctuation">\</span>
            --with-http_stub_status_module <span class="token punctuation">\</span>
            --with-http_gzip_static_module <span class="token punctuation">\</span>
            --with-pcre <span class="token punctuation">\</span>
            --with-stream <span class="token punctuation">\</span>
            --with-stream_ssl_module <span class="token punctuation">\</span>
            --with-stream_realip_module
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 编译步骤,根据Makefile文件生成相应的模块</span>
root@ubuntu1:/usr/local/src/nginx-1.16.1<span class="token comment"># make</span>
<span class="token comment"># 创建目录,并将生成的模块和文件复制到相应的目录</span>
root@ubuntu1:/usr/local/src/nginx-1.16.1<span class="token comment"># make install</span>
<span class="token comment"># 查看是否编译成功</span>
root@ubuntu1:/usr/local/src/nginx-1.16.1<span class="token comment"># ll /apps/nginx/</span>
total <span class="token number">24</span>
drwxr-xr-x <span class="token number">6</span> root root <span class="token number">4096</span> Oct <span class="token number">10</span> <span class="token number">13</span>:32 ./
drwxr-xr-x <span class="token number">3</span> root root <span class="token number">4096</span> Oct <span class="token number">10</span> <span class="token number">13</span>:13 <span class="token punctuation">..</span>/
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">4096</span> Oct <span class="token number">10</span> <span class="token number">13</span>:32 conf/ <span class="token comment">#该目录保存了nginx所有的配置文件</span>
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">4096</span> Oct <span class="token number">10</span> <span class="token number">13</span>:32 html/ <span class="token comment">#该目录中保存了nginx服务器的web文件</span>
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">4096</span> Oct <span class="token number">10</span> <span class="token number">13</span>:32 logs/ <span class="token comment">#错误日志</span>
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">4096</span> Oct <span class="token number">10</span> <span class="token number">13</span>:32 sbin/ <span class="token comment">#启动脚本</span>
<span class="token comment">#以普通⽤⼾启动nginx</span>
root@ubuntu1:/usr/local/src/nginx-1.16.1<span class="token comment"># useradd -m -r -s /bin/bash -u 2019 -U nginx</span>
<span class="token comment">#授权</span>
root@ubuntu1:/usr/local/src/nginx-1.16.1<span class="token comment"># chown nginx.nginx -R /apps/nginx/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 启动nginx</span>
root@ubuntu1:~<span class="token comment"># /apps/nginx/sbin/nginx</span>
<span class="token comment"># 查看nginx版本</span>
root@ubuntu1:~<span class="token comment"># /apps/nginx/sbin/nginx  -v</span>
nginx version: nginx/1.16.1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="编辑nginx启动脚本"><a href="#编辑nginx启动脚本" class="header-anchor">#</a> 编辑nginx启动脚本</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:~<span class="token comment"># cat /lib/systemd/system/nginx.service</span>
<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>nginx
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>forking
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/apps/nginx/sbin/nginx
<span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/apps/nginx/sbin/nginx  <span class="token parameter variable">-s</span> reload
<span class="token assign-left variable">ExecStop</span><span class="token operator">=</span>/apps/nginx/sbin/nginx  <span class="token parameter variable">-s</span> quit
<span class="token assign-left variable">PrivateTmp</span><span class="token operator">=</span>true
<span class="token comment">#EnvironmentFile=/etc/sysconfig/rdisc</span>
<span class="token comment">#ExecStart=/sbin/rdisc $RDISCOPTS</span>

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="默认配置文件"><a href="#默认配置文件" class="header-anchor">#</a> 默认配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:~<span class="token comment"># grep -v &quot;#&quot; /apps/nginx/conf/nginx.conf | grep -v &quot;^$&quot;</span>
<span class="token comment"># 全局配置端,对全局生效,主要设置nginx的启动用户/组,启动的工作进程数量,工作模式,Nginx的PID路径,日志路径等</span>
user ngixn nginx<span class="token punctuation">;</span> <span class="token comment">#启动Nginx工作进程的用户和组</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">#启动工作进程数数量</span>
pid        /run/nginx.pid<span class="token punctuation">;</span> 
events <span class="token punctuation">{</span> <span class="token comment">#events设置快,主要影响nginx服务器与用户的网络连接,比如是否允许同时接受多个网络连接,使用哪种事件驱动模型请求,每个工作进程可以同时支持的最大连接数,是否开启对多工作进程下的网络连接进行序列化等</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token comment"># 设置单个nginx工作进程可以接受的最大并发,作为web服务器的时候最大并发数为worker_connections * worker_processes,作为反向代理的时候就为(worker_connections * worker_processes)/2</span>
<span class="token punctuation">}</span>
http <span class="token punctuation">{</span> <span class="token comment">#http块是Nginx服务器配置中的重要部分,缓存、代理和日志格式定义等绝大多数功能和第三方模块都可以在这设置,http块可以包含多个server块,而一个server块中又可以包含多个location块,server块可以配置文件引入、MIME-Type定义、日志自定义、是否启用sendfile、连接超时时间和单个链接的请求上限等</span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>
    sendfile        on<span class="token punctuation">;</span> <span class="token comment"># 作为web服务器的时候打开sendfile加快静态文件传输,指定是否使用sndfile系统调用来传输文件,sendfile系统调用在两个文件描述符之间直接传递数据(完全在内核中操作),从而避免了数据在内核缓冲区和用户缓冲区之间的拷贝,操作效率很高,被称之为零拷贝,硬盘 &gt;&gt; kernel buffer(快速拷贝到kernelsocket buffer) &gt;&gt; 协议栈</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span> <span class="token comment"># 长连接超时时间,单位是秒</span>
    server <span class="token punctuation">{</span>  <span class="token comment">#设置一个虚拟主机,可以包含自已的全局块,同时也可以包含多个location模块。比如本虚拟机监听的端口、本虚拟机的名称和IP配置,多个server可以使用一个端口，比如都使用80端口提供web服务器</span>
        listen       <span class="token number">88</span><span class="token punctuation">;</span> <span class="token comment">#配置server监听的端口</span>
        server_name  localhost<span class="token punctuation">;</span> <span class="token comment">#本server的名称,当访问此名称的时候nginx会调用当前server内部的配置进程匹配</span>
        location / <span class="token punctuation">{</span> <span class="token comment">#location其实是server的一个指令,为nginx服务器提供比较多而且灵活的指令,都是在location中体现的,主要是基于nginx接受到的请求字符串,对用户请求的URL进行匹配,并对特定的指令进行处理  </span>
            root   html<span class="token punctuation">;</span> <span class="token comment">#相当于默认页面的目录名称,默认是相对路径,可以使用绝多路径配置。</span>
            index  index.html index.htm<span class="token punctuation">;</span> <span class="token comment">#默认的页眉文件名称</span>
        <span class="token punctuation">}</span>
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span> <span class="token comment">#错误页眉的文件名称</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span> <span class="token comment">#location处理对应的不同错误码的页面定义到/50.html,这个跟对应其server中定义的目录下</span>
            root   html<span class="token punctuation">;</span> <span class="token comment"># 定义默认页面所在的目录</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="核心配置"><a href="#核心配置" class="header-anchor">#</a> 核心配置</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>user nginx ningx<span class="token punctuation">;</span> <span class="token comment">#启动Nginx工作进程的用户和组</span>
worker_processes <span class="token punctuation">[</span>number <span class="token operator">|</span> auto<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">#启动Nginx⼯作进程的数量</span>
worker_cpu_affinity auto<span class="token punctuation">;</span> <span class="token comment">#将Nginx⼯作进程绑定到指定的CPU核 ⼼，默认Nginx是不进⾏进程绑定的，绑定并不是意味着当前nginx进程独占以⼀核⼼CPU，但是可以保证此进程不会 运⾏在其他核⼼上，这就极⼤减少了nginx的⼯作进程在不同的cpu核⼼上的来回跳转，减少了CPU对进程的资源分配与 回收以及内存管理等，因此可以有效的提升nginx服务器的性能。</span>
<span class="token comment">#错误⽇志记录配置，语法：error_log file [debug | info | notice | warn | error | crit | alert | emerg] #error_log logs/error.log; #error_log logs/error.log notice; </span>
error_log /apps/nginx/logs/error.log error<span class="token punctuation">;</span>
<span class="token comment">#pid⽂件保存路径 </span>
pid /apps/nginx/logs/nginx.pid<span class="token punctuation">;</span>
<span class="token comment">#⼯作进程nice值，-20~19 一般情况下不会调这个参数</span>
worker_priority <span class="token number">0</span><span class="token punctuation">;</span> 
worker_rlimit_nofile <span class="token number">65536</span><span class="token punctuation">;</span> <span class="token comment">#这个数字包括Nginx的所有连接（例如与代理服务器的连接等），⽽不仅仅是与 客⼾端的连接,另⼀个考虑因素是实际的并发连接数不能超过系统级别的最⼤打开⽂件数的限制.</span>
events <span class="token punctuation">{</span> <span class="token comment">#事件模型配置参数 </span>
     worker_connections <span class="token number">65536</span><span class="token punctuation">;</span> <span class="token comment">#设置单个⼯作进程的最⼤并发连接数</span>
	 use epoll<span class="token punctuation">;</span> <span class="token comment">#使⽤epoll事件驱动，Nginx⽀持众多的事件驱动，⽐如select、poll、epoll，只能设置在 events模块中设置。</span>
	 accept_mutex on<span class="token punctuation">;</span> <span class="token comment">#优化同⼀时刻只有⼀个请求⽽避免多个睡眠进程被唤醒的设置，on为防⽌被同时唤醒默认 为off，全部唤醒的过程也成为&quot;惊群&quot;，因此nginx刚安装完以后要进⾏适当的优化。 multi_accept on; Nginx服务器的每个⼯作进程可以同时接受多个新的⽹络连接，但是需要在配置⽂件中配 置，此指令默认为关闭，即默认为⼀个⼯作进程只能⼀次接受⼀个新的⽹络连接，打开后⼏个同时接受多个。</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="http详细配置"><a href="#http详细配置" class="header-anchor">#</a> http详细配置</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>http<span class="token punctuation">{</span>
	include mime.types<span class="token punctuation">;</span> <span class="token comment">#导⼊⽀持的⽂件类型</span>
    default_type application/octet-stream<span class="token punctuation">;</span> <span class="token comment">#设置默认的类型，会提⽰下载不匹配的类型⽂件</span>
    <span class="token comment">#⾃定义优化参数 </span>
    sendfile on<span class="token punctuation">;</span> <span class="token comment">#实现⽂件零拷⻉</span>
    <span class="token comment">#tcp_nopush on; #在开启了sendfile的情况下，合并请求后统⼀发送给客⼾端。</span>
    <span class="token comment">#tcp_nodelay off; #在开启了keepalived模式下的连接是否启⽤TCP_NODELAY选项，当为off时，延 迟0.2s发送，默认On时，不延迟发送，⽴即发送⽤⼾相应报⽂。</span>
    keepalive_timeout <span class="token number">65</span> <span class="token number">65</span><span class="token punctuation">;</span> <span class="token comment">#设置会话保持时间 </span>
    <span class="token comment">#gzip on; #开启⽂件压缩</span>
    server<span class="token punctuation">{</span>
       listen <span class="token number">80</span><span class="token punctuation">;</span> <span class="token comment">#设置监听地址和端⼝</span>
       server_name localhost<span class="token punctuation">;</span> <span class="token comment">#设置server name，可以以空格隔开写多个并⽀持正则表达式，如 *.magedu.com www.magedu.* www.(site\d+)\.magedu\.com$ default_server</span>
       <span class="token comment">#charset koi8-r; #设置编码格式，默认是俄语格式，可以改为utf-8 </span>
       <span class="token comment">#access_log logs/host.access.log main;</span>
       location / <span class="token punctuation">{</span> 
       		root html<span class="token punctuation">;</span> 
       		index index.html index.htm<span class="token punctuation">;</span> 
       <span class="token punctuation">}</span>
       error_page <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html<span class="token punctuation">;</span> <span class="token comment">#定义错误⻚⾯ </span>
       location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span> 
       		root html<span class="token punctuation">;</span> 
       <span class="token punctuation">}</span>
       <span class="token comment">#location ~ /\.ht { #拒绝web形式访问指定⽂件，如很多的⽹站都是通过.htaccess⽂件来改变⾃⼰ 的重定向等功能。 # deny all; #}</span>
       location ~ /passwd.html <span class="token punctuation">{</span> 
       			deny all<span class="token punctuation">;</span> 
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h4 id="核心配置示例"><a href="#核心配置示例" class="header-anchor">#</a> 核心配置示例</h4> <p>基于不同的IP、不同的端口以及不同得的域名实现不同的虚拟主机，依赖于核心模块ngx_http_core_module实现</p> <h5 id="新建一个pc-web站点"><a href="#新建一个pc-web站点" class="header-anchor">#</a> 新建一个PC web站点</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:~<span class="token comment"># mkdir /apps/nginx/conf/conf.d</span>
root@ubuntu1:~<span class="token comment"># cd /apps/nginx/conf/conf.d/</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># mkdir /data/nginx/html/pc/  -p</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># cat !$</span>
<span class="token function">cat</span> /data/nginx/html/pc/index.html
<span class="token operator">&lt;</span>html <span class="token assign-left variable">lang</span><span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>meta <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>小茂 官网<span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>hello world<span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>
        <span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 修改nginx的配置文件</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># cat linux39.conf</span>
server<span class="token punctuation">{</span>
        listen  <span class="token number">88</span><span class="token punctuation">;</span>
        server_name   www.xiaomao.com<span class="token punctuation">;</span>
        charset  utf-8<span class="token punctuation">;</span>


        location / <span class="token punctuation">{</span>
            root   /data/nginx/html/pc<span class="token punctuation">;</span>
            index  index.html  index.htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token comment"># 导入配置文件</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># vim /apps/nginx/conf/nginx.conf</span>
<span class="token comment"># 在http模块里面加入</span>
include  /apps/nginx/conf/conf.d/*.conf<span class="token punctuation">;</span>
<span class="token comment"># 检查配置是否有错</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># /apps/nginx/sbin/nginx  -t</span>
nginx: the configuration <span class="token function">file</span> /apps/nginx/conf/nginx.conf syntax is ok
nginx: configuration <span class="token function">file</span> /apps/nginx/conf/nginx.conf <span class="token builtin class-name">test</span> is successful
<span class="token comment"># 重启nginx</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># /apps/nginx/sbin/nginx  -s reload</span>
<span class="token comment"># 然后配置hosts解析访问即可</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h5 id="新建一个mobile-web站点"><a href="#新建一个mobile-web站点" class="header-anchor">#</a> 新建⼀个<strong>Mobile web</strong>站点</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># mkdir /data/nginx/html/mobile -p</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># cat mobile.conf</span>
server<span class="token punctuation">{</span>
        listen  <span class="token number">88</span><span class="token punctuation">;</span>
        server_name   www.mobile.com<span class="token punctuation">;</span>
        charset  utf-8<span class="token punctuation">;</span>


        location / <span class="token punctuation">{</span>
            root   /data/nginx/html/mobile<span class="token punctuation">;</span>
            index  index.html  index.htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token comment"># 测试代码</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># echo &quot;mobile www&quot; &gt;&gt; /data/nginx/html/mobile/index.html</span>
<span class="token comment"># 重启nginx</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># /apps/nginx/sbin/nginx  -s reload</span>
<span class="token comment"># 然后配置hosts解析访问即可</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h5 id="静态资源配置"><a href="#静态资源配置" class="header-anchor">#</a> 静态资源配置</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 编辑配置文件</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># cat linux39.conf</span>
server<span class="token punctuation">{</span>
        listen  <span class="token number">88</span><span class="token punctuation">;</span>
        server_name   www.xiaomao.com<span class="token punctuation">;</span>
        charset  utf-8<span class="token punctuation">;</span>


        location / <span class="token punctuation">{</span>
            root   /data/nginx/html/pc<span class="token punctuation">;</span>
            index  index.html  index.htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        location /tfs <span class="token punctuation">{</span>
            root  /data/nginx/static<span class="token punctuation">;</span>
            index  index.html index.htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># mkdir -p /data/nginx/static/tfs</span>
<span class="token comment"># 上传图片测试</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># cd /data/nginx/static/tfs/</span>
root@ubuntu1:/data/nginx/static/tfs<span class="token comment"># ls</span>
<span class="token number">1</span>.jpg
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h5 id="访问测试"><a href="#访问测试" class="header-anchor">#</a> 访问测试</h5> <p><img src="images%5Cf9d6bc1ab25d4bdb8597fcdd05221e22.png" alt="img"></p> <h5 id="root与alias"><a href="#root与alias" class="header-anchor">#</a> root与alias</h5> <p>root:指定web的家目录,在定义location的时候,文件的绝对路径等于 root+location</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code># 准备测试代码
root@ubuntu1<span class="token operator">:</span><span class="token operator">/</span>apps<span class="token operator">/</span>nginx# cd <span class="token operator">/</span>data<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token operator">/</span>pc<span class="token operator">/</span>
root@ubuntu1<span class="token operator">:</span><span class="token operator">/</span>data<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token operator">/</span>pc# mkdir about
root@ubuntu1<span class="token operator">:</span><span class="token operator">/</span>data<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token operator">/</span>pc# echo <span class="token string">&quot;about 1123&quot;</span> <span class="token operator">&gt;&gt;</span> about<span class="token operator">/</span>index<span class="token punctuation">.</span>html
# 修改配置文件
root@ubuntu1<span class="token operator">:</span><span class="token operator">/</span>apps<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token operator">/</span>conf<span class="token punctuation">.</span>d# cat linux39<span class="token punctuation">.</span>conf
server<span class="token punctuation">{</span>
        listen  <span class="token number">88</span><span class="token punctuation">;</span>
        server_name   www<span class="token punctuation">.</span>xiaomao<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
        charset  utf<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">;</span>


        location <span class="token operator">/</span> <span class="token punctuation">{</span>
            root   <span class="token operator">/</span>data<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token operator">/</span>pc<span class="token punctuation">;</span>
            index  index<span class="token punctuation">.</span>html  index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        location <span class="token operator">/</span>about <span class="token punctuation">{</span>
            root <span class="token operator">/</span>data<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token operator">/</span>pc<span class="token punctuation">;</span>  #必须要在html⽬录中创建⼀个about⽬录才可以访问，否则报错
            index index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        location <span class="token operator">/</span>tfs <span class="token punctuation">{</span>
            root  <span class="token operator">/</span>data<span class="token operator">/</span>nginx<span class="token operator">/</span><span class="token keyword">static</span><span class="token punctuation">;</span>
            index  index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
# 重启nginx测试
root@ubuntu1<span class="token operator">:</span><span class="token operator">/</span>apps<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token operator">/</span>conf<span class="token punctuation">.</span>d# systemctl restart nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h5 id="location的使用"><a href="#location的使用" class="header-anchor">#</a> location的使用</h5> <p>在没有使⽤正则表达式的时候，nginx会先在server中的多个location选取匹配度最⾼的⼀个uri，uri是⽤⼾请求的 字符串，即域名后⾯的web⽂件路径，然后使⽤该location模块中的正则url和字符串，如果匹配成功就结束搜索， 并使⽤此location处理此请求。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>语法规则： location <span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">|</span><span class="token operator">~</span><span class="token operator">|</span><span class="token operator">~</span><span class="token operator">*</span><span class="token operator">|</span><span class="token operator">^</span><span class="token operator">~</span><span class="token punctuation">]</span> <span class="token operator">/</span>uri<span class="token operator">/</span> <span class="token punctuation">{</span> … <span class="token punctuation">}</span>
<span class="token operator">=</span> <span class="token comment">#⽤于标准uri前，需要请求字串与uri精确匹配，如果匹配成功就停⽌向下匹配并⽴即处理请求。</span>
<span class="token operator">~</span> <span class="token comment">#⽤于标准uri前，表⽰包含正则表达式并且区分⼤⼩写，并且匹配</span>
!<span class="token operator">~</span> <span class="token comment">#⽤于标准uri前，表⽰包含正则表达式并且区分⼤⼩写，并且不匹配</span>
<span class="token operator">~</span><span class="token operator">*</span> <span class="token comment">#⽤于标准uri前，表⽰包含正则表达式并且不区分⼤写，并且匹配</span>
!<span class="token operator">~</span><span class="token operator">*</span> <span class="token comment">#⽤于标准uri前，表⽰包含正则表达式并且不区分⼤⼩写,并且不匹配</span>
<span class="token operator">^</span><span class="token operator">~</span> <span class="token comment">#⽤于标准uri前，表⽰包含正则表达式并且匹配以什么开头</span>
$ <span class="token comment">#⽤于标准uri前，表⽰包含正则表达式并且匹配以什么结尾</span>
\ <span class="token comment">#⽤于标准uri前，表⽰包含正则表达式并且转义字符。可以转. * ?等</span>
<span class="token operator">*</span> <span class="token comment">#⽤于标准uri前，表⽰包含正则表达式并且代表任意⻓度的任意字符</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="精确匹配"><a href="#精确匹配" class="header-anchor">#</a> 精确匹配</h5> <p>在server部分使⽤location配置⼀个web界⾯，要求：当访问nginx 服务器的/login的时候要显⽰指定html⽂件的内 容</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># cat linux39.conf</span>
server<span class="token punctuation">{</span>
        listen  <span class="token number">88</span><span class="token punctuation">;</span>
        server_name   www.xiaomao.com<span class="token punctuation">;</span>
        charset  utf-8<span class="token punctuation">;</span>

        location / <span class="token punctuation">{</span>
            root   /data/nginx/html/pc<span class="token punctuation">;</span>
            index  index.html  index.htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        location /1.jpg <span class="token punctuation">{</span>
            root  /var/www/nginx/images/<span class="token punctuation">;</span>   <span class="token comment">#精确匹配</span>
        <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token comment"># 上传图片到/vat/www/nginx/images/并重启测试</span>
<span class="token comment"># 访问路径:http://www.xiaomao.com:88/1.jpg</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h5 id="匹配大小写"><a href="#匹配大小写" class="header-anchor">#</a> 匹配大小写</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 精确匹配名称</span>
location ~ /Aa.jpg <span class="token punctuation">{</span>
            root  /var/www/nginx/images/<span class="token punctuation">;</span>
            index  index.html  index.htm<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment"># 重启nginx访问测试</span>
<span class="token comment"># 访问http://www.xiaomao.com:88/AA.jpg 会直接报404</span>
<span class="token comment"># 访问http://www.xiaomao.com:88/Aa.jpg 就会出图</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="不区分大小写"><a href="#不区分大小写" class="header-anchor">#</a> 不区分大小写</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>location ~* /Aa.jpg <span class="token punctuation">{</span>
            root  /var/www/nginx/images/<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token comment"># 重启nginx访问测试</span>
<span class="token comment"># 访问http://www.xiaomao.com:88/AA.jpg 也会出图</span>
<span class="token comment"># 访问http://www.xiaomao.com:88/Aa.jpg 就会出图</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="匹配开头"><a href="#匹配开头" class="header-anchor">#</a> 匹配开头</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 匹配开头</span>
 location ^~ /images <span class="token punctuation">{</span>
            root  /var/www/nginx<span class="token punctuation">;</span>
            index   index.html index.htm<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token comment"># 新建测试目录 </span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># mkdir /var/www/nginx/images1</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># echo images &gt;&gt;  /var/www/nginx/images/index.html</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># echo images1 &gt;&gt;  /var/www/nginx/images1/index.html</span>
<span class="token comment"># 重启nginx</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># systemctl restart nginx</span>
<span class="token comment"># 测试</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># curl http://www.xiaomao.com:88/images/</span>
images
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># curl http://www.xiaomao.com:88/images1/</span>
images1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h5 id="匹配文件后缀名"><a href="#匹配文件后缀名" class="header-anchor">#</a> 匹配文件后缀名</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># nginx配置文件</span>
location ~* <span class="token punctuation">\</span>.<span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>jpeg<span class="token operator">|</span>bmp<span class="token operator">|</span>png<span class="token operator">|</span>webp<span class="token operator">|</span>tif<span class="token operator">|</span>ico<span class="token operator">|</span>wmf<span class="token operator">|</span>js<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
                root /data/nginx/images1<span class="token punctuation">;</span>
                index index.html<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token comment"># 匹配优先级</span>
匹配优先级：<span class="token operator">=</span>, ^~, 〜/〜*，/ 
location优先级：<span class="token punctuation">(</span>location <span class="token operator">=</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span>location 完整路径<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span>location ^~ 路径<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span>location ~,~* 正 则顺序<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span>location 部分起始路径<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span>/<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="生产使用案例"><a href="#生产使用案例" class="header-anchor">#</a> 生产使用案例</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 直接匹配⽹站根会加速Nginx访问处理: </span>
location <span class="token operator">=</span> / <span class="token punctuation">{</span> 
	<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
location / <span class="token punctuation">{</span> 
	<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
<span class="token comment"># 静态资源配置</span>
location ^~ /static/ <span class="token punctuation">{</span> 
	<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
location ~* <span class="token punctuation">\</span>.<span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>jpeg<span class="token operator">|</span>png<span class="token operator">|</span>css<span class="token operator">|</span>js<span class="token operator">|</span>ico<span class="token punctuation">)</span>$ <span class="token punctuation">{</span> 
	<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h5 id="访问控制"><a href="#访问控制" class="header-anchor">#</a> 访问控制</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># nginx配置文件</span>
location ~* <span class="token punctuation">\</span>.<span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>jpeg<span class="token operator">|</span>bmp<span class="token operator">|</span>png<span class="token operator">|</span>webp<span class="token operator">|</span>tif<span class="token operator">|</span>ico<span class="token operator">|</span>wmf<span class="token operator">|</span>js<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
                root /data/nginx/images1<span class="token punctuation">;</span>
                index index.html<span class="token punctuation">;</span>
                deny <span class="token number">10.2</span>.32.11<span class="token punctuation">;</span>   <span class="token comment">#拒绝</span>
                allow <span class="token number">10.2</span>.32.0/19<span class="token punctuation">;</span>  <span class="token comment">#允许</span>
                deny all<span class="token punctuation">;</span> <span class="token comment">#先允许⼩部分，再拒绝⼤部分</span>
<span class="token punctuation">}</span>
<span class="token comment"># 测试访问</span>
root@ubuntu2:~<span class="token comment"># curl --head http://www.xiaomao.com:88/1.webp</span>
HTTP/1.1 <span class="token number">403</span> Forbidden
Server: nginx/1.16.1
Date: Tue, <span class="token number">12</span> Oct <span class="token number">2021</span> <span class="token number">15</span>:14:14 GMT
Content-Type: text/html<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
Content-Length: <span class="token number">153</span>
Connection: keep-alive
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h5 id="自定义错误界面"><a href="#自定义错误界面" class="header-anchor">#</a> 自定义错误界面</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>server<span class="token punctuation">{</span>
        listen  <span class="token number">88</span><span class="token punctuation">;</span>
        server_name   www.xiaomao.com<span class="token punctuation">;</span>
        charset  utf-8<span class="token punctuation">;</span>
        error_page <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> <span class="token number">404</span> /error.html<span class="token punctuation">;</span>  <span class="token comment">#错误页面</span>
        location / <span class="token punctuation">{</span>
            root   /data/nginx/html/pc<span class="token punctuation">;</span>
            index  index.html  index.htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        location /error.html<span class="token punctuation">{</span>      <span class="token comment"># 错误页面路径</span>
            root /data/nginx/html/pc<span class="token punctuation">;</span>
            index  index.html  index.htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">#准备测试文件</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># echo &quot;业务升级中...........&quot; &gt;&gt; /data/nginx/html/pc/error.html</span>
<span class="token comment"># 重启nginx测试</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># systemctl restart nginx</span>
<span class="token comment"># 测试</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># curl http://www.xiaomao.com:88/1.webp</span>
业务升级中<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h5 id="自定义访问日志"><a href="#自定义访问日志" class="header-anchor">#</a> 自定义访问日志</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 配置在nginx配置文件中</span>
access_log /data/nginx/logs/www-magedu-net_access.log<span class="token punctuation">;</span> <span class="token comment">#访问日志</span>
error_log /data/nginx/logs/www-magedu-net_error.log<span class="token punctuation">;</span>  <span class="token comment">#错误日志</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="检测文件是否存在"><a href="#检测文件是否存在" class="header-anchor">#</a> 检测文件是否存在</h5> <p>try_fifiles会按顺序检查⽂件是否存在，返回第⼀个找到的⽂件或⽂件夹（结尾加斜线表⽰为⽂件夹），如果所有⽂ 件或⽂件夹都找不到，会进⾏⼀个内部重定向到最后⼀个参数。只有最后⼀个参数可以引起⼀个内部重定向，之前 的参数只设置内部URI的指向。最后⼀个参数是回退URI且必须存在，否则会出现内部500错误。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># nginx配置文件</span>
location /tfs <span class="token punctuation">{</span>
            root  /data/nginx/static<span class="token punctuation">;</span>
            index  index.html index.htm<span class="token punctuation">;</span>
            try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/index.html <span class="token variable">$uri</span>.html  tfs/index.html<span class="token punctuation">;</span>  <span class="token comment">#访问不存在的页面会重定向到tfs/index.html页面</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 重启测试   这个是访问不存在的页面出现500错误</span>
root@ubuntu1:~<span class="token comment"># curl --head http://www.xiaomao.com:88/tfs/index.html</span>
HTTP/1.1 <span class="token number">500</span> Internal Server Error
Server: nginx/1.16.1
Date: Thu, <span class="token number">14</span> Oct <span class="token number">2021</span> 06:15:25 GMT
Content-Type: text/html<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
Content-Length: <span class="token number">177</span>
Connection: close
<span class="token comment">#重定向过后的</span>
root@ubuntu1:/data/nginx/static/tfs<span class="token comment"># curl --head http://www.xiaomao.com:88/tfs/index.html</span>
HTTP/1.1 <span class="token number">200</span> OK
Server: nginx/1.16.1
Date: Thu, <span class="token number">14</span> Oct <span class="token number">2021</span> 06:22:58 GMT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h5 id="长连接配置"><a href="#长连接配置" class="header-anchor">#</a> 长连接配置</h5> <p>keepalive_timeout number; #设定保持连接超时时⻓，0表⽰禁⽌⻓连接，默认为75s，通常配置在http字段作为</p> <p>站点全局配置 keepalive_requests number; #在⼀次⻓连接上所允许请求的资源的最⼤数量，默认为100次</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 修改配置文件做测试</span>
keepalive_requests <span class="token number">3</span><span class="token punctuation">;</span>
keepalive_timeout <span class="token number">65</span> <span class="token number">65</span><span class="token punctuation">;</span>
<span class="token comment"># 开启长连接后,返回客户端的会话保持时间为60s,单次连接累计请求达到指定次数请求或65s就会断开,后面的60为发送给客户端应答报文头部中显示的超时时间设置为60s:如果不设置客户端将不显示超时时间。</span>
Keep-Alive:timeout<span class="token operator">=</span><span class="token number">60</span> <span class="token comment">#浏览器收到的服务器返回的报⽂</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 测试 三次连接过后会出现Connection closed by foreign host. 所以要重新发起连接</span>
root@ubuntu1:~<span class="token comment"># telnet www.xiaomao.com 88</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="下载服务器配置"><a href="#下载服务器配置" class="header-anchor">#</a> 下载服务器配置</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:~<span class="token comment"># mkdir /data/nginx/html/pc/download</span>
 location /download <span class="token punctuation">{</span>
                autoindex on<span class="token punctuation">;</span>   <span class="token comment"># 自动索引功能</span>
                autoindex_exact_size off<span class="token punctuation">;</span> <span class="token comment">#计算⽂件确切⼤⼩（单位bytes），off只显⽰⼤概⼤⼩（单位kb、mb、 gb）</span>
                autoindex_localtime on<span class="token punctuation">;</span>  <span class="token comment">#显⽰本机时间⽽⾮GMT(格林威治)时间</span>
                root /data/nginx/html/pc<span class="token punctuation">;</span> <span class="token comment"># 目录</span>

<span class="token punctuation">}</span>
<span class="token comment"># 重启并访问下载页面</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>limit_rate rate<span class="token punctuation">;</span> <span class="token comment">#限制响应给客⼾端的传输速率，单位是bytes/second，默认值0表⽰⽆限制 限速与不限速的对⽐：</span>
limit_rate 10k<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 重启并测试</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># wget http://www.xiaomao.com:88/download/ubuntu-18.04.5-live-server-amd64.iso</span>
ubuntu-18.04.5-live-server-amd64.iso              <span class="token number">0</span>%<span class="token punctuation">[</span>                                                                                                       <span class="token punctuation">]</span> <span class="token number">412</span>.00K  <span class="token number">10</span>.0KB/s    eta 26h 13m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="作为上传服务器"><a href="#作为上传服务器" class="header-anchor">#</a> 作为上传服务器</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>client_max_body_size 1m<span class="token punctuation">;</span> <span class="token comment">#设置允许客⼾端上传单个⽂件的最⼤值，默认值为1m</span>
client_body_buffer_size size<span class="token punctuation">;</span> <span class="token comment">#⽤于接收每个客⼾端请求报⽂的body部分的缓冲区⼤⼩；默认16k；超出 此⼤⼩时，其将被暂存到磁盘上的由下⾯client_body_temp_path指令所定义的位置</span>
client_max_body_size 1m； <span class="token comment">#设置允许客⼾端上传单个⽂件的最⼤值，默认值为1m</span>
client_body_temp_path path <span class="token punctuation">[</span>level1 <span class="token punctuation">[</span>level2 <span class="token punctuation">[</span>level3<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">#设定存储客⼾端请求报⽂的body部分的临时存储路径及⼦⽬录结构和数量，⽬录名为16进制的数字，使⽤hash之后的 值从后往前截取1位、2位、2位作为⽂件名：</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># md5sum /data/nginx/html/pc/index.html</span>
09fa1f3223588b73e681a11414d2d77a  /data/nginx/html/pc/index.html
<span class="token number">1</span>级⽬录占1位16进制，即2^4<span class="token operator">=</span><span class="token number">16</span>个⽬录 <span class="token number">0</span>-f 
<span class="token number">2</span>级⽬录占2位16进制，即2^8<span class="token operator">=</span><span class="token number">256</span>个⽬录 00-ff
<span class="token number">3</span>级⽬录占2位16进制，即2^8<span class="token operator">=</span><span class="token number">256</span>个⽬录 00-ff
<span class="token comment"># 配置示例</span>
client_max_body_size 10m；
client_body_buffer_size 16k<span class="token punctuation">;</span>
client_body_temp_path /apps/nginx/temp <span class="token number">1</span> <span class="token number">2</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">#reload Nginx会⾃动创建temp⽬录</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="隐藏nginx版本"><a href="#隐藏nginx版本" class="header-anchor">#</a> 隐藏Nginx版本</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#在nginx.conf中配置</span>
http <span class="token punctuation">{</span>
 open_file_cache <span class="token assign-left variable">max</span><span class="token operator">=</span><span class="token number">10000</span> <span class="token assign-left variable">inactive</span><span class="token operator">=</span>60s<span class="token punctuation">;</span> <span class="token comment">#最⼤缓存10000个⽂件，⾮活动数据超时时⻓60s</span>
 open_file_cache_valid 60s<span class="token punctuation">;</span> <span class="token comment">#每间隔60s检查⼀下缓存数据有效性</span>
 open_file_cache_min_uses <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">#60秒内⾄少被命中访问5次才被标记为活动数据</span>
 open_file_cache_errors on<span class="token punctuation">;</span> <span class="token comment">#缓存错误信息</span>
 server_tokens off<span class="token punctuation">;</span> <span class="token comment">#隐藏Nginx server版本</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="nginx高级配置"><a href="#nginx高级配置" class="header-anchor">#</a> Nginx高级配置</h4> <h5 id="nginx状态页"><a href="#nginx状态页" class="header-anchor">#</a> Nginx状态页</h5> <p>在编译安装nginx的时候需要添加编译参数--with-http_stub_status_module，否则配置完成之后监测会是提⽰语法错误</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 配置示例</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># vim linux39.conf</span>
location /tfs <span class="token punctuation">{</span>
            root  /data/nginx/static<span class="token punctuation">;</span>
            index  index.html index.htm<span class="token punctuation">;</span>
            stub_status<span class="token punctuation">;</span>
            allow <span class="token number">10.2</span>.32.11/19<span class="token punctuation">;</span>
            allow <span class="token number">127.0</span>.0.1<span class="token punctuation">;</span>
            deny all<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 重启 Windows web界面访问失败的查看连接次数</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="状态页详细信息说明"><a href="#状态页详细信息说明" class="header-anchor">#</a> 状态页详细信息说明</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 查看状态页输出信息说明</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># curl http://www.xiaomao.com:88/tfs/</span>
Active connections: <span class="token number">1</span>
server accepts handled requests
 <span class="token number">94</span> <span class="token number">94</span> <span class="token number">94</span>
 <span class="token comment"># 上⾯三个数字分别对应accepts,handled,requests三个值</span>
Reading: <span class="token number">0</span> Writing: <span class="token number">1</span> Waiting: <span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>1、Active connections： 当前处于活动状态的客⼾端连接数，包括连接等待空闲连接数。</p> <p>2、accepts：统计总值，Nginx⾃启动后已经接受的客⼾端请求的总数。</p> <p>3、handled：统计总值，Nginx⾃启动后已经处理完成的客⼾端请求的总数，通常等于accepts</p> <p>4、worker_connections限制等被拒绝的连接</p> <p>5、requests：统计总值，Nginx⾃启动后客⼾端发来的总的请求数</p> <p>6、Reading：当前状态，正在读取客⼾端请求报⽂⾸部的连接的连接数</p> <p>7、Writing：当前状态，正在向客⼾端发送响应报⽂过程中的连接数</p> <p>8、Waiting：当前状态，正在等待客⼾端发出请求的空闲连接数，开启 keep-alive的情况下,这个值等于 active –</p> <p>(reading+writing),</p> <h5 id="nginx第三方模块"><a href="#nginx第三方模块" class="header-anchor">#</a> Nginx第三方模块</h5> <p>第三模块是对nginx 的功能扩展，第三⽅模块需要在编译安装Nginx 的时候使⽤参数--add-module=PATH指定路径 添加，有的模块是由公司的开发⼈员针对业务需求定制开发的，有的模块是开源爱好者开发好之后上传到github进 ⾏开源的模块，nginx⽀持第三⽅模块需要从源码重新编译⽀持，⽐如开源的echo模块 https://github.com/openresty/echo-nginx-module：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 导入第三方模块</span>
root@ubuntu1:/usr/local/src<span class="token comment"># wget https://github.com/openresty/echo-nginx-module/archive/v0.61.tar.gz</span>
<span class="token comment"># 重新编译nginx</span>
root@ubuntu1:/usr/local/src/nginx-1.16.1<span class="token comment"># ./configure   --prefix=/apps/nginx --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_addition_module --with-http_image_filter_module --with-http_geoip_module --with-http_gunzip_module --with-http_stub_status_module --with-http_gzip_static_module --with-pcre --with-stream --with-stream_ssl_module --with-stream_realip_module --with-http_stub_status_module --add-module=/usr/local/src/echo-nginx-module-0.61</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 测试第三方模块是否能使用</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># cat linux39.conf</span>
location / <span class="token punctuation">{</span>
            <span class="token comment">#root   /data/nginx/html/pc;</span>
            <span class="token comment">#index  index.html  index.htm;</span>
            default_type text/html<span class="token punctuation">;</span>
            <span class="token builtin class-name">echo</span> <span class="token string">&quot;hello world,main--&gt;&quot;</span><span class="token punctuation">;</span>
            echo_reset_timer<span class="token punctuation">;</span>
            echo_location /sub1<span class="token punctuation">;</span>
            echo_location /sub2<span class="token punctuation">;</span>
            <span class="token builtin class-name">echo</span> <span class="token string">&quot;took <span class="token variable">$echo_timer_elapsed</span> sec for total.&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        location /sub1 <span class="token punctuation">{</span>
                <span class="token builtin class-name">echo</span> sub1<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        location /sub2 <span class="token punctuation">{</span>
                <span class="token builtin class-name">echo</span> sub2<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 重启测试访问</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># curl http://www.xiaomao.com:88/</span>
hello world,main--<span class="token operator">&gt;</span>
sub1
sub2
took <span class="token number">0.000</span> sec <span class="token keyword">for</span> total.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="nginx变量使用"><a href="#nginx变量使用" class="header-anchor">#</a> Nginx变量使用</h5> <p>nginx的变量可以在配置⽂件中引⽤，作为功能判断或者⽇志等场景使⽤，变量可以分为内置变量和⾃定义变量， 内置变量是由nginx模块⾃带，通过变量可以获取到众多的与客⼾端访问相关的值。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token variable">$remote_addr</span><span class="token punctuation">;</span> 
<span class="token comment">#存放了客⼾端的地址，注意是客⼾端的公⽹IP，也就是⼀家⼈访问⼀个⽹站，则会显⽰为路由器的公⽹IP。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token variable">$args</span>；
<span class="token comment">#变量中存放了URL中的指令,例如http://www.magedu.net/main/index.do?id=20190221&amp;partner=search 中的id=20190221&amp;partner=search</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token variable">$document_root</span>； 
<span class="token comment">#保存了针对当前资源的请求的系统根⽬录，如/apps/nginx/html。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token variable">$host</span>； <span class="token comment">#存放了请求的host名称。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token variable">$http_user_agent</span>； <span class="token comment">#客⼾端浏览器的详细信息</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token variable">$http_cookie</span>； <span class="token comment">#客⼾端的cookie信息。</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$limit_rate</span><span class="token punctuation">;</span> <span class="token comment">#如果nginx服务器使⽤limit_rate配置了显⽰⽹络速率，则会显⽰，如果没有设置， 则显⽰0</span>
<span class="token variable">$remote_port</span>； <span class="token comment">#客⼾端请求Nginx服务器时随机打开的端⼝，这是每个客⼾端⾃⼰的端⼝。</span>
<span class="token variable">$server_port</span>； <span class="token comment">#请求的服务器的端⼝号</span>
<span class="token variable">$server_name</span>； <span class="token comment">#请求的服务器的主机名</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="自定义变量"><a href="#自定义变量" class="header-anchor">#</a> 自定义变量</h5> <p>假如需要⾃定义变量名称和值，使⽤指令set $variable value;，则⽅法如下</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code> location / <span class="token punctuation">{</span>
            <span class="token builtin class-name">set</span> <span class="token variable">$name</span> magedu<span class="token punctuation">;</span>
            <span class="token builtin class-name">echo</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
            <span class="token builtin class-name">set</span> <span class="token variable">$my_port</span> <span class="token variable">$server_port</span><span class="token punctuation">;</span>
            <span class="token builtin class-name">echo</span> <span class="token variable">$my_port</span><span class="token punctuation">;</span>  <span class="token comment">#端口号</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="nginx-自定义访问日志"><a href="#nginx-自定义访问日志" class="header-anchor">#</a> <strong>Nginx</strong> ⾃定义访问⽇志</h5> <p>访问⽇志是记录客⼾端即⽤⼾的具体请求内容信息，全局配置模块中的error_log是记录nginx服务器运⾏时的⽇志 保存路径和记录⽇志的level，因此有着本质的区别，⽽且Nginx的错误⽇志⼀般只有⼀个，但是访问⽇志可以在不 同server中定义多个，定义⼀个⽇志需要使⽤access_log指定⽇志的保存路径，使⽤log_format指定⽇志的格式， 格式中定义要保存的具体⽇志内容。</p> <p>⾃定义json格式⽇志</p> <p>Nginx 的默认访问⽇志记录内容相对⽐较单⼀，默认的格式也不⽅便后期做⽇志统计分析，⽣产环境中通常将nginx⽇志转换为json⽇志，然后配合使⽤ELK做⽇志收集-统计-分析</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:/apps/nginx/conf<span class="token comment"># vim nginx.conf</span>
http<span class="token punctuation">{</span>
		log_format access_json <span class="token string">'{&quot;@timestamp&quot;:&quot;$time_iso8601&quot;,'</span>
        <span class="token string">'&quot;host&quot;:&quot;$server_addr&quot;,'</span>
        <span class="token string">'&quot;clientip&quot;:&quot;$remote_addr&quot;,'</span>
        <span class="token string">'&quot;size&quot;:$body_bytes_sent,'</span>
        <span class="token string">'&quot;responsetime&quot;:$request_time,'</span>
        <span class="token string">'&quot;upstreamtime&quot;:&quot;$upstream_response_time&quot;,'</span>
        <span class="token string">'&quot;upstreamhost&quot;:&quot;$upstream_addr&quot;,'</span>
        <span class="token string">'&quot;http_host&quot;:&quot;$host&quot;,'</span>
        <span class="token string">'&quot;uri&quot;:&quot;$uri&quot;,'</span>
        <span class="token string">'&quot;domain&quot;:&quot;$host&quot;,'</span>
        <span class="token string">'&quot;xff&quot;:&quot;$http_x_forwarded_for&quot;,'</span>
        <span class="token string">'&quot;referer&quot;:&quot;$http_referer&quot;,'</span>
        <span class="token string">'&quot;tcp_xff&quot;:&quot;$proxy_protocol_addr&quot;,'</span>
        <span class="token string">'&quot;http_user_agent&quot;:&quot;$http_user_agent&quot;,'</span>
        <span class="token string">'&quot;status&quot;:&quot;$status&quot;}'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment"># pc端配置应用</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># vim linux39.conf</span>
server<span class="token punctuation">{</span>
        listen  <span class="token number">88</span><span class="token punctuation">;</span>
        server_name   www.xiaomao.com<span class="token punctuation">;</span>
        charset  utf-8<span class="token punctuation">;</span>
        <span class="token comment">#error_page 500 502 503 504 404 /error.html;</span>

        access_log /data/nginx/logs/www-magedu-net_access.log  access_json<span class="token punctuation">;</span> <span class="token comment">#访问日志</span>
        error_log /data/nginx/logs/www-magedu-net_error.log<span class="token punctuation">;</span>  <span class="token comment">#错误日志</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 重启测试看看是否是json格式</span>
root@ubuntu1:/data/nginx/logs<span class="token comment"># tail -f www-magedu-net_access.log</span>
<span class="token punctuation">{</span><span class="token string">&quot;@timestamp&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2021-10-15T09:07:50+00:00&quot;</span>,<span class="token string">&quot;host&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10.2.32.10&quot;</span>,<span class="token string">&quot;clientip&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10.1.10.1&quot;</span>,<span class="token string">&quot;size&quot;</span>:25,<span class="token string">&quot;responsetime&quot;</span>:0.000,<span class="token string">&quot;upstreamtime&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;-&quot;</span>,<span class="token string">&quot;upstreamhost&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;-&quot;</span>,<span class="token string">&quot;http_host&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;www.xiaomao.com&quot;</span>,<span class="token string">&quot;uri&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;/2WGLMPpywpRdcqVe2FNGZFZtJsJ9/index.html&quot;</span>,<span class="token string">&quot;domain&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;www.xiaomao.com&quot;</span>,<span class="token string">&quot;xff&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;-&quot;</span>,<span class="token string">&quot;referer&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;-&quot;</span>,<span class="token string">&quot;tcp_xff&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;&quot;</span>,<span class="token string">&quot;http_user_agent&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36&quot;</span>,<span class="token string">&quot;status&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;200&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="nginx压缩功能"><a href="#nginx压缩功能" class="header-anchor">#</a> Nginx压缩功能</h5> <p>Nginx⽀持对指定类型的⽂件进⾏压缩然后再传输给客⼾端，⽽且压缩还可以设置压缩⽐例，压缩后的⽂件⼤⼩将⽐源⽂件显著变⼩，这样有助于降低出⼝带宽的利⽤率，降低企业的IT⽀出，不过会占⽤相应的CPU资源。Nginx对⽂件的压缩功能是依赖于模块ngx_http_gzip_module，官⽅⽂档： https://nginx.org/en/docs/http/ngx_http_gzip_module.html， 配置指令如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#启⽤或禁⽤gzip压缩，默认关闭 </span>
<span class="token function">gzip</span> on <span class="token operator">|</span> off<span class="token punctuation">;</span>
<span class="token comment">#压缩⽐由低到⾼从1到9，默认为1 </span>
gzip_comp_level level<span class="token punctuation">;</span>
<span class="token comment">#禁⽤IE6 gzip功能 </span>
gzip_disable <span class="token string">&quot;MSIE [1-6]\.&quot;</span><span class="token punctuation">;</span>
<span class="token comment">#gzip压缩的最⼩⽂件，⼩于设置值的⽂件将不会压缩 </span>
gzip_min_length 1k<span class="token punctuation">;</span>
<span class="token comment">#启⽤压缩功能时，协议的最⼩版本，默认HTTP/1.1 </span>
gzip_http_version <span class="token number">1.0</span> <span class="token operator">|</span> <span class="token number">1.1</span><span class="token punctuation">;</span>
<span class="token comment">#指定Nginx服务需要向服务器申请的缓存空间的个数*⼤⼩，默认32 4k|16 8k; </span>
gzip_buffers number size<span class="token punctuation">;</span>
<span class="token comment">#指明仅对哪些类型的资源执⾏压缩操作；默认为gzip_types text/html，不⽤显⽰指定，否则出错 </span>
gzip_types mime-type <span class="token punctuation">..</span>.<span class="token punctuation">;</span>
<span class="token comment">#如果启⽤压缩，是否在响应报⽂⾸部插⼊“Vary: Accept-Encoding” </span>
gzip_vary on <span class="token operator">|</span> off<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 编辑nginx配置文件</span>
root@ubuntu1:/apps/nginx/conf<span class="token comment"># vim nginx.conf</span>
<span class="token function">gzip</span> on<span class="token punctuation">;</span>
gzip_comp_level <span class="token number">5</span><span class="token punctuation">;</span>
gzip_min_length 1k<span class="token punctuation">;</span>
gzip_types text/plain application/javascript application/x-javascript text/cssapplication/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png<span class="token punctuation">;</span>
gzip_vary on<span class="token punctuation">;</span>
gzip_buffers <span class="token number">128</span> 4k<span class="token punctuation">;</span> <span class="token comment"># 压缩缓存  压成512M</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="关于favicon-ico"><a href="#关于favicon-ico" class="header-anchor">#</a> 关于<strong>favicon.ico</strong></h5> <p>favicon.ico ⽂件是浏览器收藏⽹址时显⽰的图标，当客⼾端使⽤浏览器问⻚⾯时，浏览器会⾃⼰主动发起请求获取 ⻚⾯的favicon.ico⽂件，但是当浏览器请求的favicon.ico⽂件不存在时，服务器会记录404⽇志，⽽且浏览器也会 显⽰404报错。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 将图标保存到指定目录访问:</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># vim linux39.conf</span>
location <span class="token operator">=</span> /favicon.ico <span class="token punctuation">{</span>
           root /data/nginx/static<span class="token punctuation">;</span>
           expires 90d<span class="token punctuation">;</span> <span class="token comment">#设置文件过期时间</span>
        <span class="token punctuation">}</span>
<span class="token comment"># 图片上传        </span>
root@ubuntu1:/data/nginx/static<span class="token comment"># ll</span>
total <span class="token number">32</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">16958</span> Oct <span class="token number">16</span> 09:29 favicon.ico
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="隐藏nginx版本号"><a href="#隐藏nginx版本号" class="header-anchor">#</a> 隐藏Nginx版本号</h5> <p>更改nginx源码信息并重新编译Nginx</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code> <span class="token comment"># 路径是源码目录下的</span>
 root@ubuntu1:/usr/local/src/nginx-1.16.1<span class="token comment"># vim src/http/ngx_http_header_filter_module.c</span>
root@ubuntu1:/usr/local/src/nginx-1.16.1<span class="token comment"># pwd</span>
/usr/local/src/nginx-1.16.1
 <span class="token number">49</span> static u_char ngx_http_server_string<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Server: linux39&quot;</span> CRLF<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 然后重新编译即可</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="升级openssl版本"><a href="#升级openssl版本" class="header-anchor">#</a> 升级<strong>OpenSSL</strong>版本</h5> <p>​		⼼脏出⾎（英语：Heartbleed），也简称为⼼⾎漏洞，是⼀个出现在加密程序库OpenSSL的安全漏洞，该程序库 ⼴泛⽤于实现互联⽹的传输层安全（TLS）协议。它于2012年被引⼊了软件中，2014年4⽉⾸次向公众披露。只要 使⽤的是存在缺陷的OpenSSL实例，⽆论是服务器还是客⼾端，都可能因此⽽受到攻击。此问题的原因是在实现TLS的⼼跳扩展时没有对输⼊进⾏适当验证（缺少边界检查），因此漏洞的名称来源于“⼼跳”（heartbeat）。该程 序错误属于缓冲区过读，即可以读取的数据⽐应该允许读取的还多</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 下载源码包</span>
root@ubuntu1:/usr/local/src<span class="token comment"># wget https://www.openssl.org/source/openssl-1.1.1l.tar.gz</span>
<span class="token comment"># 解压源码包</span>
root@ubuntu1:/usr/local/src/nginx-1.16.1<span class="token comment"># tar xf openssl-1.1.1l.tar.gz</span>
<span class="token comment"># 开始编译</span>
root@ubuntu1:/usr/local/src/nginx-1.16.1<span class="token comment"># ./configure  --prefix=/apps/nginx --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_addition_module --with-http_image_filter_module --with-http_geoip_module --with-http_gunzip_module --with-http_stub_status_module --with-http_gzip_static_module --with-pcre --with-stream --with-stream_ssl_module --with-stream_realip_module --with-http_stub_status_module --add-module=/usr/local/src/echo-nginx-module-0.61  --with-openssl=/usr/local/src/openssl-1.1.1l</span>
root@ubuntu1:/usr/local/src/nginx-1.16.1<span class="token comment"># make &amp;&amp; make install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 查看是否编译成功</span>
root@ubuntu1:/usr/local/src/nginx-1.16.1<span class="token comment"># /apps/nginx/sbin/nginx -V</span>
nginx version: nginx/1.16.1
built by gcc <span class="token number">7.5</span>.0 <span class="token punctuation">(</span>Ubuntu <span class="token number">7.5</span>.0-3ubuntu1~18.04<span class="token punctuation">)</span>
built with OpenSSL <span class="token number">1.1</span>.1l  <span class="token number">24</span> Aug <span class="token number">2021</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="rewrite相关功能"><a href="#rewrite相关功能" class="header-anchor">#</a> <strong>Rewrite</strong>相关功能</h4> <p>​	Nginx服务器利⽤ngx_http_rewrite_module 模块解析和处理rewrite请求，此功能依靠 PCRE(perl compatibleregularexpression)，因此编译之前要安装PCRE库，rewrite是nginx服务器的重要功能之⼀，⽤于实现URL的重 写，URL的重写是⾮常有⽤的功能，⽐如它可以在我们改变⽹站结构之后，不需要客⼾端修改原来的书签，也⽆需 其他⽹站修改我们的链接，就可以设置为访问，另外还可以在⼀定程度上提⾼⽹站的安全性</p> <h5 id="if指令"><a href="#if指令" class="header-anchor">#</a> if指令</h5> <p>⽤于条件匹配判断，并根据条件判断结果选择不同的Nginx配置，可以配置在server或location块中进⾏配置，Nginx的if语法仅能使⽤if做单次判断，不⽀持使⽤if else或者if elif这样的多重判断，⽤法如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token keyword">if</span> （条件匹配） <span class="token punctuation">{</span>
action 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>使⽤正则表达式对变量进⾏匹配，匹配成功时if指令认为条件为true，否则认为false，变量与表达式之间使⽤以下 符号链接：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token operator">=</span>： <span class="token comment">#⽐较变量和字符串是否相等，相等时if指令认为该条件为true，反之为false。</span>
<span class="token operator">!=</span>: <span class="token comment">#⽐较变量和字符串是否不相等，不相等时if指令认为条件为true，反之为false。</span>
~： <span class="token comment">#表⽰在匹配过程中区分⼤⼩写字符，（可以通过正则表达式匹配），满⾜匹配条件为真，不满⾜为假。 </span>
<span class="token operator">!</span>~：<span class="token comment">#为区分⼤⼩写字符且匹配结果不匹配，不满⾜为真，满⾜为假。</span>
~*: <span class="token comment">#表⽰在匹配过程中不区分⼤⼩写字符，（可以通过正则表达式匹配），满⾜匹配条件为真，不满⾜为假。 </span>
<span class="token operator">!</span>~*: <span class="token comment">#为不区分⼤⼩字符且匹配结果不匹配，满⾜为假，不满⾜为真。</span>
<span class="token parameter variable">-f</span> 和 <span class="token operator">!</span> -f: <span class="token comment">#判断请求的⽂件是否存在和是否不存在 </span>
<span class="token parameter variable">-d</span> 和 <span class="token operator">!</span> -d: <span class="token comment">#判断请求的⽬录是否存在和是否不存在。</span>
<span class="token parameter variable">-x</span> 和 <span class="token operator">!</span> -x: <span class="token comment">#判断⽂件是否可执⾏和是否不可执⾏。 </span>
<span class="token parameter variable">-e</span> 和 <span class="token operator">!</span> -e: <span class="token comment">#判断请求的⽂件或⽬录是否存在和是否不存在(包括⽂件，⽬录，软链接)。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="rewrite-flflag使用介绍"><a href="#rewrite-flflag使用介绍" class="header-anchor">#</a> <strong>rewrite flflag</strong>使⽤介绍</h5> <p>利⽤nginx的rewrite的指令，可以实现url的重新跳转，rewrtie有四种不同的flflag，分别是redirect(临时重定向)、permanent(永久重定向)、break和last。其中前两种是跳转型的flflag，后两种是代理型，跳转型是指有客⼾端浏览 器重新对新地址进⾏请求，代理型是在WEB服务器内部实现跳转的。</p> <p>Syntax: rewrite regex replacement [flflag]; #通过正则表达式处理⽤⼾请求并返回替换后的数据包。 Default: —Context: server, location, if</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redirect； 
<span class="token comment">#临时重定向，重写完成后以临时重定向⽅式直接返回重写后⽣成的新URL给客⼾端，由客⼾端重新发起请求；使⽤相对 路径,或者http://或https://开头，状态码：302</span>
permanent； 
<span class="token comment">#重写完成后以永久重定向⽅式直接返回重写后⽣成的新URL给客⼾端，由客⼾端重新发起请求，状态码：301</span>
last； 
<span class="token comment">#重写完成后停⽌对当前URI在当前location中后续的其它重写操作，⽽后对新的URL启动新⼀轮重写检查，不建议在 location中使⽤</span>
break； 
<span class="token comment">#重写完成后停⽌对当前URL在当前location中后续的其它重写操作，⽽后直接将匹配结果返还给客⼾端即结束循环并 返回数据给客⼾端，建议在location中使⽤</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="域名永久与临时重定向"><a href="#域名永久与临时重定向" class="header-anchor">#</a> 域名永久与临时重定向</h5> <p>要求：因业务需要，将访问源域名 www.xiaomao.com 的请求永久重定向到www.xiaomao.net 。 临时重定向不会缓存域名解析记录(A记录)，但是永久重定向会缓存。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># vim linux39.conf</span>
<span class="token comment"># 编辑nginx配置文件</span>
location / <span class="token punctuation">{</span>
            default_type text/html<span class="token punctuation">;</span>
            root   /data/nginx/html/pc<span class="token punctuation">;</span>
            index  index.html  index.htm<span class="token punctuation">;</span>
            <span class="token comment"># 域名重定向配置</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$host</span> <span class="token operator">=</span> www.xiaomao.com <span class="token punctuation">)</span><span class="token punctuation">{</span>
                  <span class="token comment"># rewrite /(.*)  http://www.xiaomao.net/$1 permanent;</span>
                   rewrite /<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>  http://www.xiaomao.net/<span class="token variable">$1</span> redirect<span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token comment"># 重启并访问测试</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h5 id="rewrite案例-brak"><a href="#rewrite案例-brak" class="header-anchor">#</a> <strong>rewrite</strong>案例**--brak**</h5> <p>要求：访问about的请求被转发⾄images，⽽访问images传递请求再次被转发⾄images1，以此测试last和break分别有什么区别：</p> <p>break测试案例：当客⼾端访问break的时候，测试通过rewrite将URL重写为test1，然后再通过rewrite将test1 重写为test2测试两条write规则最终哪⼀条⽣效，并且测试重写后的URL会不会到其他location重新匹配</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># vim linux39.conf    </span>
    location /break<span class="token punctuation">{</span>
           root /data/nginx<span class="token punctuation">;</span>
           index index.html<span class="token punctuation">;</span>
           rewrite ^/break/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span> /test1/<span class="token variable">$1</span> <span class="token builtin class-name">break</span><span class="token punctuation">;</span>
           rewrite ^/test1/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span> /test2/<span class="token variable">$1</span> <span class="token builtin class-name">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        location <span class="token operator">=</span> /test1 <span class="token punctuation">{</span>
           index  index.html<span class="token punctuation">;</span>
           root   /data/nginx<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        location <span class="token operator">=</span> /test2 <span class="token punctuation">{</span>
            index index.html<span class="token punctuation">;</span>
            root /data/nginx<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
<span class="token comment">#break匹配成功后不再向下匹配，也不会跳转到其他的 location，即直接结束匹配并给客⼾端返回结果数据。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>break适⽤于不改变客⼾端访问⽅式，但是要将访问的⽬的URL做单次重写的场景，⽐如有V1/V2两个版本的⽹站前端 ⻚⾯并存，旧版本的⽹站数据已经保存到了statics不能丢失，但是要将访问新版本的资源重写到新的静态资源路径到 新的⽬录static：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code> root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># vim linux39.conf</span>
  location /statics <span class="token punctuation">{</span>
        root /data/nginx<span class="token punctuation">;</span>
        index index.html<span class="token punctuation">;</span>
        rewrite ^/statics/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span> /static/<span class="token variable">$1</span> <span class="token builtin class-name">break</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:/data/nginx/statics<span class="token comment"># cat /data/nginx/static/index.js</span>
<span class="token builtin class-name">test</span> v2
root@ubuntu1:/data/nginx/statics<span class="token comment"># cat /data/nginx/statics/index.js</span>
<span class="token builtin class-name">test</span>  v1
<span class="token comment"># 重启测试</span>
root@ubuntu1:/data/nginx/statics<span class="token comment"># curl http://www.xiaomao.com/statics/index.js</span>
<span class="token builtin class-name">test</span> v2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="nginx反向代理"><a href="#nginx反向代理" class="header-anchor">#</a> Nginx反向代理</h4> <p>反向代理：反向代理也叫reverse proxy，指的是代理外⽹⽤⼾的请求到内部的指定web服务器，并将数据返回给⽤ ⼾的⼀种⽅式，这是⽤的⽐较多的⼀种⽅式。</p> <p>Nginx除了可以在企业提供⾼性能的web服务之外，另外还可以将本⾝不具备的请求通过某种预定义的协议转发⾄ 其它服务器处理，不同的协议就是Nginx服务器与其他服务器进⾏通信的⼀种规范，主要在不同的场景使⽤以下模 块实现不同的功能</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ngx_http_proxy_module： 将客⼾端的请求以http协议转发⾄指定服务器进⾏处理。<span class="token punctuation">(</span>java apache nginx 应用层 rewrite <span class="token punctuation">)</span> 
ngx_stream_proxy_module：将客⼾端的请求以tcp协议转发⾄指定服务器处理。<span class="token punctuation">(</span>用于mysql  redis<span class="token punctuation">)</span> 
ngx_http_fastcgi_module：将客⼾端对php的请求以fastcgi协议转发⾄指定服务器助理。<span class="token punctuation">(</span>fastcgi<span class="token punctuation">)</span> ngx_http_uwsgi_module：将客⼾端对Python的请求以uwsgi协议转发⾄指定服务器处理。<span class="token punctuation">(</span>python<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="实现http反向代理"><a href="#实现http反向代理" class="header-anchor">#</a> 实现http反向代理</h5> <p>要求：将⽤⼾对域 www.nagedu.net 的请求转发值后端服务器处理，官⽅⽂档： https://nginx.org/en/docs/http/ngx_http_proxy_module.html，</p> <p>环境准备</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">10.2</span>.32.10  ubuntu1 <span class="token comment">#Nginx 代理服务器 </span>
<span class="token number">10.2</span>.32.11  ubuntu2 <span class="token comment">#后端web A，Apache部署 </span>
<span class="token number">10.2</span>.32.12 ubuntu3 <span class="token comment">#后端web B，Apache部署</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>部署安装apache</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu2:~<span class="token comment"># apt install apache2</span>
root@ubuntu2:~<span class="token comment"># echo &quot;web1 10.2.32.11&quot; &gt; /var/www/html/index.html</span>
root@ubuntu2:~<span class="token comment"># systemctl start apache2 &amp;&amp; systemctl enable apache2</span>

root@ubuntu3:~<span class="token comment"># apt install apache2</span>
root@ubuntu3:~<span class="token comment"># echo &quot;web2 10.2.32.12&quot; &gt; /var/www/html/index.html</span>
root@ubuntu3:~<span class="token comment"># systemctl start apache2 &amp;&amp; systemctl enable apache2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>Nginx http</strong> 反向代理⼊⻔</p> <p>官⽅⽂档：https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 测试 </span>
root@ubuntu2:~<span class="token comment"># mkdir /var/www/html/app</span>
root@ubuntu2:~<span class="token comment"># echo &quot;web 10.2.32.11&quot; &gt;  /var/www/html/app/index.html</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 反向代理参数</span>
proxy_pass； <span class="token comment">#⽤来设置将客⼾端请求转发给的后端服务器的主机，可以是主机名、IP地址：端⼝的⽅式，也可以代理到预先设置的 主机群组，需要模块gx_http_upstream_module⽀持。</span>
 location /app <span class="token punctuation">{</span>
            index  index.html<span class="token punctuation">;</span>
            <span class="token comment">#不带斜线将访问的/app,等于访问后端服务器s http://10.2.32.11:80/app/index.html，即后端服务 器配置的站点根⽬录要有app⽬录才可以被访问，这是⼀个追加/web到后端服务器 http://servername:port/app/INDEX.HTML的操作  </span>
            proxy_pass http://10.2.32.11:80<span class="token punctuation">;</span> <span class="token comment"># 标准测试</span>
            
           <span class="token comment"># proxy_pass http://10.2.32.11:80/; #带斜线，等于访问后端服务器的http://10.2.32.11:80/index.html 内容返回给客⼾端</span>
         <span class="token punctuation">}</span>
 <span class="token comment"># 重启nginx测试访问  标准测试</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># curl http://www.xiaomao.com/app</span>
web <span class="token number">10.2</span>.32.11
<span class="token comment"># 加了/后测试</span>
 location /app <span class="token punctuation">{</span>
            index  index.html<span class="token punctuation">;</span>
            proxy_pass http://10.2.32.11:80/<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># curl http://www.xiaomao.com/app</span>
web1 <span class="token number">10.2</span>.32.11
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>proxy_pass_header field<span class="token punctuation">;</span> <span class="token comment">#默认nginx在响应报⽂中不传递后端服务器的⾸部字段Date, Server, X-Pad, X-Accel等参数，如果要传递的 话则要使⽤ proxy_pass_header field声明将后端服务器返回的值传递给客⼾端。显示后端服务器版本号信息</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>proxy_hide_header field<span class="token punctuation">;</span> <span class="token comment">#⽤于nginx作为反向代理的时候，在返回给客⼾端http响应的时候，隐藏后端服务版本相应头部的信息，可以设置在 http/server或location块，</span>

<span class="token comment">#配置</span>
 location /app <span class="token punctuation">{</span>
            index  index.html<span class="token punctuation">;</span>
            proxy_pass http://10.2.32.11:80/<span class="token punctuation">;</span>
            proxy_hide_header Etag<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>proxy_connect_timeout <span class="token function">time</span><span class="token punctuation">;</span>
<span class="token comment">#配置nginx服务器与后端服务器尝试建⽴连接的超时时间，默认为60秒，⽤法如下：</span>
proxy_connect_timeout 60s； <span class="token comment">#60s为⾃定义nginx与后端服务器建⽴连接的超时时间</span>
proxy_read_timeout time； <span class="token comment">#配置nginx服务器向后端服务器或服务器组发起read请求后，等待的超时时间，默认60s </span>
proxy_send_timeout time； <span class="token comment">#配置nginx项后端服务器或服务器组发起write请求后，等待的超时时间，默认60s</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>proxy_ignore_client_abort off；
<span class="token comment">#当客⼾端⽹络中断请求时，nginx服务器中断其对后端服务器的请求。即如果此项设置为on开启，则服务器会忽略客 ⼾端中断并⼀直等着代理服务执⾏返回，如果设置为off，则客⼾端中断后Nginx也会中断客⼾端请求并⽴即记录499⽇ 志，默认为off。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>proxy_headers_hash_bucket_size <span class="token number">128</span>； <span class="token comment">#当配置了 proxy_hide_header和proxy_set_header的时候，⽤于设置nginx保存HTTP报⽂头的hash表的上 限。</span>
proxy_headers_hash_max_size <span class="token number">512</span>； <span class="token comment">#设置proxy_headers_hash_bucket_size的最⼤可⽤空间</span>
server_namse_hash_bucket_size <span class="token number">512</span><span class="token punctuation">;</span> <span class="token comment">#server_name hash表申请空间⼤⼩</span>
server_names_hash_max_szie <span class="token number">512</span><span class="token punctuation">;</span> <span class="token comment">#设置服务器名称hash表的上限⼤⼩</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="反向代理缓存功能"><a href="#反向代理缓存功能" class="header-anchor">#</a> 反向代理缓存功能</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 缓存功能默认关闭状态</span>
proxy_cache zone <span class="token operator">|</span> off<span class="token punctuation">;</span> 默认off <span class="token comment">#指明调⽤的缓存，或关闭缓存机制；Context:http, server, location</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>proxy_cache_key string<span class="token punctuation">;</span> 
<span class="token comment">#缓存中⽤于“键”的内容，默认值：proxy_cache_key $scheme$proxy_host$request_uri;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>proxy_cache_valid <span class="token punctuation">[</span>code <span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token function">time</span><span class="token punctuation">;</span> <span class="token comment">#定义对特定响应码的响应内容的缓存时⻓，定义在http{...}中</span>
⽰例: proxy_cache_valid <span class="token number">200</span> <span class="token number">302</span> 10m<span class="token punctuation">;</span> 
     proxy_cache_valid <span class="token number">404</span> 1m<span class="token punctuation">;</span>
     proxy_cache_path<span class="token punctuation">;</span>
定义可⽤于proxy功能的缓存；Context:http proxy_cache_path path <span class="token punctuation">[</span>levels<span class="token operator">=</span>levels<span class="token punctuation">]</span> <span class="token punctuation">[</span>use_temp_path<span class="token operator">=</span>on<span class="token operator">|</span>off<span class="token punctuation">]</span> <span class="token assign-left variable">keys_zone</span><span class="token operator">=</span>name:size <span class="token punctuation">[</span>inactive<span class="token operator">=</span>time<span class="token punctuation">]</span> <span class="token punctuation">[</span>max_size<span class="token operator">=</span>size<span class="token punctuation">]</span> <span class="token punctuation">[</span>manager_files<span class="token operator">=</span>number<span class="token punctuation">]</span> <span class="token punctuation">[</span>manager_sleep<span class="token operator">=</span>time<span class="token punctuation">]</span> <span class="token punctuation">[</span>manager_threshold<span class="token operator">=</span>time<span class="token punctuation">]</span> <span class="token punctuation">[</span>loader_files<span class="token operator">=</span>number<span class="token punctuation">]</span> <span class="token punctuation">[</span>loader_sleep<span class="token operator">=</span>time<span class="token punctuation">]</span> <span class="token punctuation">[</span>loader_threshold<span class="token operator">=</span>time<span class="token punctuation">]</span> <span class="token punctuation">[</span>purger<span class="token operator">=</span>on<span class="token operator">|</span>off<span class="token punctuation">]</span> <span class="token punctuation">[</span>purger_files<span class="token operator">=</span>number<span class="token punctuation">]</span> <span class="token punctuation">[</span>purger_sleep<span class="token operator">=</span>time<span class="token punctuation">]</span> <span class="token punctuation">[</span>purger_threshold<span class="token operator">=</span>time<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># ⽰例：在http配置定义缓存信息</span>
proxy_cache_path /var/cache/nginx/proxy_cache <span class="token comment">#定义缓存保存路径，proxy_cache会⾃动创建</span>
<span class="token assign-left variable">levels</span><span class="token operator">=</span><span class="token number">1</span>:2:2 <span class="token comment">#定义缓存⽬录结构层次，1:2:2可以⽣成2^4x2^8x2^8=1048576个⽬录</span>
<span class="token assign-left variable">keys_zone</span><span class="token operator">=</span>proxycache:20m <span class="token comment">#指内存中缓存的⼤⼩，主要⽤于存放key和metadata（如：使⽤次数）</span>
<span class="token assign-left variable">inactive</span><span class="token operator">=</span>120s； <span class="token comment">#缓存有效时间</span>
<span class="token assign-left variable">max_size</span><span class="token operator">=</span>1g<span class="token punctuation">;</span> <span class="token comment">#最⼤磁盘占⽤空间，磁盘存⼊⽂件内容的缓存空间最⼤值</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#调⽤缓存功能，需要定义在相应的配置段，如server{...}；或者location等</span>
proxy_cache proxycache<span class="token punctuation">;</span>
proxy_cache_key <span class="token variable">$request_uri</span><span class="token punctuation">;</span>
proxy_cache_valid <span class="token number">200</span> <span class="token number">302</span> <span class="token number">301</span> 10m<span class="token punctuation">;</span> <span class="token comment">#指定的状态码返回的数据缓存多⻓时间</span>
proxy_cache_valid any 1m<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>proxy_cache_use_stale error http_502 http_503<span class="token punctuation">;</span>
<span class="token comment">#在被代理的后端服务器出现哪种情况下，可直接使⽤过期的缓存响应客⼾端，</span>
proxy_cache_use_stale error <span class="token operator">|</span> <span class="token function">timeout</span> <span class="token operator">|</span> invalid_header <span class="token operator">|</span> updating <span class="token operator">|</span> http_500 <span class="token operator">|</span> http_502
<span class="token operator">|</span> http_503 <span class="token operator">|</span> http_504 <span class="token operator">|</span> http_403 <span class="token operator">|</span> http_404 <span class="token operator">|</span> off <span class="token punctuation">;</span> <span class="token comment">#默认是off</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>proxy_cache_methods GET <span class="token operator">|</span> HEAD <span class="token operator">|</span> POST <span class="token punctuation">..</span>.<span class="token punctuation">;</span> 
<span class="token comment">#对哪些客⼾端请求⽅法对应的响应进⾏缓存，GET和HEAD⽅法总是被缓存</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="非缓存场景压测"><a href="#非缓存场景压测" class="header-anchor">#</a> 非缓存场景压测</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 准备测试页面</span>
root@ubuntu3:/var/www/html<span class="token comment"># ll -h</span>
total <span class="token number">3</span>.9M
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">4</span>.0K Oct <span class="token number">24</span> <span class="token number">14</span>:38 ./
drwxr-xr-x <span class="token number">3</span> root root <span class="token number">4</span>.0K Oct <span class="token number">19</span> <span class="token number">14</span>:32 <span class="token punctuation">..</span>/
-rw-r--r-- <span class="token number">1</span> root root   <span class="token number">16</span> Oct <span class="token number">19</span> <span class="token number">14</span>:36 index.html
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">3</span>.9M Oct <span class="token number">24</span> <span class="token number">14</span>:38 lotus.log
root@ubuntu3:/var/www/html<span class="token comment"># ab -n 2000 -c200 http://www.xiaomao.com/app/lotus.log</span>
Concurrency Level:      <span class="token number">200</span>
Time taken <span class="token keyword">for</span> tests:   <span class="token number">0.428</span> seconds
Complete requests:      <span class="token number">2000</span>
Failed requests:        <span class="token number">0</span>
Non-2xx responses:      <span class="token number">2000</span>
Total transferred:      <span class="token number">914000</span> bytes
HTML transferred:       <span class="token number">554000</span> bytes
Requests per second:    <span class="token number">4674.60</span> <span class="token punctuation">[</span><span class="token comment">#/sec] (mean)</span>
Time per request:       <span class="token number">42.784</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean<span class="token punctuation">)</span>
Time per request:       <span class="token number">0.214</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean, across all concurrent requests<span class="token punctuation">)</span>
Transfer rate:          <span class="token number">2086.22</span> <span class="token punctuation">[</span>Kbytes/sec<span class="token punctuation">]</span> received
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h5 id="准备缓存配置"><a href="#准备缓存配置" class="header-anchor">#</a> 准备缓存配置</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:~<span class="token comment"># vim /apps/nginx/conf/nginx.conf</span>
http<span class="token punctuation">{</span>
 proxy_cache_path /apps/nginx/proxycache <span class="token assign-left variable">levels</span><span class="token operator">=</span><span class="token number">1</span>:2:2 <span class="token assign-left variable">keys_zone</span><span class="token operator">=</span>proxycache:20m <span class="token assign-left variable">inactive</span><span class="token operator">=</span>120s <span class="token assign-left variable">max_size</span><span class="token operator">=</span>1g<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 调用缓存</span>
root@ubuntu1:/apps/nginx/proxycache<span class="token comment"># vim /apps/nginx/conf/conf.d/linux39.conf</span>
location /app <span class="token punctuation">{</span>
            index  index.html<span class="token punctuation">;</span>
            proxy_pass http://10.2.32.12/<span class="token punctuation">;</span>
            proxy_cache proxycache<span class="token punctuation">;</span>
            proxy_cache_key <span class="token variable">$request_uri</span><span class="token punctuation">;</span>
            proxy_cache_valid <span class="token number">200</span> <span class="token number">302</span> <span class="token number">301</span> 10m<span class="token punctuation">;</span>
            proxy_cache_valid any 1m<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 访问并验证缓存文件</span>
root@ubuntu3:/var/www/html<span class="token comment"># ab -n 80000 -c200 http://www.xiaomao.com/app/</span>
Concurrency Level:      <span class="token number">200</span>
Time taken <span class="token keyword">for</span> tests:   <span class="token number">26.240</span> seconds
Complete requests:      <span class="token number">80000</span>
Failed requests:        <span class="token number">0</span>
Non-2xx responses:      <span class="token number">80000</span>
Total transferred:      <span class="token number">36560000</span> bytes
HTML transferred:       <span class="token number">22160000</span> bytes
Requests per second:    <span class="token number">3048.75</span> <span class="token punctuation">[</span><span class="token comment">#/sec] (mean)</span>
Time per request:       <span class="token number">65.601</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean<span class="token punctuation">)</span>
Time per request:       <span class="token number">0.328</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean, across all concurrent requests<span class="token punctuation">)</span>
Transfer rate:          <span class="token number">1360.62</span> <span class="token punctuation">[</span>Kbytes/sec<span class="token punctuation">]</span> received
<span class="token comment">#验证缓存⽬录结构及⽂件⼤⼩</span>
root@ubuntu1:~<span class="token comment"># tree /apps/nginx/proxycache/</span>
/apps/nginx/proxycache/
├── <span class="token number">1</span>
│   └── <span class="token number">7</span>
│       └── <span class="token number">5</span>
├── <span class="token number">3</span>
│   └── <span class="token number">6</span>
│       └── <span class="token number">0</span>
└── a
    └── <span class="token number">7</span>
        └── e
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h5 id="添加头部报文信息"><a href="#添加头部报文信息" class="header-anchor">#</a> 添加头部报文信息</h5> <p>nginx基于模块ngx_http_headers_module可以实现对头部报⽂添加指定的key与值， https://nginx.org/en/docs/http/ngx_http_headers_module.html</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#添加⾃定义⾸部，如下：</span>
add_header name value <span class="token punctuation">[</span>always<span class="token punctuation">]</span><span class="token punctuation">;</span>
	add_header X-Via <span class="token variable">$server_addr</span><span class="token punctuation">;</span>
	add_header X-Cache <span class="token variable">$upstream_cache_status</span><span class="token punctuation">;</span>
	add_header X-Accel <span class="token variable">$server_name</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># nginx配置</span>
root@ubuntu1:/apps/nginx/conf/conf.d<span class="token comment"># vim linux39.conf</span>
    location /app <span class="token punctuation">{</span>
            index  index.html<span class="token punctuation">;</span>
            proxy_pass http://10.2.32.12/<span class="token punctuation">;</span>
            add_header X-Via <span class="token variable">$server_addr</span><span class="token punctuation">;</span>
            add_header X-Cache <span class="token variable">$upstream_cache_status</span><span class="token punctuation">;</span>
            add_header X-Accel <span class="token variable">$server_name</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 验证头部信息   第一次访问没有缓存</span>
root@ubuntu1:~<span class="token comment"># curl -I http://www.xiaomao.com/app</span>
HTTP/1.1 <span class="token number">200</span> OK
Server: linux39
Date: Mon, <span class="token number">25</span> Oct <span class="token number">2021</span> 07:41:46 GMT
Content-Type: text/html<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
Content-Length: <span class="token number">4040629</span>
Connection: keep-alive
Vary: Accept-Encoding
Last-Modified: Sun, <span class="token number">24</span> Oct <span class="token number">2021</span> <span class="token number">14</span>:38:05 GMT
ETag: <span class="token string">&quot;3da7b5-5cf1a3131cd40&quot;</span>
Vary: Accept-Encoding
X-Via: <span class="token number">127.0</span>.0.1
X-Cache: MISS
X-Accel: www.xiaomao.com
Accept-Ranges: bytes
<span class="token comment"># 第二次访问  有缓存 X-Cache: HIT</span>
root@ubuntu1:~<span class="token comment"># curl -I http://www.xiaomao.com/app</span>
HTTP/1.1 <span class="token number">200</span> OK
Server: linux39
Date: Mon, <span class="token number">25</span> Oct <span class="token number">2021</span> 07:42:26 GMT
Content-Type: text/html<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
Content-Length: <span class="token number">4040629</span>
Connection: keep-alive
Vary: Accept-Encoding
Last-Modified: Sun, <span class="token number">24</span> Oct <span class="token number">2021</span> <span class="token number">14</span>:38:05 GMT
ETag: <span class="token string">&quot;3da7b5-5cf1a3131cd40&quot;</span>
Vary: Accept-Encoding
X-Via: <span class="token number">127.0</span>.0.1
X-Cache: HIT
X-Accel: www.xiaomao.com
Accept-Ranges: bytes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h5 id="http-upstream配置参数"><a href="#http-upstream配置参数" class="header-anchor">#</a> <strong>http upstream</strong>配置参数</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#配置⼀个后端web服务器，配置在upstream内，⾄少要有⼀个server服务器配置。</span>
upstream name <span class="token punctuation">{</span> 

<span class="token punctuation">}</span>
<span class="token comment">#⾃定义⼀组服务器，配置在http内</span>
server address <span class="token punctuation">[</span>parameters<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#server⽀持的parameters如下：</span>
<span class="token assign-left variable">weight</span><span class="token operator">=</span>number <span class="token comment">#设置权重，默认为1。</span>
<span class="token assign-left variable">max_conns</span><span class="token operator">=</span>number <span class="token comment">#给当前server设置最⼤活动链接数，默认为0表⽰没有限制。 </span>
<span class="token assign-left variable">max_fails</span><span class="token operator">=</span>number <span class="token comment">#对后端服务器连续监测失败多少次就标记为不可⽤。</span>
<span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>time <span class="token comment">#对后端服务器的单次监测超时时间，默认为10秒。 </span>
backup <span class="token comment">#设置为备份服务器，当所有服务器不可⽤时将重新启⽤次服务器。</span>
down <span class="token comment">#标记为down状态。</span>
resolve <span class="token comment">#当server定义的是主机名的时候，当A记录发⽣变化会⾃动应⽤新IP⽽不⽤重启Nginx。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">hash</span> KEY consistent；
<span class="token comment">#基于指定key做hash计算，使⽤consistent参数，将使⽤ketama⼀致性hash算法，适⽤于后端是Cache服务器 （如varnish）时使⽤，consistent定义使⽤⼀致性hash运算，⼀致性hash基于取模运算。</span>
<span class="token builtin class-name">hash</span> <span class="token variable">$request_uri</span> consistent<span class="token punctuation">;</span> <span class="token comment">#基于⽤⼾请求的uri做hash</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ip_hash； <span class="token comment">#源地址hash调度⽅法，基于的客⼾端的remote_addr(源地址)做hash计算，以实现会话保持，</span>
least_conn<span class="token punctuation">;</span> <span class="token comment">#最少连接调度算法，优先将客⼾端请求调度到当前连接最少的后端服务器</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 反向代理多台web服务器</span>
root@ubuntu1:~<span class="token comment"># vim /apps/nginx/conf/conf.d/linux39.conf</span>
upstream webserver<span class="token punctuation">{</span>
        server <span class="token number">10.2</span>.32.11:88   <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>5s <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
        server <span class="token number">10.2</span>.32.12:80   <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>5s <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
server<span class="token punctuation">{</span>
	location /app <span class="token punctuation">{</span>
            index  index.html<span class="token punctuation">;</span>
            proxy_pass http://webserver/<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 测试</span>
root@ubuntu1:~<span class="token comment"># curl http://www.xiaomao.com/app/index.html</span>
app <span class="token number">10.2</span>.32.11
root@ubuntu1:~<span class="token comment"># curl http://www.xiaomao.com/app/index.html</span>
app <span class="token number">10.2</span>.32.12
root@ubuntu1:~<span class="token comment"># curl http://www.xiaomao.com/app/index.html</span>
app <span class="token number">10.2</span>.32.11
root@ubuntu1:~<span class="token comment"># curl http://www.xiaomao.com/app/index.html</span>
app <span class="token number">10.2</span>.32.12
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="负载均衡实例-mysql"><a href="#负载均衡实例-mysql" class="header-anchor">#</a> 负载均衡实例：<strong>MySQL</strong></h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu3:~<span class="token comment"># apt install mysql-server</span>
<span class="token comment"># 编辑配置文件</span>
root@ubuntu1:/apps/nginx/conf/tcp<span class="token comment"># cat tcp.conf</span>
stream <span class="token punctuation">{</span>
        upstream linux39-mysql <span class="token punctuation">{</span>
                server <span class="token number">10.2</span>.32.12:3306 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">3</span>  <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>30s<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        server<span class="token punctuation">{</span>
                listen <span class="token number">10.2</span>.32.10:3306<span class="token punctuation">;</span>  <span class="token comment">#客户端访问这个地址然后反代到10.2.32.12上</span>
                proxy_pass  linux39-mysql<span class="token punctuation">;</span> <span class="token comment"># 转发到具体服务器组</span>
                proxy_connect_timeout 1s<span class="token punctuation">;</span> <span class="token comment">#连接超时时间</span>
                proxy_timeout 3s<span class="token punctuation">;</span> <span class="token comment">#转发超时时间</span>
                
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@ubuntu1:/apps/nginx/conf/tcp<span class="token comment"># vim /apps/nginx/conf/nginx.conf</span>
<span class="token comment"># 在http外导入</span>
inclued /apps/nginx/conf/tcp/*.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 重启并查看MySQL端口</span>
root@ubuntu1:/apps/nginx/conf/tcp<span class="token comment"># systemctl restart nginx</span>
root@ubuntu1:/apps/nginx/conf/tcp<span class="token comment"># ss -ntl</span>
State                    Recv-Q                    Send-Q                                        Local Address:Port                                       Peer Address:Port
LISTEN                   <span class="token number">0</span>                         <span class="token number">128</span>                                              <span class="token number">10.2</span>.32.10:3306                                            <span class="token number">0.0</span>.0.0:*
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="系统参数优化"><a href="#系统参数优化" class="header-anchor">#</a> 系统参数优化</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>默认的Linux内核参数考虑的是最通⽤场景，不符合⽤于⽀持⾼并发访问的Web服务器的定义，根据业务特点来进⾏调 整，当Nginx作为静态web内容服务器、反向代理或者提供压缩服务器的服务器时，内核参数的调整都是不同的，此处 针对最通⽤的、使Nginx⽀持更多并发请求的TCP⽹络参数做简单的配置,修改/etc/sysctl.conf来更改内核参数

net.ipv4.ip_nonlocal_bind <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">#允许⾮本地IP地址socket监听 </span>
net.ipv4.ip_forward <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">#开启IPv4转发 </span>
net.ipv4.tcp_timestamps <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">#是否开启数据包时间戳 </span>
net.ipv4.tcp_tw_reuse <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">#端⼝复⽤ </span>
net.ipv4.tcp_tw_recycle <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">#快速回收TIME_WAIT状态，⽤于⼤量TIME_OUT场景</span>

fs.file-max <span class="token operator">=</span> <span class="token number">1000000</span> <span class="token comment">#表⽰单个进程较⼤可以打开的句柄数</span>
net.ipv4.tcp_tw_reuse <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">#参数设置为 1 ，表⽰允许将TIME_WAIT状态的socket重新⽤于新的TCP链接，这对于服务器来说意义重⼤，因为总 有⼤量TIME_WAIT状态的链接存在</span>
net.ipv4.tcp_keepalive_time <span class="token operator">=</span> <span class="token number">600</span> <span class="token comment">#当keepalive启动时，TCP发送keepalive消息的频度；默认是2⼩时，将其设置为10分钟，可更快的清理⽆效链接</span>
net.ipv4.tcp_fin_timeout <span class="token operator">=</span> <span class="token number">30</span> <span class="token comment">#当服务器主动关闭链接时，socket保持在FIN_WAIT_2状态的较⼤时间</span>
net.ipv4.tcp_max_tw_buckets <span class="token operator">=</span> <span class="token number">5000</span> <span class="token comment">#表⽰操作系统允许TIME_WAIT套接字数量的较⼤值，如超过此值，TIME_WAIT套接字将⽴刻被清除并打印警告信息, 默认为8000，过多的TIME_WAIT套接字会使Web服务器变慢</span>

net.ipv4.tcp_rmem <span class="token operator">=</span> <span class="token number">10240</span> <span class="token number">87380</span> <span class="token number">12582912</span> <span class="token comment">#定义了TCP接受socket请求缓存的内存最⼩值、默认值、较⼤值</span>
net.ipv4.ip_local_port_range <span class="token operator">=</span> <span class="token number">1024</span> <span class="token number">65000</span> <span class="token comment">#定义UDP和TCP链接的本地端⼝的取值范围</span>
net.ipv4.tcp_wmem <span class="token operator">=</span> <span class="token number">10240</span> <span class="token number">87380</span> <span class="token number">12582912</span> <span class="token comment">#定义TCP发送缓存的最⼩值、默认值、较⼤值</span>
net.core.netdev_max_backlog <span class="token operator">=</span> <span class="token number">8096</span> <span class="token comment">#当⽹卡接收数据包的速度⼤于内核处理速度时，会有⼀个列队保存这些数据包。这个参数表⽰该列队的较⼤值</span>
<span class="token assign-left variable">net.core.somaxconn</span><span class="token operator">=</span><span class="token number">262114</span> <span class="token comment">#选项默认值是128，这个参数⽤于调节系统同时发起的TCP连接数，在⾼并发的请求中，默认的值可能会导致链接超时 或者重传，因此需要结合⾼并发请求数来调节此值。</span>
<span class="token assign-left variable">net.ipv4.tcp_max_orphans</span><span class="token operator">=</span><span class="token number">262114</span> <span class="token comment">#选项⽤于设定系统中最多有多少个TCP套接字不被关联到任何⼀个⽤⼾⽂件句柄上。如果超过这个数字，孤⽴链接将⽴ 即被复位并输出警告信息。这个限制指⽰为了防⽌简单的DOS攻击，不⽤过分依靠这个限制甚⾄认为的减⼩这个值，更 多的情况是增加这个值</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h1 id=""><a href="#" class="header-anchor">#</a></h1></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/lixuanfengs/cactus-vuepress-sc/edit/master/docs/03.手册/01.开发环境配置/01.负载均衡和web服务.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/06/22, 19:16:34</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><!----> <a href="/pages/d9927e/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">keepalibved安装与使用</div></a></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/pages/d9927e/">keepalibved安装与使用</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/118ac7/"><div>
            深圳仪器平台-开发手册记录
            <!----></div></a> <span class="date">01-25</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/6254d2/"><div>
            👋 该怎样设计一套“百万级API网关?”
            <!----></div></a> <span class="date">10-12</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/d9cb43/"><div>
            功能完善(算力关联、接口上报、调用反馈)
            <!----></div></a> <span class="date">10-09</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1183895890@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/lixuanfengs" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://cactusli.net" title="网站首页" target="_blank" class="iconfont icon-rss"></a><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=1183895890&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" class="iconfont icon-QQ"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2018-2024
    <span>Cactusli | <a href="https://github.com/lixuanfengs/cactus-vuepress/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div><div></div><div></div><div class="artalk"></div><canvas id="vuepress-canvas-cursor"></canvas><div></div><!----></div></div>
    <script src="/assets/js/app.d73578e6.js" defer></script><script src="/assets/js/2.f6444e8b.js" defer></script><script src="/assets/js/57.201a710e.js" defer></script><script src="/assets/js/13.9ca28764.js" defer></script><script src="/assets/js/6.0f00df03.js" defer></script><script src="/assets/js/5.1368437e.js" defer></script><script src="/assets/js/4.7c9e6596.js" defer></script>
  </body>
</html>
